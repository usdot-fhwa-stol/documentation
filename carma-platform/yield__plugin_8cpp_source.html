<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Carma-platform: yield_plugin/src/yield_plugin.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Carma-platform<span id="projectnumber">&#160;v4.2.0</span>
   </div>
   <div id="projectbrief">CARMA Platform is built on robot operating system (ROS) and utilizes open source software (OSS) that enables Cooperative Driving Automation (CDA) features to allow Automated Driving Systems to interact and cooperate with infrastructure and other vehicles through communication.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('yield__plugin_8cpp_source.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle"><div class="title">yield_plugin.cpp</div></div>
</div><!--header-->
<div class="contents">
<a href="yield__plugin_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a id="l00001" name="l00001"></a><span class="lineno">    1</span><span class="comment">/*</span></div>
<div class="line"><a id="l00002" name="l00002"></a><span class="lineno">    2</span><span class="comment"> * Copyright (C) 2022 LEIDOS.</span></div>
<div class="line"><a id="l00003" name="l00003"></a><span class="lineno">    3</span><span class="comment"> *</span></div>
<div class="line"><a id="l00004" name="l00004"></a><span class="lineno">    4</span><span class="comment"> * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); you may not</span></div>
<div class="line"><a id="l00005" name="l00005"></a><span class="lineno">    5</span><span class="comment"> * use this file except in compliance with the License. You may obtain a copy of</span></div>
<div class="line"><a id="l00006" name="l00006"></a><span class="lineno">    6</span><span class="comment"> * the License at</span></div>
<div class="line"><a id="l00007" name="l00007"></a><span class="lineno">    7</span><span class="comment"> *</span></div>
<div class="line"><a id="l00008" name="l00008"></a><span class="lineno">    8</span><span class="comment"> * http://www.apache.org/licenses/LICENSE-2.0</span></div>
<div class="line"><a id="l00009" name="l00009"></a><span class="lineno">    9</span><span class="comment"> *</span></div>
<div class="line"><a id="l00010" name="l00010"></a><span class="lineno">   10</span><span class="comment"> * Unless required by applicable law or agreed to in writing, software</span></div>
<div class="line"><a id="l00011" name="l00011"></a><span class="lineno">   11</span><span class="comment"> * distributed under the License is distributed on an &quot;AS IS&quot; BASIS, WITHOUT</span></div>
<div class="line"><a id="l00012" name="l00012"></a><span class="lineno">   12</span><span class="comment"> * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the</span></div>
<div class="line"><a id="l00013" name="l00013"></a><span class="lineno">   13</span><span class="comment"> * License for the specific language governing permissions and limitations under</span></div>
<div class="line"><a id="l00014" name="l00014"></a><span class="lineno">   14</span><span class="comment"> * the License.</span></div>
<div class="line"><a id="l00015" name="l00015"></a><span class="lineno">   15</span><span class="comment"> */</span></div>
<div class="line"><a id="l00016" name="l00016"></a><span class="lineno">   16</span> </div>
<div class="line"><a id="l00017" name="l00017"></a><span class="lineno">   17</span><span class="preprocessor">#include &lt;rclcpp/rclcpp.hpp&gt;</span></div>
<div class="line"><a id="l00018" name="l00018"></a><span class="lineno">   18</span><span class="preprocessor">#include &lt;string&gt;</span></div>
<div class="line"><a id="l00019" name="l00019"></a><span class="lineno">   19</span><span class="preprocessor">#include &lt;algorithm&gt;</span></div>
<div class="line"><a id="l00020" name="l00020"></a><span class="lineno">   20</span><span class="preprocessor">#include &lt;memory&gt;</span></div>
<div class="line"><a id="l00021" name="l00021"></a><span class="lineno">   21</span><span class="preprocessor">#include &lt;limits&gt;</span></div>
<div class="line"><a id="l00022" name="l00022"></a><span class="lineno">   22</span><span class="preprocessor">#include &lt;boost/uuid/uuid_generators.hpp&gt;</span></div>
<div class="line"><a id="l00023" name="l00023"></a><span class="lineno">   23</span><span class="preprocessor">#include &lt;boost/uuid/uuid_io.hpp&gt;</span></div>
<div class="line"><a id="l00024" name="l00024"></a><span class="lineno">   24</span><span class="preprocessor">#include &lt;lanelet2_core/geometry/Point.h&gt;</span></div>
<div class="line"><a id="l00025" name="l00025"></a><span class="lineno">   25</span><span class="preprocessor">#include &lt;trajectory_utils/trajectory_utils.hpp&gt;</span></div>
<div class="line"><a id="l00026" name="l00026"></a><span class="lineno">   26</span><span class="preprocessor">#include &lt;trajectory_utils/conversions/conversions.hpp&gt;</span></div>
<div class="line"><a id="l00027" name="l00027"></a><span class="lineno">   27</span><span class="preprocessor">#include &lt;sstream&gt;</span></div>
<div class="line"><a id="l00028" name="l00028"></a><span class="lineno">   28</span><span class="preprocessor">#include &lt;carma_ros2_utils/carma_lifecycle_node.hpp&gt;</span></div>
<div class="line"><a id="l00029" name="l00029"></a><span class="lineno">   29</span><span class="preprocessor">#include &lt;Eigen/Core&gt;</span></div>
<div class="line"><a id="l00030" name="l00030"></a><span class="lineno">   30</span><span class="preprocessor">#include &lt;Eigen/Geometry&gt;</span></div>
<div class="line"><a id="l00031" name="l00031"></a><span class="lineno">   31</span><span class="preprocessor">#include &lt;Eigen/LU&gt;</span></div>
<div class="line"><a id="l00032" name="l00032"></a><span class="lineno">   32</span><span class="preprocessor">#include &lt;Eigen/SVD&gt;</span></div>
<div class="line"><a id="l00033" name="l00033"></a><span class="lineno">   33</span><span class="preprocessor">#include &lt;<a class="code" href="yield__plugin_8hpp.html">yield_plugin/yield_plugin.hpp</a>&gt;</span></div>
<div class="line"><a id="l00034" name="l00034"></a><span class="lineno">   34</span><span class="preprocessor">#include &lt;carma_v2x_msgs/msg/location_ecef.hpp&gt;</span></div>
<div class="line"><a id="l00035" name="l00035"></a><span class="lineno">   35</span><span class="preprocessor">#include &lt;carma_v2x_msgs/msg/trajectory.hpp&gt;</span></div>
<div class="line"><a id="l00036" name="l00036"></a><span class="lineno">   36</span><span class="preprocessor">#include &lt;carma_v2x_msgs/msg/plan_type.hpp&gt;</span></div>
<div class="line"><a id="l00037" name="l00037"></a><span class="lineno">   37</span><span class="preprocessor">#include &lt;<a class="code" href="basic__autonomy_2include_2basic__autonomy_2smoothing_2filters_8hpp.html">basic_autonomy/smoothing/filters.hpp</a>&gt;</span></div>
<div class="line"><a id="l00038" name="l00038"></a><span class="lineno">   38</span><span class="preprocessor">#include &lt;future&gt;</span></div>
<div class="line"><a id="l00039" name="l00039"></a><span class="lineno">   39</span> </div>
<div class="line"><a id="l00040" name="l00040"></a><span class="lineno"><a class="line" href="yield__plugin_8cpp.html#a8212f1302ee6736745dc97bb5b3caaf5">   40</a></span><span class="keyword">using </span><a class="code hl_typedef" href="inlanecruising__plugin_8cpp.html#a8212f1302ee6736745dc97bb5b3caaf5">oss</a> = std::ostringstream;</div>
<div class="line"><a id="l00041" name="l00041"></a><span class="lineno"><a class="line" href="yield__plugin_8cpp.html#a6f9399eaf2efb1b12e797b77909df9ac">   41</a></span><span class="keyword">constexpr</span> <span class="keyword">auto</span> <a class="code hl_variable" href="yield__plugin_8cpp.html#a6f9399eaf2efb1b12e797b77909df9ac">EPSILON</a> {0.01}; <span class="comment">//small value to compare doubles</span></div>
<div class="line"><a id="l00042" name="l00042"></a><span class="lineno">   42</span> </div>
<div class="line"><a id="l00043" name="l00043"></a><span class="lineno">   43</span><span class="keyword">namespace </span><a class="code hl_namespace" href="namespaceyield__plugin.html">yield_plugin</a></div>
<div class="line"><a id="l00044" name="l00044"></a><span class="lineno">   44</span>{</div>
<div class="line"><a id="l00045" name="l00045"></a><span class="lineno"><a class="line" href="classyield__plugin_1_1YieldPlugin.html#a9277fa679e3465b090b5a8463690ed61">   45</a></span>  <a class="code hl_function" href="classyield__plugin_1_1YieldPlugin.html#a9277fa679e3465b090b5a8463690ed61">YieldPlugin::YieldPlugin</a>(std::shared_ptr&lt;carma_ros2_utils::CarmaLifecycleNode&gt; nh, <a class="code hl_typedef" href="namespacecarma__wm.html#a3ac653959e0b6198cae274d68b343228">carma_wm::WorldModelConstPtr</a> wm, <a class="code hl_struct" href="structYieldPluginConfig.html">YieldPluginConfig</a> config,</div>
<div class="line"><a id="l00046" name="l00046"></a><span class="lineno">   46</span>                                            <a class="code hl_typedef" href="namespaceyield__plugin.html#aa28c9381b8df2f7fdf3e7870bc5c2866">MobilityResponseCB</a> mobility_response_publisher,</div>
<div class="line"><a id="l00047" name="l00047"></a><span class="lineno">   47</span>                                            <a class="code hl_typedef" href="namespaceyield__plugin.html#a508edd284962f40938944f9304e66263">LaneChangeStatusCB</a> lc_status_publisher)</div>
<div class="line"><a id="l00048" name="l00048"></a><span class="lineno">   48</span>    : nh_(nh), wm_(wm), config_(config),mobility_response_publisher_(mobility_response_publisher), lc_status_publisher_(lc_status_publisher)</div>
<div class="line"><a id="l00049" name="l00049"></a><span class="lineno">   49</span>  {</div>
<div class="line"><a id="l00050" name="l00050"></a><span class="lineno">   50</span> </div>
<div class="line"><a id="l00051" name="l00051"></a><span class="lineno">   51</span>  }</div>
<div class="line"><a id="l00052" name="l00052"></a><span class="lineno">   52</span> </div>
<div class="line"><a id="l00053" name="l00053"></a><span class="lineno"><a class="line" href="namespaceyield__plugin.html#a82b2a694528d42a4af068732befca882">   53</a></span>  <span class="keywordtype">double</span> <a class="code hl_function" href="namespaceyield__plugin.html#a82b2a694528d42a4af068732befca882">get_trajectory_end_time</a>(<span class="keyword">const</span> carma_planning_msgs::msg::TrajectoryPlan&amp; trajectory)</div>
<div class="line"><a id="l00054" name="l00054"></a><span class="lineno">   54</span>  {</div>
<div class="line"><a id="l00055" name="l00055"></a><span class="lineno">   55</span>    <span class="keywordflow">return</span> rclcpp::Time(trajectory.trajectory_points.back().target_time).seconds();</div>
<div class="line"><a id="l00056" name="l00056"></a><span class="lineno">   56</span>  }</div>
<div class="line"><a id="l00057" name="l00057"></a><span class="lineno">   57</span> </div>
<div class="line"><a id="l00058" name="l00058"></a><span class="lineno"><a class="line" href="namespaceyield__plugin.html#a754c9aebad547b09cdeff7080a639bd3">   58</a></span>  <span class="keywordtype">double</span> <a class="code hl_function" href="namespaceyield__plugin.html#a754c9aebad547b09cdeff7080a639bd3">get_trajectory_start_time</a>(<span class="keyword">const</span> carma_planning_msgs::msg::TrajectoryPlan&amp; trajectory)</div>
<div class="line"><a id="l00059" name="l00059"></a><span class="lineno">   59</span>  {</div>
<div class="line"><a id="l00060" name="l00060"></a><span class="lineno">   60</span>    <span class="keywordflow">return</span> rclcpp::Time(trajectory.trajectory_points.front().target_time).seconds();</div>
<div class="line"><a id="l00061" name="l00061"></a><span class="lineno">   61</span>  }</div>
<div class="line"><a id="l00062" name="l00062"></a><span class="lineno">   62</span> </div>
<div class="line"><a id="l00063" name="l00063"></a><span class="lineno"><a class="line" href="namespaceyield__plugin.html#ad78fa1e6a7a22eff6b76dd32700fc55f">   63</a></span>  <span class="keywordtype">double</span> <a class="code hl_function" href="namespaceyield__plugin.html#ad78fa1e6a7a22eff6b76dd32700fc55f">get_trajectory_duration</a>(<span class="keyword">const</span> carma_planning_msgs::msg::TrajectoryPlan&amp; trajectory)</div>
<div class="line"><a id="l00064" name="l00064"></a><span class="lineno">   64</span>  {</div>
<div class="line"><a id="l00065" name="l00065"></a><span class="lineno">   65</span>    <span class="keywordflow">return</span> fabs(<a class="code hl_function" href="namespaceyield__plugin.html#a82b2a694528d42a4af068732befca882">get_trajectory_end_time</a>(trajectory) - <a class="code hl_function" href="namespaceyield__plugin.html#a754c9aebad547b09cdeff7080a639bd3">get_trajectory_start_time</a>(trajectory));</div>
<div class="line"><a id="l00066" name="l00066"></a><span class="lineno">   66</span>  }</div>
<div class="line"><a id="l00067" name="l00067"></a><span class="lineno">   67</span> </div>
<div class="line"><a id="l00068" name="l00068"></a><span class="lineno"><a class="line" href="namespaceyield__plugin.html#aadb2eac60dbb978567b697b3df16a335">   68</a></span>  <span class="keywordtype">double</span> <a class="code hl_function" href="namespaceyield__plugin.html#ad78fa1e6a7a22eff6b76dd32700fc55f">get_trajectory_duration</a>(<span class="keyword">const</span> std::vector&lt;carma_perception_msgs::msg::PredictedState&gt;&amp; trajectory)</div>
<div class="line"><a id="l00069" name="l00069"></a><span class="lineno">   69</span>  {</div>
<div class="line"><a id="l00070" name="l00070"></a><span class="lineno">   70</span>    <span class="keywordflow">return</span> (rclcpp::Time(trajectory.back().header.stamp) - rclcpp::Time(trajectory.front().header.stamp)).seconds();</div>
<div class="line"><a id="l00071" name="l00071"></a><span class="lineno">   71</span>  }</div>
<div class="line"><a id="l00072" name="l00072"></a><span class="lineno">   72</span> </div>
<div class="line"><a id="l00073" name="l00073"></a><span class="lineno"><a class="line" href="classyield__plugin_1_1YieldPlugin.html#abb40cf8a08a75c472791dbd91b99d8dc">   73</a></span>  std::vector&lt;std::pair&lt;int, lanelet::BasicPoint2d&gt;&gt; <a class="code hl_function" href="classyield__plugin_1_1YieldPlugin.html#abb40cf8a08a75c472791dbd91b99d8dc">YieldPlugin::detect_trajectories_intersection</a>(std::vector&lt;lanelet::BasicPoint2d&gt; self_trajectory, std::vector&lt;lanelet::BasicPoint2d&gt; incoming_trajectory)<span class="keyword"> const</span></div>
<div class="line"><a id="l00074" name="l00074"></a><span class="lineno">   74</span><span class="keyword">  </span>{</div>
<div class="line"><a id="l00075" name="l00075"></a><span class="lineno">   75</span>    std::vector&lt;std::pair&lt;int, lanelet::BasicPoint2d&gt;&gt; intersection_points;</div>
<div class="line"><a id="l00076" name="l00076"></a><span class="lineno">   76</span>    boost::geometry::model::linestring&lt;lanelet::BasicPoint2d&gt; self_traj;</div>
<div class="line"><a id="l00077" name="l00077"></a><span class="lineno">   77</span>    <span class="keywordflow">for</span> (<span class="keyword">auto</span> tpp:self_trajectory)</div>
<div class="line"><a id="l00078" name="l00078"></a><span class="lineno">   78</span>    {</div>
<div class="line"><a id="l00079" name="l00079"></a><span class="lineno">   79</span>      boost::geometry::append(self_traj, tpp);</div>
<div class="line"><a id="l00080" name="l00080"></a><span class="lineno">   80</span>    }</div>
<div class="line"><a id="l00081" name="l00081"></a><span class="lineno">   81</span>    <span class="comment">// distance to consider trajectories colliding (chosen based on lane width and vehicle size)</span></div>
<div class="line"><a id="l00082" name="l00082"></a><span class="lineno">   82</span>    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>=0; <a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>&lt;incoming_trajectory.size(); <a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>++)</div>
<div class="line"><a id="l00083" name="l00083"></a><span class="lineno">   83</span>    {</div>
<div class="line"><a id="l00084" name="l00084"></a><span class="lineno">   84</span>      <span class="keywordtype">double</span> res = boost::geometry::distance(incoming_trajectory.at(<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>), self_traj);</div>
<div class="line"><a id="l00085" name="l00085"></a><span class="lineno">   85</span> </div>
<div class="line"><a id="l00086" name="l00086"></a><span class="lineno">   86</span>      <span class="keywordflow">if</span> (fabs(res) &lt;= <a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#ab1f62a493a4229d4801841eb19fb1e7d">config_</a>.<a class="code hl_variable" href="structYieldPluginConfig.html#a9c609df9146f9f8dbbf4838decc6fb0b">intervehicle_collision_distance_in_m</a>)</div>
<div class="line"><a id="l00087" name="l00087"></a><span class="lineno">   87</span>      {</div>
<div class="line"><a id="l00088" name="l00088"></a><span class="lineno">   88</span>         intersection_points.push_back(std::make_pair(<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>, incoming_trajectory.at(<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>)));</div>
<div class="line"><a id="l00089" name="l00089"></a><span class="lineno">   89</span>      }</div>
<div class="line"><a id="l00090" name="l00090"></a><span class="lineno">   90</span>    }</div>
<div class="line"><a id="l00091" name="l00091"></a><span class="lineno">   91</span>    <span class="keywordflow">return</span> intersection_points;</div>
<div class="line"><a id="l00092" name="l00092"></a><span class="lineno">   92</span>  }</div>
<div class="line"><a id="l00093" name="l00093"></a><span class="lineno">   93</span> </div>
<div class="line"><a id="l00094" name="l00094"></a><span class="lineno"><a class="line" href="classyield__plugin_1_1YieldPlugin.html#a5255e398082083d48e7b07054f82fad8">   94</a></span>  std::vector&lt;lanelet::BasicPoint2d&gt; <a class="code hl_function" href="classyield__plugin_1_1YieldPlugin.html#a5255e398082083d48e7b07054f82fad8">YieldPlugin::convert_eceftrajectory_to_mappoints</a>(<span class="keyword">const</span> carma_v2x_msgs::msg::Trajectory&amp; ecef_trajectory)<span class="keyword"> const</span></div>
<div class="line"><a id="l00095" name="l00095"></a><span class="lineno">   95</span><span class="keyword">  </span>{</div>
<div class="line"><a id="l00096" name="l00096"></a><span class="lineno">   96</span>    carma_planning_msgs::msg::TrajectoryPlan trajectory_plan;</div>
<div class="line"><a id="l00097" name="l00097"></a><span class="lineno">   97</span>    std::vector&lt;lanelet::BasicPoint2d&gt; map_points;</div>
<div class="line"><a id="l00098" name="l00098"></a><span class="lineno">   98</span> </div>
<div class="line"><a id="l00099" name="l00099"></a><span class="lineno">   99</span>    lanelet::BasicPoint2d <a class="code hl_variable" href="namespaceprocess__bag.html#ada7d8d458b66074ad9e74b476c299003">first_point</a> = <a class="code hl_function" href="classyield__plugin_1_1YieldPlugin.html#ac0b6fb988e61ce2cfb04c4a1f33070d5">ecef_to_map_point</a>(ecef_trajectory.location);</div>
<div class="line"><a id="l00100" name="l00100"></a><span class="lineno">  100</span> </div>
<div class="line"><a id="l00101" name="l00101"></a><span class="lineno">  101</span>    map_points.push_back(<a class="code hl_variable" href="namespaceprocess__bag.html#ada7d8d458b66074ad9e74b476c299003">first_point</a>);</div>
<div class="line"><a id="l00102" name="l00102"></a><span class="lineno">  102</span>    <span class="keyword">auto</span> curr_point = ecef_trajectory.location;</div>
<div class="line"><a id="l00103" name="l00103"></a><span class="lineno">  103</span> </div>
<div class="line"><a id="l00104" name="l00104"></a><span class="lineno">  104</span>    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a> = 0; <a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>&lt;ecef_trajectory.offsets.size(); <a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>++)</div>
<div class="line"><a id="l00105" name="l00105"></a><span class="lineno">  105</span>    {</div>
<div class="line"><a id="l00106" name="l00106"></a><span class="lineno">  106</span>      lanelet::BasicPoint2d offset_point;</div>
<div class="line"><a id="l00107" name="l00107"></a><span class="lineno">  107</span>      curr_point.ecef_x += ecef_trajectory.offsets.at(<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>).offset_x;</div>
<div class="line"><a id="l00108" name="l00108"></a><span class="lineno">  108</span>      curr_point.ecef_y += ecef_trajectory.offsets.at(<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>).offset_y;</div>
<div class="line"><a id="l00109" name="l00109"></a><span class="lineno">  109</span>      curr_point.ecef_z += ecef_trajectory.offsets.at(<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>).offset_z;</div>
<div class="line"><a id="l00110" name="l00110"></a><span class="lineno">  110</span> </div>
<div class="line"><a id="l00111" name="l00111"></a><span class="lineno">  111</span>      offset_point = <a class="code hl_function" href="classyield__plugin_1_1YieldPlugin.html#ac0b6fb988e61ce2cfb04c4a1f33070d5">ecef_to_map_point</a>(curr_point);</div>
<div class="line"><a id="l00112" name="l00112"></a><span class="lineno">  112</span> </div>
<div class="line"><a id="l00113" name="l00113"></a><span class="lineno">  113</span>      map_points.push_back(offset_point);</div>
<div class="line"><a id="l00114" name="l00114"></a><span class="lineno">  114</span>    }</div>
<div class="line"><a id="l00115" name="l00115"></a><span class="lineno">  115</span> </div>
<div class="line"><a id="l00116" name="l00116"></a><span class="lineno">  116</span>    <span class="keywordflow">return</span> map_points;</div>
<div class="line"><a id="l00117" name="l00117"></a><span class="lineno">  117</span>  }</div>
<div class="line"><a id="l00118" name="l00118"></a><span class="lineno">  118</span> </div>
<div class="line"><a id="l00119" name="l00119"></a><span class="lineno"><a class="line" href="classyield__plugin_1_1YieldPlugin.html#ac0b6fb988e61ce2cfb04c4a1f33070d5">  119</a></span>  lanelet::BasicPoint2d <a class="code hl_function" href="classyield__plugin_1_1YieldPlugin.html#ac0b6fb988e61ce2cfb04c4a1f33070d5">YieldPlugin::ecef_to_map_point</a>(<span class="keyword">const</span> carma_v2x_msgs::msg::LocationECEF&amp; ecef_point)<span class="keyword"> const</span></div>
<div class="line"><a id="l00120" name="l00120"></a><span class="lineno">  120</span><span class="keyword">  </span>{</div>
<div class="line"><a id="l00121" name="l00121"></a><span class="lineno">  121</span> </div>
<div class="line"><a id="l00122" name="l00122"></a><span class="lineno">  122</span>    <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#a42d2a2d8a9f88afbedaa566ad57c8444">map_projector_</a>) {</div>
<div class="line"><a id="l00123" name="l00123"></a><span class="lineno">  123</span>        <span class="keywordflow">throw</span> std::invalid_argument(<span class="stringliteral">&quot;No map projector available for ecef conversion&quot;</span>);</div>
<div class="line"><a id="l00124" name="l00124"></a><span class="lineno">  124</span>    }</div>
<div class="line"><a id="l00125" name="l00125"></a><span class="lineno">  125</span> </div>
<div class="line"><a id="l00126" name="l00126"></a><span class="lineno">  126</span>    lanelet::BasicPoint3d map_point = <a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#a42d2a2d8a9f88afbedaa566ad57c8444">map_projector_</a>-&gt;projectECEF( { <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(ecef_point.ecef_x)/100.0, <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(ecef_point.ecef_y)/100.0, <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(ecef_point.ecef_z)/100.0 } , 1);</div>
<div class="line"><a id="l00127" name="l00127"></a><span class="lineno">  127</span> </div>
<div class="line"><a id="l00128" name="l00128"></a><span class="lineno">  128</span>    <span class="keywordflow">return</span> lanelet::traits::to2D(map_point);</div>
<div class="line"><a id="l00129" name="l00129"></a><span class="lineno">  129</span>  }</div>
<div class="line"><a id="l00130" name="l00130"></a><span class="lineno">  130</span> </div>
<div class="line"><a id="l00131" name="l00131"></a><span class="lineno">  131</span> </div>
<div class="line"><a id="l00132" name="l00132"></a><span class="lineno">  132</span> </div>
<div class="line"><a id="l00133" name="l00133"></a><span class="lineno"><a class="line" href="classyield__plugin_1_1YieldPlugin.html#acf45eb277044353dbb87226f0bec3f06">  133</a></span>  carma_v2x_msgs::msg::MobilityResponse <a class="code hl_function" href="classyield__plugin_1_1YieldPlugin.html#acf45eb277044353dbb87226f0bec3f06">YieldPlugin::compose_mobility_response</a>(<span class="keyword">const</span> std::string&amp; resp_recipient_id, <span class="keyword">const</span> std::string&amp; req_plan_id, <span class="keywordtype">bool</span> response)<span class="keyword"> const</span></div>
<div class="line"><a id="l00134" name="l00134"></a><span class="lineno">  134</span><span class="keyword">  </span>{</div>
<div class="line"><a id="l00135" name="l00135"></a><span class="lineno">  135</span>    carma_v2x_msgs::msg::MobilityResponse out_mobility_response;</div>
<div class="line"><a id="l00136" name="l00136"></a><span class="lineno">  136</span>    out_mobility_response.m_header.sender_id = <a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#ab1f62a493a4229d4801841eb19fb1e7d">config_</a>.<a class="code hl_variable" href="structYieldPluginConfig.html#a60e81669e3f640da18139b681e4ae426">vehicle_id</a>;</div>
<div class="line"><a id="l00137" name="l00137"></a><span class="lineno">  137</span>    out_mobility_response.m_header.recipient_id = resp_recipient_id;</div>
<div class="line"><a id="l00138" name="l00138"></a><span class="lineno">  138</span>    out_mobility_response.m_header.sender_bsm_id = <a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#ad25df251a12c9c052daeab2f58385c7d">host_bsm_id_</a>;</div>
<div class="line"><a id="l00139" name="l00139"></a><span class="lineno">  139</span>    out_mobility_response.m_header.plan_id = req_plan_id;</div>
<div class="line"><a id="l00140" name="l00140"></a><span class="lineno">  140</span>    out_mobility_response.m_header.timestamp = <a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#aa2f96dc545c04733e8ba11a6f3a0c2c6">nh_</a>-&gt;now().seconds()*1000;</div>
<div class="line"><a id="l00141" name="l00141"></a><span class="lineno">  141</span> </div>
<div class="line"><a id="l00142" name="l00142"></a><span class="lineno">  142</span> </div>
<div class="line"><a id="l00143" name="l00143"></a><span class="lineno">  143</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#ab1f62a493a4229d4801841eb19fb1e7d">config_</a>.<a class="code hl_variable" href="structYieldPluginConfig.html#a03f93a3be83b27d1d4e80ef4d765c0b0">always_accept_mobility_request</a> &amp;&amp; response)</div>
<div class="line"><a id="l00144" name="l00144"></a><span class="lineno">  144</span>    {</div>
<div class="line"><a id="l00145" name="l00145"></a><span class="lineno">  145</span>      out_mobility_response.is_accepted = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00146" name="l00146"></a><span class="lineno">  146</span>    }</div>
<div class="line"><a id="l00147" name="l00147"></a><span class="lineno">  147</span>    <span class="keywordflow">else</span> out_mobility_response.is_accepted = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00148" name="l00148"></a><span class="lineno">  148</span> </div>
<div class="line"><a id="l00149" name="l00149"></a><span class="lineno">  149</span>    <span class="keywordflow">return</span> out_mobility_response;</div>
<div class="line"><a id="l00150" name="l00150"></a><span class="lineno">  150</span>  }</div>
<div class="line"><a id="l00151" name="l00151"></a><span class="lineno">  151</span> </div>
<div class="line"><a id="l00152" name="l00152"></a><span class="lineno">  152</span> </div>
<div class="line"><a id="l00153" name="l00153"></a><span class="lineno"><a class="line" href="classyield__plugin_1_1YieldPlugin.html#a3276c693a65319e769e63078284d3056">  153</a></span>  <span class="keywordtype">void</span> <a class="code hl_function" href="classyield__plugin_1_1YieldPlugin.html#a3276c693a65319e769e63078284d3056">YieldPlugin::mobilityrequest_cb</a>(<span class="keyword">const</span> carma_v2x_msgs::msg::MobilityRequest::UniquePtr msg)</div>
<div class="line"><a id="l00154" name="l00154"></a><span class="lineno">  154</span>  {</div>
<div class="line"><a id="l00155" name="l00155"></a><span class="lineno">  155</span>    carma_v2x_msgs::msg::MobilityRequest incoming_request = *msg;</div>
<div class="line"><a id="l00156" name="l00156"></a><span class="lineno">  156</span>    carma_planning_msgs::msg::LaneChangeStatus lc_status_msg;</div>
<div class="line"><a id="l00157" name="l00157"></a><span class="lineno">  157</span>    <span class="keywordflow">if</span> (incoming_request.strategy == <span class="stringliteral">&quot;carma/cooperative-lane-change&quot;</span>)</div>
<div class="line"><a id="l00158" name="l00158"></a><span class="lineno">  158</span>    {</div>
<div class="line"><a id="l00159" name="l00159"></a><span class="lineno">  159</span>      <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#a42d2a2d8a9f88afbedaa566ad57c8444">map_projector_</a>) {</div>
<div class="line"><a id="l00160" name="l00160"></a><span class="lineno">  160</span>        RCLCPP_ERROR(<a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#aa2f96dc545c04733e8ba11a6f3a0c2c6">nh_</a>-&gt;get_logger(),<span class="stringliteral">&quot;Cannot process mobility request as map projection is not yet set!&quot;</span>);</div>
<div class="line"><a id="l00161" name="l00161"></a><span class="lineno">  161</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00162" name="l00162"></a><span class="lineno">  162</span>      }</div>
<div class="line"><a id="l00163" name="l00163"></a><span class="lineno">  163</span>      <span class="keywordflow">if</span> (incoming_request.plan_type.type == carma_v2x_msgs::msg::PlanType::CHANGE_LANE_LEFT || incoming_request.plan_type.type == carma_v2x_msgs::msg::PlanType::CHANGE_LANE_RIGHT)</div>
<div class="line"><a id="l00164" name="l00164"></a><span class="lineno">  164</span>      {</div>
<div class="line"><a id="l00165" name="l00165"></a><span class="lineno">  165</span>        RCLCPP_DEBUG(<a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#aa2f96dc545c04733e8ba11a6f3a0c2c6">nh_</a>-&gt;get_logger(),<span class="stringliteral">&quot;Cooperative Lane Change Request Received&quot;</span>);</div>
<div class="line"><a id="l00166" name="l00166"></a><span class="lineno">  166</span>        lc_status_msg.status = carma_planning_msgs::msg::LaneChangeStatus::REQUEST_RECEIVED;</div>
<div class="line"><a id="l00167" name="l00167"></a><span class="lineno">  167</span>        lc_status_msg.description = <span class="stringliteral">&quot;Received lane merge request&quot;</span>;</div>
<div class="line"><a id="l00168" name="l00168"></a><span class="lineno">  168</span> </div>
<div class="line"><a id="l00169" name="l00169"></a><span class="lineno">  169</span>        <span class="keywordflow">if</span> (incoming_request.m_header.recipient_id == <a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#ab1f62a493a4229d4801841eb19fb1e7d">config_</a>.<a class="code hl_variable" href="structYieldPluginConfig.html#a60e81669e3f640da18139b681e4ae426">vehicle_id</a>)</div>
<div class="line"><a id="l00170" name="l00170"></a><span class="lineno">  170</span>        {</div>
<div class="line"><a id="l00171" name="l00171"></a><span class="lineno">  171</span>          RCLCPP_DEBUG(<a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#aa2f96dc545c04733e8ba11a6f3a0c2c6">nh_</a>-&gt;get_logger(),<span class="stringliteral">&quot;CLC Request correctly received&quot;</span>);</div>
<div class="line"><a id="l00172" name="l00172"></a><span class="lineno">  172</span>        }</div>
<div class="line"><a id="l00173" name="l00173"></a><span class="lineno">  173</span> </div>
<div class="line"><a id="l00174" name="l00174"></a><span class="lineno">  174</span>        <span class="comment">// extract mobility header</span></div>
<div class="line"><a id="l00175" name="l00175"></a><span class="lineno">  175</span>        std::string req_sender_id = incoming_request.m_header.sender_id;</div>
<div class="line"><a id="l00176" name="l00176"></a><span class="lineno">  176</span>        std::string req_plan_id = incoming_request.m_header.plan_id;</div>
<div class="line"><a id="l00177" name="l00177"></a><span class="lineno">  177</span>        <span class="comment">// extract mobility request</span></div>
<div class="line"><a id="l00178" name="l00178"></a><span class="lineno">  178</span>        carma_v2x_msgs::msg::LocationECEF ecef_location = incoming_request.location;</div>
<div class="line"><a id="l00179" name="l00179"></a><span class="lineno">  179</span>        carma_v2x_msgs::msg::Trajectory incoming_trajectory = incoming_request.trajectory;</div>
<div class="line"><a id="l00180" name="l00180"></a><span class="lineno">  180</span>        std::string req_strategy_params = incoming_request.strategy_params;</div>
<div class="line"><a id="l00181" name="l00181"></a><span class="lineno">  181</span>        <a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#ae79ca3ae3dcfb369611d20ffa4ef7660">clc_urgency_</a> = incoming_request.urgency;</div>
<div class="line"><a id="l00182" name="l00182"></a><span class="lineno">  182</span>        RCLCPP_DEBUG_STREAM(<a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#aa2f96dc545c04733e8ba11a6f3a0c2c6">nh_</a>-&gt;get_logger(),<span class="stringliteral">&quot;received urgency: &quot;</span> &lt;&lt; <a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#ae79ca3ae3dcfb369611d20ffa4ef7660">clc_urgency_</a>);</div>
<div class="line"><a id="l00183" name="l00183"></a><span class="lineno">  183</span> </div>
<div class="line"><a id="l00184" name="l00184"></a><span class="lineno">  184</span>        <span class="comment">// Parse strategy parameters</span></div>
<div class="line"><a id="l00185" name="l00185"></a><span class="lineno">  185</span>        <span class="keyword">using </span>boost::property_tree::ptree;</div>
<div class="line"><a id="l00186" name="l00186"></a><span class="lineno">  186</span>        ptree pt;</div>
<div class="line"><a id="l00187" name="l00187"></a><span class="lineno">  187</span>        std::istringstream strstream(req_strategy_params);</div>
<div class="line"><a id="l00188" name="l00188"></a><span class="lineno">  188</span>        boost::property_tree::json_parser::read_json(strstream, pt);</div>
<div class="line"><a id="l00189" name="l00189"></a><span class="lineno">  189</span>        <span class="keywordtype">int</span> req_traj_speed_full = pt.get&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;s&quot;</span>);</div>
<div class="line"><a id="l00190" name="l00190"></a><span class="lineno">  190</span>        <span class="keywordtype">int</span> req_traj_fractional = pt.get&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;f&quot;</span>);</div>
<div class="line"><a id="l00191" name="l00191"></a><span class="lineno">  191</span>        <span class="keywordtype">int</span> start_lanelet_id = pt.get&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;sl&quot;</span>);</div>
<div class="line"><a id="l00192" name="l00192"></a><span class="lineno">  192</span>        <span class="keywordtype">int</span> end_lanelet_id = pt.get&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;el&quot;</span>);</div>
<div class="line"><a id="l00193" name="l00193"></a><span class="lineno">  193</span>        <span class="keywordtype">double</span> req_traj_speed = <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(req_traj_speed_full) + <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(req_traj_fractional)/10.0;</div>
<div class="line"><a id="l00194" name="l00194"></a><span class="lineno">  194</span>        RCLCPP_DEBUG_STREAM(<a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#aa2f96dc545c04733e8ba11a6f3a0c2c6">nh_</a>-&gt;get_logger(),<span class="stringliteral">&quot;req_traj_speed&quot;</span> &lt;&lt; req_traj_speed);</div>
<div class="line"><a id="l00195" name="l00195"></a><span class="lineno">  195</span>        RCLCPP_DEBUG_STREAM(<a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#aa2f96dc545c04733e8ba11a6f3a0c2c6">nh_</a>-&gt;get_logger(),<span class="stringliteral">&quot;start_lanelet_id&quot;</span> &lt;&lt; start_lanelet_id);</div>
<div class="line"><a id="l00196" name="l00196"></a><span class="lineno">  196</span>        RCLCPP_DEBUG_STREAM(<a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#aa2f96dc545c04733e8ba11a6f3a0c2c6">nh_</a>-&gt;get_logger(),<span class="stringliteral">&quot;end_lanelet_id&quot;</span> &lt;&lt; end_lanelet_id);</div>
<div class="line"><a id="l00197" name="l00197"></a><span class="lineno">  197</span> </div>
<div class="line"><a id="l00198" name="l00198"></a><span class="lineno">  198</span>        std::vector&lt;lanelet::BasicPoint2d&gt; req_traj_plan = {};</div>
<div class="line"><a id="l00199" name="l00199"></a><span class="lineno">  199</span> </div>
<div class="line"><a id="l00200" name="l00200"></a><span class="lineno">  200</span>        req_traj_plan = <a class="code hl_function" href="classyield__plugin_1_1YieldPlugin.html#a5255e398082083d48e7b07054f82fad8">convert_eceftrajectory_to_mappoints</a>(incoming_trajectory);</div>
<div class="line"><a id="l00201" name="l00201"></a><span class="lineno">  201</span> </div>
<div class="line"><a id="l00202" name="l00202"></a><span class="lineno">  202</span>        <span class="keywordtype">double</span> req_expiration_sec = <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(incoming_request.expiration);</div>
<div class="line"><a id="l00203" name="l00203"></a><span class="lineno">  203</span>        <span class="keywordtype">double</span> current_time_sec = <a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#aa2f96dc545c04733e8ba11a6f3a0c2c6">nh_</a>-&gt;now().seconds();</div>
<div class="line"><a id="l00204" name="l00204"></a><span class="lineno">  204</span> </div>
<div class="line"><a id="l00205" name="l00205"></a><span class="lineno">  205</span>        <span class="keywordtype">bool</span> response_to_clc_req = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00206" name="l00206"></a><span class="lineno">  206</span>        <span class="comment">// ensure there is enough time for the yield</span></div>
<div class="line"><a id="l00207" name="l00207"></a><span class="lineno">  207</span>        <span class="keywordtype">double</span> req_plan_time = req_expiration_sec - current_time_sec;</div>
<div class="line"><a id="l00208" name="l00208"></a><span class="lineno">  208</span>        <span class="keywordtype">double</span> req_timestamp = <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(incoming_request.m_header.timestamp) / 1000.0 - current_time_sec;</div>
<div class="line"><a id="l00209" name="l00209"></a><span class="lineno">  209</span>        <a class="code hl_function" href="classyield__plugin_1_1YieldPlugin.html#a2def22504a4972db1994e96033e76ee9">set_incoming_request_info</a>(req_traj_plan, req_traj_speed, req_plan_time, req_timestamp);</div>
<div class="line"><a id="l00210" name="l00210"></a><span class="lineno">  210</span> </div>
<div class="line"><a id="l00211" name="l00211"></a><span class="lineno">  211</span> </div>
<div class="line"><a id="l00212" name="l00212"></a><span class="lineno">  212</span>        <span class="keywordflow">if</span> (req_expiration_sec - current_time_sec &gt;= <a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#ab1f62a493a4229d4801841eb19fb1e7d">config_</a>.<a class="code hl_variable" href="structYieldPluginConfig.html#accd4e108184fe5a470d4f8af1de1e7a2">min_obj_avoidance_plan_time_in_s</a> &amp;&amp; <a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#ad694d6ea9d5ca884e29f33a48fe19ae3">cooperative_request_acceptable_</a>)</div>
<div class="line"><a id="l00213" name="l00213"></a><span class="lineno">  213</span>        {</div>
<div class="line"><a id="l00214" name="l00214"></a><span class="lineno">  214</span>          <a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#ae3f7420f5eccdb7f4b4ec59c7f69ec3f">timesteps_since_last_req_</a> = 0;</div>
<div class="line"><a id="l00215" name="l00215"></a><span class="lineno">  215</span>          lc_status_msg.status = carma_planning_msgs::msg::LaneChangeStatus::REQUEST_ACCEPTED;</div>
<div class="line"><a id="l00216" name="l00216"></a><span class="lineno">  216</span>          lc_status_msg.description = <span class="stringliteral">&quot;Accepted lane merge request&quot;</span>;</div>
<div class="line"><a id="l00217" name="l00217"></a><span class="lineno">  217</span>          response_to_clc_req = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00218" name="l00218"></a><span class="lineno">  218</span>          RCLCPP_DEBUG(<a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#aa2f96dc545c04733e8ba11a6f3a0c2c6">nh_</a>-&gt;get_logger(),<span class="stringliteral">&quot;CLC accepted&quot;</span>);</div>
<div class="line"><a id="l00219" name="l00219"></a><span class="lineno">  219</span>        }</div>
<div class="line"><a id="l00220" name="l00220"></a><span class="lineno">  220</span>        <span class="keywordflow">else</span></div>
<div class="line"><a id="l00221" name="l00221"></a><span class="lineno">  221</span>        {</div>
<div class="line"><a id="l00222" name="l00222"></a><span class="lineno">  222</span>          lc_status_msg.status = carma_planning_msgs::msg::LaneChangeStatus::REQUEST_REJECTED;</div>
<div class="line"><a id="l00223" name="l00223"></a><span class="lineno">  223</span>          lc_status_msg.description = <span class="stringliteral">&quot;Rejected lane merge request&quot;</span>;</div>
<div class="line"><a id="l00224" name="l00224"></a><span class="lineno">  224</span>          response_to_clc_req = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00225" name="l00225"></a><span class="lineno">  225</span>          RCLCPP_DEBUG(<a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#aa2f96dc545c04733e8ba11a6f3a0c2c6">nh_</a>-&gt;get_logger(),<span class="stringliteral">&quot;CLC rejected&quot;</span>);</div>
<div class="line"><a id="l00226" name="l00226"></a><span class="lineno">  226</span>        }</div>
<div class="line"><a id="l00227" name="l00227"></a><span class="lineno">  227</span>        carma_v2x_msgs::msg::MobilityResponse outgoing_response = <a class="code hl_function" href="classyield__plugin_1_1YieldPlugin.html#acf45eb277044353dbb87226f0bec3f06">compose_mobility_response</a>(req_sender_id, req_plan_id, response_to_clc_req);</div>
<div class="line"><a id="l00228" name="l00228"></a><span class="lineno">  228</span>        <a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#a82d36ef453849014abfe64e6ecac5e58">mobility_response_publisher_</a>(outgoing_response);</div>
<div class="line"><a id="l00229" name="l00229"></a><span class="lineno">  229</span>        lc_status_msg.status = carma_planning_msgs::msg::LaneChangeStatus::RESPONSE_SENT;</div>
<div class="line"><a id="l00230" name="l00230"></a><span class="lineno">  230</span>        RCLCPP_DEBUG(<a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#aa2f96dc545c04733e8ba11a6f3a0c2c6">nh_</a>-&gt;get_logger(),<span class="stringliteral">&quot;response sent&quot;</span>);</div>
<div class="line"><a id="l00231" name="l00231"></a><span class="lineno">  231</span>      }</div>
<div class="line"><a id="l00232" name="l00232"></a><span class="lineno">  232</span>    }</div>
<div class="line"><a id="l00233" name="l00233"></a><span class="lineno">  233</span>    <a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#a274208e09bc96aaef0ba731904aa57de">lc_status_publisher_</a>(lc_status_msg);</div>
<div class="line"><a id="l00234" name="l00234"></a><span class="lineno">  234</span> </div>
<div class="line"><a id="l00235" name="l00235"></a><span class="lineno">  235</span>  }</div>
<div class="line"><a id="l00236" name="l00236"></a><span class="lineno">  236</span> </div>
<div class="line"><a id="l00237" name="l00237"></a><span class="lineno"><a class="line" href="classyield__plugin_1_1YieldPlugin.html#a2def22504a4972db1994e96033e76ee9">  237</a></span>  <span class="keywordtype">void</span> <a class="code hl_function" href="classyield__plugin_1_1YieldPlugin.html#a2def22504a4972db1994e96033e76ee9">YieldPlugin::set_incoming_request_info</a>(std::vector &lt;lanelet::BasicPoint2d&gt; req_trajectory, <span class="keywordtype">double</span> req_speed, <span class="keywordtype">double</span> req_planning_time, <span class="keywordtype">double</span> req_timestamp)</div>
<div class="line"><a id="l00238" name="l00238"></a><span class="lineno">  238</span>  {</div>
<div class="line"><a id="l00239" name="l00239"></a><span class="lineno">  239</span>    <a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#a2e806b6f64d4490b88f8947d8a360491">req_trajectory_points_</a> = req_trajectory;</div>
<div class="line"><a id="l00240" name="l00240"></a><span class="lineno">  240</span>    <a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#ac1099523a4ea8b3ecc607cf466e42162">req_target_speed_</a> = req_speed;</div>
<div class="line"><a id="l00241" name="l00241"></a><span class="lineno">  241</span>    <a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#ad620a98521987c31d004b5aabbf3a620">req_target_plan_time_</a> = req_planning_time;</div>
<div class="line"><a id="l00242" name="l00242"></a><span class="lineno">  242</span>    RCLCPP_DEBUG_STREAM(<a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#aa2f96dc545c04733e8ba11a6f3a0c2c6">nh_</a>-&gt;get_logger(),<span class="stringliteral">&quot;req_target_plan_time_&quot;</span> &lt;&lt; <a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#ad620a98521987c31d004b5aabbf3a620">req_target_plan_time_</a>);</div>
<div class="line"><a id="l00243" name="l00243"></a><span class="lineno">  243</span>    <a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#a25b4eec8b5e4648044a4b46570cb4199">req_timestamp_</a> = req_timestamp;</div>
<div class="line"><a id="l00244" name="l00244"></a><span class="lineno">  244</span>  }</div>
<div class="line"><a id="l00245" name="l00245"></a><span class="lineno">  245</span> </div>
<div class="line"><a id="l00246" name="l00246"></a><span class="lineno"><a class="line" href="classyield__plugin_1_1YieldPlugin.html#a7b2ee0cdcba01c2df0f1d9df679424f8">  246</a></span>  <span class="keywordtype">void</span> <a class="code hl_function" href="classyield__plugin_1_1YieldPlugin.html#a7b2ee0cdcba01c2df0f1d9df679424f8">YieldPlugin::bsm_cb</a>(<span class="keyword">const</span> carma_v2x_msgs::msg::BSM::UniquePtr msg)</div>
<div class="line"><a id="l00247" name="l00247"></a><span class="lineno">  247</span>  {</div>
<div class="line"><a id="l00248" name="l00248"></a><span class="lineno">  248</span>    carma_v2x_msgs::msg::BSMCoreData bsm_core_ = msg-&gt;core_data;</div>
<div class="line"><a id="l00249" name="l00249"></a><span class="lineno">  249</span>    <a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#ad25df251a12c9c052daeab2f58385c7d">host_bsm_id_</a> = <a class="code hl_function" href="classyield__plugin_1_1YieldPlugin.html#a852c927a6a8d94bfdbeeffcf56ba6331">bsmIDtoString</a>(bsm_core_);</div>
<div class="line"><a id="l00250" name="l00250"></a><span class="lineno">  250</span>  }</div>
<div class="line"><a id="l00251" name="l00251"></a><span class="lineno">  251</span> </div>
<div class="line"><a id="l00252" name="l00252"></a><span class="lineno"><a class="line" href="classyield__plugin_1_1YieldPlugin.html#a0fd790e287683a2ef404e16a15e0ea29">  252</a></span> <span class="keywordtype">void</span> <a class="code hl_function" href="classyield__plugin_1_1YieldPlugin.html#a0fd790e287683a2ef404e16a15e0ea29">YieldPlugin::plan_trajectory_callback</a>(</div>
<div class="line"><a id="l00253" name="l00253"></a><span class="lineno">  253</span>  carma_planning_msgs::srv::PlanTrajectory::Request::SharedPtr req,</div>
<div class="line"><a id="l00254" name="l00254"></a><span class="lineno">  254</span>  carma_planning_msgs::srv::PlanTrajectory::Response::SharedPtr resp)</div>
<div class="line"><a id="l00255" name="l00255"></a><span class="lineno">  255</span>{</div>
<div class="line"><a id="l00256" name="l00256"></a><span class="lineno">  256</span>    RCLCPP_DEBUG(<a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#aa2f96dc545c04733e8ba11a6f3a0c2c6">nh_</a>-&gt;get_logger(),<span class="stringliteral">&quot;Yield_plugin was called!&quot;</span>);</div>
<div class="line"><a id="l00257" name="l00257"></a><span class="lineno">  257</span>    <span class="keywordflow">if</span> (req-&gt;initial_trajectory_plan.trajectory_points.size() &lt; 2){</div>
<div class="line"><a id="l00258" name="l00258"></a><span class="lineno">  258</span>      <span class="keywordflow">throw</span> std::invalid_argument(<span class="stringliteral">&quot;Empty Trajectory received by Yield&quot;</span>);</div>
<div class="line"><a id="l00259" name="l00259"></a><span class="lineno">  259</span>    }</div>
<div class="line"><a id="l00260" name="l00260"></a><span class="lineno">  260</span>    rclcpp::Clock system_clock(RCL_SYSTEM_TIME);</div>
<div class="line"><a id="l00261" name="l00261"></a><span class="lineno">  261</span>    rclcpp::Time start_time = system_clock.now();  <span class="comment">// Start timing the execution time for planning so it can be logged</span></div>
<div class="line"><a id="l00262" name="l00262"></a><span class="lineno">  262</span> </div>
<div class="line"><a id="l00263" name="l00263"></a><span class="lineno">  263</span>    carma_planning_msgs::msg::TrajectoryPlan original_trajectory = req-&gt;initial_trajectory_plan;</div>
<div class="line"><a id="l00264" name="l00264"></a><span class="lineno">  264</span>    carma_planning_msgs::msg::TrajectoryPlan yield_trajectory;</div>
<div class="line"><a id="l00265" name="l00265"></a><span class="lineno">  265</span> </div>
<div class="line"><a id="l00266" name="l00266"></a><span class="lineno">  266</span> </div>
<div class="line"><a id="l00267" name="l00267"></a><span class="lineno">  267</span>    <span class="keywordtype">double</span> initial_velocity = req-&gt;vehicle_state.longitudinal_vel;</div>
<div class="line"><a id="l00268" name="l00268"></a><span class="lineno">  268</span>    <span class="comment">// If vehicle_state is stopped, non-zero velocity from the trajectory</span></div>
<div class="line"><a id="l00269" name="l00269"></a><span class="lineno">  269</span>    <span class="comment">// should be used. Otherwise, vehicle will not move.</span></div>
<div class="line"><a id="l00270" name="l00270"></a><span class="lineno">  270</span>    <span class="keywordflow">if</span> (initial_velocity &lt; <a class="code hl_variable" href="yield__plugin_8cpp.html#a6f9399eaf2efb1b12e797b77909df9ac">EPSILON</a>)</div>
<div class="line"><a id="l00271" name="l00271"></a><span class="lineno">  271</span>    {</div>
<div class="line"><a id="l00272" name="l00272"></a><span class="lineno">  272</span>      initial_velocity = original_trajectory.initial_longitudinal_velocity;</div>
<div class="line"><a id="l00273" name="l00273"></a><span class="lineno">  273</span>    }</div>
<div class="line"><a id="l00274" name="l00274"></a><span class="lineno">  274</span> </div>
<div class="line"><a id="l00275" name="l00275"></a><span class="lineno">  275</span>    <span class="comment">// seperating cooperative yield with regular object detection for better performance.</span></div>
<div class="line"><a id="l00276" name="l00276"></a><span class="lineno">  276</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#ab1f62a493a4229d4801841eb19fb1e7d">config_</a>.<a class="code hl_variable" href="structYieldPluginConfig.html#ac9bcf3101e2e858035adbf089cfe57a9">enable_cooperative_behavior</a> &amp;&amp; <a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#ae79ca3ae3dcfb369611d20ffa4ef7660">clc_urgency_</a> &gt; <a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#ab1f62a493a4229d4801841eb19fb1e7d">config_</a>.<a class="code hl_variable" href="structYieldPluginConfig.html#ab38d52251f92d06ed380887824745784">acceptable_urgency</a>)</div>
<div class="line"><a id="l00277" name="l00277"></a><span class="lineno">  277</span>    {</div>
<div class="line"><a id="l00278" name="l00278"></a><span class="lineno">  278</span>      RCLCPP_DEBUG(<a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#aa2f96dc545c04733e8ba11a6f3a0c2c6">nh_</a>-&gt;get_logger(),<span class="stringliteral">&quot;Only consider high urgency clc&quot;</span>);</div>
<div class="line"><a id="l00279" name="l00279"></a><span class="lineno">  279</span>      <span class="keywordflow">if</span> (<a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#ae3f7420f5eccdb7f4b4ec59c7f69ec3f">timesteps_since_last_req_</a> &lt; <a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#ab1f62a493a4229d4801841eb19fb1e7d">config_</a>.<a class="code hl_variable" href="structYieldPluginConfig.html#af17f6b695b3a4372462f7c252ec4daa8">acceptable_passed_timesteps</a>)</div>
<div class="line"><a id="l00280" name="l00280"></a><span class="lineno">  280</span>      {</div>
<div class="line"><a id="l00281" name="l00281"></a><span class="lineno">  281</span>        RCLCPP_DEBUG(<a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#aa2f96dc545c04733e8ba11a6f3a0c2c6">nh_</a>-&gt;get_logger(),<span class="stringliteral">&quot;Yield for CLC. We haven&#39;t received an updated negotiation this timestep&quot;</span>);</div>
<div class="line"><a id="l00282" name="l00282"></a><span class="lineno">  282</span>        yield_trajectory = <a class="code hl_function" href="classyield__plugin_1_1YieldPlugin.html#ad9c9e0e4278774a519de12a6a5f4398f">update_traj_for_cooperative_behavior</a>(original_trajectory, initial_velocity);</div>
<div class="line"><a id="l00283" name="l00283"></a><span class="lineno">  283</span>        <a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#ae3f7420f5eccdb7f4b4ec59c7f69ec3f">timesteps_since_last_req_</a>++;</div>
<div class="line"><a id="l00284" name="l00284"></a><span class="lineno">  284</span>      }</div>
<div class="line"><a id="l00285" name="l00285"></a><span class="lineno">  285</span>      <span class="keywordflow">else</span></div>
<div class="line"><a id="l00286" name="l00286"></a><span class="lineno">  286</span>      {</div>
<div class="line"><a id="l00287" name="l00287"></a><span class="lineno">  287</span>        RCLCPP_DEBUG(<a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#aa2f96dc545c04733e8ba11a6f3a0c2c6">nh_</a>-&gt;get_logger(),<span class="stringliteral">&quot;unreliable CLC communication, switching to object avoidance&quot;</span>);</div>
<div class="line"><a id="l00288" name="l00288"></a><span class="lineno">  288</span>        yield_trajectory = <a class="code hl_function" href="classyield__plugin_1_1YieldPlugin.html#ac1c423b99887ccbf945a86da7b7809f6">update_traj_for_object</a>(original_trajectory, <a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#ade1ae58ef6dfc4c31025162c8c150b0a">external_objects_</a>, initial_velocity); <span class="comment">// Compute the trajectory</span></div>
<div class="line"><a id="l00289" name="l00289"></a><span class="lineno">  289</span>      }</div>
<div class="line"><a id="l00290" name="l00290"></a><span class="lineno">  290</span>    }</div>
<div class="line"><a id="l00291" name="l00291"></a><span class="lineno">  291</span>    <span class="keywordflow">else</span></div>
<div class="line"><a id="l00292" name="l00292"></a><span class="lineno">  292</span>    {</div>
<div class="line"><a id="l00293" name="l00293"></a><span class="lineno">  293</span>      RCLCPP_DEBUG(<a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#aa2f96dc545c04733e8ba11a6f3a0c2c6">nh_</a>-&gt;get_logger(),<span class="stringliteral">&quot;Yield for object avoidance&quot;</span>);</div>
<div class="line"><a id="l00294" name="l00294"></a><span class="lineno">  294</span>      yield_trajectory = <a class="code hl_function" href="classyield__plugin_1_1YieldPlugin.html#ac1c423b99887ccbf945a86da7b7809f6">update_traj_for_object</a>(original_trajectory, <a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#ade1ae58ef6dfc4c31025162c8c150b0a">external_objects_</a>, initial_velocity); <span class="comment">// Compute the trajectory</span></div>
<div class="line"><a id="l00295" name="l00295"></a><span class="lineno">  295</span>    }</div>
<div class="line"><a id="l00296" name="l00296"></a><span class="lineno">  296</span> </div>
<div class="line"><a id="l00297" name="l00297"></a><span class="lineno">  297</span>    <span class="comment">// return original trajectory if no difference in trajectory points a.k.a no collision</span></div>
<div class="line"><a id="l00298" name="l00298"></a><span class="lineno">  298</span>    <span class="keywordflow">if</span> (fabs(<a class="code hl_function" href="namespaceyield__plugin.html#a82b2a694528d42a4af068732befca882">get_trajectory_end_time</a>(original_trajectory) - <a class="code hl_function" href="namespaceyield__plugin.html#a82b2a694528d42a4af068732befca882">get_trajectory_end_time</a>(yield_trajectory)) &lt; <a class="code hl_variable" href="yield__plugin_8cpp.html#a6f9399eaf2efb1b12e797b77909df9ac">EPSILON</a>)</div>
<div class="line"><a id="l00299" name="l00299"></a><span class="lineno">  299</span>    {</div>
<div class="line"><a id="l00300" name="l00300"></a><span class="lineno">  300</span>      resp-&gt;trajectory_plan = original_trajectory;</div>
<div class="line"><a id="l00301" name="l00301"></a><span class="lineno">  301</span>    }</div>
<div class="line"><a id="l00302" name="l00302"></a><span class="lineno">  302</span>    <span class="keywordflow">else</span></div>
<div class="line"><a id="l00303" name="l00303"></a><span class="lineno">  303</span>    {</div>
<div class="line"><a id="l00304" name="l00304"></a><span class="lineno">  304</span>      yield_trajectory.header.frame_id = <span class="stringliteral">&quot;map&quot;</span>;</div>
<div class="line"><a id="l00305" name="l00305"></a><span class="lineno">  305</span>      yield_trajectory.header.stamp = <a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#aa2f96dc545c04733e8ba11a6f3a0c2c6">nh_</a>-&gt;now();</div>
<div class="line"><a id="l00306" name="l00306"></a><span class="lineno">  306</span>      yield_trajectory.trajectory_id = original_trajectory.trajectory_id;</div>
<div class="line"><a id="l00307" name="l00307"></a><span class="lineno">  307</span>      resp-&gt;trajectory_plan = yield_trajectory;</div>
<div class="line"><a id="l00308" name="l00308"></a><span class="lineno">  308</span>    }</div>
<div class="line"><a id="l00309" name="l00309"></a><span class="lineno">  309</span> </div>
<div class="line"><a id="l00310" name="l00310"></a><span class="lineno">  310</span>    rclcpp::Time end_time = system_clock.now();  <span class="comment">// Planning complete</span></div>
<div class="line"><a id="l00311" name="l00311"></a><span class="lineno">  311</span> </div>
<div class="line"><a id="l00312" name="l00312"></a><span class="lineno">  312</span>    <span class="keyword">auto</span> duration = end_time - start_time;</div>
<div class="line"><a id="l00313" name="l00313"></a><span class="lineno">  313</span>    RCLCPP_DEBUG_STREAM(<a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#aa2f96dc545c04733e8ba11a6f3a0c2c6">nh_</a>-&gt;get_logger(), <span class="stringliteral">&quot;ExecutionTime: &quot;</span> &lt;&lt; <a class="code hl_function" href="namespacecarma__cooperative__perception.html#a64b708654c8aecb09122d39577df31b5">std::to_string</a>(duration.seconds()));</div>
<div class="line"><a id="l00314" name="l00314"></a><span class="lineno">  314</span> </div>
<div class="line"><a id="l00315" name="l00315"></a><span class="lineno">  315</span>  }</div>
<div class="line"><a id="l00316" name="l00316"></a><span class="lineno">  316</span> </div>
<div class="line"><a id="l00317" name="l00317"></a><span class="lineno"><a class="line" href="classyield__plugin_1_1YieldPlugin.html#ad9c9e0e4278774a519de12a6a5f4398f">  317</a></span>  carma_planning_msgs::msg::TrajectoryPlan <a class="code hl_function" href="classyield__plugin_1_1YieldPlugin.html#ad9c9e0e4278774a519de12a6a5f4398f">YieldPlugin::update_traj_for_cooperative_behavior</a>(<span class="keyword">const</span> carma_planning_msgs::msg::TrajectoryPlan&amp; original_tp, <span class="keywordtype">double</span> current_speed)</div>
<div class="line"><a id="l00318" name="l00318"></a><span class="lineno">  318</span>  {</div>
<div class="line"><a id="l00319" name="l00319"></a><span class="lineno">  319</span>    carma_planning_msgs::msg::TrajectoryPlan cooperative_trajectory;</div>
<div class="line"><a id="l00320" name="l00320"></a><span class="lineno">  320</span> </div>
<div class="line"><a id="l00321" name="l00321"></a><span class="lineno">  321</span>    <span class="keywordtype">double</span> initial_pos = 0;</div>
<div class="line"><a id="l00322" name="l00322"></a><span class="lineno">  322</span>    <span class="keywordtype">double</span> goal_pos;</div>
<div class="line"><a id="l00323" name="l00323"></a><span class="lineno">  323</span>    <span class="keywordtype">double</span> initial_velocity = current_speed;</div>
<div class="line"><a id="l00324" name="l00324"></a><span class="lineno">  324</span>    <span class="keywordtype">double</span> goal_velocity = <a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#ac1099523a4ea8b3ecc607cf466e42162">req_target_speed_</a>;</div>
<div class="line"><a id="l00325" name="l00325"></a><span class="lineno">  325</span>    <span class="keywordtype">double</span> planning_time = <a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#ad620a98521987c31d004b5aabbf3a620">req_target_plan_time_</a>;</div>
<div class="line"><a id="l00326" name="l00326"></a><span class="lineno">  326</span> </div>
<div class="line"><a id="l00327" name="l00327"></a><span class="lineno">  327</span>    std::vector&lt;lanelet::BasicPoint2d&gt; host_traj_points = {};</div>
<div class="line"><a id="l00328" name="l00328"></a><span class="lineno">  328</span>    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>=0; <a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>&lt;original_tp.trajectory_points.size(); <a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>++)</div>
<div class="line"><a id="l00329" name="l00329"></a><span class="lineno">  329</span>    {</div>
<div class="line"><a id="l00330" name="l00330"></a><span class="lineno">  330</span>      lanelet::BasicPoint2d traj_point;</div>
<div class="line"><a id="l00331" name="l00331"></a><span class="lineno">  331</span>      traj_point.x() = original_tp.trajectory_points.at(<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>).x;</div>
<div class="line"><a id="l00332" name="l00332"></a><span class="lineno">  332</span>      traj_point.y() = original_tp.trajectory_points.at(<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>).y;</div>
<div class="line"><a id="l00333" name="l00333"></a><span class="lineno">  333</span>      host_traj_points.push_back(traj_point);</div>
<div class="line"><a id="l00334" name="l00334"></a><span class="lineno">  334</span>    }</div>
<div class="line"><a id="l00335" name="l00335"></a><span class="lineno">  335</span> </div>
<div class="line"><a id="l00336" name="l00336"></a><span class="lineno">  336</span>    std::vector&lt;std::pair&lt;int, lanelet::BasicPoint2d&gt;&gt; intersection_points = <a class="code hl_function" href="classyield__plugin_1_1YieldPlugin.html#abb40cf8a08a75c472791dbd91b99d8dc">detect_trajectories_intersection</a>(host_traj_points, <a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#a2e806b6f64d4490b88f8947d8a360491">req_trajectory_points_</a>);</div>
<div class="line"><a id="l00337" name="l00337"></a><span class="lineno">  337</span>    <span class="keywordflow">if</span> (!intersection_points.empty())</div>
<div class="line"><a id="l00338" name="l00338"></a><span class="lineno">  338</span>    {</div>
<div class="line"><a id="l00339" name="l00339"></a><span class="lineno">  339</span>      lanelet::BasicPoint2d intersection_point = intersection_points[0].second;</div>
<div class="line"><a id="l00340" name="l00340"></a><span class="lineno">  340</span>      <span class="keywordtype">double</span> dx = original_tp.trajectory_points[0].x - intersection_point.x();</div>
<div class="line"><a id="l00341" name="l00341"></a><span class="lineno">  341</span>      <span class="keywordtype">double</span> dy = original_tp.trajectory_points[0].y - intersection_point.y();</div>
<div class="line"><a id="l00342" name="l00342"></a><span class="lineno">  342</span>      <span class="comment">// check if a digital_gap is available</span></div>
<div class="line"><a id="l00343" name="l00343"></a><span class="lineno">  343</span>      <span class="keywordtype">double</span> digital_gap = <a class="code hl_function" href="classyield__plugin_1_1YieldPlugin.html#a3703b49299aa6b61b3889a8e6799ac74">check_traj_for_digital_min_gap</a>(original_tp);</div>
<div class="line"><a id="l00344" name="l00344"></a><span class="lineno">  344</span>      RCLCPP_DEBUG_STREAM(<a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#aa2f96dc545c04733e8ba11a6f3a0c2c6">nh_</a>-&gt;get_logger(),<span class="stringliteral">&quot;digital_gap: &quot;</span> &lt;&lt; digital_gap);</div>
<div class="line"><a id="l00345" name="l00345"></a><span class="lineno">  345</span>      goal_pos = sqrt(dx*dx + dy*dy) - <a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#ab1f62a493a4229d4801841eb19fb1e7d">config_</a>.<a class="code hl_variable" href="structYieldPluginConfig.html#ada1059dd1218ecd9b513195b775aa633">minimum_safety_gap_in_meters</a>;</div>
<div class="line"><a id="l00346" name="l00346"></a><span class="lineno">  346</span>      RCLCPP_DEBUG_STREAM(<a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#aa2f96dc545c04733e8ba11a6f3a0c2c6">nh_</a>-&gt;get_logger(),<span class="stringliteral">&quot;Goal position (goal_pos): &quot;</span> &lt;&lt; goal_pos);</div>
<div class="line"><a id="l00347" name="l00347"></a><span class="lineno">  347</span>      <span class="keywordtype">double</span> collision_time = <a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#a25b4eec8b5e4648044a4b46570cb4199">req_timestamp_</a> + (intersection_points[0].first * <a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#a7de1720c3d602feb197f52f6ce25fa73">ecef_traj_timestep_</a>) - <a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#ab1f62a493a4229d4801841eb19fb1e7d">config_</a>.<a class="code hl_variable" href="structYieldPluginConfig.html#affc7ab1122ea90f3bd0b377f5ec4af49">safety_collision_time_gap_in_s</a>;</div>
<div class="line"><a id="l00348" name="l00348"></a><span class="lineno">  348</span>      RCLCPP_DEBUG_STREAM(<a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#aa2f96dc545c04733e8ba11a6f3a0c2c6">nh_</a>-&gt;get_logger(),<span class="stringliteral">&quot;req time stamp: &quot;</span> &lt;&lt; <a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#a25b4eec8b5e4648044a4b46570cb4199">req_timestamp_</a>);</div>
<div class="line"><a id="l00349" name="l00349"></a><span class="lineno">  349</span>      RCLCPP_DEBUG_STREAM(<a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#aa2f96dc545c04733e8ba11a6f3a0c2c6">nh_</a>-&gt;get_logger(),<span class="stringliteral">&quot;Collision time: &quot;</span> &lt;&lt; collision_time);</div>
<div class="line"><a id="l00350" name="l00350"></a><span class="lineno">  350</span>      RCLCPP_DEBUG_STREAM(<a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#aa2f96dc545c04733e8ba11a6f3a0c2c6">nh_</a>-&gt;get_logger(),<span class="stringliteral">&quot;intersection num: &quot;</span> &lt;&lt; intersection_points[0].first);</div>
<div class="line"><a id="l00351" name="l00351"></a><span class="lineno">  351</span>      RCLCPP_DEBUG_STREAM(<a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#aa2f96dc545c04733e8ba11a6f3a0c2c6">nh_</a>-&gt;get_logger(),<span class="stringliteral">&quot;Planning time: &quot;</span> &lt;&lt; planning_time);</div>
<div class="line"><a id="l00352" name="l00352"></a><span class="lineno">  352</span>      <span class="comment">// calculate distance traveled from beginning of trajectory to collision point</span></div>
<div class="line"><a id="l00353" name="l00353"></a><span class="lineno">  353</span>      <span class="keywordtype">double</span> dx2 = intersection_point.x() - <a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#a2e806b6f64d4490b88f8947d8a360491">req_trajectory_points_</a>[0].x();</div>
<div class="line"><a id="l00354" name="l00354"></a><span class="lineno">  354</span>      <span class="keywordtype">double</span> dy2 = intersection_point.y() - <a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#a2e806b6f64d4490b88f8947d8a360491">req_trajectory_points_</a>[0].y();</div>
<div class="line"><a id="l00355" name="l00355"></a><span class="lineno">  355</span>      <span class="comment">// calculate incoming trajectory speed from time and distance between trajectory points</span></div>
<div class="line"><a id="l00356" name="l00356"></a><span class="lineno">  356</span>      <span class="keywordtype">double</span> incoming_trajectory_speed = sqrt(dx2*dx2 + dy2*dy2)/(intersection_points[0].first * <a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#a7de1720c3d602feb197f52f6ce25fa73">ecef_traj_timestep_</a>);</div>
<div class="line"><a id="l00357" name="l00357"></a><span class="lineno">  357</span>      <span class="comment">// calculate goal velocity from request trajectory</span></div>
<div class="line"><a id="l00358" name="l00358"></a><span class="lineno">  358</span>      goal_velocity = std::min(goal_velocity, incoming_trajectory_speed);</div>
<div class="line"><a id="l00359" name="l00359"></a><span class="lineno">  359</span>      <span class="keywordtype">double</span> min_time = (initial_velocity - goal_velocity)/<a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#ab1f62a493a4229d4801841eb19fb1e7d">config_</a>.<a class="code hl_variable" href="structYieldPluginConfig.html#a92f70f21fdd60cc19df76491b18c041e">yield_max_deceleration_in_ms2</a>;</div>
<div class="line"><a id="l00360" name="l00360"></a><span class="lineno">  360</span> </div>
<div class="line"><a id="l00361" name="l00361"></a><span class="lineno">  361</span>      RCLCPP_DEBUG_STREAM(<a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#aa2f96dc545c04733e8ba11a6f3a0c2c6">nh_</a>-&gt;get_logger(),<span class="stringliteral">&quot;goal_velocity: &quot;</span> &lt;&lt; goal_velocity);</div>
<div class="line"><a id="l00362" name="l00362"></a><span class="lineno">  362</span>      RCLCPP_DEBUG_STREAM(<a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#aa2f96dc545c04733e8ba11a6f3a0c2c6">nh_</a>-&gt;get_logger(),<span class="stringliteral">&quot;incoming_trajectory_speed: &quot;</span> &lt;&lt; incoming_trajectory_speed);</div>
<div class="line"><a id="l00363" name="l00363"></a><span class="lineno">  363</span> </div>
<div class="line"><a id="l00364" name="l00364"></a><span class="lineno">  364</span>      <span class="keywordflow">if</span> (planning_time &gt; min_time)</div>
<div class="line"><a id="l00365" name="l00365"></a><span class="lineno">  365</span>      {</div>
<div class="line"><a id="l00366" name="l00366"></a><span class="lineno">  366</span>        <a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#ad694d6ea9d5ca884e29f33a48fe19ae3">cooperative_request_acceptable_</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00367" name="l00367"></a><span class="lineno">  367</span>        <span class="keywordtype">double</span> original_max_speed = <a class="code hl_function" href="classyield__plugin_1_1YieldPlugin.html#ae53a42abb996d38cf701a3fba7e473f8">max_trajectory_speed</a>(original_tp.trajectory_points, <a class="code hl_function" href="namespaceyield__plugin.html#a82b2a694528d42a4af068732befca882">get_trajectory_end_time</a>(original_tp));</div>
<div class="line"><a id="l00368" name="l00368"></a><span class="lineno">  368</span>        cooperative_trajectory = <a class="code hl_function" href="classyield__plugin_1_1YieldPlugin.html#ace53f1895cbbf2a5f109cbfc11d6313f">generate_JMT_trajectory</a>(original_tp, initial_pos, goal_pos, initial_velocity, goal_velocity, planning_time, original_max_speed);</div>
<div class="line"><a id="l00369" name="l00369"></a><span class="lineno">  369</span>      }</div>
<div class="line"><a id="l00370" name="l00370"></a><span class="lineno">  370</span>      <span class="keywordflow">else</span></div>
<div class="line"><a id="l00371" name="l00371"></a><span class="lineno">  371</span>      {</div>
<div class="line"><a id="l00372" name="l00372"></a><span class="lineno">  372</span>        <a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#ad694d6ea9d5ca884e29f33a48fe19ae3">cooperative_request_acceptable_</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00373" name="l00373"></a><span class="lineno">  373</span>        RCLCPP_DEBUG(<a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#aa2f96dc545c04733e8ba11a6f3a0c2c6">nh_</a>-&gt;get_logger(),<span class="stringliteral">&quot;The incoming requested trajectory is rejected, due to insufficient gap&quot;</span>);</div>
<div class="line"><a id="l00374" name="l00374"></a><span class="lineno">  374</span>        cooperative_trajectory = original_tp;</div>
<div class="line"><a id="l00375" name="l00375"></a><span class="lineno">  375</span>      }</div>
<div class="line"><a id="l00376" name="l00376"></a><span class="lineno">  376</span> </div>
<div class="line"><a id="l00377" name="l00377"></a><span class="lineno">  377</span>    }</div>
<div class="line"><a id="l00378" name="l00378"></a><span class="lineno">  378</span>    <span class="keywordflow">else</span></div>
<div class="line"><a id="l00379" name="l00379"></a><span class="lineno">  379</span>    {</div>
<div class="line"><a id="l00380" name="l00380"></a><span class="lineno">  380</span>      <a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#ad694d6ea9d5ca884e29f33a48fe19ae3">cooperative_request_acceptable_</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00381" name="l00381"></a><span class="lineno">  381</span>      RCLCPP_DEBUG(<a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#aa2f96dc545c04733e8ba11a6f3a0c2c6">nh_</a>-&gt;get_logger(),<span class="stringliteral">&quot;The incoming requested trajectory does not overlap with host vehicle&#39;s trajectory&quot;</span>);</div>
<div class="line"><a id="l00382" name="l00382"></a><span class="lineno">  382</span>      cooperative_trajectory = original_tp;</div>
<div class="line"><a id="l00383" name="l00383"></a><span class="lineno">  383</span>    }</div>
<div class="line"><a id="l00384" name="l00384"></a><span class="lineno">  384</span> </div>
<div class="line"><a id="l00385" name="l00385"></a><span class="lineno">  385</span>    <span class="keywordflow">return</span> cooperative_trajectory;</div>
<div class="line"><a id="l00386" name="l00386"></a><span class="lineno">  386</span>  }</div>
<div class="line"><a id="l00387" name="l00387"></a><span class="lineno">  387</span> </div>
<div class="line"><a id="l00388" name="l00388"></a><span class="lineno"><a class="line" href="namespaceyield__plugin.html#a6685355374aa80334c267d788788cb2f">  388</a></span>  <span class="keywordtype">double</span> <a class="code hl_function" href="namespaceyield__plugin.html#a6685355374aa80334c267d788788cb2f">get_smallest_time_step_of_traj</a>(<span class="keyword">const</span> carma_planning_msgs::msg::TrajectoryPlan&amp; original_tp)</div>
<div class="line"><a id="l00389" name="l00389"></a><span class="lineno">  389</span>  {</div>
<div class="line"><a id="l00390" name="l00390"></a><span class="lineno">  390</span>    <span class="keywordtype">double</span> smallest_time_step = std::numeric_limits&lt;double&gt;::infinity();</div>
<div class="line"><a id="l00391" name="l00391"></a><span class="lineno">  391</span>    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a> = 0; <a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a> &lt; original_tp.trajectory_points.size() - 1; <a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a> ++)</div>
<div class="line"><a id="l00392" name="l00392"></a><span class="lineno">  392</span>    {</div>
<div class="line"><a id="l00393" name="l00393"></a><span class="lineno">  393</span>      smallest_time_step = std::min(smallest_time_step,</div>
<div class="line"><a id="l00394" name="l00394"></a><span class="lineno">  394</span>        (rclcpp::Time(original_tp.trajectory_points.at(<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a> + 1).target_time)</div>
<div class="line"><a id="l00395" name="l00395"></a><span class="lineno">  395</span>        - rclcpp::Time(original_tp.trajectory_points.at(<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>).target_time)).seconds());</div>
<div class="line"><a id="l00396" name="l00396"></a><span class="lineno">  396</span>    }</div>
<div class="line"><a id="l00397" name="l00397"></a><span class="lineno">  397</span>    RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<span class="stringliteral">&quot;yield_plugin&quot;</span>),<span class="stringliteral">&quot;smallest_time_step: &quot;</span> &lt;&lt; smallest_time_step);</div>
<div class="line"><a id="l00398" name="l00398"></a><span class="lineno">  398</span> </div>
<div class="line"><a id="l00399" name="l00399"></a><span class="lineno">  399</span>    <span class="keywordflow">return</span> smallest_time_step;</div>
<div class="line"><a id="l00400" name="l00400"></a><span class="lineno">  400</span>  }</div>
<div class="line"><a id="l00401" name="l00401"></a><span class="lineno">  401</span> </div>
<div class="line"><a id="l00402" name="l00402"></a><span class="lineno"><a class="line" href="classyield__plugin_1_1YieldPlugin.html#ace53f1895cbbf2a5f109cbfc11d6313f">  402</a></span>  carma_planning_msgs::msg::TrajectoryPlan <a class="code hl_function" href="classyield__plugin_1_1YieldPlugin.html#ace53f1895cbbf2a5f109cbfc11d6313f">YieldPlugin::generate_JMT_trajectory</a>(<span class="keyword">const</span> carma_planning_msgs::msg::TrajectoryPlan&amp; original_tp, <span class="keywordtype">double</span> initial_pos, <span class="keywordtype">double</span> goal_pos,</div>
<div class="line"><a id="l00403" name="l00403"></a><span class="lineno">  403</span>    <span class="keywordtype">double</span> initial_velocity, <span class="keywordtype">double</span> goal_velocity, <span class="keywordtype">double</span> planning_time, <span class="keywordtype">double</span> original_max_speed)</div>
<div class="line"><a id="l00404" name="l00404"></a><span class="lineno">  404</span>  {</div>
<div class="line"><a id="l00405" name="l00405"></a><span class="lineno">  405</span>    carma_planning_msgs::msg::TrajectoryPlan jmt_trajectory;</div>
<div class="line"><a id="l00406" name="l00406"></a><span class="lineno">  406</span>    std::vector&lt;carma_planning_msgs::msg::TrajectoryPlanPoint&gt; jmt_trajectory_points;</div>
<div class="line"><a id="l00407" name="l00407"></a><span class="lineno">  407</span>    jmt_trajectory_points.push_back(original_tp.trajectory_points[0]);</div>
<div class="line"><a id="l00408" name="l00408"></a><span class="lineno">  408</span> </div>
<div class="line"><a id="l00409" name="l00409"></a><span class="lineno">  409</span>    std::vector&lt;double&gt; original_traj_relative_downtracks = <a class="code hl_function" href="classyield__plugin_1_1YieldPlugin.html#a1bc011c9c2db48289bf40214d972cec4">get_relative_downtracks</a>(original_tp);</div>
<div class="line"><a id="l00410" name="l00410"></a><span class="lineno">  410</span>    std::vector&lt;double&gt; calculated_speeds = {};</div>
<div class="line"><a id="l00411" name="l00411"></a><span class="lineno">  411</span>    std::vector&lt;double&gt; new_relative_downtracks = {};</div>
<div class="line"><a id="l00412" name="l00412"></a><span class="lineno">  412</span>    new_relative_downtracks.push_back(0.0);</div>
<div class="line"><a id="l00413" name="l00413"></a><span class="lineno">  413</span>    calculated_speeds.push_back(initial_velocity);</div>
<div class="line"><a id="l00414" name="l00414"></a><span class="lineno">  414</span>    <span class="keywordtype">double</span> new_traj_accumulated_downtrack = 0.0;</div>
<div class="line"><a id="l00415" name="l00415"></a><span class="lineno">  415</span>    <span class="keywordtype">double</span> original_traj_accumulated_downtrack = original_traj_relative_downtracks.at(1);</div>
<div class="line"><a id="l00416" name="l00416"></a><span class="lineno">  416</span> </div>
<div class="line"><a id="l00417" name="l00417"></a><span class="lineno">  417</span>    <span class="comment">// Up until goal_pos (which also can be until end of the entire original trajectory), generate new speeds at</span></div>
<div class="line"><a id="l00418" name="l00418"></a><span class="lineno">  418</span>    <span class="comment">// or near original trajectory points by generating them at a fixed time interval using the JMT polynomial equation</span></div>
<div class="line"><a id="l00419" name="l00419"></a><span class="lineno">  419</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> initial_time = 0;</div>
<div class="line"><a id="l00420" name="l00420"></a><span class="lineno">  420</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> initial_accel = 0;</div>
<div class="line"><a id="l00421" name="l00421"></a><span class="lineno">  421</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> goal_accel = 0;</div>
<div class="line"><a id="l00422" name="l00422"></a><span class="lineno">  422</span>    <span class="keywordtype">int</span> new_traj_idx = 1;</div>
<div class="line"><a id="l00423" name="l00423"></a><span class="lineno">  423</span>    <span class="keywordtype">int</span> original_traj_idx = 1;</div>
<div class="line"><a id="l00424" name="l00424"></a><span class="lineno">  424</span>    RCLCPP_DEBUG_STREAM(<a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#aa2f96dc545c04733e8ba11a6f3a0c2c6">nh_</a>-&gt;get_logger(),<span class="stringliteral">&quot;Following parameters used for JMT: &quot;</span></div>
<div class="line"><a id="l00425" name="l00425"></a><span class="lineno">  425</span>      <span class="stringliteral">&quot;\ninitial_pos: &quot;</span> &lt;&lt; initial_pos &lt;&lt;</div>
<div class="line"><a id="l00426" name="l00426"></a><span class="lineno">  426</span>      <span class="stringliteral">&quot;\ngoal_pos: &quot;</span> &lt;&lt; goal_pos &lt;&lt;</div>
<div class="line"><a id="l00427" name="l00427"></a><span class="lineno">  427</span>      <span class="stringliteral">&quot;\ninitial_velocity: &quot;</span> &lt;&lt; initial_velocity &lt;&lt;</div>
<div class="line"><a id="l00428" name="l00428"></a><span class="lineno">  428</span>      <span class="stringliteral">&quot;\ngoal_velocity: &quot;</span> &lt;&lt; goal_velocity &lt;&lt;</div>
<div class="line"><a id="l00429" name="l00429"></a><span class="lineno">  429</span>      <span class="stringliteral">&quot;\ninitial_accel: &quot;</span> &lt;&lt; initial_accel &lt;&lt;</div>
<div class="line"><a id="l00430" name="l00430"></a><span class="lineno">  430</span>      <span class="stringliteral">&quot;\ngoal_accel: &quot;</span> &lt;&lt; goal_accel &lt;&lt;</div>
<div class="line"><a id="l00431" name="l00431"></a><span class="lineno">  431</span>      <span class="stringliteral">&quot;\nplanning_time: &quot;</span> &lt;&lt; planning_time &lt;&lt;</div>
<div class="line"><a id="l00432" name="l00432"></a><span class="lineno">  432</span>      <span class="stringliteral">&quot;\noriginal_max_speed: &quot;</span> &lt;&lt; original_max_speed);</div>
<div class="line"><a id="l00433" name="l00433"></a><span class="lineno">  433</span> </div>
<div class="line"><a id="l00434" name="l00434"></a><span class="lineno">  434</span>    <span class="comment">// Get the polynomial solutions used to generate the trajectory</span></div>
<div class="line"><a id="l00435" name="l00435"></a><span class="lineno">  435</span>    std::vector&lt;double&gt; polynomial_coefficients = quintic_coefficient_calculator::quintic_coefficient_calculator(initial_pos,</div>
<div class="line"><a id="l00436" name="l00436"></a><span class="lineno">  436</span>                                                                                                goal_pos,</div>
<div class="line"><a id="l00437" name="l00437"></a><span class="lineno">  437</span>                                                                                                initial_velocity,</div>
<div class="line"><a id="l00438" name="l00438"></a><span class="lineno">  438</span>                                                                                                goal_velocity,</div>
<div class="line"><a id="l00439" name="l00439"></a><span class="lineno">  439</span>                                                                                                initial_accel,</div>
<div class="line"><a id="l00440" name="l00440"></a><span class="lineno">  440</span>                                                                                                goal_accel,</div>
<div class="line"><a id="l00441" name="l00441"></a><span class="lineno">  441</span>                                                                                                initial_time,</div>
<div class="line"><a id="l00442" name="l00442"></a><span class="lineno">  442</span>                                                                                                planning_time);</div>
<div class="line"><a id="l00443" name="l00443"></a><span class="lineno">  443</span>    RCLCPP_DEBUG_STREAM(<a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#aa2f96dc545c04733e8ba11a6f3a0c2c6">nh_</a>-&gt;get_logger(),<span class="stringliteral">&quot;Used original_max_speed: &quot;</span> &lt;&lt; original_max_speed);</div>
<div class="line"><a id="l00444" name="l00444"></a><span class="lineno">  444</span>    <span class="keyword">const</span> <span class="keyword">auto</span> smallest_time_step = <a class="code hl_function" href="namespaceyield__plugin.html#a6685355374aa80334c267d788788cb2f">get_smallest_time_step_of_traj</a>(original_tp);</div>
<div class="line"><a id="l00445" name="l00445"></a><span class="lineno">  445</span>    <span class="keywordflow">while</span> (new_traj_accumulated_downtrack &lt; goal_pos - <a class="code hl_variable" href="yield__plugin_8cpp.html#a6f9399eaf2efb1b12e797b77909df9ac">EPSILON</a> &amp;&amp; original_traj_idx &lt; original_traj_relative_downtracks.size())</div>
<div class="line"><a id="l00446" name="l00446"></a><span class="lineno">  446</span>    {</div>
<div class="line"><a id="l00447" name="l00447"></a><span class="lineno">  447</span>      <span class="keyword">const</span> <span class="keywordtype">double</span> target_time = new_traj_idx * smallest_time_step;</div>
<div class="line"><a id="l00448" name="l00448"></a><span class="lineno">  448</span>      <span class="keyword">const</span> <span class="keywordtype">double</span> downtrack_at_target_time = <a class="code hl_function" href="classyield__plugin_1_1YieldPlugin.html#ae7ffd46ccbae6de4b60a7f49a8cfa3d6">polynomial_calc</a>(polynomial_coefficients, target_time);</div>
<div class="line"><a id="l00449" name="l00449"></a><span class="lineno">  449</span>      <span class="keywordtype">double</span> velocity_at_target_time = <a class="code hl_function" href="classyield__plugin_1_1YieldPlugin.html#afeab08ed138eafe6e24abd775c3163dd">polynomial_calc_d</a>(polynomial_coefficients, target_time);</div>
<div class="line"><a id="l00450" name="l00450"></a><span class="lineno">  450</span> </div>
<div class="line"><a id="l00451" name="l00451"></a><span class="lineno">  451</span>      RCLCPP_DEBUG_STREAM(<a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#aa2f96dc545c04733e8ba11a6f3a0c2c6">nh_</a>-&gt;get_logger(), <span class="stringliteral">&quot;Calculated speed velocity_at_target_time: &quot;</span> &lt;&lt; velocity_at_target_time</div>
<div class="line"><a id="l00452" name="l00452"></a><span class="lineno">  452</span>        &lt;&lt; <span class="stringliteral">&quot;, downtrack_at_target_time: &quot;</span>&lt;&lt; downtrack_at_target_time &lt;&lt; <span class="stringliteral">&quot;, target_time: &quot;</span> &lt;&lt; target_time);</div>
<div class="line"><a id="l00453" name="l00453"></a><span class="lineno">  453</span> </div>
<div class="line"><a id="l00454" name="l00454"></a><span class="lineno">  454</span>      <span class="comment">// if the speed becomes negative, the downtrack starts reversing to negative as well</span></div>
<div class="line"><a id="l00455" name="l00455"></a><span class="lineno">  455</span>      <span class="comment">// which will never reach the goal_pos, so break here.</span></div>
<div class="line"><a id="l00456" name="l00456"></a><span class="lineno">  456</span>      <span class="keywordflow">if</span> (velocity_at_target_time &lt; 0.0)</div>
<div class="line"><a id="l00457" name="l00457"></a><span class="lineno">  457</span>      {</div>
<div class="line"><a id="l00458" name="l00458"></a><span class="lineno">  458</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00459" name="l00459"></a><span class="lineno">  459</span>      }</div>
<div class="line"><a id="l00460" name="l00460"></a><span class="lineno">  460</span> </div>
<div class="line"><a id="l00461" name="l00461"></a><span class="lineno">  461</span>      <span class="comment">// Cannot have a negative speed or have a higher speed than that of the original trajectory</span></div>
<div class="line"><a id="l00462" name="l00462"></a><span class="lineno">  462</span>      velocity_at_target_time = std::clamp(velocity_at_target_time, 0.0, original_max_speed);</div>
<div class="line"><a id="l00463" name="l00463"></a><span class="lineno">  463</span> </div>
<div class="line"><a id="l00464" name="l00464"></a><span class="lineno">  464</span>      <span class="comment">// Pick the speed if it matches with the original downtracks</span></div>
<div class="line"><a id="l00465" name="l00465"></a><span class="lineno">  465</span>      <span class="keywordflow">if</span> (downtrack_at_target_time &gt;= original_traj_accumulated_downtrack)</div>
<div class="line"><a id="l00466" name="l00466"></a><span class="lineno">  466</span>      {</div>
<div class="line"><a id="l00467" name="l00467"></a><span class="lineno">  467</span>        RCLCPP_DEBUG_STREAM(<a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#aa2f96dc545c04733e8ba11a6f3a0c2c6">nh_</a>-&gt;get_logger(), <span class="stringliteral">&quot;Picked calculated speed velocity_at_target_time: &quot;</span> &lt;&lt; velocity_at_target_time</div>
<div class="line"><a id="l00468" name="l00468"></a><span class="lineno">  468</span>          &lt;&lt; <span class="stringliteral">&quot;, downtrack_at_target_time: &quot;</span>&lt;&lt; downtrack_at_target_time &lt;&lt; <span class="stringliteral">&quot;, target_time: &quot;</span> &lt;&lt; target_time);</div>
<div class="line"><a id="l00469" name="l00469"></a><span class="lineno">  469</span>        <span class="comment">// velocity_at_target_time doesn&#39;t exactly correspond to original_traj_accumulated_downtrack but does for new_traj_accumulated_downtrack.</span></div>
<div class="line"><a id="l00470" name="l00470"></a><span class="lineno">  470</span>        <span class="comment">// however, the logic is assuming they are close enough that the speed is usable</span></div>
<div class="line"><a id="l00471" name="l00471"></a><span class="lineno">  471</span>        calculated_speeds.push_back(velocity_at_target_time);</div>
<div class="line"><a id="l00472" name="l00472"></a><span class="lineno">  472</span>        original_traj_accumulated_downtrack += original_traj_relative_downtracks.at(original_traj_idx);</div>
<div class="line"><a id="l00473" name="l00473"></a><span class="lineno">  473</span>        original_traj_idx ++;</div>
<div class="line"><a id="l00474" name="l00474"></a><span class="lineno">  474</span>      }</div>
<div class="line"><a id="l00475" name="l00475"></a><span class="lineno">  475</span>      new_traj_accumulated_downtrack = downtrack_at_target_time;</div>
<div class="line"><a id="l00476" name="l00476"></a><span class="lineno">  476</span>      new_traj_idx++;</div>
<div class="line"><a id="l00477" name="l00477"></a><span class="lineno">  477</span> </div>
<div class="line"><a id="l00478" name="l00478"></a><span class="lineno">  478</span>    }</div>
<div class="line"><a id="l00479" name="l00479"></a><span class="lineno">  479</span> </div>
<div class="line"><a id="l00480" name="l00480"></a><span class="lineno">  480</span>    <span class="comment">// if the loop above finished prematurely due to negative speed, fill with 0.0 speeds</span></div>
<div class="line"><a id="l00481" name="l00481"></a><span class="lineno">  481</span>    <span class="comment">// since the speed crossed 0.0 and algorithm indicates stopping</span></div>
<div class="line"><a id="l00482" name="l00482"></a><span class="lineno">  482</span>    std::fill_n(std::back_inserter(calculated_speeds),</div>
<div class="line"><a id="l00483" name="l00483"></a><span class="lineno">  483</span>                std::size(original_traj_relative_downtracks) - std::size(calculated_speeds),</div>
<div class="line"><a id="l00484" name="l00484"></a><span class="lineno">  484</span>                0.0);</div>
<div class="line"><a id="l00485" name="l00485"></a><span class="lineno">  485</span> </div>
<div class="line"><a id="l00486" name="l00486"></a><span class="lineno">  486</span>    <span class="comment">// Moving average filter to smoothen the speeds</span></div>
<div class="line"><a id="l00487" name="l00487"></a><span class="lineno">  487</span>    std::vector&lt;double&gt; filtered_speeds = <a class="code hl_function" href="namespacebasic__autonomy_1_1smoothing.html#afb726e75a21ada8efa3ca5561ffc9984">basic_autonomy::smoothing::moving_average_filter</a>(calculated_speeds, <a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#ab1f62a493a4229d4801841eb19fb1e7d">config_</a>.<a class="code hl_variable" href="structYieldPluginConfig.html#a712ad260a3344fe9828d6022211743fe">speed_moving_average_window_size</a>);</div>
<div class="line"><a id="l00488" name="l00488"></a><span class="lineno">  488</span>    RCLCPP_DEBUG_STREAM(<a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#aa2f96dc545c04733e8ba11a6f3a0c2c6">nh_</a>-&gt;get_logger(), <span class="stringliteral">&quot;filtered_speeds size: &quot;</span> &lt;&lt; filtered_speeds.size());</div>
<div class="line"><a id="l00489" name="l00489"></a><span class="lineno">  489</span> </div>
<div class="line"><a id="l00490" name="l00490"></a><span class="lineno">  490</span>    <span class="comment">// Replace the original trajectory&#39;s associated timestamps based on the newly calculated speeds</span></div>
<div class="line"><a id="l00491" name="l00491"></a><span class="lineno">  491</span>    <span class="keywordtype">double</span> prev_speed = filtered_speeds.at(0);</div>
<div class="line"><a id="l00492" name="l00492"></a><span class="lineno">  492</span>    RCLCPP_DEBUG_STREAM(<a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#aa2f96dc545c04733e8ba11a6f3a0c2c6">nh_</a>-&gt;get_logger(), <span class="stringliteral">&quot;start speed: &quot;</span> &lt;&lt; prev_speed &lt;&lt; <span class="stringliteral">&quot;, target_time: &quot;</span> &lt;&lt; <a class="code hl_function" href="namespacecarma__cooperative__perception.html#a64b708654c8aecb09122d39577df31b5">std::to_string</a>(rclcpp::Time(original_tp.trajectory_points[0].target_time).seconds()));</div>
<div class="line"><a id="l00493" name="l00493"></a><span class="lineno">  493</span> </div>
<div class="line"><a id="l00494" name="l00494"></a><span class="lineno">  494</span>    <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> <a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a> = 1; <a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a> &lt; original_tp.trajectory_points.size(); <a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>++)</div>
<div class="line"><a id="l00495" name="l00495"></a><span class="lineno">  495</span>    {</div>
<div class="line"><a id="l00496" name="l00496"></a><span class="lineno">  496</span>      carma_planning_msgs::msg::TrajectoryPlanPoint jmt_tpp = original_tp.trajectory_points.at(<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>);</div>
<div class="line"><a id="l00497" name="l00497"></a><span class="lineno">  497</span> </div>
<div class="line"><a id="l00498" name="l00498"></a><span class="lineno">  498</span>      <span class="comment">// In case only subset of original trajectory needs modification,</span></div>
<div class="line"><a id="l00499" name="l00499"></a><span class="lineno">  499</span>      <span class="comment">// the rest of the points should keep the last speed to cruise</span></div>
<div class="line"><a id="l00500" name="l00500"></a><span class="lineno">  500</span>      <span class="keywordtype">double</span> current_speed = goal_velocity;</div>
<div class="line"><a id="l00501" name="l00501"></a><span class="lineno">  501</span> </div>
<div class="line"><a id="l00502" name="l00502"></a><span class="lineno">  502</span>      <span class="keywordflow">if</span> (<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a> &lt; filtered_speeds.size())</div>
<div class="line"><a id="l00503" name="l00503"></a><span class="lineno">  503</span>      {</div>
<div class="line"><a id="l00504" name="l00504"></a><span class="lineno">  504</span>        current_speed = filtered_speeds.at(<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>);</div>
<div class="line"><a id="l00505" name="l00505"></a><span class="lineno">  505</span>      }</div>
<div class="line"><a id="l00506" name="l00506"></a><span class="lineno">  506</span> </div>
<div class="line"><a id="l00507" name="l00507"></a><span class="lineno">  507</span>      <span class="comment">//Force the speed to 0 if below configured value for more control over stopping behavior</span></div>
<div class="line"><a id="l00508" name="l00508"></a><span class="lineno">  508</span>      <span class="keywordflow">if</span> (current_speed &lt; <a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#ab1f62a493a4229d4801841eb19fb1e7d">config_</a>.<a class="code hl_variable" href="structYieldPluginConfig.html#a17c3152e5b5091ad40df3a4ee8969b25">max_stop_speed_in_ms</a>)</div>
<div class="line"><a id="l00509" name="l00509"></a><span class="lineno">  509</span>      {</div>
<div class="line"><a id="l00510" name="l00510"></a><span class="lineno">  510</span>        current_speed = 0;</div>
<div class="line"><a id="l00511" name="l00511"></a><span class="lineno">  511</span>      }</div>
<div class="line"><a id="l00512" name="l00512"></a><span class="lineno">  512</span> </div>
<div class="line"><a id="l00513" name="l00513"></a><span class="lineno">  513</span>      <span class="comment">// Derived from constant accelaration kinematic equation: (vi + vf) / 2 * dt = d_dist</span></div>
<div class="line"><a id="l00514" name="l00514"></a><span class="lineno">  514</span>      <span class="comment">// This also handles a case correctly when current_speed is 0, but prev_speed is not 0 yet</span></div>
<div class="line"><a id="l00515" name="l00515"></a><span class="lineno">  515</span>      <span class="keyword">const</span> <span class="keywordtype">double</span> dt = (2 * original_traj_relative_downtracks.at(<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>)) / (current_speed + prev_speed);</div>
<div class="line"><a id="l00516" name="l00516"></a><span class="lineno">  516</span>      jmt_tpp.target_time =  rclcpp::Time(jmt_trajectory_points.back().target_time) + rclcpp::Duration(dt*1e9);</div>
<div class="line"><a id="l00517" name="l00517"></a><span class="lineno">  517</span> </div>
<div class="line"><a id="l00518" name="l00518"></a><span class="lineno">  518</span>      <span class="keywordflow">if</span> (prev_speed &lt; <a class="code hl_variable" href="yield__plugin_8cpp.html#a6f9399eaf2efb1b12e797b77909df9ac">EPSILON</a>) <span class="comment">// Handle a special case if prev_speed (thus current_speed too) is 0</span></div>
<div class="line"><a id="l00519" name="l00519"></a><span class="lineno">  519</span>      {</div>
<div class="line"><a id="l00520" name="l00520"></a><span class="lineno">  520</span>        <span class="comment">// NOTE: Assigning arbitrary 100 mins dt between points where normally dt is only 1 sec to model a stopping behavior.</span></div>
<div class="line"><a id="l00521" name="l00521"></a><span class="lineno">  521</span>        <span class="comment">// Another way to model it is to keep the trajectory point at a same location and increment time slightly. However,</span></div>
<div class="line"><a id="l00522" name="l00522"></a><span class="lineno">  522</span>        <span class="comment">// if the vehicle goes past the point, it may cruise toward undesirable location (for example into the intersection).</span></div>
<div class="line"><a id="l00523" name="l00523"></a><span class="lineno">  523</span>        <span class="comment">// Keeping the points help the controller steer the vehicle toward direction of travel even when stopping.</span></div>
<div class="line"><a id="l00524" name="l00524"></a><span class="lineno">  524</span>        <span class="comment">// Only downside is the trajectory plan is huge where only 15 sec is expected, but since this is stopping case, it shouldn&#39;t matter.</span></div>
<div class="line"><a id="l00525" name="l00525"></a><span class="lineno">  525</span>        jmt_tpp.target_time = rclcpp::Time(jmt_trajectory_points.back().target_time) + rclcpp::Duration(6000 * 1e9);</div>
<div class="line"><a id="l00526" name="l00526"></a><span class="lineno">  526</span>        RCLCPP_DEBUG_STREAM(<a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#aa2f96dc545c04733e8ba11a6f3a0c2c6">nh_</a>-&gt;get_logger(), <span class="stringliteral">&quot;Zero speed = x: &quot;</span> &lt;&lt; jmt_tpp.x &lt;&lt; <span class="stringliteral">&quot;, y:&quot;</span> &lt;&lt; jmt_tpp.y</div>
<div class="line"><a id="l00527" name="l00527"></a><span class="lineno">  527</span>          &lt;&lt; <span class="stringliteral">&quot;, t:&quot;</span> &lt;&lt; <a class="code hl_function" href="namespacecarma__cooperative__perception.html#a64b708654c8aecb09122d39577df31b5">std::to_string</a>(rclcpp::Time(jmt_tpp.target_time).seconds())</div>
<div class="line"><a id="l00528" name="l00528"></a><span class="lineno">  528</span>          &lt;&lt; <span class="stringliteral">&quot;, prev_speed: &quot;</span> &lt;&lt; prev_speed &lt;&lt; <span class="stringliteral">&quot;, current_speed: &quot;</span> &lt;&lt; current_speed);</div>
<div class="line"><a id="l00529" name="l00529"></a><span class="lineno">  529</span>      }</div>
<div class="line"><a id="l00530" name="l00530"></a><span class="lineno">  530</span>      <span class="keywordflow">else</span></div>
<div class="line"><a id="l00531" name="l00531"></a><span class="lineno">  531</span>      {</div>
<div class="line"><a id="l00532" name="l00532"></a><span class="lineno">  532</span>        RCLCPP_DEBUG_STREAM(<a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#aa2f96dc545c04733e8ba11a6f3a0c2c6">nh_</a>-&gt;get_logger(), <span class="stringliteral">&quot;Non-zero speed = x: &quot;</span> &lt;&lt; jmt_tpp.x &lt;&lt; <span class="stringliteral">&quot;, y:&quot;</span> &lt;&lt; jmt_tpp.y</div>
<div class="line"><a id="l00533" name="l00533"></a><span class="lineno">  533</span>          &lt;&lt; <span class="stringliteral">&quot;, t:&quot;</span> &lt;&lt; <a class="code hl_function" href="namespacecarma__cooperative__perception.html#a64b708654c8aecb09122d39577df31b5">std::to_string</a>(rclcpp::Time(jmt_tpp.target_time).seconds())</div>
<div class="line"><a id="l00534" name="l00534"></a><span class="lineno">  534</span>          &lt;&lt; <span class="stringliteral">&quot;, prev_speed: &quot;</span> &lt;&lt; prev_speed &lt;&lt; <span class="stringliteral">&quot;, current_speed: &quot;</span> &lt;&lt; current_speed);</div>
<div class="line"><a id="l00535" name="l00535"></a><span class="lineno">  535</span>      }</div>
<div class="line"><a id="l00536" name="l00536"></a><span class="lineno">  536</span> </div>
<div class="line"><a id="l00537" name="l00537"></a><span class="lineno">  537</span>      jmt_trajectory_points.push_back(jmt_tpp);</div>
<div class="line"><a id="l00538" name="l00538"></a><span class="lineno">  538</span>      <span class="keywordtype">double</span> insta_decel = (current_speed - prev_speed) / (rclcpp::Time(jmt_trajectory_points.at(<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>).target_time).seconds() - rclcpp::Time(jmt_trajectory_points.at(<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a> - 1).target_time).seconds());</div>
<div class="line"><a id="l00539" name="l00539"></a><span class="lineno">  539</span>      RCLCPP_DEBUG_STREAM(<a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#aa2f96dc545c04733e8ba11a6f3a0c2c6">nh_</a>-&gt;get_logger(), <span class="stringliteral">&quot;insta_decel: &quot;</span> &lt;&lt; insta_decel );</div>
<div class="line"><a id="l00540" name="l00540"></a><span class="lineno">  540</span>      prev_speed = current_speed;</div>
<div class="line"><a id="l00541" name="l00541"></a><span class="lineno">  541</span>    }</div>
<div class="line"><a id="l00542" name="l00542"></a><span class="lineno">  542</span> </div>
<div class="line"><a id="l00543" name="l00543"></a><span class="lineno">  543</span>    jmt_trajectory.header = original_tp.header;</div>
<div class="line"><a id="l00544" name="l00544"></a><span class="lineno">  544</span>    jmt_trajectory.trajectory_id = original_tp.trajectory_id;</div>
<div class="line"><a id="l00545" name="l00545"></a><span class="lineno">  545</span>    jmt_trajectory.trajectory_points = jmt_trajectory_points;</div>
<div class="line"><a id="l00546" name="l00546"></a><span class="lineno">  546</span>    jmt_trajectory.initial_longitudinal_velocity = initial_velocity;</div>
<div class="line"><a id="l00547" name="l00547"></a><span class="lineno">  547</span>    <span class="keywordflow">return</span> jmt_trajectory;</div>
<div class="line"><a id="l00548" name="l00548"></a><span class="lineno">  548</span>  }</div>
<div class="line"><a id="l00549" name="l00549"></a><span class="lineno">  549</span> </div>
<div class="line"><a id="l00550" name="l00550"></a><span class="lineno"><a class="line" href="classyield__plugin_1_1YieldPlugin.html#ab60b2f939cebede3a6d9a3ae5529b0d9">  550</a></span>  std::optional&lt;GetCollisionResult&gt; <a class="code hl_function" href="classyield__plugin_1_1YieldPlugin.html#ab60b2f939cebede3a6d9a3ae5529b0d9">YieldPlugin::get_collision</a>(<span class="keyword">const</span> carma_planning_msgs::msg::TrajectoryPlan&amp; trajectory1,</div>
<div class="line"><a id="l00551" name="l00551"></a><span class="lineno">  551</span>    <span class="keyword">const</span> std::vector&lt;carma_perception_msgs::msg::PredictedState&gt;&amp; trajectory2, <span class="keywordtype">double</span> collision_radius, <span class="keywordtype">double</span> trajectory1_max_speed)</div>
<div class="line"><a id="l00552" name="l00552"></a><span class="lineno">  552</span>  {</div>
<div class="line"><a id="l00553" name="l00553"></a><span class="lineno">  553</span> </div>
<div class="line"><a id="l00554" name="l00554"></a><span class="lineno">  554</span>    <span class="comment">// Iterate through each pair of consecutive points in the trajectories</span></div>
<div class="line"><a id="l00555" name="l00555"></a><span class="lineno">  555</span>    RCLCPP_DEBUG_STREAM(<a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#aa2f96dc545c04733e8ba11a6f3a0c2c6">nh_</a>-&gt;get_logger(), <span class="stringliteral">&quot;Starting a new collision detection, trajectory size: &quot;</span></div>
<div class="line"><a id="l00556" name="l00556"></a><span class="lineno">  556</span>      &lt;&lt; trajectory1.trajectory_points.size() &lt;&lt; <span class="stringliteral">&quot;. prediction size: &quot;</span> &lt;&lt; trajectory2.size());</div>
<div class="line"><a id="l00557" name="l00557"></a><span class="lineno">  557</span> </div>
<div class="line"><a id="l00558" name="l00558"></a><span class="lineno">  558</span>    <span class="comment">// Iterate through the object to check if it&#39;s on the route</span></div>
<div class="line"><a id="l00559" name="l00559"></a><span class="lineno">  559</span>    <span class="keywordtype">bool</span> on_route = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00560" name="l00560"></a><span class="lineno">  560</span>    <span class="keywordtype">int</span> on_route_idx = 0;</div>
<div class="line"><a id="l00561" name="l00561"></a><span class="lineno">  561</span> </div>
<div class="line"><a id="l00562" name="l00562"></a><span class="lineno">  562</span>    <span class="comment">// A flag to stop searching more than one lanelet if the object has no velocity</span></div>
<div class="line"><a id="l00563" name="l00563"></a><span class="lineno">  563</span>    <span class="keyword">const</span> <span class="keyword">auto</span> traj2_speed{std::hypot(trajectory2.front().predicted_velocity.linear.x,</div>
<div class="line"><a id="l00564" name="l00564"></a><span class="lineno">  564</span>                                  trajectory2.front().predicted_velocity.linear.y)};</div>
<div class="line"><a id="l00565" name="l00565"></a><span class="lineno">  565</span>    <span class="keywordtype">bool</span> traj2_has_zero_speed = traj2_speed &lt; <a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#ab1f62a493a4229d4801841eb19fb1e7d">config_</a>.<a class="code hl_variable" href="structYieldPluginConfig.html#abe6d1c18b2a7f34566828c71eb4573ef">obstacle_zero_speed_threshold_in_ms</a>;</div>
<div class="line"><a id="l00566" name="l00566"></a><span class="lineno">  566</span> </div>
<div class="line"><a id="l00567" name="l00567"></a><span class="lineno">  567</span>    <span class="keywordflow">if</span> (trajectory2.size() &lt; 2)</div>
<div class="line"><a id="l00568" name="l00568"></a><span class="lineno">  568</span>    {</div>
<div class="line"><a id="l00569" name="l00569"></a><span class="lineno">  569</span>      <span class="keywordflow">throw</span> std::invalid_argument(<span class="stringliteral">&quot;Object on ther road doesn&#39;t have enough predicted states! Please check motion_computation is correctly applying predicted states&quot;</span>);</div>
<div class="line"><a id="l00570" name="l00570"></a><span class="lineno">  570</span>    }</div>
<div class="line"><a id="l00571" name="l00571"></a><span class="lineno">  571</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> predict_step_duration = (rclcpp::Time(trajectory2.at(1).header.stamp) - rclcpp::Time(trajectory2.front().header.stamp)).seconds();</div>
<div class="line"><a id="l00572" name="l00572"></a><span class="lineno">  572</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> predict_total_duration = <a class="code hl_function" href="namespaceyield__plugin.html#ad78fa1e6a7a22eff6b76dd32700fc55f">get_trajectory_duration</a>(trajectory2);</div>
<div class="line"><a id="l00573" name="l00573"></a><span class="lineno">  573</span> </div>
<div class="line"><a id="l00574" name="l00574"></a><span class="lineno">  574</span>    <span class="keywordflow">if</span> (predict_step_duration &lt; 0.0)</div>
<div class="line"><a id="l00575" name="l00575"></a><span class="lineno">  575</span>    {</div>
<div class="line"><a id="l00576" name="l00576"></a><span class="lineno">  576</span>      <span class="keywordflow">throw</span> std::invalid_argument(<span class="stringliteral">&quot;Predicted states of the object is malformed. Detected trajectory going backwards in time!&quot;</span>);</div>
<div class="line"><a id="l00577" name="l00577"></a><span class="lineno">  577</span>    }</div>
<div class="line"><a id="l00578" name="l00578"></a><span class="lineno">  578</span> </div>
<div class="line"><a id="l00579" name="l00579"></a><span class="lineno">  579</span>    <span class="comment">// In order to optimize the for loops for comparing two trajectories, following logic skips every iteration_stride-th points of the traj2.</span></div>
<div class="line"><a id="l00580" name="l00580"></a><span class="lineno">  580</span>    <span class="comment">// Since skipping number of points from the traj2 may result in ignoring potential collisions, its value is dependent on two</span></div>
<div class="line"><a id="l00581" name="l00581"></a><span class="lineno">  581</span>    <span class="comment">// trajectories&#39; speeds and intervehicle_collision_distance_in_m radius.</span></div>
<div class="line"><a id="l00582" name="l00582"></a><span class="lineno">  582</span>    <span class="comment">// Therefore, the derivation first calculates the max time, t, that both actors can move while still being in collision radius:</span></div>
<div class="line"><a id="l00583" name="l00583"></a><span class="lineno">  583</span>    <span class="comment">// sqrt( (v1 * t / 2)^2 + (v2 * t / 2)^2 ) = collision_radius. Here v1 and v2 are assumed to be perpendicular to each other and</span></div>
<div class="line"><a id="l00584" name="l00584"></a><span class="lineno">  584</span>    <span class="comment">// intersecting at t/2 to get max possible collision_radius. Solving for t gives following:</span></div>
<div class="line"><a id="l00585" name="l00585"></a><span class="lineno">  585</span>    <span class="keywordtype">double</span> iteration_stride_max_time_s = 2 * <a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#ab1f62a493a4229d4801841eb19fb1e7d">config_</a>.<a class="code hl_variable" href="structYieldPluginConfig.html#a9c609df9146f9f8dbbf4838decc6fb0b">intervehicle_collision_distance_in_m</a> / sqrt(pow(traj2_speed, 2) + pow(trajectory1_max_speed, 2));</div>
<div class="line"><a id="l00586" name="l00586"></a><span class="lineno">  586</span>    <span class="keywordtype">int</span> iteration_stride = std::max(1, <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(iteration_stride_max_time_s / predict_step_duration));</div>
<div class="line"><a id="l00587" name="l00587"></a><span class="lineno">  587</span> </div>
<div class="line"><a id="l00588" name="l00588"></a><span class="lineno">  588</span>    RCLCPP_DEBUG_STREAM(<a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#aa2f96dc545c04733e8ba11a6f3a0c2c6">nh_</a>-&gt;get_logger(), <span class="stringliteral">&quot;Determined iteration_stride: &quot;</span> &lt;&lt; iteration_stride</div>
<div class="line"><a id="l00589" name="l00589"></a><span class="lineno">  589</span>      &lt;&lt; <span class="stringliteral">&quot;, with traj2_speed: &quot;</span> &lt;&lt; traj2_speed</div>
<div class="line"><a id="l00590" name="l00590"></a><span class="lineno">  590</span>      &lt;&lt; <span class="stringliteral">&quot;, with trajectory1_max_speed: &quot;</span> &lt;&lt; trajectory1_max_speed</div>
<div class="line"><a id="l00591" name="l00591"></a><span class="lineno">  591</span>      &lt;&lt; <span class="stringliteral">&quot;, with predict_step_duration: &quot;</span> &lt;&lt; predict_step_duration</div>
<div class="line"><a id="l00592" name="l00592"></a><span class="lineno">  592</span>      &lt;&lt; <span class="stringliteral">&quot;, iteration_stride_max_time_s: &quot;</span> &lt;&lt; iteration_stride_max_time_s);</div>
<div class="line"><a id="l00593" name="l00593"></a><span class="lineno">  593</span> </div>
<div class="line"><a id="l00594" name="l00594"></a><span class="lineno">  594</span>    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> j = 0; j &lt; trajectory2.size(); j += iteration_stride) <span class="comment">// Saving computation time aiming for 1.5 meter interval</span></div>
<div class="line"><a id="l00595" name="l00595"></a><span class="lineno">  595</span>    {</div>
<div class="line"><a id="l00596" name="l00596"></a><span class="lineno">  596</span>      lanelet::BasicPoint2d curr_point;</div>
<div class="line"><a id="l00597" name="l00597"></a><span class="lineno">  597</span>      curr_point.x() = trajectory2.at(j).predicted_position.position.x;</div>
<div class="line"><a id="l00598" name="l00598"></a><span class="lineno">  598</span>      curr_point.y() = trajectory2.at(j).predicted_position.position.y;</div>
<div class="line"><a id="l00599" name="l00599"></a><span class="lineno">  599</span> </div>
<div class="line"><a id="l00600" name="l00600"></a><span class="lineno">  600</span>      <span class="keyword">auto</span> corresponding_lanelets = <a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#aff229ed7bba2a76d0b1b99a83b9fdf88">wm_</a>-&gt;getLaneletsFromPoint(curr_point, 8); <span class="comment">// some intersection can have 8 overlapping lanelets</span></div>
<div class="line"><a id="l00601" name="l00601"></a><span class="lineno">  601</span> </div>
<div class="line"><a id="l00602" name="l00602"></a><span class="lineno">  602</span>      <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; llt: corresponding_lanelets)</div>
<div class="line"><a id="l00603" name="l00603"></a><span class="lineno">  603</span>      {</div>
<div class="line"><a id="l00604" name="l00604"></a><span class="lineno">  604</span>        RCLCPP_DEBUG_STREAM(<a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#aa2f96dc545c04733e8ba11a6f3a0c2c6">nh_</a>-&gt;get_logger(), <span class="stringliteral">&quot;Checking llt: &quot;</span> &lt;&lt; llt.id());</div>
<div class="line"><a id="l00605" name="l00605"></a><span class="lineno">  605</span> </div>
<div class="line"><a id="l00606" name="l00606"></a><span class="lineno">  606</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#a03f092d19aab7369af56f9438938d454">route_llt_ids_</a>.find(llt.id()) != <a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#a03f092d19aab7369af56f9438938d454">route_llt_ids_</a>.end())</div>
<div class="line"><a id="l00607" name="l00607"></a><span class="lineno">  607</span>        {</div>
<div class="line"><a id="l00608" name="l00608"></a><span class="lineno">  608</span>          on_route = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00609" name="l00609"></a><span class="lineno">  609</span>          on_route_idx = j;</div>
<div class="line"><a id="l00610" name="l00610"></a><span class="lineno">  610</span>          <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00611" name="l00611"></a><span class="lineno">  611</span>        }</div>
<div class="line"><a id="l00612" name="l00612"></a><span class="lineno">  612</span>      }</div>
<div class="line"><a id="l00613" name="l00613"></a><span class="lineno">  613</span>      <span class="keywordflow">if</span> (on_route || traj2_has_zero_speed)</div>
<div class="line"><a id="l00614" name="l00614"></a><span class="lineno">  614</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00615" name="l00615"></a><span class="lineno">  615</span>    }</div>
<div class="line"><a id="l00616" name="l00616"></a><span class="lineno">  616</span> </div>
<div class="line"><a id="l00617" name="l00617"></a><span class="lineno">  617</span>    <span class="keywordflow">if</span> (!on_route)</div>
<div class="line"><a id="l00618" name="l00618"></a><span class="lineno">  618</span>    {</div>
<div class="line"><a id="l00619" name="l00619"></a><span class="lineno">  619</span>      RCLCPP_DEBUG(<a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#aa2f96dc545c04733e8ba11a6f3a0c2c6">nh_</a>-&gt;get_logger(), <span class="stringliteral">&quot;Predicted states are not on the route! ignoring&quot;</span>);</div>
<div class="line"><a id="l00620" name="l00620"></a><span class="lineno">  620</span>      <span class="keywordflow">return</span> std::nullopt;</div>
<div class="line"><a id="l00621" name="l00621"></a><span class="lineno">  621</span>    }</div>
<div class="line"><a id="l00622" name="l00622"></a><span class="lineno">  622</span> </div>
<div class="line"><a id="l00623" name="l00623"></a><span class="lineno">  623</span>    <span class="keywordtype">double</span> smallest_dist = std::numeric_limits&lt;double&gt;::infinity();</div>
<div class="line"><a id="l00624" name="l00624"></a><span class="lineno">  624</span>    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a> = 0; <a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a> &lt; trajectory1.trajectory_points.size() - 1; ++<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>)</div>
<div class="line"><a id="l00625" name="l00625"></a><span class="lineno">  625</span>    {</div>
<div class="line"><a id="l00626" name="l00626"></a><span class="lineno">  626</span>      <span class="keyword">auto</span> p1a = trajectory1.trajectory_points.at(<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>);</div>
<div class="line"><a id="l00627" name="l00627"></a><span class="lineno">  627</span>      <span class="keyword">auto</span> p1b = trajectory1.trajectory_points.at(<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a> + 1);</div>
<div class="line"><a id="l00628" name="l00628"></a><span class="lineno">  628</span>      <span class="keywordtype">double</span> previous_distance_between_predictions = std::numeric_limits&lt;double&gt;::infinity();</div>
<div class="line"><a id="l00629" name="l00629"></a><span class="lineno">  629</span>      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> j = on_route_idx; j &lt; trajectory2.size() - 1; j += iteration_stride)</div>
<div class="line"><a id="l00630" name="l00630"></a><span class="lineno">  630</span>      {</div>
<div class="line"><a id="l00631" name="l00631"></a><span class="lineno">  631</span>        <span class="keyword">auto</span> p2a = trajectory2.at(j);</div>
<div class="line"><a id="l00632" name="l00632"></a><span class="lineno">  632</span>        <span class="keyword">auto</span> p2b = trajectory2.at(j + 1);</div>
<div class="line"><a id="l00633" name="l00633"></a><span class="lineno">  633</span>        <span class="keywordtype">double</span> p1a_t = rclcpp::Time(p1a.target_time).seconds();</div>
<div class="line"><a id="l00634" name="l00634"></a><span class="lineno">  634</span>        <span class="keywordtype">double</span> p1b_t = rclcpp::Time(p1b.target_time).seconds();</div>
<div class="line"><a id="l00635" name="l00635"></a><span class="lineno">  635</span>        <span class="keywordtype">double</span> p2a_t = rclcpp::Time(p2a.header.stamp).seconds();</div>
<div class="line"><a id="l00636" name="l00636"></a><span class="lineno">  636</span>        <span class="keywordtype">double</span> p2b_t = rclcpp::Time(p2b.header.stamp).seconds();</div>
<div class="line"><a id="l00637" name="l00637"></a><span class="lineno">  637</span> </div>
<div class="line"><a id="l00638" name="l00638"></a><span class="lineno">  638</span>        RCLCPP_DEBUG_STREAM(<a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#aa2f96dc545c04733e8ba11a6f3a0c2c6">nh_</a>-&gt;get_logger(), <span class="stringliteral">&quot;p1a.target_time: &quot;</span> &lt;&lt; <a class="code hl_function" href="namespacecarma__cooperative__perception.html#a64b708654c8aecb09122d39577df31b5">std::to_string</a>(p1a_t) &lt;&lt; <span class="stringliteral">&quot;, p1b.target_time: &quot;</span> &lt;&lt; <a class="code hl_function" href="namespacecarma__cooperative__perception.html#a64b708654c8aecb09122d39577df31b5">std::to_string</a>(p1b_t));</div>
<div class="line"><a id="l00639" name="l00639"></a><span class="lineno">  639</span>        RCLCPP_DEBUG_STREAM(<a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#aa2f96dc545c04733e8ba11a6f3a0c2c6">nh_</a>-&gt;get_logger(), <span class="stringliteral">&quot;p2a.target_time: &quot;</span> &lt;&lt; <a class="code hl_function" href="namespacecarma__cooperative__perception.html#a64b708654c8aecb09122d39577df31b5">std::to_string</a>(p2a_t) &lt;&lt; <span class="stringliteral">&quot;, p2b.target_time: &quot;</span> &lt;&lt; <a class="code hl_function" href="namespacecarma__cooperative__perception.html#a64b708654c8aecb09122d39577df31b5">std::to_string</a>(p2b_t));</div>
<div class="line"><a id="l00640" name="l00640"></a><span class="lineno">  640</span>        RCLCPP_DEBUG_STREAM(<a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#aa2f96dc545c04733e8ba11a6f3a0c2c6">nh_</a>-&gt;get_logger(), <span class="stringliteral">&quot;p1a.x: &quot;</span> &lt;&lt; p1a.x &lt;&lt; <span class="stringliteral">&quot;, p1a.y: &quot;</span> &lt;&lt; p1a.y);</div>
<div class="line"><a id="l00641" name="l00641"></a><span class="lineno">  641</span>        RCLCPP_DEBUG_STREAM(<a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#aa2f96dc545c04733e8ba11a6f3a0c2c6">nh_</a>-&gt;get_logger(), <span class="stringliteral">&quot;p1b.x: &quot;</span> &lt;&lt; p1b.x &lt;&lt; <span class="stringliteral">&quot;, p1b.y: &quot;</span> &lt;&lt; p1b.y);</div>
<div class="line"><a id="l00642" name="l00642"></a><span class="lineno">  642</span> </div>
<div class="line"><a id="l00643" name="l00643"></a><span class="lineno">  643</span>        RCLCPP_DEBUG_STREAM(<a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#aa2f96dc545c04733e8ba11a6f3a0c2c6">nh_</a>-&gt;get_logger(), <span class="stringliteral">&quot;p2a.x: &quot;</span> &lt;&lt; p2a.predicted_position.position.x &lt;&lt; <span class="stringliteral">&quot;, p2a.y: &quot;</span> &lt;&lt; p2a.predicted_position.position.y);</div>
<div class="line"><a id="l00644" name="l00644"></a><span class="lineno">  644</span>        RCLCPP_DEBUG_STREAM(<a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#aa2f96dc545c04733e8ba11a6f3a0c2c6">nh_</a>-&gt;get_logger(), <span class="stringliteral">&quot;p2b.x: &quot;</span> &lt;&lt; p2b.predicted_position.position.x &lt;&lt; <span class="stringliteral">&quot;, p2b.y: &quot;</span> &lt;&lt; p2b.predicted_position.position.y);</div>
<div class="line"><a id="l00645" name="l00645"></a><span class="lineno">  645</span> </div>
<div class="line"><a id="l00646" name="l00646"></a><span class="lineno">  646</span>        <span class="comment">// Linearly interpolate positions at a common timestamp for both trajectories</span></div>
<div class="line"><a id="l00647" name="l00647"></a><span class="lineno">  647</span>        <span class="keywordtype">double</span> dt = (p2a_t - p1a_t) / (p1b_t - p1a_t);</div>
<div class="line"><a id="l00648" name="l00648"></a><span class="lineno">  648</span>        <span class="keywordtype">double</span> x1 = p1a.x + dt * (p1b.x - p1a.x);</div>
<div class="line"><a id="l00649" name="l00649"></a><span class="lineno">  649</span>        <span class="keywordtype">double</span> y1 = p1a.y + dt * (p1b.y - p1a.y);</div>
<div class="line"><a id="l00650" name="l00650"></a><span class="lineno">  650</span>        <span class="keywordtype">double</span> x2 = p2a.predicted_position.position.x;</div>
<div class="line"><a id="l00651" name="l00651"></a><span class="lineno">  651</span>        <span class="keywordtype">double</span> y2 = p2a.predicted_position.position.y;</div>
<div class="line"><a id="l00652" name="l00652"></a><span class="lineno">  652</span> </div>
<div class="line"><a id="l00653" name="l00653"></a><span class="lineno">  653</span>        <span class="comment">// Calculate the distance between the two interpolated points</span></div>
<div class="line"><a id="l00654" name="l00654"></a><span class="lineno">  654</span>        <span class="keyword">const</span> <span class="keyword">auto</span> distance{std::hypot(x1 - x2, y1 - y2)};</div>
<div class="line"><a id="l00655" name="l00655"></a><span class="lineno">  655</span> </div>
<div class="line"><a id="l00656" name="l00656"></a><span class="lineno">  656</span>        smallest_dist = std::min(distance, smallest_dist);</div>
<div class="line"><a id="l00657" name="l00657"></a><span class="lineno">  657</span>        RCLCPP_DEBUG_STREAM(<a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#aa2f96dc545c04733e8ba11a6f3a0c2c6">nh_</a>-&gt;get_logger(), <span class="stringliteral">&quot;Smallest_dist: &quot;</span> &lt;&lt; smallest_dist &lt;&lt; <span class="stringliteral">&quot;, distance: &quot;</span> &lt;&lt; distance &lt;&lt; <span class="stringliteral">&quot;, dt: &quot;</span> &lt;&lt; dt</div>
<div class="line"><a id="l00658" name="l00658"></a><span class="lineno">  658</span>          &lt;&lt; <span class="stringliteral">&quot;, x1: &quot;</span> &lt;&lt; x1 &lt;&lt; <span class="stringliteral">&quot;, y1: &quot;</span> &lt;&lt; y1</div>
<div class="line"><a id="l00659" name="l00659"></a><span class="lineno">  659</span>          &lt;&lt; <span class="stringliteral">&quot;, x2: &quot;</span> &lt;&lt; x2 &lt;&lt; <span class="stringliteral">&quot;, y2: &quot;</span> &lt;&lt; y2</div>
<div class="line"><a id="l00660" name="l00660"></a><span class="lineno">  660</span>          &lt;&lt; <span class="stringliteral">&quot;, p2a_t:&quot;</span> &lt;&lt; <a class="code hl_function" href="namespacecarma__cooperative__perception.html#a64b708654c8aecb09122d39577df31b5">std::to_string</a>(p2a_t));</div>
<div class="line"><a id="l00661" name="l00661"></a><span class="lineno">  661</span> </div>
<div class="line"><a id="l00662" name="l00662"></a><span class="lineno">  662</span>        <span class="comment">// Following &quot;if logic&quot; assumes the traj2 is a simple cv model, aka, traj2 point is a straight line over time.</span></div>
<div class="line"><a id="l00663" name="l00663"></a><span class="lineno">  663</span>        <span class="comment">// And current traj1 point is fixed in this iteration.</span></div>
<div class="line"><a id="l00664" name="l00664"></a><span class="lineno">  664</span>        <span class="comment">// Then once the distance between the two start to increase over traj2 iteration,</span></div>
<div class="line"><a id="l00665" name="l00665"></a><span class="lineno">  665</span>        <span class="comment">// the distance will always increase and it&#39;s unnecessary to continue the logic to find the smallest_dist</span></div>
<div class="line"><a id="l00666" name="l00666"></a><span class="lineno">  666</span>        <span class="keywordflow">if</span> (previous_distance_between_predictions &lt; distance)</div>
<div class="line"><a id="l00667" name="l00667"></a><span class="lineno">  667</span>        {</div>
<div class="line"><a id="l00668" name="l00668"></a><span class="lineno">  668</span>          RCLCPP_DEBUG_STREAM(<a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#aa2f96dc545c04733e8ba11a6f3a0c2c6">nh_</a>-&gt;get_logger(), <span class="stringliteral">&quot;Stopping search here because the distance between predictions started to increase&quot;</span>);</div>
<div class="line"><a id="l00669" name="l00669"></a><span class="lineno">  669</span>          <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00670" name="l00670"></a><span class="lineno">  670</span>        }</div>
<div class="line"><a id="l00671" name="l00671"></a><span class="lineno">  671</span>        previous_distance_between_predictions = distance;</div>
<div class="line"><a id="l00672" name="l00672"></a><span class="lineno">  672</span> </div>
<div class="line"><a id="l00673" name="l00673"></a><span class="lineno">  673</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a> == 0 &amp;&amp; j == 0 &amp;&amp; distance &gt; <a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#ab1f62a493a4229d4801841eb19fb1e7d">config_</a>.<a class="code hl_variable" href="structYieldPluginConfig.html#a1e7bba4a59d1301d477e64ad1a403cee">collision_check_radius_in_m</a>)</div>
<div class="line"><a id="l00674" name="l00674"></a><span class="lineno">  674</span>        {</div>
<div class="line"><a id="l00675" name="l00675"></a><span class="lineno">  675</span>          RCLCPP_DEBUG(<a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#aa2f96dc545c04733e8ba11a6f3a0c2c6">nh_</a>-&gt;get_logger(), <span class="stringliteral">&quot;Too far away&quot;</span> );</div>
<div class="line"><a id="l00676" name="l00676"></a><span class="lineno">  676</span>          <span class="keywordflow">return</span> std::nullopt;</div>
<div class="line"><a id="l00677" name="l00677"></a><span class="lineno">  677</span>        }</div>
<div class="line"><a id="l00678" name="l00678"></a><span class="lineno">  678</span> </div>
<div class="line"><a id="l00679" name="l00679"></a><span class="lineno">  679</span>        <span class="keywordflow">if</span> (distance &gt; collision_radius)</div>
<div class="line"><a id="l00680" name="l00680"></a><span class="lineno">  680</span>        {</div>
<div class="line"><a id="l00681" name="l00681"></a><span class="lineno">  681</span>          <span class="comment">// continue searching for collision</span></div>
<div class="line"><a id="l00682" name="l00682"></a><span class="lineno">  682</span>          <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00683" name="l00683"></a><span class="lineno">  683</span>        }</div>
<div class="line"><a id="l00684" name="l00684"></a><span class="lineno">  684</span> </div>
<div class="line"><a id="l00685" name="l00685"></a><span class="lineno">  685</span>        <a class="code hl_struct" href="structyield__plugin_1_1GetCollisionResult.html">GetCollisionResult</a> collision_result;</div>
<div class="line"><a id="l00686" name="l00686"></a><span class="lineno">  686</span>        collision_result.<a class="code hl_variable" href="structyield__plugin_1_1GetCollisionResult.html#a318dfe3459bea1d2dfa363af9b3a36a2">point1</a> = lanelet::BasicPoint2d(x1,y1);</div>
<div class="line"><a id="l00687" name="l00687"></a><span class="lineno">  687</span>        collision_result.<a class="code hl_variable" href="structyield__plugin_1_1GetCollisionResult.html#a693c36abfe23c410546f66098bed5685">point2</a> = lanelet::BasicPoint2d(x2,y2);</div>
<div class="line"><a id="l00688" name="l00688"></a><span class="lineno">  688</span>        collision_result.<a class="code hl_variable" href="structyield__plugin_1_1GetCollisionResult.html#a5c30ed2c66023cf2ad745cf8139a0b1a">collision_time</a> = rclcpp::Time(p2a.header.stamp);</div>
<div class="line"><a id="l00689" name="l00689"></a><span class="lineno">  689</span>        <span class="keywordflow">return</span> collision_result;</div>
<div class="line"><a id="l00690" name="l00690"></a><span class="lineno">  690</span>      }</div>
<div class="line"><a id="l00691" name="l00691"></a><span class="lineno">  691</span>    }</div>
<div class="line"><a id="l00692" name="l00692"></a><span class="lineno">  692</span> </div>
<div class="line"><a id="l00693" name="l00693"></a><span class="lineno">  693</span>    <span class="comment">// No collision detected</span></div>
<div class="line"><a id="l00694" name="l00694"></a><span class="lineno">  694</span>    <span class="keywordflow">return</span> std::nullopt;</div>
<div class="line"><a id="l00695" name="l00695"></a><span class="lineno">  695</span>  }</div>
<div class="line"><a id="l00696" name="l00696"></a><span class="lineno">  696</span> </div>
<div class="line"><a id="l00697" name="l00697"></a><span class="lineno"><a class="line" href="classyield__plugin_1_1YieldPlugin.html#ae1279ff6d53eb474b635f992ed854d0b">  697</a></span>  <span class="keywordtype">bool</span> <a class="code hl_function" href="classyield__plugin_1_1YieldPlugin.html#ae1279ff6d53eb474b635f992ed854d0b">YieldPlugin::is_object_behind_vehicle</a>(<a class="code hl_typedef" href="stdint_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> object_id, <span class="keyword">const</span> rclcpp::Time&amp; collision_time, <span class="keywordtype">double</span> vehicle_downtrack, <span class="keywordtype">double</span> object_downtrack)</div>
<div class="line"><a id="l00698" name="l00698"></a><span class="lineno">  698</span>  {</div>
<div class="line"><a id="l00699" name="l00699"></a><span class="lineno">  699</span>    <span class="keyword">const</span> <span class="keyword">auto</span> previous_clearance_count = <a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#adc6d5d9e4116d9f6ca142e5bb2fd1bc8">consecutive_clearance_count_for_obstacles_</a>[object_id];</div>
<div class="line"><a id="l00700" name="l00700"></a><span class="lineno">  700</span>    <span class="comment">// if the object&#39;s location is half a length of the vehicle past its rear-axle, it is considered behind</span></div>
<div class="line"><a id="l00701" name="l00701"></a><span class="lineno">  701</span>    <span class="comment">// half a length of the vehicle to conservatively estimate the rear axle to rear bumper length</span></div>
<div class="line"><a id="l00702" name="l00702"></a><span class="lineno">  702</span>    <span class="keywordflow">if</span> (object_downtrack &lt; vehicle_downtrack - <a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#ab1f62a493a4229d4801841eb19fb1e7d">config_</a>.<a class="code hl_variable" href="structYieldPluginConfig.html#a7b0405c10307bac9613aba5a228de94e">vehicle_length</a> / 2)</div>
<div class="line"><a id="l00703" name="l00703"></a><span class="lineno">  703</span>    {</div>
<div class="line"><a id="l00704" name="l00704"></a><span class="lineno">  704</span>      <a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#adc6d5d9e4116d9f6ca142e5bb2fd1bc8">consecutive_clearance_count_for_obstacles_</a>[object_id] = std::min(<a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#adc6d5d9e4116d9f6ca142e5bb2fd1bc8">consecutive_clearance_count_for_obstacles_</a>[object_id] + 1, <a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#ab1f62a493a4229d4801841eb19fb1e7d">config_</a>.<a class="code hl_variable" href="structYieldPluginConfig.html#a7e5796ed6d92befd6c726b5a0b6ef4f8">consecutive_clearance_count_for_obstacles_threshold</a>);</div>
<div class="line"><a id="l00705" name="l00705"></a><span class="lineno">  705</span>      RCLCPP_INFO_STREAM(<a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#aa2f96dc545c04733e8ba11a6f3a0c2c6">nh_</a>-&gt;get_logger(), <span class="stringliteral">&quot;Detected an object nearby might be behind the vehicle at timestamp: &quot;</span> &lt;&lt; <a class="code hl_function" href="namespacecarma__cooperative__perception.html#a64b708654c8aecb09122d39577df31b5">std::to_string</a>(collision_time.seconds()) &lt;&lt;</div>
<div class="line"><a id="l00706" name="l00706"></a><span class="lineno">  706</span>        <span class="stringliteral">&quot;, and consecutive_clearance_count_for obstacle: &quot;</span> &lt;&lt;  object_id &lt;&lt; <span class="stringliteral">&quot;, is: &quot;</span> &lt;&lt; <a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#adc6d5d9e4116d9f6ca142e5bb2fd1bc8">consecutive_clearance_count_for_obstacles_</a>[object_id]);</div>
<div class="line"><a id="l00707" name="l00707"></a><span class="lineno">  707</span>    }</div>
<div class="line"><a id="l00708" name="l00708"></a><span class="lineno">  708</span>    <span class="comment">// confirmed false positive for a collision</span></div>
<div class="line"><a id="l00709" name="l00709"></a><span class="lineno">  709</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#adc6d5d9e4116d9f6ca142e5bb2fd1bc8">consecutive_clearance_count_for_obstacles_</a>[object_id] &gt;= <a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#ab1f62a493a4229d4801841eb19fb1e7d">config_</a>.<a class="code hl_variable" href="structYieldPluginConfig.html#a7e5796ed6d92befd6c726b5a0b6ef4f8">consecutive_clearance_count_for_obstacles_threshold</a>)</div>
<div class="line"><a id="l00710" name="l00710"></a><span class="lineno">  710</span>    {</div>
<div class="line"><a id="l00711" name="l00711"></a><span class="lineno">  711</span>      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l00712" name="l00712"></a><span class="lineno">  712</span>    }</div>
<div class="line"><a id="l00713" name="l00713"></a><span class="lineno">  713</span>    <span class="comment">// if the clearance counter didn&#39;t increase by this point, true collision was detected</span></div>
<div class="line"><a id="l00714" name="l00714"></a><span class="lineno">  714</span>    <span class="comment">// therefore reset the consecutive clearance counter as it is no longer consecutive</span></div>
<div class="line"><a id="l00715" name="l00715"></a><span class="lineno">  715</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#adc6d5d9e4116d9f6ca142e5bb2fd1bc8">consecutive_clearance_count_for_obstacles_</a>[object_id] == previous_clearance_count)</div>
<div class="line"><a id="l00716" name="l00716"></a><span class="lineno">  716</span>    {</div>
<div class="line"><a id="l00717" name="l00717"></a><span class="lineno">  717</span>      <a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#adc6d5d9e4116d9f6ca142e5bb2fd1bc8">consecutive_clearance_count_for_obstacles_</a>[object_id] = 0;</div>
<div class="line"><a id="l00718" name="l00718"></a><span class="lineno">  718</span>    }</div>
<div class="line"><a id="l00719" name="l00719"></a><span class="lineno">  719</span> </div>
<div class="line"><a id="l00720" name="l00720"></a><span class="lineno">  720</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00721" name="l00721"></a><span class="lineno">  721</span>  }</div>
<div class="line"><a id="l00722" name="l00722"></a><span class="lineno">  722</span> </div>
<div class="line"><a id="l00723" name="l00723"></a><span class="lineno"><a class="line" href="classyield__plugin_1_1YieldPlugin.html#a5644e9f63528efc0484b875c7debef01">  723</a></span>  std::optional&lt;rclcpp::Time&gt; <a class="code hl_function" href="classyield__plugin_1_1YieldPlugin.html#a5644e9f63528efc0484b875c7debef01">YieldPlugin::get_collision_time</a>(<span class="keyword">const</span> carma_planning_msgs::msg::TrajectoryPlan&amp; original_tp,</div>
<div class="line"><a id="l00724" name="l00724"></a><span class="lineno">  724</span>    <span class="keyword">const</span> carma_perception_msgs::msg::ExternalObject&amp; curr_obstacle, <span class="keywordtype">double</span> original_tp_max_speed)</div>
<div class="line"><a id="l00725" name="l00725"></a><span class="lineno">  725</span>  {</div>
<div class="line"><a id="l00726" name="l00726"></a><span class="lineno">  726</span>    <span class="keyword">auto</span> plan_start_time = <a class="code hl_function" href="namespaceyield__plugin.html#a754c9aebad547b09cdeff7080a639bd3">get_trajectory_start_time</a>(original_tp);</div>
<div class="line"><a id="l00727" name="l00727"></a><span class="lineno">  727</span> </div>
<div class="line"><a id="l00728" name="l00728"></a><span class="lineno">  728</span>    RCLCPP_DEBUG_STREAM(<a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#aa2f96dc545c04733e8ba11a6f3a0c2c6">nh_</a>-&gt;get_logger(), <span class="stringliteral">&quot;Object&#39;s back time: &quot;</span> &lt;&lt; <a class="code hl_function" href="namespacecarma__cooperative__perception.html#a64b708654c8aecb09122d39577df31b5">std::to_string</a>(rclcpp::Time(curr_obstacle.predictions.back().header.stamp).seconds())</div>
<div class="line"><a id="l00729" name="l00729"></a><span class="lineno">  729</span>      &lt;&lt; <span class="stringliteral">&quot;, plan_start_time: &quot;</span> &lt;&lt; <a class="code hl_function" href="namespacecarma__cooperative__perception.html#a64b708654c8aecb09122d39577df31b5">std::to_string</a>(plan_start_time));</div>
<div class="line"><a id="l00730" name="l00730"></a><span class="lineno">  730</span> </div>
<div class="line"><a id="l00731" name="l00731"></a><span class="lineno">  731</span>    <span class="comment">// do not process outdated objects</span></div>
<div class="line"><a id="l00732" name="l00732"></a><span class="lineno">  732</span>    <span class="keywordflow">if</span> (rclcpp::Time(curr_obstacle.predictions.back().header.stamp).seconds() &lt;= plan_start_time)</div>
<div class="line"><a id="l00733" name="l00733"></a><span class="lineno">  733</span>    {</div>
<div class="line"><a id="l00734" name="l00734"></a><span class="lineno">  734</span>      <span class="keywordflow">return</span> std::nullopt;</div>
<div class="line"><a id="l00735" name="l00735"></a><span class="lineno">  735</span>    }</div>
<div class="line"><a id="l00736" name="l00736"></a><span class="lineno">  736</span> </div>
<div class="line"><a id="l00737" name="l00737"></a><span class="lineno">  737</span>    std::vector&lt;carma_perception_msgs::msg::PredictedState&gt; new_list;</div>
<div class="line"><a id="l00738" name="l00738"></a><span class="lineno">  738</span>    carma_perception_msgs::msg::PredictedState curr_state;</div>
<div class="line"><a id="l00739" name="l00739"></a><span class="lineno">  739</span>    <span class="comment">// artificially include current position as one of the predicted states</span></div>
<div class="line"><a id="l00740" name="l00740"></a><span class="lineno">  740</span>    curr_state.header.stamp = curr_obstacle.header.stamp;</div>
<div class="line"><a id="l00741" name="l00741"></a><span class="lineno">  741</span>    curr_state.predicted_position.position.x = curr_obstacle.pose.pose.position.x;</div>
<div class="line"><a id="l00742" name="l00742"></a><span class="lineno">  742</span>    curr_state.predicted_position.position.y = curr_obstacle.pose.pose.position.y;</div>
<div class="line"><a id="l00743" name="l00743"></a><span class="lineno">  743</span>    <span class="comment">// NOTE: predicted_velocity is not used for collision calculation, but timestamps</span></div>
<div class="line"><a id="l00744" name="l00744"></a><span class="lineno">  744</span>    curr_state.predicted_velocity.linear.x = curr_obstacle.velocity.twist.linear.x;</div>
<div class="line"><a id="l00745" name="l00745"></a><span class="lineno">  745</span>    curr_state.predicted_velocity.linear.y = curr_obstacle.velocity.twist.linear.y;</div>
<div class="line"><a id="l00746" name="l00746"></a><span class="lineno">  746</span>    RCLCPP_DEBUG_STREAM(<a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#aa2f96dc545c04733e8ba11a6f3a0c2c6">nh_</a>-&gt;get_logger(), <span class="stringliteral">&quot;Object: &quot;</span> &lt;&lt; curr_obstacle.id &lt;&lt;<span class="stringliteral">&quot;, type: &quot;</span> &lt;&lt; <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(curr_obstacle.object_type)</div>
<div class="line"><a id="l00747" name="l00747"></a><span class="lineno">  747</span>      &lt;&lt; <span class="stringliteral">&quot;, speed_x: &quot;</span> &lt;&lt; curr_obstacle.velocity.twist.linear.x  &lt;&lt; <span class="stringliteral">&quot;, speed_y: &quot;</span> &lt;&lt; curr_obstacle.velocity.twist.linear.y);</div>
<div class="line"><a id="l00748" name="l00748"></a><span class="lineno">  748</span>    new_list.push_back(curr_state);</div>
<div class="line"><a id="l00749" name="l00749"></a><span class="lineno">  749</span>    new_list.insert(new_list.end(), curr_obstacle.predictions.cbegin(), curr_obstacle.predictions.cend());</div>
<div class="line"><a id="l00750" name="l00750"></a><span class="lineno">  750</span> </div>
<div class="line"><a id="l00751" name="l00751"></a><span class="lineno">  751</span>    <span class="keyword">const</span> <span class="keyword">auto</span> collision_result = <a class="code hl_function" href="classyield__plugin_1_1YieldPlugin.html#ab60b2f939cebede3a6d9a3ae5529b0d9">get_collision</a>(original_tp, new_list, <a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#ab1f62a493a4229d4801841eb19fb1e7d">config_</a>.<a class="code hl_variable" href="structYieldPluginConfig.html#a9c609df9146f9f8dbbf4838decc6fb0b">intervehicle_collision_distance_in_m</a>, original_tp_max_speed);</div>
<div class="line"><a id="l00752" name="l00752"></a><span class="lineno">  752</span> </div>
<div class="line"><a id="l00753" name="l00753"></a><span class="lineno">  753</span>    <span class="keywordflow">if</span> (!collision_result)</div>
<div class="line"><a id="l00754" name="l00754"></a><span class="lineno">  754</span>    {</div>
<div class="line"><a id="l00755" name="l00755"></a><span class="lineno">  755</span>      <span class="comment">// reset the consecutive clearance counter because no collision was detected at this iteration</span></div>
<div class="line"><a id="l00756" name="l00756"></a><span class="lineno">  756</span>      <a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#adc6d5d9e4116d9f6ca142e5bb2fd1bc8">consecutive_clearance_count_for_obstacles_</a>[curr_obstacle.id] = 0;</div>
<div class="line"><a id="l00757" name="l00757"></a><span class="lineno">  757</span>      <span class="keywordflow">return</span> std::nullopt;</div>
<div class="line"><a id="l00758" name="l00758"></a><span class="lineno">  758</span>    }</div>
<div class="line"><a id="l00759" name="l00759"></a><span class="lineno">  759</span> </div>
<div class="line"><a id="l00760" name="l00760"></a><span class="lineno">  760</span>    <span class="comment">// if within collision radius, it is not a collision if obstacle is behind the vehicle despite being in collision radius</span></div>
<div class="line"><a id="l00761" name="l00761"></a><span class="lineno">  761</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> vehicle_downtrack = <a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#aff229ed7bba2a76d0b1b99a83b9fdf88">wm_</a>-&gt;routeTrackPos(collision_result.value().point1).downtrack;</div>
<div class="line"><a id="l00762" name="l00762"></a><span class="lineno">  762</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> object_downtrack = <a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#aff229ed7bba2a76d0b1b99a83b9fdf88">wm_</a>-&gt;routeTrackPos(collision_result.value().point2).downtrack;</div>
<div class="line"><a id="l00763" name="l00763"></a><span class="lineno">  763</span> </div>
<div class="line"><a id="l00764" name="l00764"></a><span class="lineno">  764</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="classyield__plugin_1_1YieldPlugin.html#ae1279ff6d53eb474b635f992ed854d0b">is_object_behind_vehicle</a>(curr_obstacle.id, collision_result.value().collision_time, vehicle_downtrack, object_downtrack))</div>
<div class="line"><a id="l00765" name="l00765"></a><span class="lineno">  765</span>    {</div>
<div class="line"><a id="l00766" name="l00766"></a><span class="lineno">  766</span>      RCLCPP_INFO_STREAM(<a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#aa2f96dc545c04733e8ba11a6f3a0c2c6">nh_</a>-&gt;get_logger(), <span class="stringliteral">&quot;Confirmed that the object: &quot;</span> &lt;&lt; curr_obstacle.id &lt;&lt; <span class="stringliteral">&quot; is behind the vehicle at timestamp &quot;</span> &lt;&lt; <a class="code hl_function" href="namespacecarma__cooperative__perception.html#a64b708654c8aecb09122d39577df31b5">std::to_string</a>(collision_result.value().collision_time.seconds()));</div>
<div class="line"><a id="l00767" name="l00767"></a><span class="lineno">  767</span>      <span class="keywordflow">return</span> std::nullopt;</div>
<div class="line"><a id="l00768" name="l00768"></a><span class="lineno">  768</span>    }</div>
<div class="line"><a id="l00769" name="l00769"></a><span class="lineno">  769</span> </div>
<div class="line"><a id="l00770" name="l00770"></a><span class="lineno">  770</span>    <span class="keyword">const</span> <span class="keyword">auto</span> distance{std::hypot(</div>
<div class="line"><a id="l00771" name="l00771"></a><span class="lineno">  771</span>      collision_result.value().point1.x() - collision_result.value().point2.x(),</div>
<div class="line"><a id="l00772" name="l00772"></a><span class="lineno">  772</span>      collision_result.value().point1.y() - collision_result.value().point2.y()</div>
<div class="line"><a id="l00773" name="l00773"></a><span class="lineno">  773</span>    )}; <span class="comment">//for debug</span></div>
<div class="line"><a id="l00774" name="l00774"></a><span class="lineno">  774</span> </div>
<div class="line"><a id="l00775" name="l00775"></a><span class="lineno">  775</span>    RCLCPP_WARN_STREAM(<a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#aa2f96dc545c04733e8ba11a6f3a0c2c6">nh_</a>-&gt;get_logger(), <span class="stringliteral">&quot;Collision detected for object: &quot;</span> &lt;&lt; curr_obstacle.id &lt;&lt; <span class="stringliteral">&quot;, at timestamp &quot;</span> &lt;&lt; <a class="code hl_function" href="namespacecarma__cooperative__perception.html#a64b708654c8aecb09122d39577df31b5">std::to_string</a>(collision_result.value().collision_time.seconds()) &lt;&lt;</div>
<div class="line"><a id="l00776" name="l00776"></a><span class="lineno">  776</span>      <span class="stringliteral">&quot;, x: &quot;</span> &lt;&lt; collision_result.value().point1.x() &lt;&lt; <span class="stringliteral">&quot;, y: &quot;</span> &lt;&lt; collision_result.value().point1.y() &lt;&lt;</div>
<div class="line"><a id="l00777" name="l00777"></a><span class="lineno">  777</span>      <span class="stringliteral">&quot;, within actual downtrack distance: &quot;</span> &lt;&lt; object_downtrack - vehicle_downtrack &lt;&lt;</div>
<div class="line"><a id="l00778" name="l00778"></a><span class="lineno">  778</span>      <span class="stringliteral">&quot;, and collision distance: &quot;</span> &lt;&lt; distance);</div>
<div class="line"><a id="l00779" name="l00779"></a><span class="lineno">  779</span> </div>
<div class="line"><a id="l00780" name="l00780"></a><span class="lineno">  780</span>    <span class="keywordflow">return</span> collision_result.value().collision_time;</div>
<div class="line"><a id="l00781" name="l00781"></a><span class="lineno">  781</span>  }</div>
<div class="line"><a id="l00782" name="l00782"></a><span class="lineno">  782</span> </div>
<div class="line"><a id="l00783" name="l00783"></a><span class="lineno"><a class="line" href="classyield__plugin_1_1YieldPlugin.html#aae4fab3792eaa78de9a88299c209246d">  783</a></span>  std::unordered_map&lt;uint32_t, rclcpp::Time&gt; <a class="code hl_function" href="classyield__plugin_1_1YieldPlugin.html#aae4fab3792eaa78de9a88299c209246d">YieldPlugin::get_collision_times_concurrently</a>(<span class="keyword">const</span> carma_planning_msgs::msg::TrajectoryPlan&amp; original_tp,</div>
<div class="line"><a id="l00784" name="l00784"></a><span class="lineno">  784</span>    <span class="keyword">const</span> std::vector&lt;carma_perception_msgs::msg::ExternalObject&gt;&amp; external_objects, <span class="keywordtype">double</span> original_tp_max_speed)</div>
<div class="line"><a id="l00785" name="l00785"></a><span class="lineno">  785</span>  {</div>
<div class="line"><a id="l00786" name="l00786"></a><span class="lineno">  786</span> </div>
<div class="line"><a id="l00787" name="l00787"></a><span class="lineno">  787</span>    std::unordered_map&lt;uint32_t, std::future&lt;std::optional&lt;rclcpp::Time&gt;&gt;&gt; futures;</div>
<div class="line"><a id="l00788" name="l00788"></a><span class="lineno">  788</span>    std::unordered_map&lt;uint32_t, rclcpp::Time&gt; collision_times;</div>
<div class="line"><a id="l00789" name="l00789"></a><span class="lineno">  789</span> </div>
<div class="line"><a id="l00790" name="l00790"></a><span class="lineno">  790</span>    <span class="comment">// Launch asynchronous tasks to check for collision times</span></div>
<div class="line"><a id="l00791" name="l00791"></a><span class="lineno">  791</span>    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; <span class="keywordtype">object</span> : external_objects) {</div>
<div class="line"><a id="l00792" name="l00792"></a><span class="lineno">  792</span>      futures[<span class="keywordtype">object</span>.id] = std::async(std::launch::async,[<span class="keyword">this</span>, &amp;original_tp, &amp;<span class="keywordtype">object</span>, &amp;original_tp_max_speed]{</div>
<div class="line"><a id="l00793" name="l00793"></a><span class="lineno">  793</span>          <span class="keywordflow">return</span> <a class="code hl_function" href="classyield__plugin_1_1YieldPlugin.html#a5644e9f63528efc0484b875c7debef01">get_collision_time</a>(original_tp, <span class="keywordtype">object</span>, original_tp_max_speed);</div>
<div class="line"><a id="l00794" name="l00794"></a><span class="lineno">  794</span>        });</div>
<div class="line"><a id="l00795" name="l00795"></a><span class="lineno">  795</span>    }</div>
<div class="line"><a id="l00796" name="l00796"></a><span class="lineno">  796</span> </div>
<div class="line"><a id="l00797" name="l00797"></a><span class="lineno">  797</span>    <span class="comment">// Collect results from futures and update collision_times</span></div>
<div class="line"><a id="l00798" name="l00798"></a><span class="lineno">  798</span>    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; <span class="keywordtype">object</span> : external_objects) {</div>
<div class="line"><a id="l00799" name="l00799"></a><span class="lineno">  799</span>      <span class="keywordflow">if</span> (<span class="keyword">const</span> <span class="keyword">auto</span> collision_time{futures.at(<span class="keywordtype">object</span>.<span class="keywordtype">id</span>).get()}) {</div>
<div class="line"><a id="l00800" name="l00800"></a><span class="lineno">  800</span>        collision_times[<span class="keywordtype">object</span>.id] = collision_time.value();</div>
<div class="line"><a id="l00801" name="l00801"></a><span class="lineno">  801</span>      }</div>
<div class="line"><a id="l00802" name="l00802"></a><span class="lineno">  802</span>    }</div>
<div class="line"><a id="l00803" name="l00803"></a><span class="lineno">  803</span> </div>
<div class="line"><a id="l00804" name="l00804"></a><span class="lineno">  804</span>    <span class="keywordflow">return</span> collision_times;</div>
<div class="line"><a id="l00805" name="l00805"></a><span class="lineno">  805</span>  }</div>
<div class="line"><a id="l00806" name="l00806"></a><span class="lineno">  806</span> </div>
<div class="line"><a id="l00807" name="l00807"></a><span class="lineno"><a class="line" href="classyield__plugin_1_1YieldPlugin.html#a546149400d9d6371c5de50f229d6ecfc">  807</a></span>  std::optional&lt;std::pair&lt;carma_perception_msgs::msg::ExternalObject, double&gt;&gt; <a class="code hl_function" href="classyield__plugin_1_1YieldPlugin.html#a546149400d9d6371c5de50f229d6ecfc">YieldPlugin::get_earliest_collision_object_and_time</a>(<span class="keyword">const</span> carma_planning_msgs::msg::TrajectoryPlan&amp; original_tp,</div>
<div class="line"><a id="l00808" name="l00808"></a><span class="lineno">  808</span>    <span class="keyword">const</span> std::vector&lt;carma_perception_msgs::msg::ExternalObject&gt;&amp; external_objects)</div>
<div class="line"><a id="l00809" name="l00809"></a><span class="lineno">  809</span>  {</div>
<div class="line"><a id="l00810" name="l00810"></a><span class="lineno">  810</span>    RCLCPP_DEBUG_STREAM(<a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#aa2f96dc545c04733e8ba11a6f3a0c2c6">nh_</a>-&gt;get_logger(), <span class="stringliteral">&quot;ExternalObjects size: &quot;</span> &lt;&lt; external_objects.size());</div>
<div class="line"><a id="l00811" name="l00811"></a><span class="lineno">  811</span> </div>
<div class="line"><a id="l00812" name="l00812"></a><span class="lineno">  812</span>    <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#aff229ed7bba2a76d0b1b99a83b9fdf88">wm_</a>-&gt;getRoute())</div>
<div class="line"><a id="l00813" name="l00813"></a><span class="lineno">  813</span>    {</div>
<div class="line"><a id="l00814" name="l00814"></a><span class="lineno">  814</span>      RCLCPP_WARN(<a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#aa2f96dc545c04733e8ba11a6f3a0c2c6">nh_</a>-&gt;get_logger(), <span class="stringliteral">&quot;Yield plugin was not able to analyze collision since route is not available! Please check if route is set&quot;</span>);</div>
<div class="line"><a id="l00815" name="l00815"></a><span class="lineno">  815</span>      <span class="keywordflow">return</span> std::nullopt;</div>
<div class="line"><a id="l00816" name="l00816"></a><span class="lineno">  816</span>    }</div>
<div class="line"><a id="l00817" name="l00817"></a><span class="lineno">  817</span> </div>
<div class="line"><a id="l00818" name="l00818"></a><span class="lineno">  818</span>    <span class="comment">// save route Ids for faster access</span></div>
<div class="line"><a id="l00819" name="l00819"></a><span class="lineno">  819</span>    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; llt: <a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#aff229ed7bba2a76d0b1b99a83b9fdf88">wm_</a>-&gt;getRoute()-&gt;shortestPath())</div>
<div class="line"><a id="l00820" name="l00820"></a><span class="lineno">  820</span>    {</div>
<div class="line"><a id="l00821" name="l00821"></a><span class="lineno">  821</span>      <span class="comment">// TODO: Enhancement https://github.com/usdot-fhwa-stol/carma-platform/issues/2316</span></div>
<div class="line"><a id="l00822" name="l00822"></a><span class="lineno">  822</span>      <a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#a03f092d19aab7369af56f9438938d454">route_llt_ids_</a>.insert(llt.id());</div>
<div class="line"><a id="l00823" name="l00823"></a><span class="lineno">  823</span>    }</div>
<div class="line"><a id="l00824" name="l00824"></a><span class="lineno">  824</span> </div>
<div class="line"><a id="l00825" name="l00825"></a><span class="lineno">  825</span>    RCLCPP_DEBUG_STREAM(<a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#aa2f96dc545c04733e8ba11a6f3a0c2c6">nh_</a>-&gt;get_logger(),<span class="stringliteral">&quot;External Object List (external_objects) size: &quot;</span> &lt;&lt; external_objects.size());</div>
<div class="line"><a id="l00826" name="l00826"></a><span class="lineno">  826</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> original_max_speed = <a class="code hl_function" href="classyield__plugin_1_1YieldPlugin.html#ae53a42abb996d38cf701a3fba7e473f8">max_trajectory_speed</a>(original_tp.trajectory_points, <a class="code hl_function" href="namespaceyield__plugin.html#a82b2a694528d42a4af068732befca882">get_trajectory_end_time</a>(original_tp));</div>
<div class="line"><a id="l00827" name="l00827"></a><span class="lineno">  827</span>    std::unordered_map&lt;uint32_t, rclcpp::Time&gt; collision_times = <a class="code hl_function" href="classyield__plugin_1_1YieldPlugin.html#aae4fab3792eaa78de9a88299c209246d">get_collision_times_concurrently</a>(original_tp,external_objects, original_max_speed);</div>
<div class="line"><a id="l00828" name="l00828"></a><span class="lineno">  828</span> </div>
<div class="line"><a id="l00829" name="l00829"></a><span class="lineno">  829</span>    <span class="keywordflow">if</span> (collision_times.empty()) { <span class="keywordflow">return</span> std::nullopt; }</div>
<div class="line"><a id="l00830" name="l00830"></a><span class="lineno">  830</span> </div>
<div class="line"><a id="l00831" name="l00831"></a><span class="lineno">  831</span>    <span class="keyword">const</span> <span class="keyword">auto</span> earliest_colliding_object_id{std::min_element(</div>
<div class="line"><a id="l00832" name="l00832"></a><span class="lineno">  832</span>      std::cbegin(collision_times), std::cend(collision_times),</div>
<div class="line"><a id="l00833" name="l00833"></a><span class="lineno">  833</span>      [](<span class="keyword">const</span> <span class="keyword">auto</span> &amp; <a class="code hl_variable" href="pointer_8h.html#aeeddce917cf130d62c370b8f216026dd">a</a>, <span class="keyword">const</span> <span class="keyword">auto</span> &amp; b){ <span class="keywordflow">return</span> <a class="code hl_variable" href="pointer_8h.html#aeeddce917cf130d62c370b8f216026dd">a</a>.second &lt; b.second; })-&gt;first};</div>
<div class="line"><a id="l00834" name="l00834"></a><span class="lineno">  834</span> </div>
<div class="line"><a id="l00835" name="l00835"></a><span class="lineno">  835</span>    <span class="keyword">const</span> <span class="keyword">auto</span> earliest_colliding_object{std::find_if(</div>
<div class="line"><a id="l00836" name="l00836"></a><span class="lineno">  836</span>      std::cbegin(external_objects), std::cend(external_objects),</div>
<div class="line"><a id="l00837" name="l00837"></a><span class="lineno">  837</span>      [&amp;earliest_colliding_object_id](<span class="keyword">const</span> <span class="keyword">auto</span> &amp; <span class="keywordtype">object</span>) { <span class="keywordflow">return</span> <span class="keywordtype">object</span>.id == earliest_colliding_object_id; })};</div>
<div class="line"><a id="l00838" name="l00838"></a><span class="lineno">  838</span> </div>
<div class="line"><a id="l00839" name="l00839"></a><span class="lineno">  839</span>    RCLCPP_DEBUG_STREAM(<a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#aa2f96dc545c04733e8ba11a6f3a0c2c6">nh_</a>-&gt;get_logger(),<span class="stringliteral">&quot;earliest object x: &quot;</span> &lt;&lt; earliest_colliding_object-&gt;velocity.twist.linear.x</div>
<div class="line"><a id="l00840" name="l00840"></a><span class="lineno">  840</span>        &lt;&lt; <span class="stringliteral">&quot;, y: &quot;</span> &lt;&lt; earliest_colliding_object-&gt;velocity.twist.linear.y);</div>
<div class="line"><a id="l00841" name="l00841"></a><span class="lineno">  841</span>    <span class="keywordflow">return</span> std::make_pair(*earliest_colliding_object, collision_times.at(earliest_colliding_object_id).seconds());</div>
<div class="line"><a id="l00842" name="l00842"></a><span class="lineno">  842</span> </div>
<div class="line"><a id="l00843" name="l00843"></a><span class="lineno">  843</span>  }</div>
<div class="line"><a id="l00844" name="l00844"></a><span class="lineno">  844</span> </div>
<div class="line"><a id="l00845" name="l00845"></a><span class="lineno"><a class="line" href="classyield__plugin_1_1YieldPlugin.html#a378558cb2b27d8337d980150543d447d">  845</a></span>  <span class="keywordtype">double</span> <a class="code hl_function" href="classyield__plugin_1_1YieldPlugin.html#a378558cb2b27d8337d980150543d447d">YieldPlugin::get_predicted_velocity_at_time</a>(<span class="keyword">const</span> geometry_msgs::msg::Twist&amp; object_velocity_in_map_frame,</div>
<div class="line"><a id="l00846" name="l00846"></a><span class="lineno">  846</span>    <span class="keyword">const</span> carma_planning_msgs::msg::TrajectoryPlan&amp; original_tp, <span class="keywordtype">double</span> timestamp_in_sec_to_predict)</div>
<div class="line"><a id="l00847" name="l00847"></a><span class="lineno">  847</span>  {</div>
<div class="line"><a id="l00848" name="l00848"></a><span class="lineno">  848</span>    RCLCPP_DEBUG_STREAM(<a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#aa2f96dc545c04733e8ba11a6f3a0c2c6">nh_</a>-&gt;get_logger(), <span class="stringliteral">&quot;timestamp_in_sec_to_predict: &quot;</span> &lt;&lt; <a class="code hl_function" href="namespacecarma__cooperative__perception.html#a64b708654c8aecb09122d39577df31b5">std::to_string</a>(timestamp_in_sec_to_predict) &lt;&lt;</div>
<div class="line"><a id="l00849" name="l00849"></a><span class="lineno">  849</span>      <span class="stringliteral">&quot;, trajectory_end_time: &quot;</span> &lt;&lt; <a class="code hl_function" href="namespacecarma__cooperative__perception.html#a64b708654c8aecb09122d39577df31b5">std::to_string</a>(<a class="code hl_function" href="namespaceyield__plugin.html#a82b2a694528d42a4af068732befca882">get_trajectory_end_time</a>(original_tp)));</div>
<div class="line"><a id="l00850" name="l00850"></a><span class="lineno">  850</span> </div>
<div class="line"><a id="l00851" name="l00851"></a><span class="lineno">  851</span>    <span class="keywordtype">double</span> point_b_time = 0.0;</div>
<div class="line"><a id="l00852" name="l00852"></a><span class="lineno">  852</span>    carma_planning_msgs::msg::TrajectoryPlanPoint point_a;</div>
<div class="line"><a id="l00853" name="l00853"></a><span class="lineno">  853</span>    carma_planning_msgs::msg::TrajectoryPlanPoint point_b;</div>
<div class="line"><a id="l00854" name="l00854"></a><span class="lineno">  854</span> </div>
<div class="line"><a id="l00855" name="l00855"></a><span class="lineno">  855</span>    <span class="comment">// trajectory points&#39; time is guaranteed to be increasing</span></div>
<div class="line"><a id="l00856" name="l00856"></a><span class="lineno">  856</span>    <span class="comment">// then find the corresponding point at timestamp_in_sec_to_predict</span></div>
<div class="line"><a id="l00857" name="l00857"></a><span class="lineno">  857</span>    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a> = 0; <a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a> &lt; original_tp.trajectory_points.size() - 1; ++<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>)</div>
<div class="line"><a id="l00858" name="l00858"></a><span class="lineno">  858</span>    {</div>
<div class="line"><a id="l00859" name="l00859"></a><span class="lineno">  859</span>      point_a = original_tp.trajectory_points.at(<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>);</div>
<div class="line"><a id="l00860" name="l00860"></a><span class="lineno">  860</span>      point_b = original_tp.trajectory_points.at(<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a> + 1);</div>
<div class="line"><a id="l00861" name="l00861"></a><span class="lineno">  861</span>      point_b_time = rclcpp::Time(point_b.target_time).seconds();</div>
<div class="line"><a id="l00862" name="l00862"></a><span class="lineno">  862</span>      <span class="keywordflow">if</span> (point_b_time &gt;= timestamp_in_sec_to_predict)</div>
<div class="line"><a id="l00863" name="l00863"></a><span class="lineno">  863</span>      {</div>
<div class="line"><a id="l00864" name="l00864"></a><span class="lineno">  864</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00865" name="l00865"></a><span class="lineno">  865</span>      }</div>
<div class="line"><a id="l00866" name="l00866"></a><span class="lineno">  866</span>    }</div>
<div class="line"><a id="l00867" name="l00867"></a><span class="lineno">  867</span> </div>
<div class="line"><a id="l00868" name="l00868"></a><span class="lineno">  868</span>    <span class="keyword">auto</span> dx = point_b.x - point_a.x;</div>
<div class="line"><a id="l00869" name="l00869"></a><span class="lineno">  869</span>    <span class="keyword">auto</span> dy = point_b.y - point_a.y;</div>
<div class="line"><a id="l00870" name="l00870"></a><span class="lineno">  870</span>    <span class="keyword">const</span> tf2::Vector3 trajectory_direction(dx, dy, 0);</div>
<div class="line"><a id="l00871" name="l00871"></a><span class="lineno">  871</span> </div>
<div class="line"><a id="l00872" name="l00872"></a><span class="lineno">  872</span>    RCLCPP_DEBUG_STREAM(<a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#aa2f96dc545c04733e8ba11a6f3a0c2c6">nh_</a>-&gt;get_logger(), <span class="stringliteral">&quot;timestamp_in_sec_to_predict: &quot;</span> &lt;&lt; <a class="code hl_function" href="namespacecarma__cooperative__perception.html#a64b708654c8aecb09122d39577df31b5">std::to_string</a>(timestamp_in_sec_to_predict)</div>
<div class="line"><a id="l00873" name="l00873"></a><span class="lineno">  873</span>      &lt;&lt; <span class="stringliteral">&quot;, point_b_time: &quot;</span> &lt;&lt; <a class="code hl_function" href="namespacecarma__cooperative__perception.html#a64b708654c8aecb09122d39577df31b5">std::to_string</a>(point_b_time)</div>
<div class="line"><a id="l00874" name="l00874"></a><span class="lineno">  874</span>      &lt;&lt; <span class="stringliteral">&quot;, dx: &quot;</span> &lt;&lt; dx &lt;&lt; <span class="stringliteral">&quot;, dy: &quot;</span> &lt;&lt; dy &lt;&lt; <span class="stringliteral">&quot;, &quot;</span></div>
<div class="line"><a id="l00875" name="l00875"></a><span class="lineno">  875</span>      &lt;&lt; <span class="stringliteral">&quot;, object_velocity_in_map_frame.x: &quot;</span> &lt;&lt; object_velocity_in_map_frame.linear.x</div>
<div class="line"><a id="l00876" name="l00876"></a><span class="lineno">  876</span>      &lt;&lt; <span class="stringliteral">&quot;, object_velocity_in_map_frame.y: &quot;</span> &lt;&lt; object_velocity_in_map_frame.linear.y);</div>
<div class="line"><a id="l00877" name="l00877"></a><span class="lineno">  877</span> </div>
<div class="line"><a id="l00878" name="l00878"></a><span class="lineno">  878</span>    <span class="keywordflow">if</span> (trajectory_direction.length() &lt; 0.001) <span class="comment">//EPSILON</span></div>
<div class="line"><a id="l00879" name="l00879"></a><span class="lineno">  879</span>    {</div>
<div class="line"><a id="l00880" name="l00880"></a><span class="lineno">  880</span>      <span class="keywordflow">return</span> 0.0;</div>
<div class="line"><a id="l00881" name="l00881"></a><span class="lineno">  881</span>    }</div>
<div class="line"><a id="l00882" name="l00882"></a><span class="lineno">  882</span> </div>
<div class="line"><a id="l00883" name="l00883"></a><span class="lineno">  883</span>    <span class="keyword">const</span> tf2::Vector3 object_direction(object_velocity_in_map_frame.linear.x, object_velocity_in_map_frame.linear.y, 0);</div>
<div class="line"><a id="l00884" name="l00884"></a><span class="lineno">  884</span> </div>
<div class="line"><a id="l00885" name="l00885"></a><span class="lineno">  885</span>    <span class="keywordflow">return</span> tf2::tf2Dot(object_direction, trajectory_direction) / trajectory_direction.length();</div>
<div class="line"><a id="l00886" name="l00886"></a><span class="lineno">  886</span>  }</div>
<div class="line"><a id="l00887" name="l00887"></a><span class="lineno">  887</span> </div>
<div class="line"><a id="l00888" name="l00888"></a><span class="lineno"><a class="line" href="classyield__plugin_1_1YieldPlugin.html#ac1c423b99887ccbf945a86da7b7809f6">  888</a></span>  carma_planning_msgs::msg::TrajectoryPlan <a class="code hl_function" href="classyield__plugin_1_1YieldPlugin.html#ac1c423b99887ccbf945a86da7b7809f6">YieldPlugin::update_traj_for_object</a>(<span class="keyword">const</span> carma_planning_msgs::msg::TrajectoryPlan&amp; original_tp,</div>
<div class="line"><a id="l00889" name="l00889"></a><span class="lineno">  889</span>    <span class="keyword">const</span> std::vector&lt;carma_perception_msgs::msg::ExternalObject&gt;&amp; external_objects, <span class="keywordtype">double</span> initial_velocity)</div>
<div class="line"><a id="l00890" name="l00890"></a><span class="lineno">  890</span>  {</div>
<div class="line"><a id="l00891" name="l00891"></a><span class="lineno">  891</span>    <span class="keywordflow">if</span> (original_tp.trajectory_points.size() &lt; 2)</div>
<div class="line"><a id="l00892" name="l00892"></a><span class="lineno">  892</span>    {</div>
<div class="line"><a id="l00893" name="l00893"></a><span class="lineno">  893</span>      RCLCPP_WARN(<a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#aa2f96dc545c04733e8ba11a6f3a0c2c6">nh_</a>-&gt;get_logger(), <span class="stringliteral">&quot;Yield plugin received less than 2 points in update_traj_for_object, returning unchanged...&quot;</span>);</div>
<div class="line"><a id="l00894" name="l00894"></a><span class="lineno">  894</span>      <span class="keywordflow">return</span> original_tp;</div>
<div class="line"><a id="l00895" name="l00895"></a><span class="lineno">  895</span>    }</div>
<div class="line"><a id="l00896" name="l00896"></a><span class="lineno">  896</span> </div>
<div class="line"><a id="l00897" name="l00897"></a><span class="lineno">  897</span>    <span class="comment">// Get earliest collision object</span></div>
<div class="line"><a id="l00898" name="l00898"></a><span class="lineno">  898</span>    <span class="keyword">const</span> <span class="keyword">auto</span> earliest_collision_obj_pair = <a class="code hl_function" href="classyield__plugin_1_1YieldPlugin.html#a546149400d9d6371c5de50f229d6ecfc">get_earliest_collision_object_and_time</a>(original_tp, external_objects);</div>
<div class="line"><a id="l00899" name="l00899"></a><span class="lineno">  899</span> </div>
<div class="line"><a id="l00900" name="l00900"></a><span class="lineno">  900</span>    <span class="keywordflow">if</span> (!earliest_collision_obj_pair)</div>
<div class="line"><a id="l00901" name="l00901"></a><span class="lineno">  901</span>    {</div>
<div class="line"><a id="l00902" name="l00902"></a><span class="lineno">  902</span>      RCLCPP_DEBUG(<a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#aa2f96dc545c04733e8ba11a6f3a0c2c6">nh_</a>-&gt;get_logger(),<span class="stringliteral">&quot;No collision detected, so trajectory not modified.&quot;</span>);</div>
<div class="line"><a id="l00903" name="l00903"></a><span class="lineno">  903</span>      <span class="keywordflow">return</span> original_tp;</div>
<div class="line"><a id="l00904" name="l00904"></a><span class="lineno">  904</span>    }</div>
<div class="line"><a id="l00905" name="l00905"></a><span class="lineno">  905</span> </div>
<div class="line"><a id="l00906" name="l00906"></a><span class="lineno">  906</span>    carma_perception_msgs::msg::ExternalObject earliest_collision_obj = earliest_collision_obj_pair.value().first;</div>
<div class="line"><a id="l00907" name="l00907"></a><span class="lineno">  907</span>    <span class="keywordtype">double</span> earliest_collision_time_in_seconds = earliest_collision_obj_pair.value().second;</div>
<div class="line"><a id="l00908" name="l00908"></a><span class="lineno">  908</span> </div>
<div class="line"><a id="l00909" name="l00909"></a><span class="lineno">  909</span>    <span class="comment">// Issue (https://github.com/usdot-fhwa-stol/carma-platform/issues/2155): If the yield_plugin can detect if the roadway object is moving along the route,</span></div>
<div class="line"><a id="l00910" name="l00910"></a><span class="lineno">  910</span>    <span class="comment">// it is able to plan yielding much earlier and smoother using on_route_vehicle_collision_horizon_in_s.</span></div>
<div class="line"><a id="l00911" name="l00911"></a><span class="lineno">  911</span> </div>
<div class="line"><a id="l00912" name="l00912"></a><span class="lineno">  912</span>    <span class="keyword">const</span> lanelet::BasicPoint2d vehicle_point(original_tp.trajectory_points[0].x,original_tp.trajectory_points[0].y);</div>
<div class="line"><a id="l00913" name="l00913"></a><span class="lineno">  913</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> vehicle_downtrack = <a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#aff229ed7bba2a76d0b1b99a83b9fdf88">wm_</a>-&gt;routeTrackPos(vehicle_point).downtrack;</div>
<div class="line"><a id="l00914" name="l00914"></a><span class="lineno">  914</span> </div>
<div class="line"><a id="l00915" name="l00915"></a><span class="lineno">  915</span>    RCLCPP_DEBUG_STREAM(<a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#aa2f96dc545c04733e8ba11a6f3a0c2c6">nh_</a>-&gt;get_logger(),<span class="stringliteral">&quot;vehicle_downtrack: &quot;</span> &lt;&lt; vehicle_downtrack);</div>
<div class="line"><a id="l00916" name="l00916"></a><span class="lineno">  916</span> </div>
<div class="line"><a id="l00917" name="l00917"></a><span class="lineno">  917</span>    RCLCPP_WARN_STREAM(<a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#aa2f96dc545c04733e8ba11a6f3a0c2c6">nh_</a>-&gt;get_logger(),<span class="stringliteral">&quot;Collision Detected!&quot;</span>);</div>
<div class="line"><a id="l00918" name="l00918"></a><span class="lineno">  918</span> </div>
<div class="line"><a id="l00919" name="l00919"></a><span class="lineno">  919</span>    <span class="keyword">const</span> lanelet::BasicPoint2d object_point(earliest_collision_obj.pose.pose.position.x, earliest_collision_obj.pose.pose.position.y);</div>
<div class="line"><a id="l00920" name="l00920"></a><span class="lineno">  920</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> object_downtrack = <a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#aff229ed7bba2a76d0b1b99a83b9fdf88">wm_</a>-&gt;routeTrackPos(object_point).downtrack;</div>
<div class="line"><a id="l00921" name="l00921"></a><span class="lineno">  921</span> </div>
<div class="line"><a id="l00922" name="l00922"></a><span class="lineno">  922</span>    RCLCPP_DEBUG_STREAM(<a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#aa2f96dc545c04733e8ba11a6f3a0c2c6">nh_</a>-&gt;get_logger(),<span class="stringliteral">&quot;object_downtrack: &quot;</span> &lt;&lt; object_downtrack);</div>
<div class="line"><a id="l00923" name="l00923"></a><span class="lineno">  923</span> </div>
<div class="line"><a id="l00924" name="l00924"></a><span class="lineno">  924</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> object_downtrack_lead = std::max(0.0, object_downtrack - vehicle_downtrack);</div>
<div class="line"><a id="l00925" name="l00925"></a><span class="lineno">  925</span>    RCLCPP_DEBUG_STREAM(<a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#aa2f96dc545c04733e8ba11a6f3a0c2c6">nh_</a>-&gt;get_logger(),<span class="stringliteral">&quot;object_downtrack_lead: &quot;</span> &lt;&lt; object_downtrack_lead);</div>
<div class="line"><a id="l00926" name="l00926"></a><span class="lineno">  926</span> </div>
<div class="line"><a id="l00927" name="l00927"></a><span class="lineno">  927</span>    <span class="comment">// The vehicle&#39;s goal velocity of the yielding behavior is to match the velocity of the object along the trajectory.</span></div>
<div class="line"><a id="l00928" name="l00928"></a><span class="lineno">  928</span>    <span class="keywordtype">double</span> goal_velocity = <a class="code hl_function" href="classyield__plugin_1_1YieldPlugin.html#a378558cb2b27d8337d980150543d447d">get_predicted_velocity_at_time</a>(earliest_collision_obj.velocity.twist, original_tp, earliest_collision_time_in_seconds);</div>
<div class="line"><a id="l00929" name="l00929"></a><span class="lineno">  929</span>    RCLCPP_DEBUG_STREAM(<a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#aa2f96dc545c04733e8ba11a6f3a0c2c6">nh_</a>-&gt;get_logger(),<span class="stringliteral">&quot;object&#39;s speed along trajectory at collision: &quot;</span> &lt;&lt; goal_velocity);</div>
<div class="line"><a id="l00930" name="l00930"></a><span class="lineno">  930</span> </div>
<div class="line"><a id="l00931" name="l00931"></a><span class="lineno">  931</span>    <span class="comment">// roadway object position</span></div>
<div class="line"><a id="l00932" name="l00932"></a><span class="lineno">  932</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> gap_time_until_min_gap_distance = std::max(0.0, object_downtrack_lead - <a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#ab1f62a493a4229d4801841eb19fb1e7d">config_</a>.<a class="code hl_variable" href="structYieldPluginConfig.html#ada1059dd1218ecd9b513195b775aa633">minimum_safety_gap_in_meters</a>)/initial_velocity;</div>
<div class="line"><a id="l00933" name="l00933"></a><span class="lineno">  933</span> </div>
<div class="line"><a id="l00934" name="l00934"></a><span class="lineno">  934</span>    <span class="keywordflow">if</span> (goal_velocity &lt;= <a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#ab1f62a493a4229d4801841eb19fb1e7d">config_</a>.<a class="code hl_variable" href="structYieldPluginConfig.html#abe6d1c18b2a7f34566828c71eb4573ef">obstacle_zero_speed_threshold_in_ms</a>){</div>
<div class="line"><a id="l00935" name="l00935"></a><span class="lineno">  935</span>      RCLCPP_WARN_STREAM(<a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#aa2f96dc545c04733e8ba11a6f3a0c2c6">nh_</a>-&gt;get_logger(),<span class="stringliteral">&quot;The obstacle is not moving, goal velocity is set to 0 from: &quot;</span> &lt;&lt; goal_velocity);</div>
<div class="line"><a id="l00936" name="l00936"></a><span class="lineno">  936</span>      goal_velocity = 0.0;</div>
<div class="line"><a id="l00937" name="l00937"></a><span class="lineno">  937</span>    }</div>
<div class="line"><a id="l00938" name="l00938"></a><span class="lineno">  938</span> </div>
<div class="line"><a id="l00939" name="l00939"></a><span class="lineno">  939</span>    <span class="comment">// determine the safety inter-vehicle gap based on speed</span></div>
<div class="line"><a id="l00940" name="l00940"></a><span class="lineno">  940</span>    <span class="keywordtype">double</span> safety_gap = std::max(goal_velocity * gap_time_until_min_gap_distance, <a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#ab1f62a493a4229d4801841eb19fb1e7d">config_</a>.<a class="code hl_variable" href="structYieldPluginConfig.html#ada1059dd1218ecd9b513195b775aa633">minimum_safety_gap_in_meters</a>);</div>
<div class="line"><a id="l00941" name="l00941"></a><span class="lineno">  941</span>    <span class="keywordflow">if</span> (!std::isnormal(safety_gap))</div>
<div class="line"><a id="l00942" name="l00942"></a><span class="lineno">  942</span>    {</div>
<div class="line"><a id="l00943" name="l00943"></a><span class="lineno">  943</span>      RCLCPP_WARN_STREAM(rclcpp::get_logger(<span class="stringliteral">&quot;yield_plugin&quot;</span>),<span class="stringliteral">&quot;Detected non-normal (nan, inf, etc.) safety_gap.&quot;</span></div>
<div class="line"><a id="l00944" name="l00944"></a><span class="lineno">  944</span>        <span class="stringliteral">&quot;Making it desired safety gap configured at config_.minimum_safety_gap_in_meters: &quot;</span> &lt;&lt; <a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#ab1f62a493a4229d4801841eb19fb1e7d">config_</a>.<a class="code hl_variable" href="structYieldPluginConfig.html#ada1059dd1218ecd9b513195b775aa633">minimum_safety_gap_in_meters</a>);</div>
<div class="line"><a id="l00945" name="l00945"></a><span class="lineno">  945</span>      safety_gap = <a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#ab1f62a493a4229d4801841eb19fb1e7d">config_</a>.<a class="code hl_variable" href="structYieldPluginConfig.html#ada1059dd1218ecd9b513195b775aa633">minimum_safety_gap_in_meters</a>;</div>
<div class="line"><a id="l00946" name="l00946"></a><span class="lineno">  946</span>    }</div>
<div class="line"><a id="l00947" name="l00947"></a><span class="lineno">  947</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#ab1f62a493a4229d4801841eb19fb1e7d">config_</a>.<a class="code hl_variable" href="structYieldPluginConfig.html#a31b1781ef97ad5d956fe8c51cc161d69">enable_adjustable_gap</a>)</div>
<div class="line"><a id="l00948" name="l00948"></a><span class="lineno">  948</span>    {</div>
<div class="line"><a id="l00949" name="l00949"></a><span class="lineno">  949</span>      <span class="comment">// externally_commanded_safety_gap is desired distance gap commanded from external sources</span></div>
<div class="line"><a id="l00950" name="l00950"></a><span class="lineno">  950</span>      <span class="comment">// such as different plugin, map, or infrastructure depending on the use case</span></div>
<div class="line"><a id="l00951" name="l00951"></a><span class="lineno">  951</span>      <span class="keywordtype">double</span> externally_commanded_safety_gap = <a class="code hl_function" href="classyield__plugin_1_1YieldPlugin.html#a3703b49299aa6b61b3889a8e6799ac74">check_traj_for_digital_min_gap</a>(original_tp);</div>
<div class="line"><a id="l00952" name="l00952"></a><span class="lineno">  952</span>      RCLCPP_DEBUG_STREAM(<a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#aa2f96dc545c04733e8ba11a6f3a0c2c6">nh_</a>-&gt;get_logger(),<span class="stringliteral">&quot;externally_commanded_safety_gap: &quot;</span> &lt;&lt; externally_commanded_safety_gap);</div>
<div class="line"><a id="l00953" name="l00953"></a><span class="lineno">  953</span>      <span class="comment">// if a digital gap is available, it is replaced as safety gap</span></div>
<div class="line"><a id="l00954" name="l00954"></a><span class="lineno">  954</span>      safety_gap = std::max(safety_gap, externally_commanded_safety_gap);</div>
<div class="line"><a id="l00955" name="l00955"></a><span class="lineno">  955</span>    }</div>
<div class="line"><a id="l00956" name="l00956"></a><span class="lineno">  956</span> </div>
<div class="line"><a id="l00957" name="l00957"></a><span class="lineno">  957</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> goal_pos = std::max(0.0, object_downtrack_lead - safety_gap - <a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#ab1f62a493a4229d4801841eb19fb1e7d">config_</a>.<a class="code hl_variable" href="structYieldPluginConfig.html#a7b0405c10307bac9613aba5a228de94e">vehicle_length</a>);</div>
<div class="line"><a id="l00958" name="l00958"></a><span class="lineno">  958</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> initial_pos = 0.0; <span class="comment">//relative initial position (first trajectory point)</span></div>
<div class="line"><a id="l00959" name="l00959"></a><span class="lineno">  959</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> original_max_speed = <a class="code hl_function" href="classyield__plugin_1_1YieldPlugin.html#ae53a42abb996d38cf701a3fba7e473f8">max_trajectory_speed</a>(original_tp.trajectory_points, earliest_collision_time_in_seconds);</div>
<div class="line"><a id="l00960" name="l00960"></a><span class="lineno">  960</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> delta_v_max = fabs(goal_velocity - original_max_speed);</div>
<div class="line"><a id="l00961" name="l00961"></a><span class="lineno">  961</span>    RCLCPP_DEBUG_STREAM(<a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#aa2f96dc545c04733e8ba11a6f3a0c2c6">nh_</a>-&gt;get_logger(),<span class="stringliteral">&quot;delta_v_max: &quot;</span> &lt;&lt; delta_v_max &lt;&lt; <span class="stringliteral">&quot;, safety_gap: &quot;</span> &lt;&lt; safety_gap);</div>
<div class="line"><a id="l00962" name="l00962"></a><span class="lineno">  962</span> </div>
<div class="line"><a id="l00963" name="l00963"></a><span class="lineno">  963</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> time_required_for_comfortable_decel_in_s = <a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#ab1f62a493a4229d4801841eb19fb1e7d">config_</a>.<a class="code hl_variable" href="structYieldPluginConfig.html#a7d48460ee46f906c2e6b33dc46238f12">acceleration_adjustment_factor</a> * 2 * goal_pos / delta_v_max;</div>
<div class="line"><a id="l00964" name="l00964"></a><span class="lineno">  964</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> min_time_required_for_comfortable_decel_in_s = delta_v_max / <a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#ab1f62a493a4229d4801841eb19fb1e7d">config_</a>.<a class="code hl_variable" href="structYieldPluginConfig.html#a92f70f21fdd60cc19df76491b18c041e">yield_max_deceleration_in_ms2</a>;</div>
<div class="line"><a id="l00965" name="l00965"></a><span class="lineno">  965</span> </div>
<div class="line"><a id="l00966" name="l00966"></a><span class="lineno">  966</span>    <span class="comment">// planning time for object avoidance</span></div>
<div class="line"><a id="l00967" name="l00967"></a><span class="lineno">  967</span>    <span class="keywordtype">double</span> planning_time_in_s = std::max({<a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#ab1f62a493a4229d4801841eb19fb1e7d">config_</a>.<a class="code hl_variable" href="structYieldPluginConfig.html#accd4e108184fe5a470d4f8af1de1e7a2">min_obj_avoidance_plan_time_in_s</a>, time_required_for_comfortable_decel_in_s, min_time_required_for_comfortable_decel_in_s});</div>
<div class="line"><a id="l00968" name="l00968"></a><span class="lineno">  968</span>    RCLCPP_DEBUG_STREAM(<a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#aa2f96dc545c04733e8ba11a6f3a0c2c6">nh_</a>-&gt;get_logger(),<span class="stringliteral">&quot;time_required_for_comfortable_decel_in_s: &quot;</span> &lt;&lt; time_required_for_comfortable_decel_in_s &lt;&lt; <span class="stringliteral">&quot;, min_time_required_for_comfortable_decel_in_s: &quot;</span> &lt;&lt; min_time_required_for_comfortable_decel_in_s);</div>
<div class="line"><a id="l00969" name="l00969"></a><span class="lineno">  969</span> </div>
<div class="line"><a id="l00970" name="l00970"></a><span class="lineno">  970</span>    RCLCPP_DEBUG_STREAM(<a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#aa2f96dc545c04733e8ba11a6f3a0c2c6">nh_</a>-&gt;get_logger(),<span class="stringliteral">&quot;Object avoidance planning time: &quot;</span> &lt;&lt; planning_time_in_s);</div>
<div class="line"><a id="l00971" name="l00971"></a><span class="lineno">  971</span> </div>
<div class="line"><a id="l00972" name="l00972"></a><span class="lineno">  972</span>    <span class="keywordflow">return</span> <a class="code hl_function" href="classyield__plugin_1_1YieldPlugin.html#ace53f1895cbbf2a5f109cbfc11d6313f">generate_JMT_trajectory</a>(original_tp, initial_pos, goal_pos, initial_velocity, goal_velocity, planning_time_in_s, original_max_speed);</div>
<div class="line"><a id="l00973" name="l00973"></a><span class="lineno">  973</span>  }</div>
<div class="line"><a id="l00974" name="l00974"></a><span class="lineno">  974</span> </div>
<div class="line"><a id="l00975" name="l00975"></a><span class="lineno">  975</span> </div>
<div class="line"><a id="l00976" name="l00976"></a><span class="lineno"><a class="line" href="classyield__plugin_1_1YieldPlugin.html#a1bc011c9c2db48289bf40214d972cec4">  976</a></span>  std::vector&lt;double&gt; <a class="code hl_function" href="classyield__plugin_1_1YieldPlugin.html#a1bc011c9c2db48289bf40214d972cec4">YieldPlugin::get_relative_downtracks</a>(<span class="keyword">const</span> carma_planning_msgs::msg::TrajectoryPlan&amp; trajectory_plan)<span class="keyword"> const</span></div>
<div class="line"><a id="l00977" name="l00977"></a><span class="lineno">  977</span><span class="keyword">  </span>{</div>
<div class="line"><a id="l00978" name="l00978"></a><span class="lineno">  978</span>    std::vector&lt;double&gt; downtracks;</div>
<div class="line"><a id="l00979" name="l00979"></a><span class="lineno">  979</span>    downtracks.reserve(trajectory_plan.trajectory_points.size());</div>
<div class="line"><a id="l00980" name="l00980"></a><span class="lineno">  980</span>    <span class="comment">// relative downtrack distance of the fist Point is 0.0</span></div>
<div class="line"><a id="l00981" name="l00981"></a><span class="lineno">  981</span>    downtracks.push_back(0.0);</div>
<div class="line"><a id="l00982" name="l00982"></a><span class="lineno">  982</span>    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>=1; <a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a> &lt; trajectory_plan.trajectory_points.size(); <a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>++){</div>
<div class="line"><a id="l00983" name="l00983"></a><span class="lineno">  983</span> </div>
<div class="line"><a id="l00984" name="l00984"></a><span class="lineno">  984</span>      <span class="keywordtype">double</span> dx = trajectory_plan.trajectory_points.at(<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>).x - trajectory_plan.trajectory_points.at(<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>-1).x;</div>
<div class="line"><a id="l00985" name="l00985"></a><span class="lineno">  985</span>      <span class="keywordtype">double</span> dy = trajectory_plan.trajectory_points.at(<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>).y - trajectory_plan.trajectory_points.at(<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>-1).y;</div>
<div class="line"><a id="l00986" name="l00986"></a><span class="lineno">  986</span>      downtracks.push_back(sqrt(dx*dx + dy*dy));</div>
<div class="line"><a id="l00987" name="l00987"></a><span class="lineno">  987</span>    }</div>
<div class="line"><a id="l00988" name="l00988"></a><span class="lineno">  988</span>    <span class="keywordflow">return</span> downtracks;</div>
<div class="line"><a id="l00989" name="l00989"></a><span class="lineno">  989</span>  }</div>
<div class="line"><a id="l00990" name="l00990"></a><span class="lineno">  990</span> </div>
<div class="line"><a id="l00991" name="l00991"></a><span class="lineno"><a class="line" href="classyield__plugin_1_1YieldPlugin.html#ae7ffd46ccbae6de4b60a7f49a8cfa3d6">  991</a></span>  <span class="keywordtype">double</span> <a class="code hl_function" href="classyield__plugin_1_1YieldPlugin.html#ae7ffd46ccbae6de4b60a7f49a8cfa3d6">YieldPlugin::polynomial_calc</a>(std::vector&lt;double&gt; coeff, <span class="keywordtype">double</span> <a class="code hl_variable" href="namespaceprocess__traj__logs.html#af3ba6144a2d35a4990f1a8d04632a052">x</a>)<span class="keyword"> const</span></div>
<div class="line"><a id="l00992" name="l00992"></a><span class="lineno">  992</span><span class="keyword">  </span>{</div>
<div class="line"><a id="l00993" name="l00993"></a><span class="lineno">  993</span>    <span class="keywordtype">double</span> result = 0;</div>
<div class="line"><a id="l00994" name="l00994"></a><span class="lineno">  994</span>    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a> = 0; <a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a> &lt; coeff.size(); <a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>++)</div>
<div class="line"><a id="l00995" name="l00995"></a><span class="lineno">  995</span>    {</div>
<div class="line"><a id="l00996" name="l00996"></a><span class="lineno">  996</span>      <span class="keywordtype">double</span> <a class="code hl_variable" href="pointer_8h.html#a32aff7c6c4cd253fdf6563677afab5ce">value</a> = coeff.at(<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>) * pow(<a class="code hl_variable" href="namespaceprocess__traj__logs.html#af3ba6144a2d35a4990f1a8d04632a052">x</a>, <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(coeff.size() - 1 - <a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>));</div>
<div class="line"><a id="l00997" name="l00997"></a><span class="lineno">  997</span>      result = result + <a class="code hl_variable" href="pointer_8h.html#a32aff7c6c4cd253fdf6563677afab5ce">value</a>;</div>
<div class="line"><a id="l00998" name="l00998"></a><span class="lineno">  998</span>    }</div>
<div class="line"><a id="l00999" name="l00999"></a><span class="lineno">  999</span>    <span class="keywordflow">return</span> result;</div>
<div class="line"><a id="l01000" name="l01000"></a><span class="lineno"> 1000</span>  }</div>
<div class="line"><a id="l01001" name="l01001"></a><span class="lineno"> 1001</span> </div>
<div class="line"><a id="l01002" name="l01002"></a><span class="lineno"><a class="line" href="classyield__plugin_1_1YieldPlugin.html#afeab08ed138eafe6e24abd775c3163dd"> 1002</a></span>  <span class="keywordtype">double</span> <a class="code hl_function" href="classyield__plugin_1_1YieldPlugin.html#afeab08ed138eafe6e24abd775c3163dd">YieldPlugin::polynomial_calc_d</a>(std::vector&lt;double&gt; coeff, <span class="keywordtype">double</span> <a class="code hl_variable" href="namespaceprocess__traj__logs.html#af3ba6144a2d35a4990f1a8d04632a052">x</a>)<span class="keyword"> const</span></div>
<div class="line"><a id="l01003" name="l01003"></a><span class="lineno"> 1003</span><span class="keyword">  </span>{</div>
<div class="line"><a id="l01004" name="l01004"></a><span class="lineno"> 1004</span>    <span class="keywordtype">double</span> result = 0;</div>
<div class="line"><a id="l01005" name="l01005"></a><span class="lineno"> 1005</span>    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a> = 0; <a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a> &lt; coeff.size()-1; <a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>++)</div>
<div class="line"><a id="l01006" name="l01006"></a><span class="lineno"> 1006</span>    {</div>
<div class="line"><a id="l01007" name="l01007"></a><span class="lineno"> 1007</span>      <span class="keywordtype">double</span> <a class="code hl_variable" href="pointer_8h.html#a32aff7c6c4cd253fdf6563677afab5ce">value</a> = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(coeff.size() - 1 - <a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>) * coeff.at(<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>) * pow(<a class="code hl_variable" href="namespaceprocess__traj__logs.html#af3ba6144a2d35a4990f1a8d04632a052">x</a>, <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(coeff.size() - 2 - <a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>));</div>
<div class="line"><a id="l01008" name="l01008"></a><span class="lineno"> 1008</span>      result = result + <a class="code hl_variable" href="pointer_8h.html#a32aff7c6c4cd253fdf6563677afab5ce">value</a>;</div>
<div class="line"><a id="l01009" name="l01009"></a><span class="lineno"> 1009</span>    }</div>
<div class="line"><a id="l01010" name="l01010"></a><span class="lineno"> 1010</span>    <span class="keywordflow">return</span> result;</div>
<div class="line"><a id="l01011" name="l01011"></a><span class="lineno"> 1011</span>  }</div>
<div class="line"><a id="l01012" name="l01012"></a><span class="lineno"> 1012</span> </div>
<div class="line"><a id="l01013" name="l01013"></a><span class="lineno"><a class="line" href="classyield__plugin_1_1YieldPlugin.html#ae53a42abb996d38cf701a3fba7e473f8"> 1013</a></span>  <span class="keywordtype">double</span> <a class="code hl_function" href="classyield__plugin_1_1YieldPlugin.html#ae53a42abb996d38cf701a3fba7e473f8">YieldPlugin::max_trajectory_speed</a>(<span class="keyword">const</span> std::vector&lt;carma_planning_msgs::msg::TrajectoryPlanPoint&gt;&amp; trajectory_points, <span class="keywordtype">double</span> timestamp_in_sec_to_search_until)<span class="keyword"> const</span></div>
<div class="line"><a id="l01014" name="l01014"></a><span class="lineno"> 1014</span><span class="keyword">  </span>{</div>
<div class="line"><a id="l01015" name="l01015"></a><span class="lineno"> 1015</span>    <span class="keywordtype">double</span> max_speed = 0;</div>
<div class="line"><a id="l01016" name="l01016"></a><span class="lineno"> 1016</span>    <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> <a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a> = 0; <a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a> &lt; trajectory_points.size() - 2; <a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>++ )</div>
<div class="line"><a id="l01017" name="l01017"></a><span class="lineno"> 1017</span>    {</div>
<div class="line"><a id="l01018" name="l01018"></a><span class="lineno"> 1018</span>      <span class="keywordtype">double</span> dx = trajectory_points.at(<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a> + 1).x - trajectory_points.at(<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>).x;</div>
<div class="line"><a id="l01019" name="l01019"></a><span class="lineno"> 1019</span>      <span class="keywordtype">double</span> dy = trajectory_points.at(<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a> + 1).y - trajectory_points.at(<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>).y;</div>
<div class="line"><a id="l01020" name="l01020"></a><span class="lineno"> 1020</span>      <span class="keywordtype">double</span> d = sqrt(dx*dx + dy*dy);</div>
<div class="line"><a id="l01021" name="l01021"></a><span class="lineno"> 1021</span>      <span class="keywordtype">double</span> t = (rclcpp::Time(trajectory_points.at(<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a> + 1).target_time).seconds() - rclcpp::Time(trajectory_points.at(<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>).target_time).seconds());</div>
<div class="line"><a id="l01022" name="l01022"></a><span class="lineno"> 1022</span>      <span class="keywordtype">double</span> v = d/t;</div>
<div class="line"><a id="l01023" name="l01023"></a><span class="lineno"> 1023</span>      <span class="keywordflow">if</span>(v &gt; max_speed)</div>
<div class="line"><a id="l01024" name="l01024"></a><span class="lineno"> 1024</span>      {</div>
<div class="line"><a id="l01025" name="l01025"></a><span class="lineno"> 1025</span>        max_speed = v;</div>
<div class="line"><a id="l01026" name="l01026"></a><span class="lineno"> 1026</span>      }</div>
<div class="line"><a id="l01027" name="l01027"></a><span class="lineno"> 1027</span>      <span class="keywordflow">if</span> (rclcpp::Time(trajectory_points.at(<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a> + 1).target_time).seconds() &gt;= timestamp_in_sec_to_search_until)</div>
<div class="line"><a id="l01028" name="l01028"></a><span class="lineno"> 1028</span>      {</div>
<div class="line"><a id="l01029" name="l01029"></a><span class="lineno"> 1029</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01030" name="l01030"></a><span class="lineno"> 1030</span>      }</div>
<div class="line"><a id="l01031" name="l01031"></a><span class="lineno"> 1031</span> </div>
<div class="line"><a id="l01032" name="l01032"></a><span class="lineno"> 1032</span>    }</div>
<div class="line"><a id="l01033" name="l01033"></a><span class="lineno"> 1033</span>    <span class="keywordflow">return</span> max_speed;</div>
<div class="line"><a id="l01034" name="l01034"></a><span class="lineno"> 1034</span>  }</div>
<div class="line"><a id="l01035" name="l01035"></a><span class="lineno"> 1035</span> </div>
<div class="line"><a id="l01036" name="l01036"></a><span class="lineno"><a class="line" href="classyield__plugin_1_1YieldPlugin.html#a3703b49299aa6b61b3889a8e6799ac74"> 1036</a></span>  <span class="keywordtype">double</span> <a class="code hl_function" href="classyield__plugin_1_1YieldPlugin.html#a3703b49299aa6b61b3889a8e6799ac74">YieldPlugin::check_traj_for_digital_min_gap</a>(<span class="keyword">const</span> carma_planning_msgs::msg::TrajectoryPlan&amp; original_tp)<span class="keyword"> const</span></div>
<div class="line"><a id="l01037" name="l01037"></a><span class="lineno"> 1037</span><span class="keyword">  </span>{</div>
<div class="line"><a id="l01038" name="l01038"></a><span class="lineno"> 1038</span>    <span class="keywordtype">double</span> desired_gap = 0;</div>
<div class="line"><a id="l01039" name="l01039"></a><span class="lineno"> 1039</span> </div>
<div class="line"><a id="l01040" name="l01040"></a><span class="lineno"> 1040</span>    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a> = 0; <a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a> &lt; original_tp.trajectory_points.size(); <a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>++)</div>
<div class="line"><a id="l01041" name="l01041"></a><span class="lineno"> 1041</span>    {</div>
<div class="line"><a id="l01042" name="l01042"></a><span class="lineno"> 1042</span>      lanelet::BasicPoint2d veh_pos(original_tp.trajectory_points.at(<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>).x, original_tp.trajectory_points.at(<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>).y);</div>
<div class="line"><a id="l01043" name="l01043"></a><span class="lineno"> 1043</span>      <span class="keyword">auto</span> llts = <a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#aff229ed7bba2a76d0b1b99a83b9fdf88">wm_</a>-&gt;getLaneletsFromPoint(veh_pos, 1);</div>
<div class="line"><a id="l01044" name="l01044"></a><span class="lineno"> 1044</span>      <span class="keywordflow">if</span> (llts.empty())</div>
<div class="line"><a id="l01045" name="l01045"></a><span class="lineno"> 1045</span>      {</div>
<div class="line"><a id="l01046" name="l01046"></a><span class="lineno"> 1046</span>       RCLCPP_WARN_STREAM(<a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#aa2f96dc545c04733e8ba11a6f3a0c2c6">nh_</a>-&gt;get_logger(),<span class="stringliteral">&quot;Trajectory point: x= &quot;</span> &lt;&lt; original_tp.trajectory_points.at(<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>).x &lt;&lt; <span class="stringliteral">&quot;y=&quot;</span>&lt;&lt; original_tp.trajectory_points.at(<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>).y);</div>
<div class="line"><a id="l01047" name="l01047"></a><span class="lineno"> 1047</span> </div>
<div class="line"><a id="l01048" name="l01048"></a><span class="lineno"> 1048</span>        <span class="keywordflow">throw</span> std::invalid_argument(<span class="stringliteral">&quot;Trajectory Point is not on a valid lanelet.&quot;</span>);</div>
<div class="line"><a id="l01049" name="l01049"></a><span class="lineno"> 1049</span>      }</div>
<div class="line"><a id="l01050" name="l01050"></a><span class="lineno"> 1050</span>      <span class="keyword">auto</span> digital_min_gap = llts[0].regulatoryElementsAs&lt;lanelet::DigitalMinimumGap&gt;(); <span class="comment">//Returns a list of these elements)</span></div>
<div class="line"><a id="l01051" name="l01051"></a><span class="lineno"> 1051</span>      <span class="keywordflow">if</span> (!digital_min_gap.empty())</div>
<div class="line"><a id="l01052" name="l01052"></a><span class="lineno"> 1052</span>      {</div>
<div class="line"><a id="l01053" name="l01053"></a><span class="lineno"> 1053</span>        <span class="keywordtype">double</span> digital_gap = digital_min_gap[0]-&gt;getMinimumGap(); <span class="comment">// Provided gap is in meters</span></div>
<div class="line"><a id="l01054" name="l01054"></a><span class="lineno"> 1054</span>        RCLCPP_DEBUG_STREAM(<a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#aa2f96dc545c04733e8ba11a6f3a0c2c6">nh_</a>-&gt;get_logger(),<span class="stringliteral">&quot;Digital Gap found with value: &quot;</span> &lt;&lt; digital_gap);</div>
<div class="line"><a id="l01055" name="l01055"></a><span class="lineno"> 1055</span>        desired_gap = std::max(desired_gap, digital_gap);</div>
<div class="line"><a id="l01056" name="l01056"></a><span class="lineno"> 1056</span>      }</div>
<div class="line"><a id="l01057" name="l01057"></a><span class="lineno"> 1057</span>    }</div>
<div class="line"><a id="l01058" name="l01058"></a><span class="lineno"> 1058</span>    <span class="keywordflow">return</span> desired_gap;</div>
<div class="line"><a id="l01059" name="l01059"></a><span class="lineno"> 1059</span>  }</div>
<div class="line"><a id="l01060" name="l01060"></a><span class="lineno"> 1060</span> </div>
<div class="line"><a id="l01061" name="l01061"></a><span class="lineno"><a class="line" href="classyield__plugin_1_1YieldPlugin.html#aa4176fb6da1156062d1ff412016fe86e"> 1061</a></span>  <span class="keywordtype">void</span> <a class="code hl_function" href="classyield__plugin_1_1YieldPlugin.html#aa4176fb6da1156062d1ff412016fe86e">YieldPlugin::set_georeference_string</a>(<span class="keyword">const</span> std::string&amp; georeference)</div>
<div class="line"><a id="l01062" name="l01062"></a><span class="lineno"> 1062</span>  {</div>
<div class="line"><a id="l01063" name="l01063"></a><span class="lineno"> 1063</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#a0139ba3f27c4205d7820c5e8ed668042">georeference_</a> != georeference)</div>
<div class="line"><a id="l01064" name="l01064"></a><span class="lineno"> 1064</span>    {</div>
<div class="line"><a id="l01065" name="l01065"></a><span class="lineno"> 1065</span>      <a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#a0139ba3f27c4205d7820c5e8ed668042">georeference_</a> = georeference;</div>
<div class="line"><a id="l01066" name="l01066"></a><span class="lineno"> 1066</span>      <a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#a42d2a2d8a9f88afbedaa566ad57c8444">map_projector_</a> = std::make_shared&lt;lanelet::projection::LocalFrameProjector&gt;(georeference.c_str());  <span class="comment">// Build projector from proj string</span></div>
<div class="line"><a id="l01067" name="l01067"></a><span class="lineno"> 1067</span>    }</div>
<div class="line"><a id="l01068" name="l01068"></a><span class="lineno"> 1068</span>  }</div>
<div class="line"><a id="l01069" name="l01069"></a><span class="lineno"> 1069</span> </div>
<div class="line"><a id="l01070" name="l01070"></a><span class="lineno"><a class="line" href="classyield__plugin_1_1YieldPlugin.html#a8d1efa9eb3ded474b8ec28d1c63b1eef"> 1070</a></span>  <span class="keywordtype">void</span> <a class="code hl_function" href="classyield__plugin_1_1YieldPlugin.html#a8d1efa9eb3ded474b8ec28d1c63b1eef">YieldPlugin::set_external_objects</a>(<span class="keyword">const</span> std::vector&lt;carma_perception_msgs::msg::ExternalObject&gt;&amp; object_list)</div>
<div class="line"><a id="l01071" name="l01071"></a><span class="lineno"> 1071</span>  {</div>
<div class="line"><a id="l01072" name="l01072"></a><span class="lineno"> 1072</span>    <a class="code hl_variable" href="classyield__plugin_1_1YieldPlugin.html#ade1ae58ef6dfc4c31025162c8c150b0a">external_objects_</a> = object_list;</div>
<div class="line"><a id="l01073" name="l01073"></a><span class="lineno"> 1073</span>  }</div>
<div class="line"><a id="l01074" name="l01074"></a><span class="lineno"> 1074</span> </div>
<div class="line"><a id="l01075" name="l01075"></a><span class="lineno"> 1075</span>}  <span class="comment">// namespace yield_plugin</span></div>
<div class="ttc" id="abasic__autonomy_2include_2basic__autonomy_2smoothing_2filters_8hpp_html"><div class="ttname"><a href="basic__autonomy_2include_2basic__autonomy_2smoothing_2filters_8hpp.html">filters.hpp</a></div></div>
<div class="ttc" id="aclassyield__plugin_1_1YieldPlugin_html_a0139ba3f27c4205d7820c5e8ed668042"><div class="ttname"><a href="classyield__plugin_1_1YieldPlugin.html#a0139ba3f27c4205d7820c5e8ed668042">yield_plugin::YieldPlugin::georeference_</a></div><div class="ttdeci">std::string georeference_</div><div class="ttdef"><b>Definition:</b> <a href="yield__plugin_8hpp_source.html#l00339">yield_plugin.hpp:339</a></div></div>
<div class="ttc" id="aclassyield__plugin_1_1YieldPlugin_html_a03f092d19aab7369af56f9438938d454"><div class="ttname"><a href="classyield__plugin_1_1YieldPlugin.html#a03f092d19aab7369af56f9438938d454">yield_plugin::YieldPlugin::route_llt_ids_</a></div><div class="ttdeci">std::set&lt; lanelet::Id &gt; route_llt_ids_</div><div class="ttdef"><b>Definition:</b> <a href="yield__plugin_8hpp_source.html#l00316">yield_plugin.hpp:316</a></div></div>
<div class="ttc" id="aclassyield__plugin_1_1YieldPlugin_html_a0fd790e287683a2ef404e16a15e0ea29"><div class="ttname"><a href="classyield__plugin_1_1YieldPlugin.html#a0fd790e287683a2ef404e16a15e0ea29">yield_plugin::YieldPlugin::plan_trajectory_callback</a></div><div class="ttdeci">void plan_trajectory_callback(carma_planning_msgs::srv::PlanTrajectory::Request::SharedPtr req, carma_planning_msgs::srv::PlanTrajectory::Response::SharedPtr resp)</div><div class="ttdoc">Service callback for trajectory planning.</div><div class="ttdef"><b>Definition:</b> <a href="yield__plugin_8cpp_source.html#l00252">yield_plugin.cpp:252</a></div></div>
<div class="ttc" id="aclassyield__plugin_1_1YieldPlugin_html_a1bc011c9c2db48289bf40214d972cec4"><div class="ttname"><a href="classyield__plugin_1_1YieldPlugin.html#a1bc011c9c2db48289bf40214d972cec4">yield_plugin::YieldPlugin::get_relative_downtracks</a></div><div class="ttdeci">std::vector&lt; double &gt; get_relative_downtracks(const carma_planning_msgs::msg::TrajectoryPlan &amp;trajectory_plan) const</div><div class="ttdoc">calculates distance between trajectory points in a plan</div><div class="ttdef"><b>Definition:</b> <a href="yield__plugin_8cpp_source.html#l00976">yield_plugin.cpp:976</a></div></div>
<div class="ttc" id="aclassyield__plugin_1_1YieldPlugin_html_a25b4eec8b5e4648044a4b46570cb4199"><div class="ttname"><a href="classyield__plugin_1_1YieldPlugin.html#a25b4eec8b5e4648044a4b46570cb4199">yield_plugin::YieldPlugin::req_timestamp_</a></div><div class="ttdeci">double req_timestamp_</div><div class="ttdef"><b>Definition:</b> <a href="yield__plugin_8hpp_source.html#l00326">yield_plugin.hpp:326</a></div></div>
<div class="ttc" id="aclassyield__plugin_1_1YieldPlugin_html_a274208e09bc96aaef0ba731904aa57de"><div class="ttname"><a href="classyield__plugin_1_1YieldPlugin.html#a274208e09bc96aaef0ba731904aa57de">yield_plugin::YieldPlugin::lc_status_publisher_</a></div><div class="ttdeci">LaneChangeStatusCB lc_status_publisher_</div><div class="ttdef"><b>Definition:</b> <a href="yield__plugin_8hpp_source.html#l00314">yield_plugin.hpp:314</a></div></div>
<div class="ttc" id="aclassyield__plugin_1_1YieldPlugin_html_a2def22504a4972db1994e96033e76ee9"><div class="ttname"><a href="classyield__plugin_1_1YieldPlugin.html#a2def22504a4972db1994e96033e76ee9">yield_plugin::YieldPlugin::set_incoming_request_info</a></div><div class="ttdeci">void set_incoming_request_info(std::vector&lt; lanelet::BasicPoint2d &gt; req_trajectory, double req_speed, double req_planning_time, double req_timestamp)</div><div class="ttdoc">set values for member variables related to cooperative behavior</div><div class="ttdef"><b>Definition:</b> <a href="yield__plugin_8cpp_source.html#l00237">yield_plugin.cpp:237</a></div></div>
<div class="ttc" id="aclassyield__plugin_1_1YieldPlugin_html_a2e806b6f64d4490b88f8947d8a360491"><div class="ttname"><a href="classyield__plugin_1_1YieldPlugin.html#a2e806b6f64d4490b88f8947d8a360491">yield_plugin::YieldPlugin::req_trajectory_points_</a></div><div class="ttdeci">std::vector&lt; lanelet::BasicPoint2d &gt; req_trajectory_points_</div><div class="ttdef"><b>Definition:</b> <a href="yield__plugin_8hpp_source.html#l00324">yield_plugin.hpp:324</a></div></div>
<div class="ttc" id="aclassyield__plugin_1_1YieldPlugin_html_a3276c693a65319e769e63078284d3056"><div class="ttname"><a href="classyield__plugin_1_1YieldPlugin.html#a3276c693a65319e769e63078284d3056">yield_plugin::YieldPlugin::mobilityrequest_cb</a></div><div class="ttdeci">void mobilityrequest_cb(const carma_v2x_msgs::msg::MobilityRequest::UniquePtr msg)</div><div class="ttdoc">callback for mobility request</div><div class="ttdef"><b>Definition:</b> <a href="yield__plugin_8cpp_source.html#l00153">yield_plugin.cpp:153</a></div></div>
<div class="ttc" id="aclassyield__plugin_1_1YieldPlugin_html_a3703b49299aa6b61b3889a8e6799ac74"><div class="ttname"><a href="classyield__plugin_1_1YieldPlugin.html#a3703b49299aa6b61b3889a8e6799ac74">yield_plugin::YieldPlugin::check_traj_for_digital_min_gap</a></div><div class="ttdeci">double check_traj_for_digital_min_gap(const carma_planning_msgs::msg::TrajectoryPlan &amp;original_tp) const</div><div class="ttdoc">checks trajectory for minimum gap associated with it</div><div class="ttdef"><b>Definition:</b> <a href="yield__plugin_8cpp_source.html#l01036">yield_plugin.cpp:1036</a></div></div>
<div class="ttc" id="aclassyield__plugin_1_1YieldPlugin_html_a378558cb2b27d8337d980150543d447d"><div class="ttname"><a href="classyield__plugin_1_1YieldPlugin.html#a378558cb2b27d8337d980150543d447d">yield_plugin::YieldPlugin::get_predicted_velocity_at_time</a></div><div class="ttdeci">double get_predicted_velocity_at_time(const geometry_msgs::msg::Twist &amp;object_velocity_in_map_frame, const carma_planning_msgs::msg::TrajectoryPlan &amp;original_tp, double timestamp_in_sec_to_predict)</div><div class="ttdoc">Given the object velocity in map frame with x,y components, this function returns the projected veloc...</div><div class="ttdef"><b>Definition:</b> <a href="yield__plugin_8cpp_source.html#l00845">yield_plugin.cpp:845</a></div></div>
<div class="ttc" id="aclassyield__plugin_1_1YieldPlugin_html_a42d2a2d8a9f88afbedaa566ad57c8444"><div class="ttname"><a href="classyield__plugin_1_1YieldPlugin.html#a42d2a2d8a9f88afbedaa566ad57c8444">yield_plugin::YieldPlugin::map_projector_</a></div><div class="ttdeci">std::shared_ptr&lt; lanelet::projection::LocalFrameProjector &gt; map_projector_</div><div class="ttdef"><b>Definition:</b> <a href="yield__plugin_8hpp_source.html#l00340">yield_plugin.hpp:340</a></div></div>
<div class="ttc" id="aclassyield__plugin_1_1YieldPlugin_html_a5255e398082083d48e7b07054f82fad8"><div class="ttname"><a href="classyield__plugin_1_1YieldPlugin.html#a5255e398082083d48e7b07054f82fad8">yield_plugin::YieldPlugin::convert_eceftrajectory_to_mappoints</a></div><div class="ttdeci">std::vector&lt; lanelet::BasicPoint2d &gt; convert_eceftrajectory_to_mappoints(const carma_v2x_msgs::msg::Trajectory &amp;ecef_trajectory) const</div><div class="ttdoc">convert a carma trajectory from ecef frame to map frame ecef trajectory consists of the point and a s...</div><div class="ttdef"><b>Definition:</b> <a href="yield__plugin_8cpp_source.html#l00094">yield_plugin.cpp:94</a></div></div>
<div class="ttc" id="aclassyield__plugin_1_1YieldPlugin_html_a546149400d9d6371c5de50f229d6ecfc"><div class="ttname"><a href="classyield__plugin_1_1YieldPlugin.html#a546149400d9d6371c5de50f229d6ecfc">yield_plugin::YieldPlugin::get_earliest_collision_object_and_time</a></div><div class="ttdeci">std::optional&lt; std::pair&lt; carma_perception_msgs::msg::ExternalObject, double &gt; &gt; get_earliest_collision_object_and_time(const carma_planning_msgs::msg::TrajectoryPlan &amp;original_tp, const std::vector&lt; carma_perception_msgs::msg::ExternalObject &gt; &amp;external_objects)</div><div class="ttdoc">Return the earliest collision object and time of collision pair from the given trajectory and list of...</div><div class="ttdef"><b>Definition:</b> <a href="yield__plugin_8cpp_source.html#l00807">yield_plugin.cpp:807</a></div></div>
<div class="ttc" id="aclassyield__plugin_1_1YieldPlugin_html_a5644e9f63528efc0484b875c7debef01"><div class="ttname"><a href="classyield__plugin_1_1YieldPlugin.html#a5644e9f63528efc0484b875c7debef01">yield_plugin::YieldPlugin::get_collision_time</a></div><div class="ttdeci">std::optional&lt; rclcpp::Time &gt; get_collision_time(const carma_planning_msgs::msg::TrajectoryPlan &amp;original_tp, const carma_perception_msgs::msg::ExternalObject &amp;curr_obstacle, double original_tp_max_speed)</div><div class="ttdoc">Return collision time given two trajectories with one being external object with predicted steps.</div><div class="ttdef"><b>Definition:</b> <a href="yield__plugin_8cpp_source.html#l00723">yield_plugin.cpp:723</a></div></div>
<div class="ttc" id="aclassyield__plugin_1_1YieldPlugin_html_a7b2ee0cdcba01c2df0f1d9df679424f8"><div class="ttname"><a href="classyield__plugin_1_1YieldPlugin.html#a7b2ee0cdcba01c2df0f1d9df679424f8">yield_plugin::YieldPlugin::bsm_cb</a></div><div class="ttdeci">void bsm_cb(const carma_v2x_msgs::msg::BSM::UniquePtr msg)</div><div class="ttdoc">callback for bsm message</div><div class="ttdef"><b>Definition:</b> <a href="yield__plugin_8cpp_source.html#l00246">yield_plugin.cpp:246</a></div></div>
<div class="ttc" id="aclassyield__plugin_1_1YieldPlugin_html_a7de1720c3d602feb197f52f6ce25fa73"><div class="ttname"><a href="classyield__plugin_1_1YieldPlugin.html#a7de1720c3d602feb197f52f6ce25fa73">yield_plugin::YieldPlugin::ecef_traj_timestep_</a></div><div class="ttdeci">double ecef_traj_timestep_</div><div class="ttdef"><b>Definition:</b> <a href="yield__plugin_8hpp_source.html#l00332">yield_plugin.hpp:332</a></div></div>
<div class="ttc" id="aclassyield__plugin_1_1YieldPlugin_html_a82d36ef453849014abfe64e6ecac5e58"><div class="ttname"><a href="classyield__plugin_1_1YieldPlugin.html#a82d36ef453849014abfe64e6ecac5e58">yield_plugin::YieldPlugin::mobility_response_publisher_</a></div><div class="ttdeci">MobilityResponseCB mobility_response_publisher_</div><div class="ttdef"><b>Definition:</b> <a href="yield__plugin_8hpp_source.html#l00313">yield_plugin.hpp:313</a></div></div>
<div class="ttc" id="aclassyield__plugin_1_1YieldPlugin_html_a852c927a6a8d94bfdbeeffcf56ba6331"><div class="ttname"><a href="classyield__plugin_1_1YieldPlugin.html#a852c927a6a8d94bfdbeeffcf56ba6331">yield_plugin::YieldPlugin::bsmIDtoString</a></div><div class="ttdeci">std::string bsmIDtoString(carma_v2x_msgs::msg::BSMCoreData bsm_core)</div><div class="ttdef"><b>Definition:</b> <a href="yield__plugin_8hpp_source.html#l00342">yield_plugin.hpp:342</a></div></div>
<div class="ttc" id="aclassyield__plugin_1_1YieldPlugin_html_a8d1efa9eb3ded474b8ec28d1c63b1eef"><div class="ttname"><a href="classyield__plugin_1_1YieldPlugin.html#a8d1efa9eb3ded474b8ec28d1c63b1eef">yield_plugin::YieldPlugin::set_external_objects</a></div><div class="ttdeci">void set_external_objects(const std::vector&lt; carma_perception_msgs::msg::ExternalObject &gt; &amp;object_list)</div><div class="ttdoc">Setter for external objects with predictions in the environment.</div><div class="ttdef"><b>Definition:</b> <a href="yield__plugin_8cpp_source.html#l01070">yield_plugin.cpp:1070</a></div></div>
<div class="ttc" id="aclassyield__plugin_1_1YieldPlugin_html_a9277fa679e3465b090b5a8463690ed61"><div class="ttname"><a href="classyield__plugin_1_1YieldPlugin.html#a9277fa679e3465b090b5a8463690ed61">yield_plugin::YieldPlugin::YieldPlugin</a></div><div class="ttdeci">YieldPlugin(std::shared_ptr&lt; carma_ros2_utils::CarmaLifecycleNode &gt; nh, carma_wm::WorldModelConstPtr wm, YieldPluginConfig config, MobilityResponseCB mobility_response_publisher, LaneChangeStatusCB lc_status_publisher)</div><div class="ttdoc">Constructor.</div><div class="ttdef"><b>Definition:</b> <a href="yield__plugin_8cpp_source.html#l00045">yield_plugin.cpp:45</a></div></div>
<div class="ttc" id="aclassyield__plugin_1_1YieldPlugin_html_aa2f96dc545c04733e8ba11a6f3a0c2c6"><div class="ttname"><a href="classyield__plugin_1_1YieldPlugin.html#aa2f96dc545c04733e8ba11a6f3a0c2c6">yield_plugin::YieldPlugin::nh_</a></div><div class="ttdeci">std::shared_ptr&lt; carma_ros2_utils::CarmaLifecycleNode &gt; nh_</div><div class="ttdef"><b>Definition:</b> <a href="yield__plugin_8hpp_source.html#l00315">yield_plugin.hpp:315</a></div></div>
<div class="ttc" id="aclassyield__plugin_1_1YieldPlugin_html_aa4176fb6da1156062d1ff412016fe86e"><div class="ttname"><a href="classyield__plugin_1_1YieldPlugin.html#aa4176fb6da1156062d1ff412016fe86e">yield_plugin::YieldPlugin::set_georeference_string</a></div><div class="ttdeci">void set_georeference_string(const std::string &amp;georeference)</div><div class="ttdoc">Setter for map projection string to define lat/lon -&gt; map conversion.</div><div class="ttdef"><b>Definition:</b> <a href="yield__plugin_8cpp_source.html#l01061">yield_plugin.cpp:1061</a></div></div>
<div class="ttc" id="aclassyield__plugin_1_1YieldPlugin_html_aae4fab3792eaa78de9a88299c209246d"><div class="ttname"><a href="classyield__plugin_1_1YieldPlugin.html#aae4fab3792eaa78de9a88299c209246d">yield_plugin::YieldPlugin::get_collision_times_concurrently</a></div><div class="ttdeci">std::unordered_map&lt; uint32_t, rclcpp::Time &gt; get_collision_times_concurrently(const carma_planning_msgs::msg::TrajectoryPlan &amp;original_tp, const std::vector&lt; carma_perception_msgs::msg::ExternalObject &gt; &amp;external_objects, double original_tp_max_speed)</div><div class="ttdoc">Given the list of objects with predicted states, get all collision times concurrently using multi-thr...</div><div class="ttdef"><b>Definition:</b> <a href="yield__plugin_8cpp_source.html#l00783">yield_plugin.cpp:783</a></div></div>
<div class="ttc" id="aclassyield__plugin_1_1YieldPlugin_html_ab1f62a493a4229d4801841eb19fb1e7d"><div class="ttname"><a href="classyield__plugin_1_1YieldPlugin.html#ab1f62a493a4229d4801841eb19fb1e7d">yield_plugin::YieldPlugin::config_</a></div><div class="ttdeci">YieldPluginConfig config_</div><div class="ttdef"><b>Definition:</b> <a href="yield__plugin_8hpp_source.html#l00312">yield_plugin.hpp:312</a></div></div>
<div class="ttc" id="aclassyield__plugin_1_1YieldPlugin_html_ab60b2f939cebede3a6d9a3ae5529b0d9"><div class="ttname"><a href="classyield__plugin_1_1YieldPlugin.html#ab60b2f939cebede3a6d9a3ae5529b0d9">yield_plugin::YieldPlugin::get_collision</a></div><div class="ttdeci">std::optional&lt; GetCollisionResult &gt; get_collision(const carma_planning_msgs::msg::TrajectoryPlan &amp;trajectory1, const std::vector&lt; carma_perception_msgs::msg::PredictedState &gt; &amp;trajectory2, double collision_radius, double trajectory1_max_speed)</div><div class="ttdoc">Return naive collision time and locations based on collision radius given two trajectories with one b...</div><div class="ttdef"><b>Definition:</b> <a href="yield__plugin_8cpp_source.html#l00550">yield_plugin.cpp:550</a></div></div>
<div class="ttc" id="aclassyield__plugin_1_1YieldPlugin_html_abb40cf8a08a75c472791dbd91b99d8dc"><div class="ttname"><a href="classyield__plugin_1_1YieldPlugin.html#abb40cf8a08a75c472791dbd91b99d8dc">yield_plugin::YieldPlugin::detect_trajectories_intersection</a></div><div class="ttdeci">std::vector&lt; std::pair&lt; int, lanelet::BasicPoint2d &gt; &gt; detect_trajectories_intersection(std::vector&lt; lanelet::BasicPoint2d &gt; self_trajectory, std::vector&lt; lanelet::BasicPoint2d &gt; incoming_trajectory) const</div><div class="ttdoc">detect intersection point(s) of two trajectories</div><div class="ttdef"><b>Definition:</b> <a href="yield__plugin_8cpp_source.html#l00073">yield_plugin.cpp:73</a></div></div>
<div class="ttc" id="aclassyield__plugin_1_1YieldPlugin_html_ac0b6fb988e61ce2cfb04c4a1f33070d5"><div class="ttname"><a href="classyield__plugin_1_1YieldPlugin.html#ac0b6fb988e61ce2cfb04c4a1f33070d5">yield_plugin::YieldPlugin::ecef_to_map_point</a></div><div class="ttdeci">lanelet::BasicPoint2d ecef_to_map_point(const carma_v2x_msgs::msg::LocationECEF &amp;ecef_point) const</div><div class="ttdoc">convert a point in ecef frame (in cm) into map frame (in meters)</div><div class="ttdef"><b>Definition:</b> <a href="yield__plugin_8cpp_source.html#l00119">yield_plugin.cpp:119</a></div></div>
<div class="ttc" id="aclassyield__plugin_1_1YieldPlugin_html_ac1099523a4ea8b3ecc607cf466e42162"><div class="ttname"><a href="classyield__plugin_1_1YieldPlugin.html#ac1099523a4ea8b3ecc607cf466e42162">yield_plugin::YieldPlugin::req_target_speed_</a></div><div class="ttdeci">double req_target_speed_</div><div class="ttdef"><b>Definition:</b> <a href="yield__plugin_8hpp_source.html#l00325">yield_plugin.hpp:325</a></div></div>
<div class="ttc" id="aclassyield__plugin_1_1YieldPlugin_html_ac1c423b99887ccbf945a86da7b7809f6"><div class="ttname"><a href="classyield__plugin_1_1YieldPlugin.html#ac1c423b99887ccbf945a86da7b7809f6">yield_plugin::YieldPlugin::update_traj_for_object</a></div><div class="ttdeci">carma_planning_msgs::msg::TrajectoryPlan update_traj_for_object(const carma_planning_msgs::msg::TrajectoryPlan &amp;original_tp, const std::vector&lt; carma_perception_msgs::msg::ExternalObject &gt; &amp;external_objects, double initial_velocity)</div><div class="ttdoc">trajectory is modified to safely avoid obstacles on the road</div><div class="ttdef"><b>Definition:</b> <a href="yield__plugin_8cpp_source.html#l00888">yield_plugin.cpp:888</a></div></div>
<div class="ttc" id="aclassyield__plugin_1_1YieldPlugin_html_ace53f1895cbbf2a5f109cbfc11d6313f"><div class="ttname"><a href="classyield__plugin_1_1YieldPlugin.html#ace53f1895cbbf2a5f109cbfc11d6313f">yield_plugin::YieldPlugin::generate_JMT_trajectory</a></div><div class="ttdeci">carma_planning_msgs::msg::TrajectoryPlan generate_JMT_trajectory(const carma_planning_msgs::msg::TrajectoryPlan &amp;original_tp, double initial_pos, double goal_pos, double initial_velocity, double goal_velocity, double planning_time, double original_max_speed)</div><div class="ttdoc">generate a Jerk Minimizing Trajectory(JMT) with the provided start and end conditions</div><div class="ttdef"><b>Definition:</b> <a href="yield__plugin_8cpp_source.html#l00402">yield_plugin.cpp:402</a></div></div>
<div class="ttc" id="aclassyield__plugin_1_1YieldPlugin_html_acf45eb277044353dbb87226f0bec3f06"><div class="ttname"><a href="classyield__plugin_1_1YieldPlugin.html#acf45eb277044353dbb87226f0bec3f06">yield_plugin::YieldPlugin::compose_mobility_response</a></div><div class="ttdeci">carma_v2x_msgs::msg::MobilityResponse compose_mobility_response(const std::string &amp;resp_recipient_id, const std::string &amp;req_plan_id, bool response) const</div><div class="ttdoc">compose a mobility response message</div><div class="ttdef"><b>Definition:</b> <a href="yield__plugin_8cpp_source.html#l00133">yield_plugin.cpp:133</a></div></div>
<div class="ttc" id="aclassyield__plugin_1_1YieldPlugin_html_ad25df251a12c9c052daeab2f58385c7d"><div class="ttname"><a href="classyield__plugin_1_1YieldPlugin.html#ad25df251a12c9c052daeab2f58385c7d">yield_plugin::YieldPlugin::host_bsm_id_</a></div><div class="ttdeci">std::string host_bsm_id_</div><div class="ttdef"><b>Definition:</b> <a href="yield__plugin_8hpp_source.html#l00337">yield_plugin.hpp:337</a></div></div>
<div class="ttc" id="aclassyield__plugin_1_1YieldPlugin_html_ad620a98521987c31d004b5aabbf3a620"><div class="ttname"><a href="classyield__plugin_1_1YieldPlugin.html#ad620a98521987c31d004b5aabbf3a620">yield_plugin::YieldPlugin::req_target_plan_time_</a></div><div class="ttdeci">double req_target_plan_time_</div><div class="ttdef"><b>Definition:</b> <a href="yield__plugin_8hpp_source.html#l00327">yield_plugin.hpp:327</a></div></div>
<div class="ttc" id="aclassyield__plugin_1_1YieldPlugin_html_ad694d6ea9d5ca884e29f33a48fe19ae3"><div class="ttname"><a href="classyield__plugin_1_1YieldPlugin.html#ad694d6ea9d5ca884e29f33a48fe19ae3">yield_plugin::YieldPlugin::cooperative_request_acceptable_</a></div><div class="ttdeci">bool cooperative_request_acceptable_</div><div class="ttdef"><b>Definition:</b> <a href="yield__plugin_8hpp_source.html#l00321">yield_plugin.hpp:321</a></div></div>
<div class="ttc" id="aclassyield__plugin_1_1YieldPlugin_html_ad9c9e0e4278774a519de12a6a5f4398f"><div class="ttname"><a href="classyield__plugin_1_1YieldPlugin.html#ad9c9e0e4278774a519de12a6a5f4398f">yield_plugin::YieldPlugin::update_traj_for_cooperative_behavior</a></div><div class="ttdeci">carma_planning_msgs::msg::TrajectoryPlan update_traj_for_cooperative_behavior(const carma_planning_msgs::msg::TrajectoryPlan &amp;original_tp, double current_speed)</div><div class="ttdoc">update trajectory for yielding to an incoming cooperative behavior</div><div class="ttdef"><b>Definition:</b> <a href="yield__plugin_8cpp_source.html#l00317">yield_plugin.cpp:317</a></div></div>
<div class="ttc" id="aclassyield__plugin_1_1YieldPlugin_html_adc6d5d9e4116d9f6ca142e5bb2fd1bc8"><div class="ttname"><a href="classyield__plugin_1_1YieldPlugin.html#adc6d5d9e4116d9f6ca142e5bb2fd1bc8">yield_plugin::YieldPlugin::consecutive_clearance_count_for_obstacles_</a></div><div class="ttdeci">std::unordered_map&lt; uint32_t, int &gt; consecutive_clearance_count_for_obstacles_</div><div class="ttdef"><b>Definition:</b> <a href="yield__plugin_8hpp_source.html#l00319">yield_plugin.hpp:319</a></div></div>
<div class="ttc" id="aclassyield__plugin_1_1YieldPlugin_html_ade1ae58ef6dfc4c31025162c8c150b0a"><div class="ttname"><a href="classyield__plugin_1_1YieldPlugin.html#ade1ae58ef6dfc4c31025162c8c150b0a">yield_plugin::YieldPlugin::external_objects_</a></div><div class="ttdeci">std::vector&lt; carma_perception_msgs::msg::ExternalObject &gt; external_objects_</div><div class="ttdef"><b>Definition:</b> <a href="yield__plugin_8hpp_source.html#l00318">yield_plugin.hpp:318</a></div></div>
<div class="ttc" id="aclassyield__plugin_1_1YieldPlugin_html_ae1279ff6d53eb474b635f992ed854d0b"><div class="ttname"><a href="classyield__plugin_1_1YieldPlugin.html#ae1279ff6d53eb474b635f992ed854d0b">yield_plugin::YieldPlugin::is_object_behind_vehicle</a></div><div class="ttdeci">bool is_object_behind_vehicle(uint32_t object_id, const rclcpp::Time &amp;collision_time, double vehicle_point, double object_downtrack)</div><div class="ttdoc">Check if object location is behind the vehicle using estimates of the vehicle's length and route down...</div><div class="ttdef"><b>Definition:</b> <a href="yield__plugin_8cpp_source.html#l00697">yield_plugin.cpp:697</a></div></div>
<div class="ttc" id="aclassyield__plugin_1_1YieldPlugin_html_ae3f7420f5eccdb7f4b4ec59c7f69ec3f"><div class="ttname"><a href="classyield__plugin_1_1YieldPlugin.html#ae3f7420f5eccdb7f4b4ec59c7f69ec3f">yield_plugin::YieldPlugin::timesteps_since_last_req_</a></div><div class="ttdeci">int timesteps_since_last_req_</div><div class="ttdef"><b>Definition:</b> <a href="yield__plugin_8hpp_source.html#l00328">yield_plugin.hpp:328</a></div></div>
<div class="ttc" id="aclassyield__plugin_1_1YieldPlugin_html_ae53a42abb996d38cf701a3fba7e473f8"><div class="ttname"><a href="classyield__plugin_1_1YieldPlugin.html#ae53a42abb996d38cf701a3fba7e473f8">yield_plugin::YieldPlugin::max_trajectory_speed</a></div><div class="ttdeci">double max_trajectory_speed(const std::vector&lt; carma_planning_msgs::msg::TrajectoryPlanPoint &gt; &amp;trajectory_points, double timestamp_in_sec_to_search_until) const</div><div class="ttdoc">calculates the maximum speed in a set of tajectory points</div><div class="ttdef"><b>Definition:</b> <a href="yield__plugin_8cpp_source.html#l01013">yield_plugin.cpp:1013</a></div></div>
<div class="ttc" id="aclassyield__plugin_1_1YieldPlugin_html_ae79ca3ae3dcfb369611d20ffa4ef7660"><div class="ttname"><a href="classyield__plugin_1_1YieldPlugin.html#ae79ca3ae3dcfb369611d20ffa4ef7660">yield_plugin::YieldPlugin::clc_urgency_</a></div><div class="ttdeci">int clc_urgency_</div><div class="ttdef"><b>Definition:</b> <a href="yield__plugin_8hpp_source.html#l00329">yield_plugin.hpp:329</a></div></div>
<div class="ttc" id="aclassyield__plugin_1_1YieldPlugin_html_ae7ffd46ccbae6de4b60a7f49a8cfa3d6"><div class="ttname"><a href="classyield__plugin_1_1YieldPlugin.html#ae7ffd46ccbae6de4b60a7f49a8cfa3d6">yield_plugin::YieldPlugin::polynomial_calc</a></div><div class="ttdeci">double polynomial_calc(std::vector&lt; double &gt; coeff, double x) const</div><div class="ttdoc">calculate quintic polynomial equation for a given x</div><div class="ttdef"><b>Definition:</b> <a href="yield__plugin_8cpp_source.html#l00991">yield_plugin.cpp:991</a></div></div>
<div class="ttc" id="aclassyield__plugin_1_1YieldPlugin_html_afeab08ed138eafe6e24abd775c3163dd"><div class="ttname"><a href="classyield__plugin_1_1YieldPlugin.html#afeab08ed138eafe6e24abd775c3163dd">yield_plugin::YieldPlugin::polynomial_calc_d</a></div><div class="ttdeci">double polynomial_calc_d(std::vector&lt; double &gt; coeff, double x) const</div><div class="ttdoc">calculate derivative of quintic polynomial equation for a given x</div><div class="ttdef"><b>Definition:</b> <a href="yield__plugin_8cpp_source.html#l01002">yield_plugin.cpp:1002</a></div></div>
<div class="ttc" id="aclassyield__plugin_1_1YieldPlugin_html_aff229ed7bba2a76d0b1b99a83b9fdf88"><div class="ttname"><a href="classyield__plugin_1_1YieldPlugin.html#aff229ed7bba2a76d0b1b99a83b9fdf88">yield_plugin::YieldPlugin::wm_</a></div><div class="ttdeci">carma_wm::WorldModelConstPtr wm_</div><div class="ttdef"><b>Definition:</b> <a href="yield__plugin_8hpp_source.html#l00311">yield_plugin.hpp:311</a></div></div>
<div class="ttc" id="ainlanecruising__plugin_8cpp_html_a8212f1302ee6736745dc97bb5b3caaf5"><div class="ttname"><a href="inlanecruising__plugin_8cpp.html#a8212f1302ee6736745dc97bb5b3caaf5">oss</a></div><div class="ttdeci">std::ostringstream oss</div><div class="ttdef"><b>Definition:</b> <a href="inlanecruising__plugin_8cpp_source.html#l00036">inlanecruising_plugin.cpp:36</a></div></div>
<div class="ttc" id="anamespacebasic__autonomy_1_1smoothing_html_afb726e75a21ada8efa3ca5561ffc9984"><div class="ttname"><a href="namespacebasic__autonomy_1_1smoothing.html#afb726e75a21ada8efa3ca5561ffc9984">basic_autonomy::smoothing::moving_average_filter</a></div><div class="ttdeci">std::vector&lt; double &gt; moving_average_filter(const std::vector&lt; double &gt; input, int window_size, bool ignore_first_point=true)</div><div class="ttdoc">Extremely simplie moving average filter.</div><div class="ttdef"><b>Definition:</b> <a href="filters_8cpp_source.html#l00024">filters.cpp:24</a></div></div>
<div class="ttc" id="anamespacecarma__cooperative__perception_html_a64b708654c8aecb09122d39577df31b5"><div class="ttname"><a href="namespacecarma__cooperative__perception.html#a64b708654c8aecb09122d39577df31b5">carma_cooperative_perception::to_string</a></div><div class="ttdeci">auto to_string(const UtmZone &amp;zone) -&gt; std::string</div><div class="ttdef"><b>Definition:</b> <a href="utm__zone_8cpp_source.html#l00021">utm_zone.cpp:21</a></div></div>
<div class="ttc" id="anamespacecarma__wm_html_a3ac653959e0b6198cae274d68b343228"><div class="ttname"><a href="namespacecarma__wm.html#a3ac653959e0b6198cae274d68b343228">carma_wm::WorldModelConstPtr</a></div><div class="ttdeci">std::shared_ptr&lt; const WorldModel &gt; WorldModelConstPtr</div><div class="ttdef"><b>Definition:</b> <a href="WorldModel_8hpp_source.html#l00442">WorldModel.hpp:442</a></div></div>
<div class="ttc" id="anamespaceprocess__bag_html_ada7d8d458b66074ad9e74b476c299003"><div class="ttname"><a href="namespaceprocess__bag.html#ada7d8d458b66074ad9e74b476c299003">process_bag.first_point</a></div><div class="ttdeci">list first_point</div><div class="ttdef"><b>Definition:</b> <a href="process__bag_8py_source.html#l00052">process_bag.py:52</a></div></div>
<div class="ttc" id="anamespaceprocess__bag_html_af102a02c97622dd30b0dbf7bafb0d199"><div class="ttname"><a href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">process_bag.i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="process__bag_8py_source.html#l00059">process_bag.py:59</a></div></div>
<div class="ttc" id="anamespaceprocess__traj__logs_html_af3ba6144a2d35a4990f1a8d04632a052"><div class="ttname"><a href="namespaceprocess__traj__logs.html#af3ba6144a2d35a4990f1a8d04632a052">process_traj_logs.x</a></div><div class="ttdeci">x</div><div class="ttdef"><b>Definition:</b> <a href="process__traj__logs_8py_source.html#l00128">process_traj_logs.py:128</a></div></div>
<div class="ttc" id="anamespaceyield__plugin_html"><div class="ttname"><a href="namespaceyield__plugin.html">yield_plugin</a></div><div class="ttdef"><b>Definition:</b> <a href="yield__plugin_8hpp_source.html#l00049">yield_plugin.hpp:50</a></div></div>
<div class="ttc" id="anamespaceyield__plugin_html_a508edd284962f40938944f9304e66263"><div class="ttname"><a href="namespaceyield__plugin.html#a508edd284962f40938944f9304e66263">yield_plugin::LaneChangeStatusCB</a></div><div class="ttdeci">std::function&lt; void(const carma_planning_msgs::msg::LaneChangeStatus &amp;)&gt; LaneChangeStatusCB</div><div class="ttdef"><b>Definition:</b> <a href="yield__plugin_8hpp_source.html#l00052">yield_plugin.hpp:52</a></div></div>
<div class="ttc" id="anamespaceyield__plugin_html_a6685355374aa80334c267d788788cb2f"><div class="ttname"><a href="namespaceyield__plugin.html#a6685355374aa80334c267d788788cb2f">yield_plugin::get_smallest_time_step_of_traj</a></div><div class="ttdeci">double get_smallest_time_step_of_traj(const carma_planning_msgs::msg::TrajectoryPlan &amp;original_tp)</div><div class="ttdef"><b>Definition:</b> <a href="yield__plugin_8cpp_source.html#l00388">yield_plugin.cpp:388</a></div></div>
<div class="ttc" id="anamespaceyield__plugin_html_a754c9aebad547b09cdeff7080a639bd3"><div class="ttname"><a href="namespaceyield__plugin.html#a754c9aebad547b09cdeff7080a639bd3">yield_plugin::get_trajectory_start_time</a></div><div class="ttdeci">double get_trajectory_start_time(const carma_planning_msgs::msg::TrajectoryPlan &amp;trajectory)</div><div class="ttdef"><b>Definition:</b> <a href="yield__plugin_8cpp_source.html#l00058">yield_plugin.cpp:58</a></div></div>
<div class="ttc" id="anamespaceyield__plugin_html_a82b2a694528d42a4af068732befca882"><div class="ttname"><a href="namespaceyield__plugin.html#a82b2a694528d42a4af068732befca882">yield_plugin::get_trajectory_end_time</a></div><div class="ttdeci">double get_trajectory_end_time(const carma_planning_msgs::msg::TrajectoryPlan &amp;trajectory)</div><div class="ttdef"><b>Definition:</b> <a href="yield__plugin_8cpp_source.html#l00053">yield_plugin.cpp:53</a></div></div>
<div class="ttc" id="anamespaceyield__plugin_html_aa28c9381b8df2f7fdf3e7870bc5c2866"><div class="ttname"><a href="namespaceyield__plugin.html#aa28c9381b8df2f7fdf3e7870bc5c2866">yield_plugin::MobilityResponseCB</a></div><div class="ttdeci">std::function&lt; void(const carma_v2x_msgs::msg::MobilityResponse &amp;)&gt; MobilityResponseCB</div><div class="ttdef"><b>Definition:</b> <a href="yield__plugin_8hpp_source.html#l00051">yield_plugin.hpp:51</a></div></div>
<div class="ttc" id="anamespaceyield__plugin_html_ad78fa1e6a7a22eff6b76dd32700fc55f"><div class="ttname"><a href="namespaceyield__plugin.html#ad78fa1e6a7a22eff6b76dd32700fc55f">yield_plugin::get_trajectory_duration</a></div><div class="ttdeci">double get_trajectory_duration(const carma_planning_msgs::msg::TrajectoryPlan &amp;trajectory)</div><div class="ttdef"><b>Definition:</b> <a href="yield__plugin_8cpp_source.html#l00063">yield_plugin.cpp:63</a></div></div>
<div class="ttc" id="apointer_8h_html_a32aff7c6c4cd253fdf6563677afab5ce"><div class="ttname"><a href="pointer_8h.html#a32aff7c6c4cd253fdf6563677afab5ce">value</a></div><div class="ttdeci">const GenericPointer&lt; typename T::ValueType &gt; T2 value</div><div class="ttdef"><b>Definition:</b> <a href="pointer_8h_source.html#l01222">pointer.h:1222</a></div></div>
<div class="ttc" id="apointer_8h_html_aeeddce917cf130d62c370b8f216026dd"><div class="ttname"><a href="pointer_8h.html#aeeddce917cf130d62c370b8f216026dd">a</a></div><div class="ttdeci">const GenericPointer&lt; typename T::ValueType &gt; T2 T::AllocatorType &amp; a</div><div class="ttdef"><b>Definition:</b> <a href="pointer_8h_source.html#l01121">pointer.h:1121</a></div></div>
<div class="ttc" id="astdint_8h_html_a435d1572bf3f880d55459d9805097f62"><div class="ttname"><a href="stdint_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a></div><div class="ttdeci">unsigned int uint32_t</div><div class="ttdef"><b>Definition:</b> <a href="stdint_8h_source.html#l00126">stdint.h:126</a></div></div>
<div class="ttc" id="astructYieldPluginConfig_html"><div class="ttname"><a href="structYieldPluginConfig.html">YieldPluginConfig</a></div><div class="ttdoc">Stuct containing the algorithm configuration values for the YieldPluginConfig.</div><div class="ttdef"><b>Definition:</b> <a href="yield__config_8hpp_source.html#l00024">yield_config.hpp:25</a></div></div>
<div class="ttc" id="astructYieldPluginConfig_html_a03f93a3be83b27d1d4e80ef4d765c0b0"><div class="ttname"><a href="structYieldPluginConfig.html#a03f93a3be83b27d1d4e80ef4d765c0b0">YieldPluginConfig::always_accept_mobility_request</a></div><div class="ttdeci">bool always_accept_mobility_request</div><div class="ttdef"><b>Definition:</b> <a href="yield__config_8hpp_source.html#l00037">yield_config.hpp:37</a></div></div>
<div class="ttc" id="astructYieldPluginConfig_html_a17c3152e5b5091ad40df3a4ee8969b25"><div class="ttname"><a href="structYieldPluginConfig.html#a17c3152e5b5091ad40df3a4ee8969b25">YieldPluginConfig::max_stop_speed_in_ms</a></div><div class="ttdeci">double max_stop_speed_in_ms</div><div class="ttdef"><b>Definition:</b> <a href="yield__config_8hpp_source.html#l00035">yield_config.hpp:35</a></div></div>
<div class="ttc" id="astructYieldPluginConfig_html_a1e7bba4a59d1301d477e64ad1a403cee"><div class="ttname"><a href="structYieldPluginConfig.html#a1e7bba4a59d1301d477e64ad1a403cee">YieldPluginConfig::collision_check_radius_in_m</a></div><div class="ttdeci">double collision_check_radius_in_m</div><div class="ttdef"><b>Definition:</b> <a href="yield__config_8hpp_source.html#l00046">yield_config.hpp:46</a></div></div>
<div class="ttc" id="astructYieldPluginConfig_html_a31b1781ef97ad5d956fe8c51cc161d69"><div class="ttname"><a href="structYieldPluginConfig.html#a31b1781ef97ad5d956fe8c51cc161d69">YieldPluginConfig::enable_adjustable_gap</a></div><div class="ttdeci">bool enable_adjustable_gap</div><div class="ttdef"><b>Definition:</b> <a href="yield__config_8hpp_source.html#l00043">yield_config.hpp:43</a></div></div>
<div class="ttc" id="astructYieldPluginConfig_html_a60e81669e3f640da18139b681e4ae426"><div class="ttname"><a href="structYieldPluginConfig.html#a60e81669e3f640da18139b681e4ae426">YieldPluginConfig::vehicle_id</a></div><div class="ttdeci">std::string vehicle_id</div><div class="ttdef"><b>Definition:</b> <a href="yield__config_8hpp_source.html#l00038">yield_config.hpp:38</a></div></div>
<div class="ttc" id="astructYieldPluginConfig_html_a712ad260a3344fe9828d6022211743fe"><div class="ttname"><a href="structYieldPluginConfig.html#a712ad260a3344fe9828d6022211743fe">YieldPluginConfig::speed_moving_average_window_size</a></div><div class="ttdeci">double speed_moving_average_window_size</div><div class="ttdef"><b>Definition:</b> <a href="yield__config_8hpp_source.html#l00045">yield_config.hpp:45</a></div></div>
<div class="ttc" id="astructYieldPluginConfig_html_a7b0405c10307bac9613aba5a228de94e"><div class="ttname"><a href="structYieldPluginConfig.html#a7b0405c10307bac9613aba5a228de94e">YieldPluginConfig::vehicle_length</a></div><div class="ttdeci">double vehicle_length</div><div class="ttdef"><b>Definition:</b> <a href="yield__config_8hpp_source.html#l00032">yield_config.hpp:32</a></div></div>
<div class="ttc" id="astructYieldPluginConfig_html_a7d48460ee46f906c2e6b33dc46238f12"><div class="ttname"><a href="structYieldPluginConfig.html#a7d48460ee46f906c2e6b33dc46238f12">YieldPluginConfig::acceleration_adjustment_factor</a></div><div class="ttdeci">double acceleration_adjustment_factor</div><div class="ttdef"><b>Definition:</b> <a href="yield__config_8hpp_source.html#l00026">yield_config.hpp:26</a></div></div>
<div class="ttc" id="astructYieldPluginConfig_html_a7e5796ed6d92befd6c726b5a0b6ef4f8"><div class="ttname"><a href="structYieldPluginConfig.html#a7e5796ed6d92befd6c726b5a0b6ef4f8">YieldPluginConfig::consecutive_clearance_count_for_obstacles_threshold</a></div><div class="ttdeci">int consecutive_clearance_count_for_obstacles_threshold</div><div class="ttdef"><b>Definition:</b> <a href="yield__config_8hpp_source.html#l00041">yield_config.hpp:41</a></div></div>
<div class="ttc" id="astructYieldPluginConfig_html_a92f70f21fdd60cc19df76491b18c041e"><div class="ttname"><a href="structYieldPluginConfig.html#a92f70f21fdd60cc19df76491b18c041e">YieldPluginConfig::yield_max_deceleration_in_ms2</a></div><div class="ttdeci">double yield_max_deceleration_in_ms2</div><div class="ttdef"><b>Definition:</b> <a href="yield__config_8hpp_source.html#l00030">yield_config.hpp:30</a></div></div>
<div class="ttc" id="astructYieldPluginConfig_html_a9c609df9146f9f8dbbf4838decc6fb0b"><div class="ttname"><a href="structYieldPluginConfig.html#a9c609df9146f9f8dbbf4838decc6fb0b">YieldPluginConfig::intervehicle_collision_distance_in_m</a></div><div class="ttdeci">double intervehicle_collision_distance_in_m</div><div class="ttdef"><b>Definition:</b> <a href="yield__config_8hpp_source.html#l00040">yield_config.hpp:40</a></div></div>
<div class="ttc" id="astructYieldPluginConfig_html_ab38d52251f92d06ed380887824745784"><div class="ttname"><a href="structYieldPluginConfig.html#ab38d52251f92d06ed380887824745784">YieldPluginConfig::acceptable_urgency</a></div><div class="ttdeci">int acceptable_urgency</div><div class="ttdef"><b>Definition:</b> <a href="yield__config_8hpp_source.html#l00044">yield_config.hpp:44</a></div></div>
<div class="ttc" id="astructYieldPluginConfig_html_abe6d1c18b2a7f34566828c71eb4573ef"><div class="ttname"><a href="structYieldPluginConfig.html#abe6d1c18b2a7f34566828c71eb4573ef">YieldPluginConfig::obstacle_zero_speed_threshold_in_ms</a></div><div class="ttdeci">double obstacle_zero_speed_threshold_in_ms</div><div class="ttdef"><b>Definition:</b> <a href="yield__config_8hpp_source.html#l00028">yield_config.hpp:28</a></div></div>
<div class="ttc" id="astructYieldPluginConfig_html_ac9bcf3101e2e858035adbf089cfe57a9"><div class="ttname"><a href="structYieldPluginConfig.html#ac9bcf3101e2e858035adbf089cfe57a9">YieldPluginConfig::enable_cooperative_behavior</a></div><div class="ttdeci">bool enable_cooperative_behavior</div><div class="ttdef"><b>Definition:</b> <a href="yield__config_8hpp_source.html#l00036">yield_config.hpp:36</a></div></div>
<div class="ttc" id="astructYieldPluginConfig_html_accd4e108184fe5a470d4f8af1de1e7a2"><div class="ttname"><a href="structYieldPluginConfig.html#accd4e108184fe5a470d4f8af1de1e7a2">YieldPluginConfig::min_obj_avoidance_plan_time_in_s</a></div><div class="ttdeci">double min_obj_avoidance_plan_time_in_s</div><div class="ttdef"><b>Definition:</b> <a href="yield__config_8hpp_source.html#l00029">yield_config.hpp:29</a></div></div>
<div class="ttc" id="astructYieldPluginConfig_html_ada1059dd1218ecd9b513195b775aa633"><div class="ttname"><a href="structYieldPluginConfig.html#ada1059dd1218ecd9b513195b775aa633">YieldPluginConfig::minimum_safety_gap_in_meters</a></div><div class="ttdeci">double minimum_safety_gap_in_meters</div><div class="ttdef"><b>Definition:</b> <a href="yield__config_8hpp_source.html#l00031">yield_config.hpp:31</a></div></div>
<div class="ttc" id="astructYieldPluginConfig_html_af17f6b695b3a4372462f7c252ec4daa8"><div class="ttname"><a href="structYieldPluginConfig.html#af17f6b695b3a4372462f7c252ec4daa8">YieldPluginConfig::acceptable_passed_timesteps</a></div><div class="ttdeci">int acceptable_passed_timesteps</div><div class="ttdef"><b>Definition:</b> <a href="yield__config_8hpp_source.html#l00039">yield_config.hpp:39</a></div></div>
<div class="ttc" id="astructYieldPluginConfig_html_affc7ab1122ea90f3bd0b377f5ec4af49"><div class="ttname"><a href="structYieldPluginConfig.html#affc7ab1122ea90f3bd0b377f5ec4af49">YieldPluginConfig::safety_collision_time_gap_in_s</a></div><div class="ttdeci">double safety_collision_time_gap_in_s</div><div class="ttdef"><b>Definition:</b> <a href="yield__config_8hpp_source.html#l00042">yield_config.hpp:42</a></div></div>
<div class="ttc" id="astructyield__plugin_1_1GetCollisionResult_html"><div class="ttname"><a href="structyield__plugin_1_1GetCollisionResult.html">yield_plugin::GetCollisionResult</a></div><div class="ttdoc">Convenience class for saving collision results.</div><div class="ttdef"><b>Definition:</b> <a href="yield__plugin_8hpp_source.html#l00066">yield_plugin.hpp:67</a></div></div>
<div class="ttc" id="astructyield__plugin_1_1GetCollisionResult_html_a318dfe3459bea1d2dfa363af9b3a36a2"><div class="ttname"><a href="structyield__plugin_1_1GetCollisionResult.html#a318dfe3459bea1d2dfa363af9b3a36a2">yield_plugin::GetCollisionResult::point1</a></div><div class="ttdeci">lanelet::BasicPoint2d point1</div><div class="ttdef"><b>Definition:</b> <a href="yield__plugin_8hpp_source.html#l00069">yield_plugin.hpp:69</a></div></div>
<div class="ttc" id="astructyield__plugin_1_1GetCollisionResult_html_a5c30ed2c66023cf2ad745cf8139a0b1a"><div class="ttname"><a href="structyield__plugin_1_1GetCollisionResult.html#a5c30ed2c66023cf2ad745cf8139a0b1a">yield_plugin::GetCollisionResult::collision_time</a></div><div class="ttdeci">rclcpp::Time collision_time</div><div class="ttdef"><b>Definition:</b> <a href="yield__plugin_8hpp_source.html#l00068">yield_plugin.hpp:68</a></div></div>
<div class="ttc" id="astructyield__plugin_1_1GetCollisionResult_html_a693c36abfe23c410546f66098bed5685"><div class="ttname"><a href="structyield__plugin_1_1GetCollisionResult.html#a693c36abfe23c410546f66098bed5685">yield_plugin::GetCollisionResult::point2</a></div><div class="ttdeci">lanelet::BasicPoint2d point2</div><div class="ttdef"><b>Definition:</b> <a href="yield__plugin_8hpp_source.html#l00070">yield_plugin.hpp:70</a></div></div>
<div class="ttc" id="ayield__plugin_8cpp_html_a6f9399eaf2efb1b12e797b77909df9ac"><div class="ttname"><a href="yield__plugin_8cpp.html#a6f9399eaf2efb1b12e797b77909df9ac">EPSILON</a></div><div class="ttdeci">constexpr auto EPSILON</div><div class="ttdef"><b>Definition:</b> <a href="yield__plugin_8cpp_source.html#l00041">yield_plugin.cpp:41</a></div></div>
<div class="ttc" id="ayield__plugin_8hpp_html"><div class="ttname"><a href="yield__plugin_8hpp.html">yield_plugin.hpp</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_f2ecdaa25f4bea09ca4e467995c3c717.html">yield_plugin</a></li><li class="navelem"><a class="el" href="dir_ef78ea2effe39bb05d8493b9c77dd603.html">src</a></li><li class="navelem"><a class="el" href="yield__plugin_8cpp.html">yield_plugin.cpp</a></li>
    <li class="footer">Generated on Mon Jun 17 2024 15:08:24 for Carma-platform by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.4 </li>
  </ul>
</div>
</body>
</html>
