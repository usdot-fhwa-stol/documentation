<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Carma-streets: traffic_signal_controller_service::monitor_desired_phase_plan Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Carma-streets<span id="projectnumber">&#160;v4.2.0</span>
   </div>
   <div id="projectbrief">CARMA Streets is a component of CARMA ecosystem that improves the efficiency and performance of the Transportation Systems Management and Operations (TSMO) strategies.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('classtraffic__signal__controller__service_1_1monitor__desired__phase__plan.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a> &#124;
<a href="classtraffic__signal__controller__service_1_1monitor__desired__phase__plan-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">traffic_signal_controller_service::monitor_desired_phase_plan Class Reference</div></div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;<a class="el" href="monitor__desired__phase__plan_8h_source.html">monitor_desired_phase_plan.h</a>&gt;</code></p>
<div class="dynheader">
Collaboration diagram for traffic_signal_controller_service::monitor_desired_phase_plan:</div>
<div class="dyncontent">
<div class="center"><img src="classtraffic__signal__controller__service_1_1monitor__desired__phase__plan__coll__graph.png" border="0" usemap="#atraffic__signal__controller__service_1_1monitor__desired__phase__plan_coll__map" alt="Collaboration graph"/></div>
<map name="atraffic__signal__controller__service_1_1monitor__desired__phase__plan_coll__map" id="atraffic__signal__controller__service_1_1monitor__desired__phase__plan_coll__map">
<area shape="rect" title=" " alt="" coords="92,189,267,443"/>
<area shape="rect" title=" " alt="" coords="5,5,164,127"/>
<area shape="rect" title=" " alt="" coords="188,13,360,119"/>
</map>
</div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a69a95828a2a76bc2dd1e3724bcced2c7"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtraffic__signal__controller__service_1_1monitor__desired__phase__plan.html#a69a95828a2a76bc2dd1e3724bcced2c7">monitor_desired_phase_plan</a> (const std::shared_ptr&lt; <a class="el" href="classtraffic__signal__controller__service_1_1snmp__client.html">snmp_client</a> &gt; client)</td></tr>
<tr class="memdesc:a69a95828a2a76bc2dd1e3724bcced2c7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Construct a new monitor desired phase plan object..  <a href="classtraffic__signal__controller__service_1_1monitor__desired__phase__plan.html#a69a95828a2a76bc2dd1e3724bcced2c7">More...</a><br /></td></tr>
<tr class="separator:a69a95828a2a76bc2dd1e3724bcced2c7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a40e202a6b65b458586fb922d6d3a23b8"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtraffic__signal__controller__service_1_1monitor__desired__phase__plan.html#a40e202a6b65b458586fb922d6d3a23b8">~monitor_desired_phase_plan</a> ()=default</td></tr>
<tr class="memdesc:a40e202a6b65b458586fb922d6d3a23b8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Destroy the monitor desired phase plan object.  <a href="classtraffic__signal__controller__service_1_1monitor__desired__phase__plan.html#a40e202a6b65b458586fb922d6d3a23b8">More...</a><br /></td></tr>
<tr class="separator:a40e202a6b65b458586fb922d6d3a23b8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3913b45075d330fede938e222e0167f1"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtraffic__signal__controller__service_1_1monitor__desired__phase__plan.html#a3913b45075d330fede938e222e0167f1">update_desired_phase_plan</a> (const std::string &amp;payload)</td></tr>
<tr class="memdesc:a3913b45075d330fede938e222e0167f1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Update desired_phase_plan object with json received string message.  <a href="classtraffic__signal__controller__service_1_1monitor__desired__phase__plan.html#a3913b45075d330fede938e222e0167f1">More...</a><br /></td></tr>
<tr class="separator:a3913b45075d330fede938e222e0167f1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a29a37f4f2b68922a93e9a05928f28217"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtraffic__signal__controller__service_1_1monitor__desired__phase__plan.html#a29a37f4f2b68922a93e9a05928f28217">update_spat_future_movement_events</a> (std::shared_ptr&lt; <a class="el" href="classsignal__phase__and__timing_1_1spat.html">signal_phase_and_timing::spat</a> &gt; spat_ptr, const std::shared_ptr&lt; <a class="el" href="classtraffic__signal__controller__service_1_1tsc__state.html">tsc_state</a> &gt; tsc_state_ptr) const</td></tr>
<tr class="memdesc:a29a37f4f2b68922a93e9a05928f28217"><td class="mdescLeft">&#160;</td><td class="mdescRight">Update spat movement_event list with desired phase plan information.  <a href="classtraffic__signal__controller__service_1_1monitor__desired__phase__plan.html#a29a37f4f2b68922a93e9a05928f28217">More...</a><br /></td></tr>
<tr class="separator:a29a37f4f2b68922a93e9a05928f28217"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a721ca0f9d497b129efd36e7819952096"><td class="memItemLeft" align="right" valign="top">std::shared_ptr&lt; <a class="el" href="structstreets__desired__phase__plan_1_1streets__desired__phase__plan.html">streets_desired_phase_plan::streets_desired_phase_plan</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtraffic__signal__controller__service_1_1monitor__desired__phase__plan.html#a721ca0f9d497b129efd36e7819952096">get_desired_phase_plan_ptr</a> () const</td></tr>
<tr class="memdesc:a721ca0f9d497b129efd36e7819952096"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns shared pointer to desired_phase_plan object.  <a href="classtraffic__signal__controller__service_1_1monitor__desired__phase__plan.html#a721ca0f9d497b129efd36e7819952096">More...</a><br /></td></tr>
<tr class="separator:a721ca0f9d497b129efd36e7819952096"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa1a159a46faa26e7fa81b6f0e5ea3fcc"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtraffic__signal__controller__service_1_1monitor__desired__phase__plan.html#aa1a159a46faa26e7fa81b6f0e5ea3fcc">fix_upcoming_green</a> (const std::shared_ptr&lt; <a class="el" href="classsignal__phase__and__timing_1_1spat.html">signal_phase_and_timing::spat</a> &gt; spat_ptr, const std::shared_ptr&lt; <a class="el" href="classtraffic__signal__controller__service_1_1tsc__state.html">tsc_state</a> &gt; tsc_state_ptr) const</td></tr>
<tr class="memdesc:aa1a159a46faa26e7fa81b6f0e5ea3fcc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Method to represent the upcoming green, when no desired phase plan is present and the TSC is currently in YELLOW CHANGE or RED CLEARANCE. This is indicated by the SPaT not containing any movement states with GREEN/PROTECTED MOVEMENT ALLOWED as the current state. Using the SNMP Client to make a GET request to the PHASE_STATUS_GROUP_PHASE_NEXT OID (see <a class="el" href="ntcip__oids_8h.html">ntcip_oids.h</a> PHASE_STATUS_GROUP_PHASE_NEXT documentation for more information) we will determine which phases are next and project GREEN, YELLOW and RED events onto the SPaT for this next GREEN using phase configuration information (min green, yellow change, and red clearance) to set timing data. THe projected GREEN phase will be fixed to last the minimum GREEN duration.  <a href="classtraffic__signal__controller__service_1_1monitor__desired__phase__plan.html#aa1a159a46faa26e7fa81b6f0e5ea3fcc">More...</a><br /></td></tr>
<tr class="separator:aa1a159a46faa26e7fa81b6f0e5ea3fcc"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pri-attribs" name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr class="memitem:ae6b65664bfddcfb561e83b33cc6bec27"><td class="memItemLeft" align="right" valign="top">std::shared_ptr&lt; <a class="el" href="structstreets__desired__phase__plan_1_1streets__desired__phase__plan.html">streets_desired_phase_plan::streets_desired_phase_plan</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtraffic__signal__controller__service_1_1monitor__desired__phase__plan.html#ae6b65664bfddcfb561e83b33cc6bec27">desired_phase_plan_ptr</a></td></tr>
<tr class="separator:ae6b65664bfddcfb561e83b33cc6bec27"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af39b5d16b681d8a0a473874bde88da7d"><td class="memItemLeft" align="right" valign="top">std::shared_ptr&lt; <a class="el" href="classtraffic__signal__controller__service_1_1snmp__client.html">snmp_client</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtraffic__signal__controller__service_1_1monitor__desired__phase__plan.html#af39b5d16b681d8a0a473874bde88da7d">_snmp_client</a></td></tr>
<tr class="separator:af39b5d16b681d8a0a473874bde88da7d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock">
<p class="definition">Definition at line <a class="el" href="monitor__desired__phase__plan_8h_source.html#l00012">12</a> of file <a class="el" href="monitor__desired__phase__plan_8h_source.html">monitor_desired_phase_plan.h</a>.</p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a69a95828a2a76bc2dd1e3724bcced2c7" name="a69a95828a2a76bc2dd1e3724bcced2c7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a69a95828a2a76bc2dd1e3724bcced2c7">&#9670;&nbsp;</a></span>monitor_desired_phase_plan()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">traffic_signal_controller_service::monitor_desired_phase_plan::monitor_desired_phase_plan </td>
          <td>(</td>
          <td class="paramtype">const std::shared_ptr&lt; <a class="el" href="classtraffic__signal__controller__service_1_1snmp__client.html">snmp_client</a> &gt;&#160;</td>
          <td class="paramname"><em>client</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">explicit</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Construct a new monitor desired phase plan object.. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">client</td><td>shared pointer to an initialized SNMP client for NTCIP next phase group requests. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="monitor__desired__phase__plan_8cpp_source.html#l00005">5</a> of file <a class="el" href="monitor__desired__phase__plan_8cpp_source.html">monitor_desired_phase_plan.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">    5</span>                                                                                                  :  <a class="code hl_variable" href="classtraffic__signal__controller__service_1_1monitor__desired__phase__plan.html#af39b5d16b681d8a0a473874bde88da7d">_snmp_client</a>(client) {</div>
<div class="line"><span class="lineno">    6</span> </div>
<div class="line"><span class="lineno">    7</span>    }</div>
<div class="ttc" id="aclasstraffic__signal__controller__service_1_1monitor__desired__phase__plan_html_af39b5d16b681d8a0a473874bde88da7d"><div class="ttname"><a href="classtraffic__signal__controller__service_1_1monitor__desired__phase__plan.html#af39b5d16b681d8a0a473874bde88da7d">traffic_signal_controller_service::monitor_desired_phase_plan::_snmp_client</a></div><div class="ttdeci">std::shared_ptr&lt; snmp_client &gt; _snmp_client</div><div class="ttdef"><b>Definition:</b> <a href="monitor__desired__phase__plan_8h_source.html#l00017">monitor_desired_phase_plan.h:17</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a40e202a6b65b458586fb922d6d3a23b8" name="a40e202a6b65b458586fb922d6d3a23b8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a40e202a6b65b458586fb922d6d3a23b8">&#9670;&nbsp;</a></span>~monitor_desired_phase_plan()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">traffic_signal_controller_service::monitor_desired_phase_plan::~monitor_desired_phase_plan </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">default</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Destroy the monitor desired phase plan object. </p>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="aa1a159a46faa26e7fa81b6f0e5ea3fcc" name="aa1a159a46faa26e7fa81b6f0e5ea3fcc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa1a159a46faa26e7fa81b6f0e5ea3fcc">&#9670;&nbsp;</a></span>fix_upcoming_green()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void traffic_signal_controller_service::monitor_desired_phase_plan::fix_upcoming_green </td>
          <td>(</td>
          <td class="paramtype">const std::shared_ptr&lt; <a class="el" href="classsignal__phase__and__timing_1_1spat.html">signal_phase_and_timing::spat</a> &gt;&#160;</td>
          <td class="paramname"><em>spat_ptr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::shared_ptr&lt; <a class="el" href="classtraffic__signal__controller__service_1_1tsc__state.html">tsc_state</a> &gt;&#160;</td>
          <td class="paramname"><em>tsc_state_ptr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Method to represent the upcoming green, when no desired phase plan is present and the TSC is currently in YELLOW CHANGE or RED CLEARANCE. This is indicated by the SPaT not containing any movement states with GREEN/PROTECTED MOVEMENT ALLOWED as the current state. Using the SNMP Client to make a GET request to the PHASE_STATUS_GROUP_PHASE_NEXT OID (see <a class="el" href="ntcip__oids_8h.html">ntcip_oids.h</a> PHASE_STATUS_GROUP_PHASE_NEXT documentation for more information) we will determine which phases are next and project GREEN, YELLOW and RED events onto the SPaT for this next GREEN using phase configuration information (min green, yellow change, and red clearance) to set timing data. THe projected GREEN phase will be fixed to last the minimum GREEN duration. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">spat_ptr</td><td>shared pointer to the current spat information. </td></tr>
    <tr><td class="paramname">tsc_state_ptr</td><td>shared pointer to the tsc state information including tsc phase configuration information. </td></tr>
  </table>
  </dd>
</dl>
<p >Response value is 8 bit int in which each bit is interpreted individually as 1 or 0. 1 indicates that the vehicle phase for that bit is committed to be next. 0 indicates this phase is not committed to be next.</p>
<p >bit 0 represent vehicle phase 1 bit 1 represent vehicle phase 2 bit 2 represent vehicle phase 3 bit 3 represent vehicle phase 4 bit 4 represent vehicle phase 5 bit 5 represent vehicle phase 6 bit 6 represent vehicle phase 7 bit 7 represent vehicle phase 8</p>

<p class="definition">Definition at line <a class="el" href="monitor__desired__phase__plan_8cpp_source.html#l00050">50</a> of file <a class="el" href="monitor__desired__phase__plan_8cpp_source.html">monitor_desired_phase_plan.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   51</span>                                                            {</div>
<div class="line"><span class="lineno">   52</span>        <span class="comment">// Find start time of next green</span></div>
<div class="line"><span class="lineno">   53</span>        <span class="keywordtype">bool</span> is_yellow_change = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">   54</span>        <span class="comment">// Start time for fixed up coming green</span></div>
<div class="line"><span class="lineno">   55</span>        uint64_t start_time_epoch_ms = 0;</div>
<div class="line"><span class="lineno">   56</span>        <span class="comment">// Current time used for any calculations</span></div>
<div class="line"><span class="lineno">   57</span>        uint64_t cur_time_since_epoch = std::chrono::duration_cast&lt;std::chrono::milliseconds&gt;(std::chrono::system_clock::now().time_since_epoch()).count();</div>
<div class="line"><span class="lineno">   58</span>        <span class="keyword">auto</span> state = spat_ptr-&gt;get_intersection();</div>
<div class="line"><span class="lineno">   59</span> </div>
<div class="line"><span class="lineno">   60</span>        <span class="comment">// Check if current spat includes yellow clearance</span></div>
<div class="line"><span class="lineno">   61</span>        <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;movement : state.states) {</div>
<div class="line"><span class="lineno">   62</span>            <span class="comment">// Found yellow states</span></div>
<div class="line"><span class="lineno">   63</span>            <span class="keywordflow">if</span> ( movement.state_time_speed.front().event_state == <a class="code hl_enumvalue" href="namespacesignal__phase__and__timing.html#a89bd5b280352669f719b2c36a9dc2a14a909f43d0494b87359c21298b5310e4fc">signal_phase_and_timing::movement_phase_state::protected_clearance</a> ) {</div>
<div class="line"><span class="lineno">   64</span>                is_yellow_change = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">   65</span>                <span class="keyword">auto</span> yellow_phase_configuration =tsc_state-&gt;get_signal_group_state_map().find(movement.signal_group)-&gt;second;</div>
<div class="line"><span class="lineno">   66</span>                <span class="comment">// Start time of upcoming green will be end of yellow + red clearance </span></div>
<div class="line"><span class="lineno">   67</span>                uint64_t local_start_time_epoch = movement.state_time_speed.front().timing.get_epoch_min_end_time() + yellow_phase_configuration.red_clearance;</div>
<div class="line"><span class="lineno">   68</span>                <span class="keywordflow">if</span> ( local_start_time_epoch &gt; start_time_epoch_ms) {</div>
<div class="line"><span class="lineno">   69</span>                    <span class="comment">// If there are multiple movement groups in yellow, start time will be the largest end of yellow + red clearance time</span></div>
<div class="line"><span class="lineno">   70</span>                    start_time_epoch_ms = local_start_time_epoch;</div>
<div class="line"><span class="lineno">   71</span>                }</div>
<div class="line"><span class="lineno">   72</span>            }</div>
<div class="line"><span class="lineno">   73</span>        }</div>
<div class="line"><span class="lineno">   74</span>        <span class="comment">// If it does not include a green and does not include a yellow assume it is in all red clearance </span></div>
<div class="line"><span class="lineno">   75</span>        <span class="keywordflow">if</span> ( !is_yellow_change ) {</div>
<div class="line"><span class="lineno">   76</span>            <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;movement : state.states) {</div>
<div class="line"><span class="lineno">   77</span>                <span class="comment">// Found red states</span></div>
<div class="line"><span class="lineno">   78</span>                <span class="keywordflow">if</span> ( movement.state_time_speed.front().event_state == <a class="code hl_enumvalue" href="namespacesignal__phase__and__timing.html#a89bd5b280352669f719b2c36a9dc2a14a03e3f63efcce21f01897bc0583979afa">signal_phase_and_timing::movement_phase_state::stop_and_remain</a> ) {</div>
<div class="line"><span class="lineno">   79</span>                    <span class="keyword">auto</span> red_phase_configuration =tsc_state-&gt;get_signal_group_state_map().find(movement.signal_group)-&gt;second;</div>
<div class="line"><span class="lineno">   80</span>                    uint64_t local_start_time_epoch = movement.state_time_speed.front().timing.get_epoch_min_end_time();</div>
<div class="line"><span class="lineno">   81</span>                    <span class="comment">// If red phase end - current time is less than or equal to red clearance then this phase is currently in red clearance</span></div>
<div class="line"><span class="lineno">   82</span>                    <span class="comment">// and will get green next.</span></div>
<div class="line"><span class="lineno">   83</span>                    <span class="keywordflow">if</span> ( local_start_time_epoch - cur_time_since_epoch &lt;= (uint) (red_phase_configuration.red_clearance) ) {</div>
<div class="line"><span class="lineno">   84</span>                        start_time_epoch_ms = local_start_time_epoch;</div>
<div class="line"><span class="lineno">   85</span>                    }</div>
<div class="line"><span class="lineno">   86</span> </div>
<div class="line"><span class="lineno">   87</span>                }</div>
<div class="line"><span class="lineno">   88</span>            }</div>
<div class="line"><span class="lineno">   89</span>        }</div>
<div class="line"><span class="lineno">   90</span>        <span class="comment">// Once start time is determine. We must determine next phase.</span></div>
<div class="line"><span class="lineno">   91</span>        snmp_response_obj response;</div>
<div class="line"><span class="lineno">   92</span>        response.type = <a class="code hl_enumvalue" href="structtraffic__signal__controller__service_1_1snmp__response__obj.html#a7379a4a3fcabddd7000d9be76111c38aa5d5cd46919fa987731fb2edefe0f2a0c">snmp_response_obj::response_type::INTEGER</a>;</div>
<div class="line"><span class="lineno">   93</span>        <a class="code hl_variable" href="classtraffic__signal__controller__service_1_1monitor__desired__phase__plan.html#af39b5d16b681d8a0a473874bde88da7d">_snmp_client</a>-&gt;process_snmp_request(<a class="code hl_variable" href="namespacentcip__oids.html#a84cca9aac94935e04813e700bbd36e2f">ntcip_oids::PHASE_STATUS_GROUP_PHASE_NEXT</a>,<a class="code hl_enumvalue" href="namespacetraffic__signal__controller__service.html#aa91e53dd22b41ddac648a9b468615b61a7528035a93ee69cedb1dbddb2f0bfcc8">traffic_signal_controller_service::request_type::GET</a>, response );</div>
<div class="line"><span class="lineno">   94</span>        </div>
<div class="line"><span class="lineno">   95</span>        <span class="comment">// Generate Desired Phase Plan with next green fixed.</span></div>
<div class="line"><span class="lineno">   96</span>        <a class="code hl_struct" href="structstreets__desired__phase__plan_1_1streets__desired__phase__plan.html">streets_desired_phase_plan::streets_desired_phase_plan</a> one_fixed_green;</div>
<div class="line"><span class="lineno">   97</span>        one_fixed_green.<a class="code hl_variable" href="structstreets__desired__phase__plan_1_1streets__desired__phase__plan.html#a6ab5f8258479b528ce1b9b2a4815fb04">timestamp</a> = cur_time_since_epoch;</div>
<div class="line"><span class="lineno">   98</span>        <a class="code hl_struct" href="structstreets__desired__phase__plan_1_1signal__group2green__phase__timing.html">streets_desired_phase_plan::signal_group2green_phase_timing</a> fixed_green;</div>
<div class="line"><span class="lineno">   99</span>        fixed_green.<a class="code hl_variable" href="structstreets__desired__phase__plan_1_1signal__group2green__phase__timing.html#a349aa0bbaad1a332ea8b7dc1ee9470da">start_time</a> = start_time_epoch_ms;</div>
<div class="line"><span class="lineno">  100</span>        </div>
<div class="line"><span class="lineno">  116</span>        <span class="keywordflow">for</span> (uint <a class="code hl_variable" href="namespacesimulate__bsm.html#a29b8e2f01a805057636de5ad54422c21">i</a> = 0; <a class="code hl_variable" href="namespacesimulate__bsm.html#a29b8e2f01a805057636de5ad54422c21">i</a> &lt; 8; ++<a class="code hl_variable" href="namespacesimulate__bsm.html#a29b8e2f01a805057636de5ad54422c21">i</a>) {</div>
<div class="line"><span class="lineno">  117</span>            <span class="keywordflow">if</span> (((response.val_int &gt;&gt; <a class="code hl_variable" href="namespacesimulate__bsm.html#a29b8e2f01a805057636de5ad54422c21">i</a>) &amp; 1) == 1) {</div>
<div class="line"><span class="lineno">  118</span>                <span class="comment">// Add any signal group for phase that has bit as 1</span></div>
<div class="line"><span class="lineno">  119</span>                <span class="keyword">auto</span> signal_group_id = tsc_state-&gt;get_vehicle_signal_group_id(<a class="code hl_variable" href="namespacesimulate__bsm.html#a29b8e2f01a805057636de5ad54422c21">i</a>+1);</div>
<div class="line"><span class="lineno">  120</span>                fixed_green.<a class="code hl_variable" href="structstreets__desired__phase__plan_1_1signal__group2green__phase__timing.html#a6987d5d817d188e2928481c0a0c2b1b0">signal_groups</a>.push_back(signal_group_id);</div>
<div class="line"><span class="lineno">  121</span>            }</div>
<div class="line"><span class="lineno">  122</span>        }</div>
<div class="line"><span class="lineno">  123</span>        <span class="keywordflow">if</span> ( fixed_green.<a class="code hl_variable" href="structstreets__desired__phase__plan_1_1signal__group2green__phase__timing.html#a6987d5d817d188e2928481c0a0c2b1b0">signal_groups</a>.size() &gt; 2 ) {</div>
<div class="line"><span class="lineno">  124</span>            <span class="keywordflow">throw</span> monitor_desired_phase_plan_exception( <span class="stringliteral">&quot;More than two phases were found to be next!&quot;</span>);</div>
<div class="line"><span class="lineno">  125</span>        }</div>
<div class="line"><span class="lineno">  126</span>        <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( fixed_green.<a class="code hl_variable" href="structstreets__desired__phase__plan_1_1signal__group2green__phase__timing.html#a6987d5d817d188e2928481c0a0c2b1b0">signal_groups</a>.size() &lt; 1) {</div>
<div class="line"><span class="lineno">  127</span>            <span class="keywordflow">throw</span> monitor_desired_phase_plan_exception(<span class="stringliteral">&quot;No signal groups were found to be next&quot;</span>);</div>
<div class="line"><span class="lineno">  128</span>        }</div>
<div class="line"><span class="lineno">  129</span>        <span class="comment">// Calculating the end of the fixed green by using min green configuration</span></div>
<div class="line"><span class="lineno">  130</span>        <span class="comment">// for all signal groups included in the movement group that is assigned the </span></div>
<div class="line"><span class="lineno">  131</span>        <span class="comment">// next green.</span></div>
<div class="line"><span class="lineno">  132</span>        uint64_t fixed_green_end_time_epoch_ms = 0;</div>
<div class="line"><span class="lineno">  133</span>        <span class="keywordflow">for</span> ( <span class="keyword">const</span> <span class="keyword">auto</span> &amp;s_g_id : fixed_green.<a class="code hl_variable" href="structstreets__desired__phase__plan_1_1signal__group2green__phase__timing.html#a6987d5d817d188e2928481c0a0c2b1b0">signal_groups</a> ) {</div>
<div class="line"><span class="lineno">  134</span>            <span class="keyword">auto</span> sig_group_config = tsc_state-&gt;get_signal_group_state_map().find(s_g_id)-&gt;second;</div>
<div class="line"><span class="lineno">  135</span>            uint64_t local_end_time_epoch_ms = fixed_green.<a class="code hl_variable" href="structstreets__desired__phase__plan_1_1signal__group2green__phase__timing.html#a349aa0bbaad1a332ea8b7dc1ee9470da">start_time</a> + sig_group_config.min_green;</div>
<div class="line"><span class="lineno">  136</span>            <span class="keywordflow">if</span> ( local_end_time_epoch_ms &gt; fixed_green_end_time_epoch_ms ) {</div>
<div class="line"><span class="lineno">  137</span>                <span class="comment">// find max of green start + min green to assign end time</span></div>
<div class="line"><span class="lineno">  138</span>                fixed_green_end_time_epoch_ms = local_end_time_epoch_ms;</div>
<div class="line"><span class="lineno">  139</span>            }</div>
<div class="line"><span class="lineno">  140</span>        }</div>
<div class="line"><span class="lineno">  141</span>        fixed_green.<a class="code hl_variable" href="structstreets__desired__phase__plan_1_1signal__group2green__phase__timing.html#afeaff7b517806a61775cfc161d21cf1c">end_time</a> = fixed_green_end_time_epoch_ms;</div>
<div class="line"><span class="lineno">  142</span>        one_fixed_green.<a class="code hl_variable" href="structstreets__desired__phase__plan_1_1streets__desired__phase__plan.html#a03eca534118891c3c183eed332b33810">desired_phase_plan</a>.push_back(fixed_green);</div>
<div class="line"><span class="lineno">  143</span>        SPDLOG_DEBUG(<span class="stringliteral">&quot;Updating SPaT with DPP : \n{0}&quot;</span>, one_fixed_green.<a class="code hl_function" href="structstreets__desired__phase__plan_1_1streets__desired__phase__plan.html#ae2a335d599173d37b8a12abe26948c01">toJson</a>());</div>
<div class="line"><span class="lineno">  144</span>        spat_ptr-&gt;update_spat_with_candidate_dpp(one_fixed_green, tsc_state-&gt;get_tsc_config_state());</div>
<div class="line"><span class="lineno">  145</span> </div>
<div class="line"><span class="lineno">  146</span>    }</div>
<div class="ttc" id="anamespacentcip__oids_html_a84cca9aac94935e04813e700bbd36e2f"><div class="ttname"><a href="namespacentcip__oids.html#a84cca9aac94935e04813e700bbd36e2f">ntcip_oids::PHASE_STATUS_GROUP_PHASE_NEXT</a></div><div class="ttdeci">static const std::string PHASE_STATUS_GROUP_PHASE_NEXT</div><div class="ttdoc">Phase Status Group Phase Next object is used to determine whether any vehicle phases are committed by...</div><div class="ttdef"><b>Definition:</b> <a href="ntcip__oids_8h_source.html#l00105">ntcip_oids.h:105</a></div></div>
<div class="ttc" id="anamespacesignal__phase__and__timing_html_a89bd5b280352669f719b2c36a9dc2a14a03e3f63efcce21f01897bc0583979afa"><div class="ttname"><a href="namespacesignal__phase__and__timing.html#a89bd5b280352669f719b2c36a9dc2a14a03e3f63efcce21f01897bc0583979afa">signal_phase_and_timing::movement_phase_state::stop_and_remain</a></div><div class="ttdeci">@ stop_and_remain</div><div class="ttdoc">e.g. called 'red light' in US. Driver Action: Stop vehicle at stop line. Do not proceed....</div></div>
<div class="ttc" id="anamespacesignal__phase__and__timing_html_a89bd5b280352669f719b2c36a9dc2a14a909f43d0494b87359c21298b5310e4fc"><div class="ttname"><a href="namespacesignal__phase__and__timing.html#a89bd5b280352669f719b2c36a9dc2a14a909f43d0494b87359c21298b5310e4fc">signal_phase_and_timing::movement_phase_state::protected_clearance</a></div><div class="ttdeci">@ protected_clearance</div><div class="ttdoc">Often called 'protected yellow' in US Driver Action: Prepare to stop. Proceed if unable,...</div></div>
<div class="ttc" id="anamespacesimulate__bsm_html_a29b8e2f01a805057636de5ad54422c21"><div class="ttname"><a href="namespacesimulate__bsm.html#a29b8e2f01a805057636de5ad54422c21">simulate_bsm.i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="simulate__bsm_8py_source.html#l00019">simulate_bsm.py:19</a></div></div>
<div class="ttc" id="anamespacetraffic__signal__controller__service_html_aa91e53dd22b41ddac648a9b468615b61a7528035a93ee69cedb1dbddb2f0bfcc8"><div class="ttname"><a href="namespacetraffic__signal__controller__service.html#aa91e53dd22b41ddac648a9b468615b61a7528035a93ee69cedb1dbddb2f0bfcc8">traffic_signal_controller_service::request_type::GET</a></div><div class="ttdeci">@ GET</div></div>
<div class="ttc" id="astructstreets__desired__phase__plan_1_1signal__group2green__phase__timing_html"><div class="ttname"><a href="structstreets__desired__phase__plan_1_1signal__group2green__phase__timing.html">streets_desired_phase_plan::signal_group2green_phase_timing</a></div><div class="ttdoc">Start and end time for traffic signal green phase state assigned to a set of signal groups....</div><div class="ttdef"><b>Definition:</b> <a href="streets__desired__phase__plan_8h_source.html#l00017">streets_desired_phase_plan.h:18</a></div></div>
<div class="ttc" id="astructstreets__desired__phase__plan_1_1signal__group2green__phase__timing_html_a349aa0bbaad1a332ea8b7dc1ee9470da"><div class="ttname"><a href="structstreets__desired__phase__plan_1_1signal__group2green__phase__timing.html#a349aa0bbaad1a332ea8b7dc1ee9470da">streets_desired_phase_plan::signal_group2green_phase_timing::start_time</a></div><div class="ttdeci">uint64_t start_time</div><div class="ttdef"><b>Definition:</b> <a href="streets__desired__phase__plan_8h_source.html#l00019">streets_desired_phase_plan.h:19</a></div></div>
<div class="ttc" id="astructstreets__desired__phase__plan_1_1signal__group2green__phase__timing_html_a6987d5d817d188e2928481c0a0c2b1b0"><div class="ttname"><a href="structstreets__desired__phase__plan_1_1signal__group2green__phase__timing.html#a6987d5d817d188e2928481c0a0c2b1b0">streets_desired_phase_plan::signal_group2green_phase_timing::signal_groups</a></div><div class="ttdeci">std::vector&lt; int &gt; signal_groups</div><div class="ttdef"><b>Definition:</b> <a href="streets__desired__phase__plan_8h_source.html#l00021">streets_desired_phase_plan.h:21</a></div></div>
<div class="ttc" id="astructstreets__desired__phase__plan_1_1signal__group2green__phase__timing_html_afeaff7b517806a61775cfc161d21cf1c"><div class="ttname"><a href="structstreets__desired__phase__plan_1_1signal__group2green__phase__timing.html#afeaff7b517806a61775cfc161d21cf1c">streets_desired_phase_plan::signal_group2green_phase_timing::end_time</a></div><div class="ttdeci">uint64_t end_time</div><div class="ttdef"><b>Definition:</b> <a href="streets__desired__phase__plan_8h_source.html#l00020">streets_desired_phase_plan.h:20</a></div></div>
<div class="ttc" id="astructstreets__desired__phase__plan_1_1streets__desired__phase__plan_html"><div class="ttname"><a href="structstreets__desired__phase__plan_1_1streets__desired__phase__plan.html">streets_desired_phase_plan::streets_desired_phase_plan</a></div><div class="ttdef"><b>Definition:</b> <a href="streets__desired__phase__plan_8h_source.html#l00029">streets_desired_phase_plan.h:30</a></div></div>
<div class="ttc" id="astructstreets__desired__phase__plan_1_1streets__desired__phase__plan_html_a03eca534118891c3c183eed332b33810"><div class="ttname"><a href="structstreets__desired__phase__plan_1_1streets__desired__phase__plan.html#a03eca534118891c3c183eed332b33810">streets_desired_phase_plan::streets_desired_phase_plan::desired_phase_plan</a></div><div class="ttdeci">std::vector&lt; signal_group2green_phase_timing &gt; desired_phase_plan</div><div class="ttdoc">Descriptive name for this collection.</div><div class="ttdef"><b>Definition:</b> <a href="streets__desired__phase__plan_8h_source.html#l00038">streets_desired_phase_plan.h:38</a></div></div>
<div class="ttc" id="astructstreets__desired__phase__plan_1_1streets__desired__phase__plan_html_a6ab5f8258479b528ce1b9b2a4815fb04"><div class="ttname"><a href="structstreets__desired__phase__plan_1_1streets__desired__phase__plan.html#a6ab5f8258479b528ce1b9b2a4815fb04">streets_desired_phase_plan::streets_desired_phase_plan::timestamp</a></div><div class="ttdeci">uint64_t timestamp</div><div class="ttdoc">Unix timestamp when this desired phase plan is generated.</div><div class="ttdef"><b>Definition:</b> <a href="streets__desired__phase__plan_8h_source.html#l00034">streets_desired_phase_plan.h:34</a></div></div>
<div class="ttc" id="astructstreets__desired__phase__plan_1_1streets__desired__phase__plan_html_ae2a335d599173d37b8a12abe26948c01"><div class="ttname"><a href="structstreets__desired__phase__plan_1_1streets__desired__phase__plan.html#ae2a335d599173d37b8a12abe26948c01">streets_desired_phase_plan::streets_desired_phase_plan::toJson</a></div><div class="ttdeci">std::string toJson() const</div><div class="ttdoc">Serialize Desired phase plan object to rapidjson::Value for writing as JSON string.</div><div class="ttdef"><b>Definition:</b> <a href="streets__desired__phase__plan_8cpp_source.html#l00006">streets_desired_phase_plan.cpp:6</a></div></div>
<div class="ttc" id="astructtraffic__signal__controller__service_1_1snmp__response__obj_html_a7379a4a3fcabddd7000d9be76111c38aa5d5cd46919fa987731fb2edefe0f2a0c"><div class="ttname"><a href="structtraffic__signal__controller__service_1_1snmp__response__obj.html#a7379a4a3fcabddd7000d9be76111c38aa5d5cd46919fa987731fb2edefe0f2a0c">traffic_signal_controller_service::snmp_response_obj::response_type::INTEGER</a></div><div class="ttdeci">@ INTEGER</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="monitor__desired__phase__plan_8h_source.html#l00017">_snmp_client</a>, <a class="el" href="streets__desired__phase__plan_8h_source.html#l00038">streets_desired_phase_plan::streets_desired_phase_plan::desired_phase_plan</a>, <a class="el" href="streets__desired__phase__plan_8h_source.html#l00020">streets_desired_phase_plan::signal_group2green_phase_timing::end_time</a>, <a class="el" href="namespacetraffic__signal__controller__service.html#aa91e53dd22b41ddac648a9b468615b61a7528035a93ee69cedb1dbddb2f0bfcc8">traffic_signal_controller_service::GET</a>, <a class="el" href="monitor__tsc__state_8cpp_source.html#l00551">traffic_signal_controller_service::tsc_state::get_signal_group_state_map()</a>, <a class="el" href="monitor__tsc__state_8cpp_source.html#l00111">traffic_signal_controller_service::tsc_state::get_tsc_config_state()</a>, <a class="el" href="monitor__tsc__state_8cpp_source.html#l00420">traffic_signal_controller_service::tsc_state::get_vehicle_signal_group_id()</a>, <a class="el" href="simulate__bsm_8py_source.html#l00019">simulate_bsm::i</a>, <a class="el" href="structtraffic__signal__controller__service_1_1snmp__response__obj.html#a7379a4a3fcabddd7000d9be76111c38aa5d5cd46919fa987731fb2edefe0f2a0c">traffic_signal_controller_service::snmp_response_obj::INTEGER</a>, <a class="el" href="ntcip__oids_8h_source.html#l00105">ntcip_oids::PHASE_STATUS_GROUP_PHASE_NEXT</a>, <a class="el" href="namespacesignal__phase__and__timing.html#a89bd5b280352669f719b2c36a9dc2a14a909f43d0494b87359c21298b5310e4fc">signal_phase_and_timing::protected_clearance</a>, <a class="el" href="streets__desired__phase__plan_8h_source.html#l00021">streets_desired_phase_plan::signal_group2green_phase_timing::signal_groups</a>, <a class="el" href="streets__desired__phase__plan_8h_source.html#l00019">streets_desired_phase_plan::signal_group2green_phase_timing::start_time</a>, <a class="el" href="namespacesignal__phase__and__timing.html#a89bd5b280352669f719b2c36a9dc2a14a03e3f63efcce21f01897bc0583979afa">signal_phase_and_timing::stop_and_remain</a>, <a class="el" href="streets__desired__phase__plan_8h_source.html#l00034">streets_desired_phase_plan::streets_desired_phase_plan::timestamp</a>, <a class="el" href="streets__desired__phase__plan_8cpp_source.html#l00006">streets_desired_phase_plan::streets_desired_phase_plan::toJson()</a>, <a class="el" href="snmp__client_8h_source.html#l00039">traffic_signal_controller_service::snmp_response_obj::type</a>, and <a class="el" href="snmp__client_8h_source.html#l00037">traffic_signal_controller_service::snmp_response_obj::val_int</a>.</p>

<p class="reference">Referenced by <a class="el" href="monitor__desired__phase__plan_8cpp_source.html#l00019">update_spat_future_movement_events()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classtraffic__signal__controller__service_1_1monitor__desired__phase__plan_aa1a159a46faa26e7fa81b6f0e5ea3fcc_cgraph.png" border="0" usemap="#aclasstraffic__signal__controller__service_1_1monitor__desired__phase__plan_aa1a159a46faa26e7fa81b6f0e5ea3fcc_cgraph" alt=""/></div>
<map name="aclasstraffic__signal__controller__service_1_1monitor__desired__phase__plan_aa1a159a46faa26e7fa81b6f0e5ea3fcc_cgraph" id="aclasstraffic__signal__controller__service_1_1monitor__desired__phase__plan_aa1a159a46faa26e7fa81b6f0e5ea3fcc_cgraph">
<area shape="rect" title="Method to represent the upcoming green, when no desired phase plan is present and the TSC is currentl..." alt="" coords="5,125,220,181"/>
<area shape="rect" href="classtraffic__signal__controller__service_1_1tsc__state.html#a27876c0c6172cbb37788cadd97bf6ff3" title="Return reference to signal group state map." alt="" coords="268,5,439,61"/>
<area shape="rect" href="classtraffic__signal__controller__service_1_1tsc__state.html#a05b2aa1aff298e094fd02d59b067e4e7" title="Returns a pointer to the tsc_config_state." alt="" coords="276,85,431,141"/>
<area shape="rect" href="classtraffic__signal__controller__service_1_1tsc__state.html#a42882c2c84b9decb8ab4d89485a5321f" title="Get the signal group id using phase number.Only for vehicle phases." alt="" coords="270,165,437,221"/>
<area shape="rect" href="structstreets__desired__phase__plan_1_1streets__desired__phase__plan.html#ae2a335d599173d37b8a12abe26948c01" title="Serialize Desired phase plan object to rapidjson::Value for writing as JSON string." alt="" coords="277,245,430,301"/>
<area shape="rect" href="ntcip__1202__ext_8h.html#a576de7b60eacee3f1a70393a005502cd" title="Returns std::string representation of ntcip_1202_ext message including phase_times array." alt="" coords="487,180,559,207"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classtraffic__signal__controller__service_1_1monitor__desired__phase__plan_aa1a159a46faa26e7fa81b6f0e5ea3fcc_icgraph.png" border="0" usemap="#aclasstraffic__signal__controller__service_1_1monitor__desired__phase__plan_aa1a159a46faa26e7fa81b6f0e5ea3fcc_icgraph" alt=""/></div>
<map name="aclasstraffic__signal__controller__service_1_1monitor__desired__phase__plan_aa1a159a46faa26e7fa81b6f0e5ea3fcc_icgraph" id="aclasstraffic__signal__controller__service_1_1monitor__desired__phase__plan_aa1a159a46faa26e7fa81b6f0e5ea3fcc_icgraph">
<area shape="rect" title="Method to represent the upcoming green, when no desired phase plan is present and the TSC is currentl..." alt="" coords="229,13,444,69"/>
<area shape="rect" href="classtraffic__signal__controller__service_1_1monitor__desired__phase__plan.html#a29a37f4f2b68922a93e9a05928f28217" title="Update spat movement_event list with desired phase plan information." alt="" coords="5,5,181,76"/>
</map>
</div>

</div>
</div>
<a id="a721ca0f9d497b129efd36e7819952096" name="a721ca0f9d497b129efd36e7819952096"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a721ca0f9d497b129efd36e7819952096">&#9670;&nbsp;</a></span>get_desired_phase_plan_ptr()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::shared_ptr&lt; <a class="el" href="structstreets__desired__phase__plan_1_1streets__desired__phase__plan.html">streets_desired_phase_plan::streets_desired_phase_plan</a> &gt; traffic_signal_controller_service::monitor_desired_phase_plan::get_desired_phase_plan_ptr </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Returns shared pointer to desired_phase_plan object. </p>
<dl class="section return"><dt>Returns</dt><dd>std::shared_ptr&lt;streets_desired_phase_plan::streets_desired_phase_plan&gt; </dd></dl>

<p class="definition">Definition at line <a class="el" href="monitor__desired__phase__plan_8cpp_source.html#l00014">14</a> of file <a class="el" href="monitor__desired__phase__plan_8cpp_source.html">monitor_desired_phase_plan.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   15</span>    {</div>
<div class="line"><span class="lineno">   16</span>        <span class="keywordflow">return</span> <a class="code hl_variable" href="classtraffic__signal__controller__service_1_1monitor__desired__phase__plan.html#ae6b65664bfddcfb561e83b33cc6bec27">desired_phase_plan_ptr</a>;</div>
<div class="line"><span class="lineno">   17</span>    }</div>
<div class="ttc" id="aclasstraffic__signal__controller__service_1_1monitor__desired__phase__plan_html_ae6b65664bfddcfb561e83b33cc6bec27"><div class="ttname"><a href="classtraffic__signal__controller__service_1_1monitor__desired__phase__plan.html#ae6b65664bfddcfb561e83b33cc6bec27">traffic_signal_controller_service::monitor_desired_phase_plan::desired_phase_plan_ptr</a></div><div class="ttdeci">std::shared_ptr&lt; streets_desired_phase_plan::streets_desired_phase_plan &gt; desired_phase_plan_ptr</div><div class="ttdef"><b>Definition:</b> <a href="monitor__desired__phase__plan_8h_source.html#l00015">monitor_desired_phase_plan.h:15</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="monitor__desired__phase__plan_8h_source.html#l00015">desired_phase_plan_ptr</a>.</p>

</div>
</div>
<a id="a3913b45075d330fede938e222e0167f1" name="a3913b45075d330fede938e222e0167f1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3913b45075d330fede938e222e0167f1">&#9670;&nbsp;</a></span>update_desired_phase_plan()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void traffic_signal_controller_service::monitor_desired_phase_plan::update_desired_phase_plan </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>payload</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Update desired_phase_plan object with json received string message. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">payload</td><td></td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="monitor__desired__phase__plan_8cpp_source.html#l00008">8</a> of file <a class="el" href="monitor__desired__phase__plan_8cpp_source.html">monitor_desired_phase_plan.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">    9</span>    {</div>
<div class="line"><span class="lineno">   10</span>        <a class="code hl_variable" href="classtraffic__signal__controller__service_1_1monitor__desired__phase__plan.html#ae6b65664bfddcfb561e83b33cc6bec27">desired_phase_plan_ptr</a> = std::make_shared&lt;streets_desired_phase_plan::streets_desired_phase_plan&gt;();</div>
<div class="line"><span class="lineno">   11</span>        <a class="code hl_variable" href="classtraffic__signal__controller__service_1_1monitor__desired__phase__plan.html#ae6b65664bfddcfb561e83b33cc6bec27">desired_phase_plan_ptr</a>-&gt;fromJson(payload);</div>
<div class="line"><span class="lineno">   12</span>    }</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="monitor__desired__phase__plan_8h_source.html#l00015">desired_phase_plan_ptr</a>.</p>

</div>
</div>
<a id="a29a37f4f2b68922a93e9a05928f28217" name="a29a37f4f2b68922a93e9a05928f28217"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a29a37f4f2b68922a93e9a05928f28217">&#9670;&nbsp;</a></span>update_spat_future_movement_events()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void traffic_signal_controller_service::monitor_desired_phase_plan::update_spat_future_movement_events </td>
          <td>(</td>
          <td class="paramtype">std::shared_ptr&lt; <a class="el" href="classsignal__phase__and__timing_1_1spat.html">signal_phase_and_timing::spat</a> &gt;&#160;</td>
          <td class="paramname"><em>spat_ptr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::shared_ptr&lt; <a class="el" href="classtraffic__signal__controller__service_1_1tsc__state.html">tsc_state</a> &gt;&#160;</td>
          <td class="paramname"><em>tsc_state_ptr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Update spat movement_event list with desired phase plan information. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">spat_ptr</td><td>shared pointer to spat object. </td></tr>
    <tr><td class="paramname">tsc_state_ptr</td><td>shared pointer to <a class="el" href="classtraffic__signal__controller__service_1_1tsc__state.html">tsc_state</a> object. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="monitor__desired__phase__plan_8cpp_source.html#l00019">19</a> of file <a class="el" href="monitor__desired__phase__plan_8cpp_source.html">monitor_desired_phase_plan.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   20</span>    {</div>
<div class="line"><span class="lineno">   21</span>        <span class="keywordflow">if</span> (tsc_state_ptr == <span class="keyword">nullptr</span> || spat_ptr == <span class="keyword">nullptr</span> || tsc_state_ptr-&gt;get_tsc_config_state() == <span class="keyword">nullptr</span>)</div>
<div class="line"><span class="lineno">   22</span>        {</div>
<div class="line"><span class="lineno">   23</span>            <span class="keywordflow">throw</span> monitor_desired_phase_plan_exception(<span class="stringliteral">&quot;SPAT and TSC state pointers cannot be null. SKIP prcessing!&quot;</span>);</div>
<div class="line"><span class="lineno">   24</span>        }</div>
<div class="line"><span class="lineno">   25</span> </div>
<div class="line"><span class="lineno">   26</span>        <span class="keywordflow">if</span> (spat_ptr-&gt;get_intersection().states.empty())</div>
<div class="line"><span class="lineno">   27</span>        {</div>
<div class="line"><span class="lineno">   28</span>            <span class="keywordflow">throw</span> monitor_desired_phase_plan_exception(<span class="stringliteral">&quot;Intersections states cannot be empty!&quot;</span>);</div>
<div class="line"><span class="lineno">   29</span>        }</div>
<div class="line"><span class="lineno">   30</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="classtraffic__signal__controller__service_1_1monitor__desired__phase__plan.html#ae6b65664bfddcfb561e83b33cc6bec27">desired_phase_plan_ptr</a> == <span class="keyword">nullptr</span> || <a class="code hl_variable" href="classtraffic__signal__controller__service_1_1monitor__desired__phase__plan.html#ae6b65664bfddcfb561e83b33cc6bec27">desired_phase_plan_ptr</a>-&gt;desired_phase_plan.empty())</div>
<div class="line"><span class="lineno">   31</span>        {</div>
<div class="line"><span class="lineno">   32</span>            <span class="comment">// If no current green -&gt; then either yellow change or red clearance active</span></div>
<div class="line"><span class="lineno">   33</span>            <span class="comment">// =&gt; Fix next green phase in SPaT</span></div>
<div class="line"><span class="lineno">   34</span>            <span class="keywordtype">bool</span> is_green_present = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">   35</span>            <span class="keyword">auto</span> state = spat_ptr-&gt;get_intersection();</div>
<div class="line"><span class="lineno">   36</span>            <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;movement : state.states) {</div>
<div class="line"><span class="lineno">   37</span>                <span class="keywordflow">if</span> ( movement.state_time_speed.front().event_state == <a class="code hl_enumvalue" href="namespacesignal__phase__and__timing.html#a89bd5b280352669f719b2c36a9dc2a14ababa6a65d4933ea6229e61b20668218b">signal_phase_and_timing::movement_phase_state::protected_movement_allowed</a>) {</div>
<div class="line"><span class="lineno">   38</span>                    is_green_present = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">   39</span>                    <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">   40</span>                }</div>
<div class="line"><span class="lineno">   41</span>            }</div>
<div class="line"><span class="lineno">   42</span>            <span class="keywordflow">if</span> (!is_green_present ) {</div>
<div class="line"><span class="lineno">   43</span>                <a class="code hl_function" href="classtraffic__signal__controller__service_1_1monitor__desired__phase__plan.html#aa1a159a46faa26e7fa81b6f0e5ea3fcc">fix_upcoming_green</a>(spat_ptr, tsc_state_ptr);</div>
<div class="line"><span class="lineno">   44</span>            }</div>
<div class="line"><span class="lineno">   45</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">   46</span>            spat_ptr-&gt;update_spat_with_candidate_dpp(*<a class="code hl_variable" href="classtraffic__signal__controller__service_1_1monitor__desired__phase__plan.html#ae6b65664bfddcfb561e83b33cc6bec27">desired_phase_plan_ptr</a>, tsc_state_ptr-&gt;get_tsc_config_state());</div>
<div class="line"><span class="lineno">   47</span>        }</div>
<div class="line"><span class="lineno">   48</span>    }</div>
<div class="ttc" id="aclasstraffic__signal__controller__service_1_1monitor__desired__phase__plan_html_aa1a159a46faa26e7fa81b6f0e5ea3fcc"><div class="ttname"><a href="classtraffic__signal__controller__service_1_1monitor__desired__phase__plan.html#aa1a159a46faa26e7fa81b6f0e5ea3fcc">traffic_signal_controller_service::monitor_desired_phase_plan::fix_upcoming_green</a></div><div class="ttdeci">void fix_upcoming_green(const std::shared_ptr&lt; signal_phase_and_timing::spat &gt; spat_ptr, const std::shared_ptr&lt; tsc_state &gt; tsc_state_ptr) const</div><div class="ttdoc">Method to represent the upcoming green, when no desired phase plan is present and the TSC is currentl...</div><div class="ttdef"><b>Definition:</b> <a href="monitor__desired__phase__plan_8cpp_source.html#l00050">monitor_desired_phase_plan.cpp:50</a></div></div>
<div class="ttc" id="anamespacesignal__phase__and__timing_html_a89bd5b280352669f719b2c36a9dc2a14ababa6a65d4933ea6229e61b20668218b"><div class="ttname"><a href="namespacesignal__phase__and__timing.html#a89bd5b280352669f719b2c36a9dc2a14ababa6a65d4933ea6229e61b20668218b">signal_phase_and_timing::movement_phase_state::protected_movement_allowed</a></div><div class="ttdeci">@ protected_movement_allowed</div><div class="ttdoc">Often called 'protected green' in US Driver Action: Proceed, tossing caution to the wind,...</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="monitor__desired__phase__plan_8h_source.html#l00015">desired_phase_plan_ptr</a>, <a class="el" href="monitor__desired__phase__plan_8cpp_source.html#l00050">fix_upcoming_green()</a>, and <a class="el" href="namespacesignal__phase__and__timing.html#a89bd5b280352669f719b2c36a9dc2a14ababa6a65d4933ea6229e61b20668218b">signal_phase_and_timing::protected_movement_allowed</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classtraffic__signal__controller__service_1_1monitor__desired__phase__plan_a29a37f4f2b68922a93e9a05928f28217_cgraph.png" border="0" usemap="#aclasstraffic__signal__controller__service_1_1monitor__desired__phase__plan_a29a37f4f2b68922a93e9a05928f28217_cgraph" alt=""/></div>
<map name="aclasstraffic__signal__controller__service_1_1monitor__desired__phase__plan_a29a37f4f2b68922a93e9a05928f28217_cgraph" id="aclasstraffic__signal__controller__service_1_1monitor__desired__phase__plan_a29a37f4f2b68922a93e9a05928f28217_cgraph">
<area shape="rect" title="Update spat movement_event list with desired phase plan information." alt="" coords="5,118,181,189"/>
<area shape="rect" href="classtraffic__signal__controller__service_1_1monitor__desired__phase__plan.html#aa1a159a46faa26e7fa81b6f0e5ea3fcc" title="Method to represent the upcoming green, when no desired phase plan is present and the TSC is currentl..." alt="" coords="229,125,444,181"/>
<area shape="rect" href="classtraffic__signal__controller__service_1_1tsc__state.html#a27876c0c6172cbb37788cadd97bf6ff3" title="Return reference to signal group state map." alt="" coords="492,5,663,61"/>
<area shape="rect" href="classtraffic__signal__controller__service_1_1tsc__state.html#a05b2aa1aff298e094fd02d59b067e4e7" title="Returns a pointer to the tsc_config_state." alt="" coords="500,85,655,141"/>
<area shape="rect" href="classtraffic__signal__controller__service_1_1tsc__state.html#a42882c2c84b9decb8ab4d89485a5321f" title="Get the signal group id using phase number.Only for vehicle phases." alt="" coords="494,165,661,221"/>
<area shape="rect" href="structstreets__desired__phase__plan_1_1streets__desired__phase__plan.html#ae2a335d599173d37b8a12abe26948c01" title="Serialize Desired phase plan object to rapidjson::Value for writing as JSON string." alt="" coords="501,245,654,301"/>
<area shape="rect" href="ntcip__1202__ext_8h.html#a576de7b60eacee3f1a70393a005502cd" title="Returns std::string representation of ntcip_1202_ext message including phase_times array." alt="" coords="711,180,783,207"/>
</map>
</div>

</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a id="af39b5d16b681d8a0a473874bde88da7d" name="af39b5d16b681d8a0a473874bde88da7d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af39b5d16b681d8a0a473874bde88da7d">&#9670;&nbsp;</a></span>_snmp_client</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::shared_ptr&lt;<a class="el" href="classtraffic__signal__controller__service_1_1snmp__client.html">snmp_client</a>&gt; traffic_signal_controller_service::monitor_desired_phase_plan::_snmp_client</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="monitor__desired__phase__plan_8h_source.html#l00017">17</a> of file <a class="el" href="monitor__desired__phase__plan_8h_source.html">monitor_desired_phase_plan.h</a>.</p>

<p class="reference">Referenced by <a class="el" href="monitor__desired__phase__plan_8cpp_source.html#l00050">fix_upcoming_green()</a>.</p>

</div>
</div>
<a id="ae6b65664bfddcfb561e83b33cc6bec27" name="ae6b65664bfddcfb561e83b33cc6bec27"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae6b65664bfddcfb561e83b33cc6bec27">&#9670;&nbsp;</a></span>desired_phase_plan_ptr</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::shared_ptr&lt;<a class="el" href="structstreets__desired__phase__plan_1_1streets__desired__phase__plan.html">streets_desired_phase_plan::streets_desired_phase_plan</a>&gt; traffic_signal_controller_service::monitor_desired_phase_plan::desired_phase_plan_ptr</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="monitor__desired__phase__plan_8h_source.html#l00015">15</a> of file <a class="el" href="monitor__desired__phase__plan_8h_source.html">monitor_desired_phase_plan.h</a>.</p>

<p class="reference">Referenced by <a class="el" href="monitor__desired__phase__plan_8cpp_source.html#l00014">get_desired_phase_plan_ptr()</a>, <a class="el" href="monitor__desired__phase__plan_8cpp_source.html#l00008">update_desired_phase_plan()</a>, and <a class="el" href="monitor__desired__phase__plan_8cpp_source.html#l00019">update_spat_future_movement_events()</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>tsc_client_service/include/<a class="el" href="monitor__desired__phase__plan_8h_source.html">monitor_desired_phase_plan.h</a></li>
<li>tsc_client_service/src/<a class="el" href="monitor__desired__phase__plan_8cpp_source.html">monitor_desired_phase_plan.cpp</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespacetraffic__signal__controller__service.html">traffic_signal_controller_service</a></li><li class="navelem"><a class="el" href="classtraffic__signal__controller__service_1_1monitor__desired__phase__plan.html">monitor_desired_phase_plan</a></li>
    <li class="footer">Generated on Mon Nov 21 2022 19:23:02 for Carma-streets by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.4 </li>
  </ul>
</div>
</body>
</html>
