<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Carma-platform: stop_and_wait_plugin/src/stop_and_wait_plugin.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Carma-platform<span id="projectnumber">&#160;v4.2.0</span>
   </div>
   <div id="projectbrief">CARMA Platform is built on robot operating system (ROS) and utilizes open source software (OSS) that enables Cooperative Driving Automation (CDA) features to allow Automated Driving Systems to interact and cooperate with infrastructure and other vehicles through communication.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('stop__and__wait__plugin_8cpp_source.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle"><div class="title">stop_and_wait_plugin.cpp</div></div>
</div><!--header-->
<div class="contents">
<a href="stop__and__wait__plugin_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a id="l00001" name="l00001"></a><span class="lineno">    1</span><span class="comment">/*</span></div>
<div class="line"><a id="l00002" name="l00002"></a><span class="lineno">    2</span><span class="comment"> * Copyright (C) 2019-2020 LEIDOS.</span></div>
<div class="line"><a id="l00003" name="l00003"></a><span class="lineno">    3</span><span class="comment"> *</span></div>
<div class="line"><a id="l00004" name="l00004"></a><span class="lineno">    4</span><span class="comment"> * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); you may not</span></div>
<div class="line"><a id="l00005" name="l00005"></a><span class="lineno">    5</span><span class="comment"> * use this file except in compliance with the License. You may obtain a copy of</span></div>
<div class="line"><a id="l00006" name="l00006"></a><span class="lineno">    6</span><span class="comment"> * the License at</span></div>
<div class="line"><a id="l00007" name="l00007"></a><span class="lineno">    7</span><span class="comment"> *</span></div>
<div class="line"><a id="l00008" name="l00008"></a><span class="lineno">    8</span><span class="comment"> * http://www.apache.org/licenses/LICENSE-2.0</span></div>
<div class="line"><a id="l00009" name="l00009"></a><span class="lineno">    9</span><span class="comment"> *</span></div>
<div class="line"><a id="l00010" name="l00010"></a><span class="lineno">   10</span><span class="comment"> * Unless required by applicable law or agreed to in writing, software</span></div>
<div class="line"><a id="l00011" name="l00011"></a><span class="lineno">   11</span><span class="comment"> * distributed under the License is distributed on an &quot;AS IS&quot; BASIS, WITHOUT</span></div>
<div class="line"><a id="l00012" name="l00012"></a><span class="lineno">   12</span><span class="comment"> * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the</span></div>
<div class="line"><a id="l00013" name="l00013"></a><span class="lineno">   13</span><span class="comment"> * License for the specific language governing permissions and limitations under</span></div>
<div class="line"><a id="l00014" name="l00014"></a><span class="lineno">   14</span><span class="comment"> * the License.</span></div>
<div class="line"><a id="l00015" name="l00015"></a><span class="lineno">   15</span><span class="comment"> */</span></div>
<div class="line"><a id="l00016" name="l00016"></a><span class="lineno">   16</span> </div>
<div class="line"><a id="l00017" name="l00017"></a><span class="lineno">   17</span><span class="preprocessor">#include &lt;rclcpp/rclcpp.hpp&gt;</span></div>
<div class="line"><a id="l00018" name="l00018"></a><span class="lineno">   18</span><span class="preprocessor">#include &lt;string&gt;</span></div>
<div class="line"><a id="l00019" name="l00019"></a><span class="lineno">   19</span><span class="preprocessor">#include &lt;algorithm&gt;</span></div>
<div class="line"><a id="l00020" name="l00020"></a><span class="lineno">   20</span><span class="preprocessor">#include &lt;memory&gt;</span></div>
<div class="line"><a id="l00021" name="l00021"></a><span class="lineno">   21</span><span class="preprocessor">#include &lt;boost/uuid/uuid_generators.hpp&gt;</span></div>
<div class="line"><a id="l00022" name="l00022"></a><span class="lineno">   22</span><span class="preprocessor">#include &lt;boost/uuid/uuid_io.hpp&gt;</span></div>
<div class="line"><a id="l00023" name="l00023"></a><span class="lineno">   23</span><span class="preprocessor">#include &lt;lanelet2_core/geometry/Point.h&gt;</span></div>
<div class="line"><a id="l00024" name="l00024"></a><span class="lineno">   24</span><span class="preprocessor">#include &lt;trajectory_utils/trajectory_utils.hpp&gt;</span></div>
<div class="line"><a id="l00025" name="l00025"></a><span class="lineno">   25</span><span class="preprocessor">#include &lt;trajectory_utils/conversions/conversions.hpp&gt;</span></div>
<div class="line"><a id="l00026" name="l00026"></a><span class="lineno">   26</span><span class="preprocessor">#include &lt;sstream&gt;</span></div>
<div class="line"><a id="l00027" name="l00027"></a><span class="lineno">   27</span><span class="preprocessor">#include &lt;carma_ros2_utils/carma_lifecycle_node.hpp&gt;</span></div>
<div class="line"><a id="l00028" name="l00028"></a><span class="lineno">   28</span><span class="preprocessor">#include &lt;Eigen/Core&gt;</span></div>
<div class="line"><a id="l00029" name="l00029"></a><span class="lineno">   29</span><span class="preprocessor">#include &lt;Eigen/Geometry&gt;</span></div>
<div class="line"><a id="l00030" name="l00030"></a><span class="lineno">   30</span><span class="preprocessor">#include &lt;Eigen/LU&gt;</span></div>
<div class="line"><a id="l00031" name="l00031"></a><span class="lineno">   31</span><span class="preprocessor">#include &lt;Eigen/SVD&gt;</span></div>
<div class="line"><a id="l00032" name="l00032"></a><span class="lineno">   32</span><span class="preprocessor">#include &lt;unordered_set&gt;</span></div>
<div class="line"><a id="l00033" name="l00033"></a><span class="lineno">   33</span><span class="preprocessor">#include &quot;<a class="code" href="stop__and__wait__plugin_8hpp.html">stop_and_wait_plugin.hpp</a>&quot;</span></div>
<div class="line"><a id="l00034" name="l00034"></a><span class="lineno">   34</span><span class="preprocessor">#include &lt;vector&gt;</span></div>
<div class="line"><a id="l00035" name="l00035"></a><span class="lineno">   35</span><span class="preprocessor">#include &lt;carma_planning_msgs/msg/stop_and_wait_maneuver.hpp&gt;</span></div>
<div class="line"><a id="l00036" name="l00036"></a><span class="lineno">   36</span><span class="preprocessor">#include &lt;<a class="code" href="Geometry_8hpp.html">carma_wm/Geometry.hpp</a>&gt;</span></div>
<div class="line"><a id="l00037" name="l00037"></a><span class="lineno">   37</span><span class="preprocessor">#include &lt;carma_planning_msgs/msg/trajectory_plan_point.hpp&gt;</span></div>
<div class="line"><a id="l00038" name="l00038"></a><span class="lineno">   38</span><span class="preprocessor">#include &lt;carma_planning_msgs/msg/trajectory_plan.hpp&gt;</span></div>
<div class="line"><a id="l00039" name="l00039"></a><span class="lineno">   39</span><span class="preprocessor">#include &lt;lanelet2_core/primitives/Lanelet.h&gt;</span></div>
<div class="line"><a id="l00040" name="l00040"></a><span class="lineno">   40</span><span class="preprocessor">#include &lt;lanelet2_core/geometry/LineString.h&gt;</span></div>
<div class="line"><a id="l00041" name="l00041"></a><span class="lineno">   41</span><span class="preprocessor">#include &lt;<a class="code" href="CARMAWorldModel_8hpp.html">carma_wm/CARMAWorldModel.hpp</a>&gt;</span></div>
<div class="line"><a id="l00042" name="l00042"></a><span class="lineno">   42</span><span class="preprocessor">#include &lt;math.h&gt;</span></div>
<div class="line"><a id="l00043" name="l00043"></a><span class="lineno">   43</span><span class="preprocessor">#include &lt;std_msgs/msg/float64.hpp&gt;</span></div>
<div class="line"><a id="l00044" name="l00044"></a><span class="lineno">   44</span><span class="preprocessor">#include &lt;math.h&gt;</span></div>
<div class="line"><a id="l00045" name="l00045"></a><span class="lineno">   45</span> </div>
<div class="line"><a id="l00046" name="l00046"></a><span class="lineno"><a class="line" href="stop__and__wait__plugin_8cpp.html#a8212f1302ee6736745dc97bb5b3caaf5">   46</a></span><span class="keyword">using </span><a class="code hl_typedef" href="inlanecruising__plugin_8cpp.html#a8212f1302ee6736745dc97bb5b3caaf5">oss</a> = std::ostringstream;</div>
<div class="line"><a id="l00047" name="l00047"></a><span class="lineno">   47</span> </div>
<div class="line"><a id="l00048" name="l00048"></a><span class="lineno">   48</span><span class="keyword">namespace </span><a class="code hl_namespace" href="namespacestop__and__wait__plugin.html">stop_and_wait_plugin</a></div>
<div class="line"><a id="l00049" name="l00049"></a><span class="lineno">   49</span>{</div>
<div class="line"><a id="l00050" name="l00050"></a><span class="lineno">   50</span> </div>
<div class="line"><a id="l00051" name="l00051"></a><span class="lineno"><a class="line" href="classstop__and__wait__plugin_1_1StopandWait.html#ae46b43c4b94d00c259c1fcd370cdb09a">   51</a></span><a class="code hl_function" href="classstop__and__wait__plugin_1_1StopandWait.html#ae46b43c4b94d00c259c1fcd370cdb09a">StopandWait::StopandWait</a>(std::shared_ptr&lt;carma_ros2_utils::CarmaLifecycleNode&gt; nh,</div>
<div class="line"><a id="l00052" name="l00052"></a><span class="lineno">   52</span>                                          <a class="code hl_typedef" href="namespacecarma__wm.html#a3ac653959e0b6198cae274d68b343228">carma_wm::WorldModelConstPtr</a> wm,</div>
<div class="line"><a id="l00053" name="l00053"></a><span class="lineno">   53</span>                                          <span class="keyword">const</span> <a class="code hl_struct" href="structStopandWaitConfig.html">StopandWaitConfig</a>&amp; config,</div>
<div class="line"><a id="l00054" name="l00054"></a><span class="lineno">   54</span>                                          <span class="keyword">const</span> std::string&amp; plugin_name,</div>
<div class="line"><a id="l00055" name="l00055"></a><span class="lineno">   55</span>                                          <span class="keyword">const</span> std::string&amp; <a class="code hl_variable" href="namespacespeedharm-cli.html#a979a8b66607cfccc604e46e7f199f9b6">version_id</a>)</div>
<div class="line"><a id="l00056" name="l00056"></a><span class="lineno">   56</span>  : version_id_ (<a class="code hl_variable" href="namespacespeedharm-cli.html#a979a8b66607cfccc604e46e7f199f9b6">version_id</a>),plugin_name_(plugin_name),config_(config),nh_(nh), wm_(wm)</div>
<div class="line"><a id="l00057" name="l00057"></a><span class="lineno">   57</span>{};</div>
<div class="line"><a id="l00058" name="l00058"></a><span class="lineno">   58</span> </div>
<div class="line"><a id="l00059" name="l00059"></a><span class="lineno"><a class="line" href="classstop__and__wait__plugin_1_1StopandWait.html#aacfe3c82e0d7cc47a27c67f7b9f4b83e">   59</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classstop__and__wait__plugin_1_1StopandWait.html#aacfe3c82e0d7cc47a27c67f7b9f4b83e">StopandWait::plan_trajectory_cb</a>(carma_planning_msgs::srv::PlanTrajectory::Request::SharedPtr req, carma_planning_msgs::srv::PlanTrajectory::Response::SharedPtr resp)</div>
<div class="line"><a id="l00060" name="l00060"></a><span class="lineno">   60</span>{</div>
<div class="line"><a id="l00061" name="l00061"></a><span class="lineno">   61</span>  std::chrono::system_clock::time_point start_time = std::chrono::system_clock::now();  <span class="comment">// Start timing the execution time for planning so it can be logged</span></div>
<div class="line"><a id="l00062" name="l00062"></a><span class="lineno">   62</span>  RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<span class="stringliteral">&quot;stop_and_wait_plugin&quot;</span>),<span class="stringliteral">&quot;Starting stop&amp;wait planning&quot;</span>);</div>
<div class="line"><a id="l00063" name="l00063"></a><span class="lineno">   63</span> </div>
<div class="line"><a id="l00064" name="l00064"></a><span class="lineno">   64</span>  <span class="keywordflow">if</span> (req-&gt;maneuver_index_to_plan &gt;= req-&gt;maneuver_plan.maneuvers.size())</div>
<div class="line"><a id="l00065" name="l00065"></a><span class="lineno">   65</span>  {</div>
<div class="line"><a id="l00066" name="l00066"></a><span class="lineno">   66</span>    <span class="keywordflow">throw</span> std::invalid_argument(</div>
<div class="line"><a id="l00067" name="l00067"></a><span class="lineno">   67</span>        <span class="stringliteral">&quot;StopAndWait plugin asked to plan invalid maneuver index: &quot;</span> + <a class="code hl_function" href="namespacecarma__cooperative__perception.html#a64b708654c8aecb09122d39577df31b5">std::to_string</a>(req-&gt;maneuver_index_to_plan) +</div>
<div class="line"><a id="l00068" name="l00068"></a><span class="lineno">   68</span>        <span class="stringliteral">&quot; for plan of size: &quot;</span> + <a class="code hl_function" href="namespacecarma__cooperative__perception.html#a64b708654c8aecb09122d39577df31b5">std::to_string</a>(req-&gt;maneuver_plan.maneuvers.size()));</div>
<div class="line"><a id="l00069" name="l00069"></a><span class="lineno">   69</span>  }</div>
<div class="line"><a id="l00070" name="l00070"></a><span class="lineno">   70</span> </div>
<div class="line"><a id="l00071" name="l00071"></a><span class="lineno">   71</span>  <span class="keywordflow">if</span> (req-&gt;maneuver_plan.maneuvers[req-&gt;maneuver_index_to_plan].type != carma_planning_msgs::msg::Maneuver::STOP_AND_WAIT)</div>
<div class="line"><a id="l00072" name="l00072"></a><span class="lineno">   72</span>  {</div>
<div class="line"><a id="l00073" name="l00073"></a><span class="lineno">   73</span>    <span class="keywordflow">throw</span> std::invalid_argument(<span class="stringliteral">&quot;StopAndWait plugin asked to plan non STOP_AND_WAIT maneuver&quot;</span>);</div>
<div class="line"><a id="l00074" name="l00074"></a><span class="lineno">   74</span>  }</div>
<div class="line"><a id="l00075" name="l00075"></a><span class="lineno">   75</span> </div>
<div class="line"><a id="l00076" name="l00076"></a><span class="lineno">   76</span>  lanelet::BasicPoint2d veh_pos(req-&gt;vehicle_state.x_pos_global, req-&gt;vehicle_state.y_pos_global);</div>
<div class="line"><a id="l00077" name="l00077"></a><span class="lineno">   77</span> </div>
<div class="line"><a id="l00078" name="l00078"></a><span class="lineno">   78</span>  RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<span class="stringliteral">&quot;stop_and_wait_plugin&quot;</span>),<span class="stringliteral">&quot;planning state x:&quot;</span> &lt;&lt; req-&gt;vehicle_state.x_pos_global &lt;&lt; <span class="stringliteral">&quot;, y: &quot;</span> &lt;&lt; req-&gt;vehicle_state.y_pos_global &lt;&lt; <span class="stringliteral">&quot;, speed: &quot;</span> &lt;&lt; req-&gt;vehicle_state.longitudinal_vel);</div>
<div class="line"><a id="l00079" name="l00079"></a><span class="lineno">   79</span> </div>
<div class="line"><a id="l00080" name="l00080"></a><span class="lineno">   80</span>  <span class="keywordflow">if</span> (req-&gt;vehicle_state.longitudinal_vel &lt; <a class="code hl_variable" href="classstop__and__wait__plugin_1_1StopandWait.html#a85799673152ebcc839e30f3c4a7cc6f8">epsilon_</a>)</div>
<div class="line"><a id="l00081" name="l00081"></a><span class="lineno">   81</span>  {</div>
<div class="line"><a id="l00082" name="l00082"></a><span class="lineno">   82</span>    RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<span class="stringliteral">&quot;stop_and_wait_plugin&quot;</span>),<span class="stringliteral">&quot;Detected that car is already stopped! Ignoring the request to plan Stop&amp;Wait&quot;</span>);</div>
<div class="line"><a id="l00083" name="l00083"></a><span class="lineno">   83</span> </div>
<div class="line"><a id="l00084" name="l00084"></a><span class="lineno">   84</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l00085" name="l00085"></a><span class="lineno">   85</span>  }</div>
<div class="line"><a id="l00086" name="l00086"></a><span class="lineno">   86</span> </div>
<div class="line"><a id="l00087" name="l00087"></a><span class="lineno">   87</span>  <span class="keywordtype">double</span> current_downtrack = <a class="code hl_variable" href="classstop__and__wait__plugin_1_1StopandWait.html#a2346402ff858040dbc850412cf1fedab">wm_</a>-&gt;routeTrackPos(veh_pos).downtrack;</div>
<div class="line"><a id="l00088" name="l00088"></a><span class="lineno">   88</span> </div>
<div class="line"><a id="l00089" name="l00089"></a><span class="lineno">   89</span>  RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<span class="stringliteral">&quot;stop_and_wait_plugin&quot;</span>),<span class="stringliteral">&quot;Current_downtrack&quot;</span> &lt;&lt; current_downtrack);</div>
<div class="line"><a id="l00090" name="l00090"></a><span class="lineno">   90</span> </div>
<div class="line"><a id="l00091" name="l00091"></a><span class="lineno">   91</span>  <span class="keywordflow">if</span> (req-&gt;maneuver_plan.maneuvers[req-&gt;maneuver_index_to_plan].stop_and_wait_maneuver.end_dist &lt; current_downtrack)</div>
<div class="line"><a id="l00092" name="l00092"></a><span class="lineno">   92</span>  {</div>
<div class="line"><a id="l00093" name="l00093"></a><span class="lineno">   93</span>    <span class="keywordflow">throw</span> std::invalid_argument(<span class="stringliteral">&quot;StopAndWait plugin asked to plan maneuver that ends earlier than the current state.&quot;</span>);</div>
<div class="line"><a id="l00094" name="l00094"></a><span class="lineno">   94</span>  }</div>
<div class="line"><a id="l00095" name="l00095"></a><span class="lineno">   95</span> </div>
<div class="line"><a id="l00096" name="l00096"></a><span class="lineno">   96</span>  resp-&gt;related_maneuvers.push_back(req-&gt;maneuver_index_to_plan);</div>
<div class="line"><a id="l00097" name="l00097"></a><span class="lineno">   97</span>  resp-&gt;maneuver_status.push_back(carma_planning_msgs::srv::PlanTrajectory::Response::MANEUVER_IN_PROGRESS);</div>
<div class="line"><a id="l00098" name="l00098"></a><span class="lineno">   98</span> </div>
<div class="line"><a id="l00099" name="l00099"></a><span class="lineno">   99</span>  std::string maneuver_id = req-&gt;maneuver_plan.maneuvers[req-&gt;maneuver_index_to_plan].stop_and_wait_maneuver.parameters.maneuver_id;</div>
<div class="line"><a id="l00100" name="l00100"></a><span class="lineno">  100</span> </div>
<div class="line"><a id="l00101" name="l00101"></a><span class="lineno">  101</span>  RCLCPP_INFO_STREAM(rclcpp::get_logger(<span class="stringliteral">&quot;stop_and_wait_plugin&quot;</span>),<span class="stringliteral">&quot;Maneuver not yet planned, planning new trajectory&quot;</span>);</div>
<div class="line"><a id="l00102" name="l00102"></a><span class="lineno">  102</span> </div>
<div class="line"><a id="l00103" name="l00103"></a><span class="lineno">  103</span>  <span class="comment">// Maneuver input is valid so continue with execution</span></div>
<div class="line"><a id="l00104" name="l00104"></a><span class="lineno">  104</span>  std::vector&lt;carma_planning_msgs::msg::Maneuver&gt; maneuver_plan = { req-&gt;maneuver_plan.maneuvers[req-&gt;maneuver_index_to_plan] };</div>
<div class="line"><a id="l00105" name="l00105"></a><span class="lineno">  105</span> </div>
<div class="line"><a id="l00106" name="l00106"></a><span class="lineno">  106</span>  std::vector&lt;PointSpeedPair&gt; points_and_target_speeds = <a class="code hl_function" href="classstop__and__wait__plugin_1_1StopandWait.html#aa9627181b624dc0e6c96ea2255bdf062">maneuvers_to_points</a>(</div>
<div class="line"><a id="l00107" name="l00107"></a><span class="lineno">  107</span>      maneuver_plan, <a class="code hl_variable" href="classstop__and__wait__plugin_1_1StopandWait.html#a2346402ff858040dbc850412cf1fedab">wm_</a>, req-&gt;vehicle_state);  <span class="comment">// Now have 1m downsampled points from cur to endpoint</span></div>
<div class="line"><a id="l00108" name="l00108"></a><span class="lineno">  108</span> </div>
<div class="line"><a id="l00109" name="l00109"></a><span class="lineno">  109</span>  <span class="comment">// Trajectory plan</span></div>
<div class="line"><a id="l00110" name="l00110"></a><span class="lineno">  110</span>  carma_planning_msgs::msg::TrajectoryPlan trajectory;</div>
<div class="line"><a id="l00111" name="l00111"></a><span class="lineno">  111</span>  trajectory.header.frame_id = <span class="stringliteral">&quot;map&quot;</span>;</div>
<div class="line"><a id="l00112" name="l00112"></a><span class="lineno">  112</span>  trajectory.header.stamp = req-&gt;header.stamp;</div>
<div class="line"><a id="l00113" name="l00113"></a><span class="lineno">  113</span>  trajectory.trajectory_id = <a class="code hl_function" href="namespacecarma__cooperative__perception.html#a64b708654c8aecb09122d39577df31b5">boost::uuids::to_string</a>(boost::uuids::random_generator()());</div>
<div class="line"><a id="l00114" name="l00114"></a><span class="lineno">  114</span> </div>
<div class="line"><a id="l00115" name="l00115"></a><span class="lineno">  115</span>  <span class="comment">// Extract the stopping buffer used to consider a stopping behavior complete</span></div>
<div class="line"><a id="l00116" name="l00116"></a><span class="lineno">  116</span>  <span class="keywordtype">double</span> stop_location_buffer = <a class="code hl_variable" href="classstop__and__wait__plugin_1_1StopandWait.html#a30fade0856056bba97e3a5db61c15ced">config_</a>.<a class="code hl_variable" href="structStopandWaitConfig.html#aca43edbb1111fbf89bf99f7cbacd6796">default_stopping_buffer</a>;  <span class="comment">// If no maneuver meta data is provided we will use the default buffer</span></div>
<div class="line"><a id="l00117" name="l00117"></a><span class="lineno">  117</span> </div>
<div class="line"><a id="l00118" name="l00118"></a><span class="lineno">  118</span>  <span class="keywordtype">double</span> stopping_accel = 0.0;</div>
<div class="line"><a id="l00119" name="l00119"></a><span class="lineno">  119</span>  <span class="keywordflow">if</span> (maneuver_plan[0].stop_and_wait_maneuver.parameters.presence_vector &amp;</div>
<div class="line"><a id="l00120" name="l00120"></a><span class="lineno">  120</span>      carma_planning_msgs::msg::ManeuverParameters::HAS_FLOAT_META_DATA)</div>
<div class="line"><a id="l00121" name="l00121"></a><span class="lineno">  121</span>  {</div>
<div class="line"><a id="l00122" name="l00122"></a><span class="lineno">  122</span>    <span class="keywordflow">if</span>(maneuver_plan[0].stop_and_wait_maneuver.parameters.float_valued_meta_data.size() &lt; 2){</div>
<div class="line"><a id="l00123" name="l00123"></a><span class="lineno">  123</span>      <span class="keywordflow">throw</span> std::invalid_argument(<span class="stringliteral">&quot;stop and wait maneuver message missing required meta data&quot;</span>);</div>
<div class="line"><a id="l00124" name="l00124"></a><span class="lineno">  124</span>    }</div>
<div class="line"><a id="l00125" name="l00125"></a><span class="lineno">  125</span>    stop_location_buffer = maneuver_plan[0].stop_and_wait_maneuver.parameters.float_valued_meta_data[0];</div>
<div class="line"><a id="l00126" name="l00126"></a><span class="lineno">  126</span>    stopping_accel = maneuver_plan[0].stop_and_wait_maneuver.parameters.float_valued_meta_data[1];</div>
<div class="line"><a id="l00127" name="l00127"></a><span class="lineno">  127</span> </div>
<div class="line"><a id="l00128" name="l00128"></a><span class="lineno">  128</span>    RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<span class="stringliteral">&quot;stop_and_wait_plugin&quot;</span>),<span class="stringliteral">&quot;Using stop buffer from meta data: &quot;</span> &lt;&lt; stop_location_buffer);</div>
<div class="line"><a id="l00129" name="l00129"></a><span class="lineno">  129</span>    RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<span class="stringliteral">&quot;stop_and_wait_plugin&quot;</span>),<span class="stringliteral">&quot;Using stopping acceleration from meta data: &quot;</span>&lt;&lt; stopping_accel);</div>
<div class="line"><a id="l00130" name="l00130"></a><span class="lineno">  130</span>  }</div>
<div class="line"><a id="l00131" name="l00131"></a><span class="lineno">  131</span>  <span class="keywordflow">else</span>{</div>
<div class="line"><a id="l00132" name="l00132"></a><span class="lineno">  132</span>    <span class="keywordflow">throw</span> std::invalid_argument(<span class="stringliteral">&quot;stop and wait maneuver message missing required float meta data&quot;</span>);</div>
<div class="line"><a id="l00133" name="l00133"></a><span class="lineno">  133</span>  }</div>
<div class="line"><a id="l00134" name="l00134"></a><span class="lineno">  134</span> </div>
<div class="line"><a id="l00135" name="l00135"></a><span class="lineno">  135</span>  <span class="keywordtype">double</span> initial_speed = req-&gt;vehicle_state.longitudinal_vel; <span class="comment">//will be modified after compose_trajectory_from_centerline</span></div>
<div class="line"><a id="l00136" name="l00136"></a><span class="lineno">  136</span> </div>
<div class="line"><a id="l00137" name="l00137"></a><span class="lineno">  137</span>  RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<span class="stringliteral">&quot;stop_and_wait_plugin&quot;</span>),<span class="stringliteral">&quot;Original size: &quot;</span> &lt;&lt; points_and_target_speeds.size());</div>
<div class="line"><a id="l00138" name="l00138"></a><span class="lineno">  138</span> </div>
<div class="line"><a id="l00139" name="l00139"></a><span class="lineno">  139</span>  trajectory.trajectory_points = <a class="code hl_function" href="classstop__and__wait__plugin_1_1StopandWait.html#ad80a802e059ba3e8a458eb53c0093a0b">compose_trajectory_from_centerline</a>(</div>
<div class="line"><a id="l00140" name="l00140"></a><span class="lineno">  140</span>      points_and_target_speeds, current_downtrack, req-&gt;vehicle_state.longitudinal_vel,</div>
<div class="line"><a id="l00141" name="l00141"></a><span class="lineno">  141</span>      maneuver_plan[0].stop_and_wait_maneuver.end_dist, stop_location_buffer, req-&gt;header.stamp, stopping_accel, initial_speed);</div>
<div class="line"><a id="l00142" name="l00142"></a><span class="lineno">  142</span> </div>
<div class="line"><a id="l00143" name="l00143"></a><span class="lineno">  143</span>  RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<span class="stringliteral">&quot;stop_and_wait_plugin&quot;</span>),<span class="stringliteral">&quot;Trajectory points size:&quot;</span> &lt;&lt; trajectory.trajectory_points.size());</div>
<div class="line"><a id="l00144" name="l00144"></a><span class="lineno">  144</span> </div>
<div class="line"><a id="l00145" name="l00145"></a><span class="lineno">  145</span>  trajectory.initial_longitudinal_velocity = initial_speed;</div>
<div class="line"><a id="l00146" name="l00146"></a><span class="lineno">  146</span> </div>
<div class="line"><a id="l00147" name="l00147"></a><span class="lineno">  147</span>  resp-&gt;trajectory_plan = trajectory;</div>
<div class="line"><a id="l00148" name="l00148"></a><span class="lineno">  148</span> </div>
<div class="line"><a id="l00149" name="l00149"></a><span class="lineno">  149</span>  <span class="comment">// Yield for potential obstacles in the road</span></div>
<div class="line"><a id="l00150" name="l00150"></a><span class="lineno">  150</span>  <span class="comment">// Aside from the flag, yield_plugin should not be called on invalid trajectories</span></div>
<div class="line"><a id="l00151" name="l00151"></a><span class="lineno">  151</span>  <span class="keywordflow">if</span> (<a class="code hl_variable" href="classstop__and__wait__plugin_1_1StopandWait.html#a30fade0856056bba97e3a5db61c15ced">config_</a>.<a class="code hl_variable" href="structStopandWaitConfig.html#ab776cb8bf766ff9b05c43e033b78316f">enable_object_avoidance</a> &amp;&amp; resp-&gt;trajectory_plan.trajectory_points.size() &gt;= 2)</div>
<div class="line"><a id="l00152" name="l00152"></a><span class="lineno">  152</span>  {</div>
<div class="line"><a id="l00153" name="l00153"></a><span class="lineno">  153</span>    <a class="code hl_function" href="namespacebasic__autonomy_1_1waypoint__generation.html#a2de71503d10ed9a644bafd31fd102081">basic_autonomy::waypoint_generation::modify_trajectory_to_yield_to_obstacles</a>(<a class="code hl_variable" href="classstop__and__wait__plugin_1_1StopandWait.html#af3e2cab6d9967d86936e4f47caa37008">nh_</a>, req, resp, <a class="code hl_variable" href="classstop__and__wait__plugin_1_1StopandWait.html#af81018d8babdb47605aacb5f819a37c0">yield_client_</a>, <a class="code hl_variable" href="classstop__and__wait__plugin_1_1StopandWait.html#a30fade0856056bba97e3a5db61c15ced">config_</a>.<a class="code hl_variable" href="structStopandWaitConfig.html#abde4d07c8db2f1a999c4af243bd8f396">tactical_plugin_service_call_timeout</a>);</div>
<div class="line"><a id="l00154" name="l00154"></a><span class="lineno">  154</span>  }</div>
<div class="line"><a id="l00155" name="l00155"></a><span class="lineno">  155</span>  <span class="keywordflow">else</span></div>
<div class="line"><a id="l00156" name="l00156"></a><span class="lineno">  156</span>  {</div>
<div class="line"><a id="l00157" name="l00157"></a><span class="lineno">  157</span>    RCLCPP_DEBUG(rclcpp::get_logger(<span class="stringliteral">&quot;stop_and_wait_plugin&quot;</span>), <span class="stringliteral">&quot;Ignored Object Avoidance&quot;</span>);</div>
<div class="line"><a id="l00158" name="l00158"></a><span class="lineno">  158</span>  }</div>
<div class="line"><a id="l00159" name="l00159"></a><span class="lineno">  159</span> </div>
<div class="line"><a id="l00160" name="l00160"></a><span class="lineno">  160</span>  std::chrono::system_clock::time_point end_time = std::chrono::system_clock::now();  <span class="comment">// Planning complete</span></div>
<div class="line"><a id="l00161" name="l00161"></a><span class="lineno">  161</span> </div>
<div class="line"><a id="l00162" name="l00162"></a><span class="lineno">  162</span>  <span class="keyword">auto</span> duration = end_time - start_time;</div>
<div class="line"><a id="l00163" name="l00163"></a><span class="lineno">  163</span>            RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<span class="stringliteral">&quot;stop_and_wait_plugin&quot;</span>), <span class="stringliteral">&quot;ExecutionTime Stop&amp;Wait Trajectory: &quot;</span> &lt;&lt; std::chrono::duration&lt;double&gt;(duration).count());</div>
<div class="line"><a id="l00164" name="l00164"></a><span class="lineno">  164</span> </div>
<div class="line"><a id="l00165" name="l00165"></a><span class="lineno">  165</span>  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l00166" name="l00166"></a><span class="lineno">  166</span>}</div>
<div class="line"><a id="l00167" name="l00167"></a><span class="lineno">  167</span> </div>
<div class="line"><a id="l00168" name="l00168"></a><span class="lineno">  168</span><span class="comment">// Returns the centerline points and speed limits for the provided maneuver</span></div>
<div class="line"><a id="l00169" name="l00169"></a><span class="lineno"><a class="line" href="classstop__and__wait__plugin_1_1StopandWait.html#aa9627181b624dc0e6c96ea2255bdf062">  169</a></span>std::vector&lt;PointSpeedPair&gt; <a class="code hl_function" href="classstop__and__wait__plugin_1_1StopandWait.html#aa9627181b624dc0e6c96ea2255bdf062">StopandWait::maneuvers_to_points</a>(<span class="keyword">const</span> std::vector&lt;carma_planning_msgs::msg::Maneuver&gt;&amp; maneuvers,</div>
<div class="line"><a id="l00170" name="l00170"></a><span class="lineno">  170</span>                                                             <span class="keyword">const</span> <a class="code hl_typedef" href="namespacecarma__wm.html#a3ac653959e0b6198cae274d68b343228">carma_wm::WorldModelConstPtr</a>&amp; wm,</div>
<div class="line"><a id="l00171" name="l00171"></a><span class="lineno">  171</span>                                                             <span class="keyword">const</span> carma_planning_msgs::msg::VehicleState&amp; state)</div>
<div class="line"><a id="l00172" name="l00172"></a><span class="lineno">  172</span>{</div>
<div class="line"><a id="l00173" name="l00173"></a><span class="lineno">  173</span>  std::vector&lt;PointSpeedPair&gt; points_and_target_speeds;</div>
<div class="line"><a id="l00174" name="l00174"></a><span class="lineno">  174</span>  std::unordered_set&lt;lanelet::Id&gt; visited_lanelets;</div>
<div class="line"><a id="l00175" name="l00175"></a><span class="lineno">  175</span> </div>
<div class="line"><a id="l00176" name="l00176"></a><span class="lineno">  176</span>  carma_planning_msgs::msg::StopAndWaitManeuver stop_and_wait_maneuver = maneuvers[0].stop_and_wait_maneuver;</div>
<div class="line"><a id="l00177" name="l00177"></a><span class="lineno">  177</span> </div>
<div class="line"><a id="l00178" name="l00178"></a><span class="lineno">  178</span>  lanelet::BasicPoint2d veh_pos(state.x_pos_global, state.y_pos_global);</div>
<div class="line"><a id="l00179" name="l00179"></a><span class="lineno">  179</span>  <span class="keywordtype">double</span> starting_downtrack = <a class="code hl_variable" href="classstop__and__wait__plugin_1_1StopandWait.html#a2346402ff858040dbc850412cf1fedab">wm_</a>-&gt;routeTrackPos(veh_pos).downtrack;  <span class="comment">// The vehicle position</span></div>
<div class="line"><a id="l00180" name="l00180"></a><span class="lineno">  180</span>  <span class="keywordtype">double</span> starting_speed = state.longitudinal_vel;</div>
<div class="line"><a id="l00181" name="l00181"></a><span class="lineno">  181</span> </div>
<div class="line"><a id="l00182" name="l00182"></a><span class="lineno">  182</span>  <span class="comment">// Sample the lanelet centerline at fixed increments.</span></div>
<div class="line"><a id="l00183" name="l00183"></a><span class="lineno">  183</span>  <span class="comment">// std::min call here is a guard against starting_downtrack being within 1m of the maneuver end_dist</span></div>
<div class="line"><a id="l00184" name="l00184"></a><span class="lineno">  184</span>  <span class="comment">// in this case the sampleRoutePoints method will return a single point allowing execution to continue</span></div>
<div class="line"><a id="l00185" name="l00185"></a><span class="lineno">  185</span>  std::vector&lt;lanelet::BasicPoint2d&gt; route_points = wm-&gt;sampleRoutePoints(</div>
<div class="line"><a id="l00186" name="l00186"></a><span class="lineno">  186</span>      std::min(starting_downtrack + <a class="code hl_variable" href="classstop__and__wait__plugin_1_1StopandWait.html#a30fade0856056bba97e3a5db61c15ced">config_</a>.<a class="code hl_variable" href="structStopandWaitConfig.html#a5da42279802aa5b76f2e0d152bc495ca">centerline_sampling_spacing</a>, stop_and_wait_maneuver.end_dist),</div>
<div class="line"><a id="l00187" name="l00187"></a><span class="lineno">  187</span>      stop_and_wait_maneuver.end_dist, <a class="code hl_variable" href="classstop__and__wait__plugin_1_1StopandWait.html#a30fade0856056bba97e3a5db61c15ced">config_</a>.<a class="code hl_variable" href="structStopandWaitConfig.html#a5da42279802aa5b76f2e0d152bc495ca">centerline_sampling_spacing</a>);</div>
<div class="line"><a id="l00188" name="l00188"></a><span class="lineno">  188</span> </div>
<div class="line"><a id="l00189" name="l00189"></a><span class="lineno">  189</span> </div>
<div class="line"><a id="l00190" name="l00190"></a><span class="lineno">  190</span>  route_points.insert(route_points.begin(), veh_pos);</div>
<div class="line"><a id="l00191" name="l00191"></a><span class="lineno">  191</span> </div>
<div class="line"><a id="l00192" name="l00192"></a><span class="lineno">  192</span> </div>
<div class="line"><a id="l00193" name="l00193"></a><span class="lineno">  193</span>  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; p : route_points)</div>
<div class="line"><a id="l00194" name="l00194"></a><span class="lineno">  194</span>  {</div>
<div class="line"><a id="l00195" name="l00195"></a><span class="lineno">  195</span>    <a class="code hl_struct" href="structstop__and__wait__plugin_1_1PointSpeedPair.html">PointSpeedPair</a> pair;</div>
<div class="line"><a id="l00196" name="l00196"></a><span class="lineno">  196</span>    pair.<a class="code hl_variable" href="structstop__and__wait__plugin_1_1PointSpeedPair.html#a3d257f2cca23d430a1d2e9aba23bc4ad">point</a> = p;</div>
<div class="line"><a id="l00197" name="l00197"></a><span class="lineno">  197</span>    pair.<a class="code hl_variable" href="structstop__and__wait__plugin_1_1PointSpeedPair.html#a61c3ee612840498ba6aea200ffeb75de">speed</a> = starting_speed; <span class="comment">// NOTE: Since the vehicle is trying to stop the assumption made is that the speed limit is irrelevant.</span></div>
<div class="line"><a id="l00198" name="l00198"></a><span class="lineno">  198</span>    points_and_target_speeds.push_back(pair);</div>
<div class="line"><a id="l00199" name="l00199"></a><span class="lineno">  199</span>  }</div>
<div class="line"><a id="l00200" name="l00200"></a><span class="lineno">  200</span> </div>
<div class="line"><a id="l00201" name="l00201"></a><span class="lineno">  201</span>  <span class="keywordflow">return</span> points_and_target_speeds;</div>
<div class="line"><a id="l00202" name="l00202"></a><span class="lineno">  202</span>}</div>
<div class="line"><a id="l00203" name="l00203"></a><span class="lineno">  203</span> </div>
<div class="line"><a id="l00204" name="l00204"></a><span class="lineno"><a class="line" href="classstop__and__wait__plugin_1_1StopandWait.html#afda81ce6bf1b8913bad9f071b7881790">  204</a></span>std::vector&lt;carma_planning_msgs::msg::TrajectoryPlanPoint&gt; <a class="code hl_function" href="classstop__and__wait__plugin_1_1StopandWait.html#afda81ce6bf1b8913bad9f071b7881790">StopandWait::trajectory_from_points_times_orientations</a>(</div>
<div class="line"><a id="l00205" name="l00205"></a><span class="lineno">  205</span>    <span class="keyword">const</span> std::vector&lt;lanelet::BasicPoint2d&gt;&amp; points, <span class="keyword">const</span> std::vector&lt;double&gt;&amp; times, <span class="keyword">const</span> std::vector&lt;double&gt;&amp; yaws,</div>
<div class="line"><a id="l00206" name="l00206"></a><span class="lineno">  206</span>    rclcpp::Time startTime)</div>
<div class="line"><a id="l00207" name="l00207"></a><span class="lineno">  207</span>{</div>
<div class="line"><a id="l00208" name="l00208"></a><span class="lineno">  208</span>  <span class="keywordflow">if</span> (points.size() != times.size() || points.size() != yaws.size())</div>
<div class="line"><a id="l00209" name="l00209"></a><span class="lineno">  209</span>  {</div>
<div class="line"><a id="l00210" name="l00210"></a><span class="lineno">  210</span>    <span class="keywordflow">throw</span> std::invalid_argument(<span class="stringliteral">&quot;All input vectors must have the same size&quot;</span>);</div>
<div class="line"><a id="l00211" name="l00211"></a><span class="lineno">  211</span>  }</div>
<div class="line"><a id="l00212" name="l00212"></a><span class="lineno">  212</span> </div>
<div class="line"><a id="l00213" name="l00213"></a><span class="lineno">  213</span>  std::vector&lt;carma_planning_msgs::msg::TrajectoryPlanPoint&gt; traj;</div>
<div class="line"><a id="l00214" name="l00214"></a><span class="lineno">  214</span>  traj.reserve(points.size());</div>
<div class="line"><a id="l00215" name="l00215"></a><span class="lineno">  215</span> </div>
<div class="line"><a id="l00216" name="l00216"></a><span class="lineno">  216</span>  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a> = 0; <a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a> &lt; points.size(); <a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>++)</div>
<div class="line"><a id="l00217" name="l00217"></a><span class="lineno">  217</span>  {</div>
<div class="line"><a id="l00218" name="l00218"></a><span class="lineno">  218</span>    carma_planning_msgs::msg::TrajectoryPlanPoint tpp;</div>
<div class="line"><a id="l00219" name="l00219"></a><span class="lineno">  219</span>    rclcpp::Duration relative_time(times[<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>] * 1e9);</div>
<div class="line"><a id="l00220" name="l00220"></a><span class="lineno">  220</span>    tpp.target_time = startTime + relative_time;</div>
<div class="line"><a id="l00221" name="l00221"></a><span class="lineno">  221</span>    tpp.x = points[<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>].x();</div>
<div class="line"><a id="l00222" name="l00222"></a><span class="lineno">  222</span>    tpp.y = points[<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>].y();</div>
<div class="line"><a id="l00223" name="l00223"></a><span class="lineno">  223</span>    tpp.yaw = yaws[<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>];</div>
<div class="line"><a id="l00224" name="l00224"></a><span class="lineno">  224</span>    tpp.planner_plugin_name = <a class="code hl_variable" href="classstop__and__wait__plugin_1_1StopandWait.html#a64d6b1a64dc7e3fc03e39b6f1d7225e3">plugin_name_</a>;</div>
<div class="line"><a id="l00225" name="l00225"></a><span class="lineno">  225</span>    tpp.controller_plugin_name = <span class="stringliteral">&quot;default&quot;</span>;</div>
<div class="line"><a id="l00226" name="l00226"></a><span class="lineno">  226</span> </div>
<div class="line"><a id="l00227" name="l00227"></a><span class="lineno">  227</span>    traj.push_back(tpp);</div>
<div class="line"><a id="l00228" name="l00228"></a><span class="lineno">  228</span>  }</div>
<div class="line"><a id="l00229" name="l00229"></a><span class="lineno">  229</span> </div>
<div class="line"><a id="l00230" name="l00230"></a><span class="lineno">  230</span>  <span class="keywordflow">return</span> traj;</div>
<div class="line"><a id="l00231" name="l00231"></a><span class="lineno">  231</span>}</div>
<div class="line"><a id="l00232" name="l00232"></a><span class="lineno">  232</span> </div>
<div class="line"><a id="l00233" name="l00233"></a><span class="lineno"><a class="line" href="classstop__and__wait__plugin_1_1StopandWait.html#ad80a802e059ba3e8a458eb53c0093a0b">  233</a></span>std::vector&lt;carma_planning_msgs::msg::TrajectoryPlanPoint&gt; <a class="code hl_function" href="classstop__and__wait__plugin_1_1StopandWait.html#ad80a802e059ba3e8a458eb53c0093a0b">StopandWait::compose_trajectory_from_centerline</a>(</div>
<div class="line"><a id="l00234" name="l00234"></a><span class="lineno">  234</span>    <span class="keyword">const</span> std::vector&lt;PointSpeedPair&gt;&amp; points, <span class="keywordtype">double</span> starting_downtrack, <span class="keywordtype">double</span> starting_speed, <span class="keywordtype">double</span> stop_location,</div>
<div class="line"><a id="l00235" name="l00235"></a><span class="lineno">  235</span>    <span class="keywordtype">double</span> stop_location_buffer, rclcpp::Time start_time, <span class="keywordtype">double</span> stopping_acceleration, <span class="keywordtype">double</span>&amp; initial_speed)</div>
<div class="line"><a id="l00236" name="l00236"></a><span class="lineno">  236</span>{</div>
<div class="line"><a id="l00237" name="l00237"></a><span class="lineno">  237</span>  std::vector&lt;carma_planning_msgs::msg::TrajectoryPlanPoint&gt; plan;</div>
<div class="line"><a id="l00238" name="l00238"></a><span class="lineno">  238</span>  <span class="keywordflow">if</span> (points.size() == 0)</div>
<div class="line"><a id="l00239" name="l00239"></a><span class="lineno">  239</span>  {</div>
<div class="line"><a id="l00240" name="l00240"></a><span class="lineno">  240</span>    RCLCPP_WARN_STREAM(rclcpp::get_logger(<span class="stringliteral">&quot;stop_and_wait_plugin&quot;</span>),<span class="stringliteral">&quot;No points to use as trajectory in stop and wait plugin&quot;</span>);</div>
<div class="line"><a id="l00241" name="l00241"></a><span class="lineno">  241</span>    <span class="keywordflow">return</span> plan;</div>
<div class="line"><a id="l00242" name="l00242"></a><span class="lineno">  242</span>  }</div>
<div class="line"><a id="l00243" name="l00243"></a><span class="lineno">  243</span> </div>
<div class="line"><a id="l00244" name="l00244"></a><span class="lineno">  244</span>  std::vector&lt;PointSpeedPair&gt; final_points;</div>
<div class="line"><a id="l00245" name="l00245"></a><span class="lineno">  245</span> </div>
<div class="line"><a id="l00246" name="l00246"></a><span class="lineno">  246</span>  <span class="keywordtype">double</span> half_stopping_buffer = stop_location_buffer * 0.5;</div>
<div class="line"><a id="l00247" name="l00247"></a><span class="lineno">  247</span>  <span class="keywordtype">double</span> remaining_distance = stop_location - half_stopping_buffer - starting_downtrack; <span class="comment">// Target to stop in the middle of the buffer</span></div>
<div class="line"><a id="l00248" name="l00248"></a><span class="lineno">  248</span> </div>
<div class="line"><a id="l00249" name="l00249"></a><span class="lineno">  249</span>  <span class="keywordtype">double</span> target_accel = stopping_acceleration * <a class="code hl_variable" href="classstop__and__wait__plugin_1_1StopandWait.html#a30fade0856056bba97e3a5db61c15ced">config_</a>.<a class="code hl_variable" href="structStopandWaitConfig.html#ae028cbbe5066f0c0a70f877188a739c4">accel_limit_multiplier</a>;</div>
<div class="line"><a id="l00250" name="l00250"></a><span class="lineno">  250</span>  <span class="keywordtype">double</span> req_dist = (starting_speed * starting_speed) /</div>
<div class="line"><a id="l00251" name="l00251"></a><span class="lineno">  251</span>                    (2.0 * target_accel);  <span class="comment">// Distance needed to go from current speed to 0 at target accel</span></div>
<div class="line"><a id="l00252" name="l00252"></a><span class="lineno">  252</span> </div>
<div class="line"><a id="l00253" name="l00253"></a><span class="lineno">  253</span>  <span class="comment">// In cases where the vehicle is not able to stop before the half_stopping_buffer the remaining distance becomes negative</span></div>
<div class="line"><a id="l00254" name="l00254"></a><span class="lineno">  254</span>  <span class="comment">// which will cause the target accel in this loop to be negative and make the vehicle speed up</span></div>
<div class="line"><a id="l00255" name="l00255"></a><span class="lineno">  255</span>  <span class="keywordflow">while</span> (remaining_distance &lt;= 0.0)</div>
<div class="line"><a id="l00256" name="l00256"></a><span class="lineno">  256</span>  {</div>
<div class="line"><a id="l00257" name="l00257"></a><span class="lineno">  257</span>    <span class="keywordflow">if</span>(remaining_distance &lt;= (stop_location - starting_downtrack))</div>
<div class="line"><a id="l00258" name="l00258"></a><span class="lineno">  258</span>    {</div>
<div class="line"><a id="l00259" name="l00259"></a><span class="lineno">  259</span>    <span class="comment">//Add additional distance to remaining to allow vehicle to stop within buffer</span></div>
<div class="line"><a id="l00260" name="l00260"></a><span class="lineno">  260</span>      remaining_distance += 0.2;</div>
<div class="line"><a id="l00261" name="l00261"></a><span class="lineno">  261</span>    }</div>
<div class="line"><a id="l00262" name="l00262"></a><span class="lineno">  262</span>    <span class="keywordflow">else</span>{</div>
<div class="line"><a id="l00263" name="l00263"></a><span class="lineno">  263</span>     <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00264" name="l00264"></a><span class="lineno">  264</span>   }</div>
<div class="line"><a id="l00265" name="l00265"></a><span class="lineno">  265</span>  }</div>
<div class="line"><a id="l00266" name="l00266"></a><span class="lineno">  266</span> </div>
<div class="line"><a id="l00267" name="l00267"></a><span class="lineno">  267</span>  <span class="keywordflow">if</span> (req_dist &gt; remaining_distance)</div>
<div class="line"><a id="l00268" name="l00268"></a><span class="lineno">  268</span>  {</div>
<div class="line"><a id="l00269" name="l00269"></a><span class="lineno">  269</span> </div>
<div class="line"><a id="l00270" name="l00270"></a><span class="lineno">  270</span>    RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<span class="stringliteral">&quot;stop_and_wait_plugin&quot;</span>),<span class="stringliteral">&quot;Target Accel Update From: &quot;</span> &lt;&lt; target_accel);</div>
<div class="line"><a id="l00271" name="l00271"></a><span class="lineno">  271</span>    target_accel =</div>
<div class="line"><a id="l00272" name="l00272"></a><span class="lineno">  272</span>        (starting_speed * starting_speed) / (2.0 * remaining_distance);  <span class="comment">// If we cannot reach the end point it the</span></div>
<div class="line"><a id="l00273" name="l00273"></a><span class="lineno">  273</span>                                                                         <span class="comment">// required distance update the accel target</span></div>
<div class="line"><a id="l00274" name="l00274"></a><span class="lineno">  274</span>    RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<span class="stringliteral">&quot;stop_and_wait_plugin&quot;</span>),<span class="stringliteral">&quot;Target Accel Update To: &quot;</span> &lt;&lt; target_accel);</div>
<div class="line"><a id="l00275" name="l00275"></a><span class="lineno">  275</span>  }</div>
<div class="line"><a id="l00276" name="l00276"></a><span class="lineno">  276</span> </div>
<div class="line"><a id="l00277" name="l00277"></a><span class="lineno">  277</span> </div>
<div class="line"><a id="l00278" name="l00278"></a><span class="lineno">  278</span>  std::vector&lt;double&gt; inverse_downtracks; <span class="comment">// Store downtracks in reverse</span></div>
<div class="line"><a id="l00279" name="l00279"></a><span class="lineno">  279</span>  inverse_downtracks.reserve(points.size());</div>
<div class="line"><a id="l00280" name="l00280"></a><span class="lineno">  280</span>  final_points.reserve(points.size());</div>
<div class="line"><a id="l00281" name="l00281"></a><span class="lineno">  281</span> </div>
<div class="line"><a id="l00282" name="l00282"></a><span class="lineno">  282</span>  <a class="code hl_struct" href="structstop__and__wait__plugin_1_1PointSpeedPair.html">PointSpeedPair</a> prev_pair = points.back();</div>
<div class="line"><a id="l00283" name="l00283"></a><span class="lineno">  283</span>  prev_pair.<a class="code hl_variable" href="structstop__and__wait__plugin_1_1PointSpeedPair.html#a61c3ee612840498ba6aea200ffeb75de">speed</a> = 0.0;</div>
<div class="line"><a id="l00284" name="l00284"></a><span class="lineno">  284</span>  final_points.push_back(prev_pair);  <span class="comment">// Store the points in reverse</span></div>
<div class="line"><a id="l00285" name="l00285"></a><span class="lineno">  285</span>  inverse_downtracks.push_back(0);</div>
<div class="line"><a id="l00286" name="l00286"></a><span class="lineno">  286</span> </div>
<div class="line"><a id="l00287" name="l00287"></a><span class="lineno">  287</span>  <span class="keywordtype">bool</span> reached_end = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00288" name="l00288"></a><span class="lineno">  288</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a> = points.size() - 2; <a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a> &gt;= 0; <a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>--)</div>
<div class="line"><a id="l00289" name="l00289"></a><span class="lineno">  289</span>  {  <span class="comment">// NOTE: Do not use size_t for i type here as -- with &gt; 0 will result in overflow</span></div>
<div class="line"><a id="l00290" name="l00290"></a><span class="lineno">  290</span> </div>
<div class="line"><a id="l00291" name="l00291"></a><span class="lineno">  291</span>    <span class="keywordtype">double</span> v_i = prev_pair.<a class="code hl_variable" href="structstop__and__wait__plugin_1_1PointSpeedPair.html#a61c3ee612840498ba6aea200ffeb75de">speed</a>;</div>
<div class="line"><a id="l00292" name="l00292"></a><span class="lineno">  292</span>    <span class="keywordtype">double</span> dx = lanelet::geometry::distance2d(prev_pair.<a class="code hl_variable" href="structstop__and__wait__plugin_1_1PointSpeedPair.html#a3d257f2cca23d430a1d2e9aba23bc4ad">point</a>, points[<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>].point);</div>
<div class="line"><a id="l00293" name="l00293"></a><span class="lineno">  293</span>    <span class="keywordtype">double</span> new_downtrack = inverse_downtracks.back() + dx;</div>
<div class="line"><a id="l00294" name="l00294"></a><span class="lineno">  294</span> </div>
<div class="line"><a id="l00295" name="l00295"></a><span class="lineno">  295</span>    <span class="keywordflow">if</span> (new_downtrack &lt; half_stopping_buffer) { <span class="comment">// Points after (when viewed not in reverse) the midpoint of the buffer should be 0 speed</span></div>
<div class="line"><a id="l00296" name="l00296"></a><span class="lineno">  296</span>      <a class="code hl_struct" href="structstop__and__wait__plugin_1_1PointSpeedPair.html">PointSpeedPair</a> pair = points[<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>];</div>
<div class="line"><a id="l00297" name="l00297"></a><span class="lineno">  297</span>      pair.<a class="code hl_variable" href="structstop__and__wait__plugin_1_1PointSpeedPair.html#a61c3ee612840498ba6aea200ffeb75de">speed</a> = 0;</div>
<div class="line"><a id="l00298" name="l00298"></a><span class="lineno">  298</span>      final_points.push_back(pair);  <span class="comment">// Store the points in reverse</span></div>
<div class="line"><a id="l00299" name="l00299"></a><span class="lineno">  299</span>      inverse_downtracks.push_back(new_downtrack);</div>
<div class="line"><a id="l00300" name="l00300"></a><span class="lineno">  300</span>      prev_pair = pair;</div>
<div class="line"><a id="l00301" name="l00301"></a><span class="lineno">  301</span>      <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00302" name="l00302"></a><span class="lineno">  302</span>    }</div>
<div class="line"><a id="l00303" name="l00303"></a><span class="lineno">  303</span> </div>
<div class="line"><a id="l00304" name="l00304"></a><span class="lineno">  304</span>    <span class="keywordflow">if</span> (reached_end || v_i &gt;= starting_speed)</div>
<div class="line"><a id="l00305" name="l00305"></a><span class="lineno">  305</span>    {  <span class="comment">// We are walking backward, so if the prev speed is greater than or equal to the starting speed then we are done</span></div>
<div class="line"><a id="l00306" name="l00306"></a><span class="lineno">  306</span>       <span class="comment">// backtracking</span></div>
<div class="line"><a id="l00307" name="l00307"></a><span class="lineno">  307</span>      reached_end = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00308" name="l00308"></a><span class="lineno">  308</span>      <a class="code hl_struct" href="structstop__and__wait__plugin_1_1PointSpeedPair.html">PointSpeedPair</a> pair = points[<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>];</div>
<div class="line"><a id="l00309" name="l00309"></a><span class="lineno">  309</span>      pair.<a class="code hl_variable" href="structstop__and__wait__plugin_1_1PointSpeedPair.html#a61c3ee612840498ba6aea200ffeb75de">speed</a> = starting_speed;</div>
<div class="line"><a id="l00310" name="l00310"></a><span class="lineno">  310</span>      final_points.push_back(pair);  <span class="comment">// Store the points in reverse</span></div>
<div class="line"><a id="l00311" name="l00311"></a><span class="lineno">  311</span>      inverse_downtracks.push_back(new_downtrack);</div>
<div class="line"><a id="l00312" name="l00312"></a><span class="lineno">  312</span>      prev_pair = pair;</div>
<div class="line"><a id="l00313" name="l00313"></a><span class="lineno">  313</span>      <span class="keywordflow">continue</span>;  <span class="comment">// continue until loop end</span></div>
<div class="line"><a id="l00314" name="l00314"></a><span class="lineno">  314</span>    }</div>
<div class="line"><a id="l00315" name="l00315"></a><span class="lineno">  315</span> </div>
<div class="line"><a id="l00316" name="l00316"></a><span class="lineno">  316</span>    <span class="keywordtype">double</span> v_f = sqrt(v_i * v_i + 2 * target_accel * dx);</div>
<div class="line"><a id="l00317" name="l00317"></a><span class="lineno">  317</span> </div>
<div class="line"><a id="l00318" name="l00318"></a><span class="lineno">  318</span>    <a class="code hl_struct" href="structstop__and__wait__plugin_1_1PointSpeedPair.html">PointSpeedPair</a> pair = points[<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>];</div>
<div class="line"><a id="l00319" name="l00319"></a><span class="lineno">  319</span>    pair.<a class="code hl_variable" href="structstop__and__wait__plugin_1_1PointSpeedPair.html#a61c3ee612840498ba6aea200ffeb75de">speed</a> = std::min(v_f, starting_speed);</div>
<div class="line"><a id="l00320" name="l00320"></a><span class="lineno">  320</span>    final_points.push_back(pair);  <span class="comment">// Store the points in reverse</span></div>
<div class="line"><a id="l00321" name="l00321"></a><span class="lineno">  321</span>    inverse_downtracks.push_back(new_downtrack);</div>
<div class="line"><a id="l00322" name="l00322"></a><span class="lineno">  322</span> </div>
<div class="line"><a id="l00323" name="l00323"></a><span class="lineno">  323</span>    prev_pair = pair;</div>
<div class="line"><a id="l00324" name="l00324"></a><span class="lineno">  324</span>  }</div>
<div class="line"><a id="l00325" name="l00325"></a><span class="lineno">  325</span> </div>
<div class="line"><a id="l00326" name="l00326"></a><span class="lineno">  326</span>  <span class="comment">// Now we have a trajectory that decelerates from our end point to somewhere in the maneuver</span></div>
<div class="line"><a id="l00327" name="l00327"></a><span class="lineno">  327</span>  std::reverse(final_points.begin(),</div>
<div class="line"><a id="l00328" name="l00328"></a><span class="lineno">  328</span>               final_points.end());</div>
<div class="line"><a id="l00329" name="l00329"></a><span class="lineno">  329</span> </div>
<div class="line"><a id="l00330" name="l00330"></a><span class="lineno">  330</span>  std::vector&lt;double&gt; speeds;</div>
<div class="line"><a id="l00331" name="l00331"></a><span class="lineno">  331</span>  std::vector&lt;lanelet::BasicPoint2d&gt; raw_points;</div>
<div class="line"><a id="l00332" name="l00332"></a><span class="lineno">  332</span>  <a class="code hl_function" href="classstop__and__wait__plugin_1_1StopandWait.html#a8dc5745955f3c287e4217b20359eb771">splitPointSpeedPairs</a>(final_points, &amp;raw_points, &amp;speeds);</div>
<div class="line"><a id="l00333" name="l00333"></a><span class="lineno">  333</span> </div>
<div class="line"><a id="l00334" name="l00334"></a><span class="lineno">  334</span>  <span class="comment">// Convert the inverted downtracks back to regular downtracks</span></div>
<div class="line"><a id="l00335" name="l00335"></a><span class="lineno">  335</span>  <span class="keywordtype">double</span> max_downtrack = inverse_downtracks.back();</div>
<div class="line"><a id="l00336" name="l00336"></a><span class="lineno">  336</span>  std::vector&lt;double&gt; downtracks = lanelet::utils::transform(inverse_downtracks, [max_downtrack](<span class="keyword">const</span> <span class="keyword">auto</span>&amp; d) { <span class="keywordflow">return</span> max_downtrack - d; });</div>
<div class="line"><a id="l00337" name="l00337"></a><span class="lineno">  337</span>  std::reverse(downtracks.begin(),</div>
<div class="line"><a id="l00338" name="l00338"></a><span class="lineno">  338</span>               downtracks.end());</div>
<div class="line"><a id="l00339" name="l00339"></a><span class="lineno">  339</span> </div>
<div class="line"><a id="l00340" name="l00340"></a><span class="lineno">  340</span>  <span class="keywordtype">bool</span> in_range = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00341" name="l00341"></a><span class="lineno">  341</span>  <span class="keywordtype">double</span> stopped_downtrack = 0;</div>
<div class="line"><a id="l00342" name="l00342"></a><span class="lineno">  342</span>  lanelet::BasicPoint2d stopped_point;</div>
<div class="line"><a id="l00343" name="l00343"></a><span class="lineno">  343</span> </div>
<div class="line"><a id="l00344" name="l00344"></a><span class="lineno">  344</span>  <span class="keywordtype">bool</span> vehicle_in_buffer = downtracks.back() &lt; stop_location_buffer;</div>
<div class="line"><a id="l00345" name="l00345"></a><span class="lineno">  345</span> </div>
<div class="line"><a id="l00346" name="l00346"></a><span class="lineno">  346</span>  std::vector&lt;double&gt; filtered_speeds = <a class="code hl_function" href="namespacebasic__autonomy_1_1smoothing.html#afb726e75a21ada8efa3ca5561ffc9984">basic_autonomy::smoothing::moving_average_filter</a>(speeds, <a class="code hl_variable" href="classstop__and__wait__plugin_1_1StopandWait.html#a30fade0856056bba97e3a5db61c15ced">config_</a>.<a class="code hl_variable" href="structStopandWaitConfig.html#af830ceb9940a67c70d3283b186a1c68c">moving_average_window_size</a>);</div>
<div class="line"><a id="l00347" name="l00347"></a><span class="lineno">  347</span> </div>
<div class="line"><a id="l00348" name="l00348"></a><span class="lineno">  348</span>  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a> = 0; <a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a> &lt; filtered_speeds.size(); <a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>++)</div>
<div class="line"><a id="l00349" name="l00349"></a><span class="lineno">  349</span>  {  <span class="comment">// Apply minimum speed constraint</span></div>
<div class="line"><a id="l00350" name="l00350"></a><span class="lineno">  350</span>    <span class="keywordtype">double</span> downtrack = downtracks[<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>];</div>
<div class="line"><a id="l00351" name="l00351"></a><span class="lineno">  351</span> </div>
<div class="line"><a id="l00352" name="l00352"></a><span class="lineno">  352</span>    <span class="keyword">constexpr</span> <span class="keywordtype">double</span> one_mph_in_mps = 0.44704;</div>
<div class="line"><a id="l00353" name="l00353"></a><span class="lineno">  353</span> </div>
<div class="line"><a id="l00354" name="l00354"></a><span class="lineno">  354</span>    <span class="keywordflow">if</span> (downtracks.back() - downtrack &lt; stop_location_buffer &amp;&amp; filtered_speeds[<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>] &lt; <a class="code hl_variable" href="classstop__and__wait__plugin_1_1StopandWait.html#a30fade0856056bba97e3a5db61c15ced">config_</a>.<a class="code hl_variable" href="structStopandWaitConfig.html#a583803dc91f20ed0dc9584fb4f416cb3">crawl_speed</a> + one_mph_in_mps)</div>
<div class="line"><a id="l00355" name="l00355"></a><span class="lineno">  355</span>    {  <span class="comment">// if we are within the stopping buffer and going at near crawl speed then command stop</span></div>
<div class="line"><a id="l00356" name="l00356"></a><span class="lineno">  356</span> </div>
<div class="line"><a id="l00357" name="l00357"></a><span class="lineno">  357</span>      <span class="comment">// To avoid any issues in control plugin behavior we only command 0 if the vehicle is inside the buffer</span></div>
<div class="line"><a id="l00358" name="l00358"></a><span class="lineno">  358</span>      <span class="keywordflow">if</span> (vehicle_in_buffer || (<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a> == filtered_speeds.size() - 1)) { <span class="comment">// Vehicle is in the buffer</span></div>
<div class="line"><a id="l00359" name="l00359"></a><span class="lineno">  359</span>        filtered_speeds[<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>] = 0.0;</div>
<div class="line"><a id="l00360" name="l00360"></a><span class="lineno">  360</span>      } <span class="keywordflow">else</span> { <span class="comment">// Vehicle is not in the buffer so fill buffer with crawl speed</span></div>
<div class="line"><a id="l00361" name="l00361"></a><span class="lineno">  361</span>        filtered_speeds[<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>] = std::max(filtered_speeds[<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>], <a class="code hl_variable" href="classstop__and__wait__plugin_1_1StopandWait.html#a30fade0856056bba97e3a5db61c15ced">config_</a>.<a class="code hl_variable" href="structStopandWaitConfig.html#a583803dc91f20ed0dc9584fb4f416cb3">crawl_speed</a>);</div>
<div class="line"><a id="l00362" name="l00362"></a><span class="lineno">  362</span>      }</div>
<div class="line"><a id="l00363" name="l00363"></a><span class="lineno">  363</span> </div>
<div class="line"><a id="l00364" name="l00364"></a><span class="lineno">  364</span>    }</div>
<div class="line"><a id="l00365" name="l00365"></a><span class="lineno">  365</span>    <span class="keywordflow">else</span></div>
<div class="line"><a id="l00366" name="l00366"></a><span class="lineno">  366</span>    {</div>
<div class="line"><a id="l00367" name="l00367"></a><span class="lineno">  367</span>      filtered_speeds[<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>] = std::max(filtered_speeds[<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>], <a class="code hl_variable" href="classstop__and__wait__plugin_1_1StopandWait.html#a30fade0856056bba97e3a5db61c15ced">config_</a>.<a class="code hl_variable" href="structStopandWaitConfig.html#a583803dc91f20ed0dc9584fb4f416cb3">crawl_speed</a>);</div>
<div class="line"><a id="l00368" name="l00368"></a><span class="lineno">  368</span>    }</div>
<div class="line"><a id="l00369" name="l00369"></a><span class="lineno">  369</span>  }</div>
<div class="line"><a id="l00370" name="l00370"></a><span class="lineno">  370</span> </div>
<div class="line"><a id="l00371" name="l00371"></a><span class="lineno">  371</span>  std::vector&lt;double&gt; times;</div>
<div class="line"><a id="l00372" name="l00372"></a><span class="lineno">  372</span>  trajectory_utils::conversions::speed_to_time(downtracks, filtered_speeds, &amp;times);</div>
<div class="line"><a id="l00373" name="l00373"></a><span class="lineno">  373</span> </div>
<div class="line"><a id="l00374" name="l00374"></a><span class="lineno">  374</span>  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a> = 0; <a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a> &lt; times.size(); <a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>++)</div>
<div class="line"><a id="l00375" name="l00375"></a><span class="lineno">  375</span>  {</div>
<div class="line"><a id="l00376" name="l00376"></a><span class="lineno">  376</span>    <span class="keywordflow">if</span> (times[<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>] != 0 &amp;&amp; !std::isnormal(times[<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>]) &amp;&amp; <a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a> != 0)</div>
<div class="line"><a id="l00377" name="l00377"></a><span class="lineno">  377</span>    {  <span class="comment">// If the time</span></div>
<div class="line"><a id="l00378" name="l00378"></a><span class="lineno">  378</span>      RCLCPP_WARN_STREAM(rclcpp::get_logger(<span class="stringliteral">&quot;stop_and_wait_plugin&quot;</span>),<span class="stringliteral">&quot;Detected non-normal (nan, inf, etc.) time. Making it same as before: &quot;</span> &lt;&lt; times[<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>-1]);</div>
<div class="line"><a id="l00379" name="l00379"></a><span class="lineno">  379</span>      <span class="comment">// NOTE: overriding the timestamps in assumption that pure_pursuit_wrapper will detect it as stopping case</span></div>
<div class="line"><a id="l00380" name="l00380"></a><span class="lineno">  380</span>      times[<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>] = times[<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a> - 1];</div>
<div class="line"><a id="l00381" name="l00381"></a><span class="lineno">  381</span>    }</div>
<div class="line"><a id="l00382" name="l00382"></a><span class="lineno">  382</span>  }</div>
<div class="line"><a id="l00383" name="l00383"></a><span class="lineno">  383</span> </div>
<div class="line"><a id="l00384" name="l00384"></a><span class="lineno">  384</span>  std::vector&lt;double&gt; yaws = <a class="code hl_function" href="namespacecarma__wm_1_1geometry.html#ad8a3ee0bf06f85a6e7a8b5097251da2b">carma_wm::geometry::compute_tangent_orientations</a>(raw_points);</div>
<div class="line"><a id="l00385" name="l00385"></a><span class="lineno">  385</span> </div>
<div class="line"><a id="l00386" name="l00386"></a><span class="lineno">  386</span>  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a> = 0; <a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a> &lt; points.size(); <a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>++)</div>
<div class="line"><a id="l00387" name="l00387"></a><span class="lineno">  387</span>  {</div>
<div class="line"><a id="l00388" name="l00388"></a><span class="lineno">  388</span>    RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<span class="stringliteral">&quot;stop_and_wait_plugin&quot;</span>),<span class="stringliteral">&quot;1d: &quot;</span> &lt;&lt; downtracks[<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>] &lt;&lt; <span class="stringliteral">&quot; t: &quot;</span> &lt;&lt; times[<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>] &lt;&lt; <span class="stringliteral">&quot; v: &quot;</span> &lt;&lt; filtered_speeds[<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>]);</div>
<div class="line"><a id="l00389" name="l00389"></a><span class="lineno">  389</span>  }</div>
<div class="line"><a id="l00390" name="l00390"></a><span class="lineno">  390</span> </div>
<div class="line"><a id="l00391" name="l00391"></a><span class="lineno">  391</span>  <span class="keyword">auto</span> traj = <a class="code hl_function" href="classstop__and__wait__plugin_1_1StopandWait.html#afda81ce6bf1b8913bad9f071b7881790">trajectory_from_points_times_orientations</a>(raw_points, times, yaws, start_time);</div>
<div class="line"><a id="l00392" name="l00392"></a><span class="lineno">  392</span> </div>
<div class="line"><a id="l00393" name="l00393"></a><span class="lineno">  393</span>  <span class="keywordflow">while</span> (rclcpp::Time(traj.back().target_time) - rclcpp::Time(traj.front().target_time) &lt; rclcpp::Duration(<a class="code hl_variable" href="classstop__and__wait__plugin_1_1StopandWait.html#a30fade0856056bba97e3a5db61c15ced">config_</a>.<a class="code hl_variable" href="structStopandWaitConfig.html#ae1af2b1d26f072bf494c62634514f3e7">minimal_trajectory_duration</a> * 1e9))</div>
<div class="line"><a id="l00394" name="l00394"></a><span class="lineno">  394</span>  {</div>
<div class="line"><a id="l00395" name="l00395"></a><span class="lineno">  395</span>    carma_planning_msgs::msg::TrajectoryPlanPoint new_point = traj.back();</div>
<div class="line"><a id="l00396" name="l00396"></a><span class="lineno">  396</span>    new_point.target_time = rclcpp::Time(new_point.target_time) + rclcpp::Duration(<a class="code hl_variable" href="classstop__and__wait__plugin_1_1StopandWait.html#a30fade0856056bba97e3a5db61c15ced">config_</a>.<a class="code hl_variable" href="structStopandWaitConfig.html#af15c8b21219680d90ce427c056542ba5">stop_timestep</a> * 1e9);</div>
<div class="line"><a id="l00397" name="l00397"></a><span class="lineno">  397</span>    new_point.planner_plugin_name = <a class="code hl_variable" href="classstop__and__wait__plugin_1_1StopandWait.html#a64d6b1a64dc7e3fc03e39b6f1d7225e3">plugin_name_</a>;</div>
<div class="line"><a id="l00398" name="l00398"></a><span class="lineno">  398</span>    traj.push_back(new_point);</div>
<div class="line"><a id="l00399" name="l00399"></a><span class="lineno">  399</span>  }</div>
<div class="line"><a id="l00400" name="l00400"></a><span class="lineno">  400</span> </div>
<div class="line"><a id="l00401" name="l00401"></a><span class="lineno">  401</span>  <span class="keywordflow">if</span> (!filtered_speeds.empty())</div>
<div class="line"><a id="l00402" name="l00402"></a><span class="lineno">  402</span>    initial_speed = filtered_speeds.front(); <span class="comment">//modify initial_speed variable passed by reference</span></div>
<div class="line"><a id="l00403" name="l00403"></a><span class="lineno">  403</span> </div>
<div class="line"><a id="l00404" name="l00404"></a><span class="lineno">  404</span>  <span class="keywordflow">return</span> traj;</div>
<div class="line"><a id="l00405" name="l00405"></a><span class="lineno">  405</span>}</div>
<div class="line"><a id="l00406" name="l00406"></a><span class="lineno">  406</span> </div>
<div class="line"><a id="l00407" name="l00407"></a><span class="lineno"><a class="line" href="classstop__and__wait__plugin_1_1StopandWait.html#a8dc5745955f3c287e4217b20359eb771">  407</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classstop__and__wait__plugin_1_1StopandWait.html#a8dc5745955f3c287e4217b20359eb771">StopandWait::splitPointSpeedPairs</a>(<span class="keyword">const</span> std::vector&lt;PointSpeedPair&gt;&amp; points,</div>
<div class="line"><a id="l00408" name="l00408"></a><span class="lineno">  408</span>                                       std::vector&lt;lanelet::BasicPoint2d&gt;* basic_points,</div>
<div class="line"><a id="l00409" name="l00409"></a><span class="lineno">  409</span>                                       std::vector&lt;double&gt;* speeds)<span class="keyword"> const</span></div>
<div class="line"><a id="l00410" name="l00410"></a><span class="lineno">  410</span><span class="keyword"></span>{</div>
<div class="line"><a id="l00411" name="l00411"></a><span class="lineno">  411</span>  basic_points-&gt;reserve(points.size());</div>
<div class="line"><a id="l00412" name="l00412"></a><span class="lineno">  412</span>  speeds-&gt;reserve(points.size());</div>
<div class="line"><a id="l00413" name="l00413"></a><span class="lineno">  413</span> </div>
<div class="line"><a id="l00414" name="l00414"></a><span class="lineno">  414</span>  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; p : points)</div>
<div class="line"><a id="l00415" name="l00415"></a><span class="lineno">  415</span>  {</div>
<div class="line"><a id="l00416" name="l00416"></a><span class="lineno">  416</span>    basic_points-&gt;push_back(p.point);</div>
<div class="line"><a id="l00417" name="l00417"></a><span class="lineno">  417</span>    speeds-&gt;push_back(p.speed);</div>
<div class="line"><a id="l00418" name="l00418"></a><span class="lineno">  418</span>  }</div>
<div class="line"><a id="l00419" name="l00419"></a><span class="lineno">  419</span>}</div>
<div class="line"><a id="l00420" name="l00420"></a><span class="lineno">  420</span> </div>
<div class="line"><a id="l00421" name="l00421"></a><span class="lineno"><a class="line" href="classstop__and__wait__plugin_1_1StopandWait.html#a8ed86cd434da4834a9beab21e16ba1a1">  421</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classstop__and__wait__plugin_1_1StopandWait.html#a8ed86cd434da4834a9beab21e16ba1a1">StopandWait::set_yield_client</a>(carma_ros2_utils::ClientPtr&lt;carma_planning_msgs::srv::PlanTrajectory&gt; client)</div>
<div class="line"><a id="l00422" name="l00422"></a><span class="lineno">  422</span>{</div>
<div class="line"><a id="l00423" name="l00423"></a><span class="lineno">  423</span>  <a class="code hl_variable" href="classstop__and__wait__plugin_1_1StopandWait.html#af81018d8babdb47605aacb5f819a37c0">yield_client_</a> = client;</div>
<div class="line"><a id="l00424" name="l00424"></a><span class="lineno">  424</span>}</div>
<div class="line"><a id="l00425" name="l00425"></a><span class="lineno">  425</span> </div>
<div class="line"><a id="l00426" name="l00426"></a><span class="lineno">  426</span>}  <span class="comment">// namespace stop_and_wait_plugin</span></div>
<div class="ttc" id="aCARMAWorldModel_8hpp_html"><div class="ttname"><a href="CARMAWorldModel_8hpp.html">CARMAWorldModel.hpp</a></div></div>
<div class="ttc" id="aGeometry_8hpp_html"><div class="ttname"><a href="Geometry_8hpp.html">Geometry.hpp</a></div></div>
<div class="ttc" id="aclassstop__and__wait__plugin_1_1StopandWait_html_a2346402ff858040dbc850412cf1fedab"><div class="ttname"><a href="classstop__and__wait__plugin_1_1StopandWait.html#a2346402ff858040dbc850412cf1fedab">stop_and_wait_plugin::StopandWait::wm_</a></div><div class="ttdeci">carma_wm::WorldModelConstPtr wm_</div><div class="ttdef"><b>Definition:</b> <a href="stop__and__wait__plugin_8hpp_source.html#l00126">stop_and_wait_plugin.hpp:126</a></div></div>
<div class="ttc" id="aclassstop__and__wait__plugin_1_1StopandWait_html_a30fade0856056bba97e3a5db61c15ced"><div class="ttname"><a href="classstop__and__wait__plugin_1_1StopandWait.html#a30fade0856056bba97e3a5db61c15ced">stop_and_wait_plugin::StopandWait::config_</a></div><div class="ttdeci">StopandWaitConfig config_</div><div class="ttdef"><b>Definition:</b> <a href="stop__and__wait__plugin_8hpp_source.html#l00127">stop_and_wait_plugin.hpp:127</a></div></div>
<div class="ttc" id="aclassstop__and__wait__plugin_1_1StopandWait_html_a64d6b1a64dc7e3fc03e39b6f1d7225e3"><div class="ttname"><a href="classstop__and__wait__plugin_1_1StopandWait.html#a64d6b1a64dc7e3fc03e39b6f1d7225e3">stop_and_wait_plugin::StopandWait::plugin_name_</a></div><div class="ttdeci">std::string plugin_name_</div><div class="ttdef"><b>Definition:</b> <a href="stop__and__wait__plugin_8hpp_source.html#l00124">stop_and_wait_plugin.hpp:124</a></div></div>
<div class="ttc" id="aclassstop__and__wait__plugin_1_1StopandWait_html_a85799673152ebcc839e30f3c4a7cc6f8"><div class="ttname"><a href="classstop__and__wait__plugin_1_1StopandWait.html#a85799673152ebcc839e30f3c4a7cc6f8">stop_and_wait_plugin::StopandWait::epsilon_</a></div><div class="ttdeci">double epsilon_</div><div class="ttdef"><b>Definition:</b> <a href="stop__and__wait__plugin_8hpp_source.html#l00121">stop_and_wait_plugin.hpp:121</a></div></div>
<div class="ttc" id="aclassstop__and__wait__plugin_1_1StopandWait_html_a8dc5745955f3c287e4217b20359eb771"><div class="ttname"><a href="classstop__and__wait__plugin_1_1StopandWait.html#a8dc5745955f3c287e4217b20359eb771">stop_and_wait_plugin::StopandWait::splitPointSpeedPairs</a></div><div class="ttdeci">void splitPointSpeedPairs(const std::vector&lt; PointSpeedPair &gt; &amp;points, std::vector&lt; lanelet::BasicPoint2d &gt; *basic_points, std::vector&lt; double &gt; *speeds) const</div><div class="ttdoc">Helper method to split a list of PointSpeedPair into separate point and speed lists.</div><div class="ttdef"><b>Definition:</b> <a href="stop__and__wait__plugin_8cpp_source.html#l00407">stop_and_wait_plugin.cpp:407</a></div></div>
<div class="ttc" id="aclassstop__and__wait__plugin_1_1StopandWait_html_a8ed86cd434da4834a9beab21e16ba1a1"><div class="ttname"><a href="classstop__and__wait__plugin_1_1StopandWait.html#a8ed86cd434da4834a9beab21e16ba1a1">stop_and_wait_plugin::StopandWait::set_yield_client</a></div><div class="ttdeci">void set_yield_client(carma_ros2_utils::ClientPtr&lt; carma_planning_msgs::srv::PlanTrajectory &gt; client)</div><div class="ttdoc">set the yield service</div><div class="ttdef"><b>Definition:</b> <a href="stop__and__wait__plugin_8cpp_source.html#l00421">stop_and_wait_plugin.cpp:421</a></div></div>
<div class="ttc" id="aclassstop__and__wait__plugin_1_1StopandWait_html_aa9627181b624dc0e6c96ea2255bdf062"><div class="ttname"><a href="classstop__and__wait__plugin_1_1StopandWait.html#aa9627181b624dc0e6c96ea2255bdf062">stop_and_wait_plugin::StopandWait::maneuvers_to_points</a></div><div class="ttdeci">std::vector&lt; PointSpeedPair &gt; maneuvers_to_points(const std::vector&lt; carma_planning_msgs::msg::Maneuver &gt; &amp;maneuvers, const carma_wm::WorldModelConstPtr &amp;wm, const carma_planning_msgs::msg::VehicleState &amp;state)</div><div class="ttdoc">Converts a set of requested STOP_AND_WAIT maneuvers to point speed limit pairs.</div><div class="ttdef"><b>Definition:</b> <a href="stop__and__wait__plugin_8cpp_source.html#l00169">stop_and_wait_plugin.cpp:169</a></div></div>
<div class="ttc" id="aclassstop__and__wait__plugin_1_1StopandWait_html_aacfe3c82e0d7cc47a27c67f7b9f4b83e"><div class="ttname"><a href="classstop__and__wait__plugin_1_1StopandWait.html#aacfe3c82e0d7cc47a27c67f7b9f4b83e">stop_and_wait_plugin::StopandWait::plan_trajectory_cb</a></div><div class="ttdeci">bool plan_trajectory_cb(carma_planning_msgs::srv::PlanTrajectory::Request::SharedPtr req, carma_planning_msgs::srv::PlanTrajectory::Response::SharedPtr resp)</div><div class="ttdoc">Service callback for trajectory planning.</div><div class="ttdef"><b>Definition:</b> <a href="stop__and__wait__plugin_8cpp_source.html#l00059">stop_and_wait_plugin.cpp:59</a></div></div>
<div class="ttc" id="aclassstop__and__wait__plugin_1_1StopandWait_html_ad80a802e059ba3e8a458eb53c0093a0b"><div class="ttname"><a href="classstop__and__wait__plugin_1_1StopandWait.html#ad80a802e059ba3e8a458eb53c0093a0b">stop_and_wait_plugin::StopandWait::compose_trajectory_from_centerline</a></div><div class="ttdeci">std::vector&lt; carma_planning_msgs::msg::TrajectoryPlanPoint &gt; compose_trajectory_from_centerline(const std::vector&lt; PointSpeedPair &gt; &amp;points, double starting_downtrack, double starting_speed, double stop_location, double stop_location_buffer, rclcpp::Time start_time, double stopping_acceleration, double &amp;initial_speed)</div><div class="ttdoc">Method converts a list of lanelet centerline points and current vehicle state into a usable list of t...</div><div class="ttdef"><b>Definition:</b> <a href="stop__and__wait__plugin_8cpp_source.html#l00233">stop_and_wait_plugin.cpp:233</a></div></div>
<div class="ttc" id="aclassstop__and__wait__plugin_1_1StopandWait_html_ae46b43c4b94d00c259c1fcd370cdb09a"><div class="ttname"><a href="classstop__and__wait__plugin_1_1StopandWait.html#ae46b43c4b94d00c259c1fcd370cdb09a">stop_and_wait_plugin::StopandWait::StopandWait</a></div><div class="ttdeci">StopandWait(std::shared_ptr&lt; carma_ros2_utils::CarmaLifecycleNode &gt; nh, carma_wm::WorldModelConstPtr wm, const StopandWaitConfig &amp;config, const std::string &amp;plugin_name, const std::string &amp;version_id)</div><div class="ttdoc">Constructor.</div><div class="ttdef"><b>Definition:</b> <a href="stop__and__wait__plugin_8cpp_source.html#l00051">stop_and_wait_plugin.cpp:51</a></div></div>
<div class="ttc" id="aclassstop__and__wait__plugin_1_1StopandWait_html_af3e2cab6d9967d86936e4f47caa37008"><div class="ttname"><a href="classstop__and__wait__plugin_1_1StopandWait.html#af3e2cab6d9967d86936e4f47caa37008">stop_and_wait_plugin::StopandWait::nh_</a></div><div class="ttdeci">std::shared_ptr&lt; carma_ros2_utils::CarmaLifecycleNode &gt; nh_</div><div class="ttdef"><b>Definition:</b> <a href="stop__and__wait__plugin_8hpp_source.html#l00128">stop_and_wait_plugin.hpp:128</a></div></div>
<div class="ttc" id="aclassstop__and__wait__plugin_1_1StopandWait_html_af81018d8babdb47605aacb5f819a37c0"><div class="ttname"><a href="classstop__and__wait__plugin_1_1StopandWait.html#af81018d8babdb47605aacb5f819a37c0">stop_and_wait_plugin::StopandWait::yield_client_</a></div><div class="ttdeci">carma_ros2_utils::ClientPtr&lt; carma_planning_msgs::srv::PlanTrajectory &gt; yield_client_</div><div class="ttdef"><b>Definition:</b> <a href="stop__and__wait__plugin_8hpp_source.html#l00130">stop_and_wait_plugin.hpp:130</a></div></div>
<div class="ttc" id="aclassstop__and__wait__plugin_1_1StopandWait_html_afda81ce6bf1b8913bad9f071b7881790"><div class="ttname"><a href="classstop__and__wait__plugin_1_1StopandWait.html#afda81ce6bf1b8913bad9f071b7881790">stop_and_wait_plugin::StopandWait::trajectory_from_points_times_orientations</a></div><div class="ttdeci">std::vector&lt; carma_planning_msgs::msg::TrajectoryPlanPoint &gt; trajectory_from_points_times_orientations(const std::vector&lt; lanelet::BasicPoint2d &gt; &amp;points, const std::vector&lt; double &gt; &amp;times, const std::vector&lt; double &gt; &amp;yaws, rclcpp::Time startTime)</div><div class="ttdef"><b>Definition:</b> <a href="stop__and__wait__plugin_8cpp_source.html#l00204">stop_and_wait_plugin.cpp:204</a></div></div>
<div class="ttc" id="ainlanecruising__plugin_8cpp_html_a8212f1302ee6736745dc97bb5b3caaf5"><div class="ttname"><a href="inlanecruising__plugin_8cpp.html#a8212f1302ee6736745dc97bb5b3caaf5">oss</a></div><div class="ttdeci">std::ostringstream oss</div><div class="ttdef"><b>Definition:</b> <a href="inlanecruising__plugin_8cpp_source.html#l00036">inlanecruising_plugin.cpp:36</a></div></div>
<div class="ttc" id="anamespacebasic__autonomy_1_1smoothing_html_afb726e75a21ada8efa3ca5561ffc9984"><div class="ttname"><a href="namespacebasic__autonomy_1_1smoothing.html#afb726e75a21ada8efa3ca5561ffc9984">basic_autonomy::smoothing::moving_average_filter</a></div><div class="ttdeci">std::vector&lt; double &gt; moving_average_filter(const std::vector&lt; double &gt; input, int window_size, bool ignore_first_point=true)</div><div class="ttdoc">Extremely simplie moving average filter.</div><div class="ttdef"><b>Definition:</b> <a href="filters_8cpp_source.html#l00024">filters.cpp:24</a></div></div>
<div class="ttc" id="anamespacebasic__autonomy_1_1waypoint__generation_html_a2de71503d10ed9a644bafd31fd102081"><div class="ttname"><a href="namespacebasic__autonomy_1_1waypoint__generation.html#a2de71503d10ed9a644bafd31fd102081">basic_autonomy::waypoint_generation::modify_trajectory_to_yield_to_obstacles</a></div><div class="ttdeci">carma_planning_msgs::srv::PlanTrajectory::Response::SharedPtr modify_trajectory_to_yield_to_obstacles(const std::shared_ptr&lt; carma_ros2_utils::CarmaLifecycleNode &gt; &amp;node_handler, const carma_planning_msgs::srv::PlanTrajectory::Request::SharedPtr &amp;req, const carma_planning_msgs::srv::PlanTrajectory::Response::SharedPtr &amp;resp, const carma_ros2_utils::ClientPtr&lt; carma_planning_msgs::srv::PlanTrajectory &gt; &amp;yield_client, int yield_plugin_service_call_timeout)</div><div class="ttdoc">Applies a yield trajectory to the original trajectory set in response.</div><div class="ttdef"><b>Definition:</b> <a href="basic__autonomy_8cpp_source.html#l01338">basic_autonomy.cpp:1338</a></div></div>
<div class="ttc" id="anamespacecarma__cooperative__perception_html_a64b708654c8aecb09122d39577df31b5"><div class="ttname"><a href="namespacecarma__cooperative__perception.html#a64b708654c8aecb09122d39577df31b5">carma_cooperative_perception::to_string</a></div><div class="ttdeci">auto to_string(const UtmZone &amp;zone) -&gt; std::string</div><div class="ttdef"><b>Definition:</b> <a href="utm__zone_8cpp_source.html#l00021">utm_zone.cpp:21</a></div></div>
<div class="ttc" id="anamespacecarma__wm_1_1geometry_html_ad8a3ee0bf06f85a6e7a8b5097251da2b"><div class="ttname"><a href="namespacecarma__wm_1_1geometry.html#ad8a3ee0bf06f85a6e7a8b5097251da2b">carma_wm::geometry::compute_tangent_orientations</a></div><div class="ttdeci">std::vector&lt; double &gt; compute_tangent_orientations(const lanelet::BasicLineString2d &amp;centerline)</div><div class="ttdoc">Compute an approximate orientation for the vehicle at each point along the provided centerline.</div><div class="ttdef"><b>Definition:</b> <a href="Geometry_8cpp_source.html#l00559">Geometry.cpp:559</a></div></div>
<div class="ttc" id="anamespacecarma__wm_html_a3ac653959e0b6198cae274d68b343228"><div class="ttname"><a href="namespacecarma__wm.html#a3ac653959e0b6198cae274d68b343228">carma_wm::WorldModelConstPtr</a></div><div class="ttdeci">std::shared_ptr&lt; const WorldModel &gt; WorldModelConstPtr</div><div class="ttdef"><b>Definition:</b> <a href="WorldModel_8hpp_source.html#l00452">WorldModel.hpp:452</a></div></div>
<div class="ttc" id="anamespaceprocess__bag_html_af102a02c97622dd30b0dbf7bafb0d199"><div class="ttname"><a href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">process_bag.i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="process__bag_8py_source.html#l00059">process_bag.py:59</a></div></div>
<div class="ttc" id="anamespacespeedharm-cli_html_a979a8b66607cfccc604e46e7f199f9b6"><div class="ttname"><a href="namespacespeedharm-cli.html#a979a8b66607cfccc604e46e7f199f9b6">speedharm-cli.version_id</a></div><div class="ttdeci">string version_id</div><div class="ttdef"><b>Definition:</b> <a href="speedharm-cli_8py_source.html#l00028">speedharm-cli.py:28</a></div></div>
<div class="ttc" id="anamespacestop__and__wait__plugin_html"><div class="ttname"><a href="namespacestop__and__wait__plugin.html">stop_and_wait_plugin</a></div><div class="ttdef"><b>Definition:</b> <a href="stop__and__wait__node_8hpp_source.html#l00049">stop_and_wait_node.hpp:50</a></div></div>
<div class="ttc" id="astop__and__wait__plugin_8hpp_html"><div class="ttname"><a href="stop__and__wait__plugin_8hpp.html">stop_and_wait_plugin.hpp</a></div></div>
<div class="ttc" id="astructStopandWaitConfig_html"><div class="ttname"><a href="structStopandWaitConfig.html">StopandWaitConfig</a></div><div class="ttdoc">Stuct containing the algorithm configuration values for the stop_and_wait_plugin.</div><div class="ttdef"><b>Definition:</b> <a href="stop__and__wait__config_8hpp_source.html#l00024">stop_and_wait_config.hpp:25</a></div></div>
<div class="ttc" id="astructStopandWaitConfig_html_a583803dc91f20ed0dc9584fb4f416cb3"><div class="ttname"><a href="structStopandWaitConfig.html#a583803dc91f20ed0dc9584fb4f416cb3">StopandWaitConfig::crawl_speed</a></div><div class="ttdeci">double crawl_speed</div><div class="ttdef"><b>Definition:</b> <a href="stop__and__wait__config_8hpp_source.html#l00031">stop_and_wait_config.hpp:31</a></div></div>
<div class="ttc" id="astructStopandWaitConfig_html_a5da42279802aa5b76f2e0d152bc495ca"><div class="ttname"><a href="structStopandWaitConfig.html#a5da42279802aa5b76f2e0d152bc495ca">StopandWaitConfig::centerline_sampling_spacing</a></div><div class="ttdeci">double centerline_sampling_spacing</div><div class="ttdef"><b>Definition:</b> <a href="stop__and__wait__config_8hpp_source.html#l00032">stop_and_wait_config.hpp:32</a></div></div>
<div class="ttc" id="astructStopandWaitConfig_html_ab776cb8bf766ff9b05c43e033b78316f"><div class="ttname"><a href="structStopandWaitConfig.html#ab776cb8bf766ff9b05c43e033b78316f">StopandWaitConfig::enable_object_avoidance</a></div><div class="ttdeci">bool enable_object_avoidance</div><div class="ttdef"><b>Definition:</b> <a href="stop__and__wait__config_8hpp_source.html#l00036">stop_and_wait_config.hpp:36</a></div></div>
<div class="ttc" id="astructStopandWaitConfig_html_abde4d07c8db2f1a999c4af243bd8f396"><div class="ttname"><a href="structStopandWaitConfig.html#abde4d07c8db2f1a999c4af243bd8f396">StopandWaitConfig::tactical_plugin_service_call_timeout</a></div><div class="ttdeci">int tactical_plugin_service_call_timeout</div><div class="ttdef"><b>Definition:</b> <a href="stop__and__wait__config_8hpp_source.html#l00035">stop_and_wait_config.hpp:35</a></div></div>
<div class="ttc" id="astructStopandWaitConfig_html_aca43edbb1111fbf89bf99f7cbacd6796"><div class="ttname"><a href="structStopandWaitConfig.html#aca43edbb1111fbf89bf99f7cbacd6796">StopandWaitConfig::default_stopping_buffer</a></div><div class="ttdeci">double default_stopping_buffer</div><div class="ttdef"><b>Definition:</b> <a href="stop__and__wait__config_8hpp_source.html#l00033">stop_and_wait_config.hpp:33</a></div></div>
<div class="ttc" id="astructStopandWaitConfig_html_ae028cbbe5066f0c0a70f877188a739c4"><div class="ttname"><a href="structStopandWaitConfig.html#ae028cbbe5066f0c0a70f877188a739c4">StopandWaitConfig::accel_limit_multiplier</a></div><div class="ttdeci">double accel_limit_multiplier</div><div class="ttdef"><b>Definition:</b> <a href="stop__and__wait__config_8hpp_source.html#l00029">stop_and_wait_config.hpp:29</a></div></div>
<div class="ttc" id="astructStopandWaitConfig_html_ae1af2b1d26f072bf494c62634514f3e7"><div class="ttname"><a href="structStopandWaitConfig.html#ae1af2b1d26f072bf494c62634514f3e7">StopandWaitConfig::minimal_trajectory_duration</a></div><div class="ttdeci">double minimal_trajectory_duration</div><div class="ttdef"><b>Definition:</b> <a href="stop__and__wait__config_8hpp_source.html#l00026">stop_and_wait_config.hpp:26</a></div></div>
<div class="ttc" id="astructStopandWaitConfig_html_af15c8b21219680d90ce427c056542ba5"><div class="ttname"><a href="structStopandWaitConfig.html#af15c8b21219680d90ce427c056542ba5">StopandWaitConfig::stop_timestep</a></div><div class="ttdeci">double stop_timestep</div><div class="ttdef"><b>Definition:</b> <a href="stop__and__wait__config_8hpp_source.html#l00027">stop_and_wait_config.hpp:27</a></div></div>
<div class="ttc" id="astructStopandWaitConfig_html_af830ceb9940a67c70d3283b186a1c68c"><div class="ttname"><a href="structStopandWaitConfig.html#af830ceb9940a67c70d3283b186a1c68c">StopandWaitConfig::moving_average_window_size</a></div><div class="ttdeci">double moving_average_window_size</div><div class="ttdef"><b>Definition:</b> <a href="stop__and__wait__config_8hpp_source.html#l00034">stop_and_wait_config.hpp:34</a></div></div>
<div class="ttc" id="astructstop__and__wait__plugin_1_1PointSpeedPair_html"><div class="ttname"><a href="structstop__and__wait__plugin_1_1PointSpeedPair.html">stop_and_wait_plugin::PointSpeedPair</a></div><div class="ttdoc">Convenience class for pairing 2d points with speeds.</div><div class="ttdef"><b>Definition:</b> <a href="stop__and__wait__plugin_8hpp_source.html#l00044">stop_and_wait_plugin.hpp:45</a></div></div>
<div class="ttc" id="astructstop__and__wait__plugin_1_1PointSpeedPair_html_a3d257f2cca23d430a1d2e9aba23bc4ad"><div class="ttname"><a href="structstop__and__wait__plugin_1_1PointSpeedPair.html#a3d257f2cca23d430a1d2e9aba23bc4ad">stop_and_wait_plugin::PointSpeedPair::point</a></div><div class="ttdeci">lanelet::BasicPoint2d point</div><div class="ttdef"><b>Definition:</b> <a href="stop__and__wait__plugin_8hpp_source.html#l00046">stop_and_wait_plugin.hpp:46</a></div></div>
<div class="ttc" id="astructstop__and__wait__plugin_1_1PointSpeedPair_html_a61c3ee612840498ba6aea200ffeb75de"><div class="ttname"><a href="structstop__and__wait__plugin_1_1PointSpeedPair.html#a61c3ee612840498ba6aea200ffeb75de">stop_and_wait_plugin::PointSpeedPair::speed</a></div><div class="ttdeci">double speed</div><div class="ttdef"><b>Definition:</b> <a href="stop__and__wait__plugin_8hpp_source.html#l00047">stop_and_wait_plugin.hpp:47</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_c744803b381d4198f3a03790afe86525.html">stop_and_wait_plugin</a></li><li class="navelem"><a class="el" href="dir_8b6f70b6d617ad04c19a0fbbe7dc444c.html">src</a></li><li class="navelem"><a class="el" href="stop__and__wait__plugin_8cpp.html">stop_and_wait_plugin.cpp</a></li>
    <li class="footer">Generated on Sun Oct 20 2024 18:10:48 for Carma-platform by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.4 </li>
  </ul>
</div>
</body>
</html>
