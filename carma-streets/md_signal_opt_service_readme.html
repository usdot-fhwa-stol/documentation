<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Carma-streets: Signal Optimization Service</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Carma-streets<span id="projectnumber">&#160;v4.2.0</span>
   </div>
   <div id="projectbrief">CARMA Streets is a component of CARMA ecosystem that improves the efficiency and performance of the Transportation Systems Management and Operations (TSMO) strategies.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md_signal_opt_service_readme.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Signal Optimization Service </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2><a class="anchor" id="autotoc_md103"></a>
Introduction</h2>
<p >The SO (Signal Optimization) service is the CARMA-Streets service responsible for optimizing traffic signal controller phase order and duration. The SO service is responsible for fixing a configurable amount of future phases on the traffic signal controller. On each phase transition (Yellow and Red clearance interval), the SO service will determine a new phase and duration to append to the list of fixed phases. The SO service does this by monitoring traffic signal state and planned state, vehicles within the intersection communication area, and the latest intersection geometry.</p>
<p >The SO service depends on message service, intersection model and TSC (Traffic Signal Controller) service. It subscribes to message service to get the vehicle status and intent information, calls the <a href="https://github.com/usdot-fhwa-stol/carma-streets/tree/develop/streets_utils/streets_vehicle_list">vehicle list library</a> to persist the vehicle. It sends HTTP GET requests to intersection model for configured time period to get the latest intersection geometry update, including the signal group ids for each link lanelet. It subscribes to the TSC service outgoing J2735 based JSON SPaT kafka topic to get information about current and future signal state. The JSON SPaT information is processed and persisted using the <a href="https://github.com/usdot-fhwa-stol/carma-streets/tree/develop/streets_utils/streets_signal_phase_and_timing">streets_signal_phase_and_timing</a> library .</p>
<h1><a class="anchor" id="autotoc_md104"></a>
Configuration parameters</h1>
<h2><a class="anchor" id="autotoc_md105"></a>
Kafka topic names</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Topic Name   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">tsc_spat_msg_in   </td><td class="markdownTableBodyNone">The topic is used to transfer message between signal optimization and TSC (Traffic Signal Controller) services. The message is carma-streets internal <a href="https://github.com/usdot-fhwa-stol/carma-streets/tree/develop/streets_utils/streets_signal_phase_and_timing">spat messages in JSON format.</a>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">vehicle_status_intent_output   </td><td class="markdownTableBodyNone">This topic is used to transfer message between signal optimization and message services. The message format refers to <a href="https://usdot-carma.atlassian.net/wiki/spaces/CRMTSMO/pages/2182873096/CARMA+Streets+Message+Data+Collection">confluence page.</a>   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md106"></a>
Additional parameters</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Parameter Name   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">sleep_millisecs   </td><td class="markdownTableBodyNone">The number of milliseconds the current iteration should sleep for.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">int_client_request_attempts   </td><td class="markdownTableBodyNone">The maximum numbers of loop to send HTTP request to intersection model to get the latest intersection geometry information.   </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md107"></a>
Implementation</h1>
<p >The SO service consist of two main classes. The first is the <code>signal_opt_messages_worker</code>. This is a worker class the holds the pointers to all the persisted data. This includes:</p><ul>
<li><code>intersection_info</code> (intersection geometry),</li>
<li><code>spat</code> (traffic signal current and future state information)</li>
<li><p class="startli"><code>vehicle_list</code> (vehicle currently in the intersection).</p>
<p class="startli"><code>add_vehicle_update</code> takes a string JSON status_and_intent message as a parameter and simply calls <code>vehicle_list::process_update(const std::string &amp;json)</code> . This will allow the <code>vehicle_list</code> to process a <code>status_and_intent</code> message and update its map of vehicles to reflect the information from this update.</p>
</li>
</ul>
<p ><code>update_spat</code> takes a string JSON modified SPaT message (see streets_utils/streets_signal_phase_and_timing documentation) and calls from <code>fromJson(const std::string &amp;json)</code>. This will cause the <code>spat</code> object to read and reflect the updated information.</p>
<p ><code>request_intersection_info</code> will poll the intersection_info REST endpoint on the <b><a class="el" href="namespaceintersection__model.html">intersection_model</a></b> service for the intersection geometry information until it receives valid information, including signal group id's for every link lanelet in the intersection. This method is currently only called on startup.</p>
<p >This worker class contains methods to update this persisted data and the get shared pointers to it. The second class is the <code><a class="el" href="namespacesignal__opt__service.html">signal_opt_service</a></code>. This class initializes and instance of the &lsquo;signal_opt_message_worker&rsquo;, reads in configuration parameters from the <code>manifest.json</code> and creates threads for kafka consumers for the <b>status_and_intent</b> and <b>spat</b> messages. These kafka consumers will call the <code>signal_opt_messages_worker</code> methods to update the stored persistence objects : <code>vehicle_list</code> and <code>spat</code>. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Thu Aug 29 2024 16:56:47 for Carma-streets by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.4 </li>
  </ul>
</div>
</body>
</html>
