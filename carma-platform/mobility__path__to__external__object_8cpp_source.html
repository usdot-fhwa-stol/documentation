<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Carma-platform: motion_computation/src/mobility_path_to_external_object.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Carma-platform<span id="projectnumber">&#160;v4.2.0</span>
   </div>
   <div id="projectbrief">CARMA Platform is built on robot operating system (ROS) and utilizes open source software (OSS) that enables Cooperative Driving Automation (CDA) features to allow Automated Driving Systems to interact and cooperate with infrastructure and other vehicles through communication.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('mobility__path__to__external__object_8cpp_source.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle"><div class="title">mobility_path_to_external_object.cpp</div></div>
</div><!--header-->
<div class="contents">
<a href="mobility__path__to__external__object_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a id="l00001" name="l00001"></a><span class="lineno">    1</span><span class="comment">// Copyright 2019-2023 Leidos</span></div>
<div class="line"><a id="l00002" name="l00002"></a><span class="lineno">    2</span><span class="comment">//</span></div>
<div class="line"><a id="l00003" name="l00003"></a><span class="lineno">    3</span><span class="comment">// Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span></div>
<div class="line"><a id="l00004" name="l00004"></a><span class="lineno">    4</span><span class="comment">// you may not use this file except in compliance with the License.</span></div>
<div class="line"><a id="l00005" name="l00005"></a><span class="lineno">    5</span><span class="comment">// You may obtain a copy of the License at</span></div>
<div class="line"><a id="l00006" name="l00006"></a><span class="lineno">    6</span><span class="comment">//</span></div>
<div class="line"><a id="l00007" name="l00007"></a><span class="lineno">    7</span><span class="comment">//     http://www.apache.org/licenses/LICENSE-2.0</span></div>
<div class="line"><a id="l00008" name="l00008"></a><span class="lineno">    8</span><span class="comment">//</span></div>
<div class="line"><a id="l00009" name="l00009"></a><span class="lineno">    9</span><span class="comment">// Unless required by applicable law or agreed to in writing, software</span></div>
<div class="line"><a id="l00010" name="l00010"></a><span class="lineno">   10</span><span class="comment">// distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span></div>
<div class="line"><a id="l00011" name="l00011"></a><span class="lineno">   11</span><span class="comment">// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></div>
<div class="line"><a id="l00012" name="l00012"></a><span class="lineno">   12</span><span class="comment">// See the License for the specific language governing permissions and</span></div>
<div class="line"><a id="l00013" name="l00013"></a><span class="lineno">   13</span><span class="comment">// limitations under the License.</span></div>
<div class="line"><a id="l00014" name="l00014"></a><span class="lineno">   14</span> </div>
<div class="line"><a id="l00015" name="l00015"></a><span class="lineno">   15</span><span class="preprocessor">#include &lt;tf2/LinearMath/Transform.h&gt;</span></div>
<div class="line"><a id="l00016" name="l00016"></a><span class="lineno">   16</span><span class="preprocessor">#include &lt;carma_perception_msgs/msg/external_object.hpp&gt;</span></div>
<div class="line"><a id="l00017" name="l00017"></a><span class="lineno">   17</span><span class="preprocessor">#include &lt;carma_v2x_msgs/msg/mobility_path.hpp&gt;</span></div>
<div class="line"><a id="l00018" name="l00018"></a><span class="lineno">   18</span><span class="preprocessor">#include &lt;<a class="code" href="mobility__path__to__external__object__helpers_8hpp.html">motion_computation/impl/mobility_path_to_external_object_helpers.hpp</a>&gt;</span></div>
<div class="line"><a id="l00019" name="l00019"></a><span class="lineno">   19</span><span class="preprocessor">#include &lt;rclcpp/logger.hpp&gt;</span></div>
<div class="line"><a id="l00020" name="l00020"></a><span class="lineno">   20</span><span class="preprocessor">#include &lt;rclcpp/logging.hpp&gt;</span></div>
<div class="line"><a id="l00021" name="l00021"></a><span class="lineno">   21</span><span class="preprocessor">#include &lt;string&gt;</span></div>
<div class="line"><a id="l00022" name="l00022"></a><span class="lineno">   22</span><span class="preprocessor">#include &lt;utility&gt;</span></div>
<div class="line"><a id="l00023" name="l00023"></a><span class="lineno">   23</span> </div>
<div class="line"><a id="l00024" name="l00024"></a><span class="lineno">   24</span><span class="keyword">namespace </span><a class="code hl_namespace" href="namespacemotion__computation.html">motion_computation</a></div>
<div class="line"><a id="l00025" name="l00025"></a><span class="lineno">   25</span>{</div>
<div class="line"><a id="l00026" name="l00026"></a><span class="lineno">   26</span><span class="keyword">namespace </span>conversion</div>
<div class="line"><a id="l00027" name="l00027"></a><span class="lineno">   27</span>{</div>
<div class="line"><a id="l00028" name="l00028"></a><span class="lineno">   28</span> </div>
<div class="line"><a id="l00029" name="l00029"></a><span class="lineno"><a class="line" href="namespacemotion__computation_1_1conversion.html#ac015baeed44f7d5fbf23e8a71bb12876">   29</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="namespacemotion__computation_1_1conversion.html#a9884e63460f3d5f5e2b755354984dc29">convert</a>(</div>
<div class="line"><a id="l00030" name="l00030"></a><span class="lineno">   30</span>  <span class="keyword">const</span> carma_v2x_msgs::msg::MobilityPath &amp; in_msg,</div>
<div class="line"><a id="l00031" name="l00031"></a><span class="lineno">   31</span>  carma_perception_msgs::msg::ExternalObject &amp; out_msg,</div>
<div class="line"><a id="l00032" name="l00032"></a><span class="lineno">   32</span>  <span class="keyword">const</span> lanelet::projection::LocalFrameProjector &amp; map_projector)</div>
<div class="line"><a id="l00033" name="l00033"></a><span class="lineno">   33</span>{</div>
<div class="line"><a id="l00034" name="l00034"></a><span class="lineno">   34</span>  <span class="keyword">constexpr</span> <span class="keywordtype">double</span> mobility_path_points_timestep_size =</div>
<div class="line"><a id="l00035" name="l00035"></a><span class="lineno">   35</span>    0.1;  <span class="comment">// Mobility path timestep size per message spec</span></div>
<div class="line"><a id="l00036" name="l00036"></a><span class="lineno">   36</span> </div>
<div class="line"><a id="l00037" name="l00037"></a><span class="lineno">   37</span>  out_msg.size.x = 2.5;  <span class="comment">// TODO(carma) identify better approach for object size in mobility path</span></div>
<div class="line"><a id="l00038" name="l00038"></a><span class="lineno">   38</span>  out_msg.size.y = 2.25;</div>
<div class="line"><a id="l00039" name="l00039"></a><span class="lineno">   39</span>  out_msg.size.z = 2.0;</div>
<div class="line"><a id="l00040" name="l00040"></a><span class="lineno">   40</span> </div>
<div class="line"><a id="l00041" name="l00041"></a><span class="lineno">   41</span>  <span class="comment">// get reference origin in ECEF (convert from cm to m)</span></div>
<div class="line"><a id="l00042" name="l00042"></a><span class="lineno">   42</span>  <span class="keywordtype">double</span> ecef_x = <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(in_msg.trajectory.location.ecef_x) / 100.0;</div>
<div class="line"><a id="l00043" name="l00043"></a><span class="lineno">   43</span>  <span class="keywordtype">double</span> ecef_y = <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(in_msg.trajectory.location.ecef_y) / 100.0;</div>
<div class="line"><a id="l00044" name="l00044"></a><span class="lineno">   44</span>  <span class="keywordtype">double</span> ecef_z = <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(in_msg.trajectory.location.ecef_z) / 100.0;</div>
<div class="line"><a id="l00045" name="l00045"></a><span class="lineno">   45</span> </div>
<div class="line"><a id="l00046" name="l00046"></a><span class="lineno">   46</span>  <span class="comment">// Convert general information</span></div>
<div class="line"><a id="l00047" name="l00047"></a><span class="lineno">   47</span>  <span class="comment">// clang-off</span></div>
<div class="line"><a id="l00048" name="l00048"></a><span class="lineno">   48</span>  out_msg.presence_vector |= carma_perception_msgs::msg::ExternalObject::ID_PRESENCE_VECTOR;</div>
<div class="line"><a id="l00049" name="l00049"></a><span class="lineno">   49</span>  out_msg.presence_vector |= carma_perception_msgs::msg::ExternalObject::POSE_PRESENCE_VECTOR;</div>
<div class="line"><a id="l00050" name="l00050"></a><span class="lineno">   50</span>  out_msg.presence_vector |= carma_perception_msgs::msg::ExternalObject::VELOCITY_PRESENCE_VECTOR;</div>
<div class="line"><a id="l00051" name="l00051"></a><span class="lineno">   51</span>  out_msg.presence_vector |=</div>
<div class="line"><a id="l00052" name="l00052"></a><span class="lineno">   52</span>    carma_perception_msgs::msg::ExternalObject::OBJECT_TYPE_PRESENCE_VECTOR;</div>
<div class="line"><a id="l00053" name="l00053"></a><span class="lineno">   53</span>  out_msg.presence_vector |= carma_perception_msgs::msg::ExternalObject::BSM_ID_PRESENCE_VECTOR;</div>
<div class="line"><a id="l00054" name="l00054"></a><span class="lineno">   54</span>  out_msg.presence_vector |= carma_perception_msgs::msg::ExternalObject::DYNAMIC_OBJ_PRESENCE;</div>
<div class="line"><a id="l00055" name="l00055"></a><span class="lineno">   55</span>  out_msg.presence_vector |= carma_perception_msgs::msg::ExternalObject::PREDICTION_PRESENCE_VECTOR;</div>
<div class="line"><a id="l00056" name="l00056"></a><span class="lineno">   56</span>  <span class="comment">// clang-on</span></div>
<div class="line"><a id="l00057" name="l00057"></a><span class="lineno">   57</span> </div>
<div class="line"><a id="l00058" name="l00058"></a><span class="lineno">   58</span>  out_msg.object_type = carma_perception_msgs::msg::ExternalObject::SMALL_VEHICLE;</div>
<div class="line"><a id="l00059" name="l00059"></a><span class="lineno">   59</span>  std::hash&lt;std::string&gt; hasher;</div>
<div class="line"><a id="l00060" name="l00060"></a><span class="lineno">   60</span> </div>
<div class="line"><a id="l00061" name="l00061"></a><span class="lineno">   61</span>  <span class="comment">// TODO(carma) hasher returns size_t, message accept uint32_t which we might lose info</span></div>
<div class="line"><a id="l00062" name="l00062"></a><span class="lineno">   62</span>  <span class="keyword">auto</span> hashed = hasher(in_msg.m_header.sender_id);</div>
<div class="line"><a id="l00063" name="l00063"></a><span class="lineno">   63</span>  out_msg.id = <span class="keyword">static_cast&lt;</span><a class="code hl_typedef" href="stdint_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a><span class="keyword">&gt;</span>(hashed);</div>
<div class="line"><a id="l00064" name="l00064"></a><span class="lineno">   64</span> </div>
<div class="line"><a id="l00065" name="l00065"></a><span class="lineno">   65</span>  <span class="comment">// convert hex std::string to uint8_t array</span></div>
<div class="line"><a id="l00066" name="l00066"></a><span class="lineno">   66</span>  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a> = 0; <a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a> &lt; in_msg.m_header.sender_bsm_id.size(); <a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a> += 2) {</div>
<div class="line"><a id="l00067" name="l00067"></a><span class="lineno">   67</span>    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> num = 0;</div>
<div class="line"><a id="l00068" name="l00068"></a><span class="lineno">   68</span>    sscanf(in_msg.m_header.sender_bsm_id.substr(<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>, <a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a> + 2).c_str(), <span class="stringliteral">&quot;%x&quot;</span>, &amp;num);</div>
<div class="line"><a id="l00069" name="l00069"></a><span class="lineno">   69</span>    out_msg.bsm_id.push_back((<a class="code hl_typedef" href="stdint_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>)num);</div>
<div class="line"><a id="l00070" name="l00070"></a><span class="lineno">   70</span>  }</div>
<div class="line"><a id="l00071" name="l00071"></a><span class="lineno">   71</span> </div>
<div class="line"><a id="l00072" name="l00072"></a><span class="lineno">   72</span>  <span class="comment">// first point&#39;s timestamp</span></div>
<div class="line"><a id="l00073" name="l00073"></a><span class="lineno">   73</span>  out_msg.header.stamp =</div>
<div class="line"><a id="l00074" name="l00074"></a><span class="lineno">   74</span>    rclcpp::Time((<a class="code hl_typedef" href="stdint_8h.html#aec6fcb673ff035718c238c8c9d544c47">uint64_t</a>)in_msg.m_header.timestamp * 1e6);  <span class="comment">// ms to nanoseconds</span></div>
<div class="line"><a id="l00075" name="l00075"></a><span class="lineno">   75</span> </div>
<div class="line"><a id="l00076" name="l00076"></a><span class="lineno">   76</span>  <span class="comment">// If it is a static object, we finished processing</span></div>
<div class="line"><a id="l00077" name="l00077"></a><span class="lineno">   77</span>  <span class="keywordflow">if</span> (in_msg.trajectory.offsets.size() &lt; 2) {</div>
<div class="line"><a id="l00078" name="l00078"></a><span class="lineno">   78</span>    out_msg.dynamic_obj = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00079" name="l00079"></a><span class="lineno">   79</span>    <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00080" name="l00080"></a><span class="lineno">   80</span>  }</div>
<div class="line"><a id="l00081" name="l00081"></a><span class="lineno">   81</span>  out_msg.dynamic_obj = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00082" name="l00082"></a><span class="lineno">   82</span> </div>
<div class="line"><a id="l00083" name="l00083"></a><span class="lineno">   83</span>  <span class="comment">// get planned trajectory points</span></div>
<div class="line"><a id="l00084" name="l00084"></a><span class="lineno">   84</span>  carma_perception_msgs::msg::PredictedState prev_state;</div>
<div class="line"><a id="l00085" name="l00085"></a><span class="lineno">   85</span>  tf2::Vector3 prev_pt_ecef{ecef_x, ecef_y, ecef_z};</div>
<div class="line"><a id="l00086" name="l00086"></a><span class="lineno">   86</span> </div>
<div class="line"><a id="l00087" name="l00087"></a><span class="lineno">   87</span>  <span class="keyword">auto</span> prev_pt_map = <a class="code hl_function" href="namespacemotion__computation_1_1conversion_1_1impl.html#aa543f123dea7c2e5476ed7e17e25456f">impl::transform_to_map_frame</a>(prev_pt_ecef, map_projector);</div>
<div class="line"><a id="l00088" name="l00088"></a><span class="lineno">   88</span>  <span class="keywordtype">double</span> prev_yaw = 0.0;</div>
<div class="line"><a id="l00089" name="l00089"></a><span class="lineno">   89</span> </div>
<div class="line"><a id="l00090" name="l00090"></a><span class="lineno">   90</span>  <span class="keywordtype">double</span> message_offset_x = 0.0;  <span class="comment">// units cm</span></div>
<div class="line"><a id="l00091" name="l00091"></a><span class="lineno">   91</span>  <span class="keywordtype">double</span> message_offset_y = 0.0;</div>
<div class="line"><a id="l00092" name="l00092"></a><span class="lineno">   92</span>  <span class="keywordtype">double</span> message_offset_z = 0.0;</div>
<div class="line"><a id="l00093" name="l00093"></a><span class="lineno">   93</span> </div>
<div class="line"><a id="l00094" name="l00094"></a><span class="lineno">   94</span>  rclcpp::Duration mobility_path_point_delta_t(mobility_path_points_timestep_size * 1e9);</div>
<div class="line"><a id="l00095" name="l00095"></a><span class="lineno">   95</span> </div>
<div class="line"><a id="l00096" name="l00096"></a><span class="lineno">   96</span>  <span class="comment">// Note the usage of current vs previous in this loop can be a bit confusing</span></div>
<div class="line"><a id="l00097" name="l00097"></a><span class="lineno">   97</span>  <span class="comment">// The intended behavior is we our always storing our prev_point but using</span></div>
<div class="line"><a id="l00098" name="l00098"></a><span class="lineno">   98</span>  <span class="comment">// curr_pt for computing velocity at prev_point</span></div>
<div class="line"><a id="l00099" name="l00099"></a><span class="lineno">   99</span>  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a> = 0; <a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a> &lt; in_msg.trajectory.offsets.size(); <a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>++) {</div>
<div class="line"><a id="l00100" name="l00100"></a><span class="lineno">  100</span>    <span class="keyword">auto</span> curr_pt_msg = in_msg.trajectory.offsets[<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>];</div>
<div class="line"><a id="l00101" name="l00101"></a><span class="lineno">  101</span> </div>
<div class="line"><a id="l00102" name="l00102"></a><span class="lineno">  102</span>    message_offset_x = <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(curr_pt_msg.offset_x) + message_offset_x;</div>
<div class="line"><a id="l00103" name="l00103"></a><span class="lineno">  103</span>    message_offset_y = <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(curr_pt_msg.offset_y) + message_offset_y;</div>
<div class="line"><a id="l00104" name="l00104"></a><span class="lineno">  104</span>    message_offset_z = <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(curr_pt_msg.offset_z) + message_offset_z;</div>
<div class="line"><a id="l00105" name="l00105"></a><span class="lineno">  105</span> </div>
<div class="line"><a id="l00106" name="l00106"></a><span class="lineno">  106</span>    tf2::Vector3 curr_pt_ecef{</div>
<div class="line"><a id="l00107" name="l00107"></a><span class="lineno">  107</span>      ecef_x + message_offset_x / 100.0, ecef_y + message_offset_y / 100.0,</div>
<div class="line"><a id="l00108" name="l00108"></a><span class="lineno">  108</span>      ecef_z + message_offset_z /</div>
<div class="line"><a id="l00109" name="l00109"></a><span class="lineno">  109</span>                 100.0};  <span class="comment">// ecef_x is in m while message_offset_x is in cm. Want m as final result</span></div>
<div class="line"><a id="l00110" name="l00110"></a><span class="lineno">  110</span>    <span class="keyword">auto</span> curr_pt_map = <a class="code hl_function" href="namespacemotion__computation_1_1conversion_1_1impl.html#aa543f123dea7c2e5476ed7e17e25456f">impl::transform_to_map_frame</a>(curr_pt_ecef, map_projector);</div>
<div class="line"><a id="l00111" name="l00111"></a><span class="lineno">  111</span> </div>
<div class="line"><a id="l00112" name="l00112"></a><span class="lineno">  112</span>    carma_perception_msgs::msg::PredictedState curr_state;</div>
<div class="line"><a id="l00113" name="l00113"></a><span class="lineno">  113</span> </div>
<div class="line"><a id="l00114" name="l00114"></a><span class="lineno">  114</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a> == 0)  <span class="comment">// First point&#39;s state should be stored outside &quot;predictions&quot;</span></div>
<div class="line"><a id="l00115" name="l00115"></a><span class="lineno">  115</span>    {</div>
<div class="line"><a id="l00116" name="l00116"></a><span class="lineno">  116</span>      rclcpp::Time prev_stamp_as_time = rclcpp::Time(out_msg.header.stamp);</div>
<div class="line"><a id="l00117" name="l00117"></a><span class="lineno">  117</span>      rclcpp::Time updated_time_step = prev_stamp_as_time + mobility_path_point_delta_t;</div>
<div class="line"><a id="l00118" name="l00118"></a><span class="lineno">  118</span> </div>
<div class="line"><a id="l00119" name="l00119"></a><span class="lineno">  119</span>      <span class="keyword">auto</span> res = <a class="code hl_function" href="namespacemotion__computation_1_1conversion_1_1impl.html#abb4c108e6903a12b1dff436ef0e6d825">impl::composePredictedState</a>(</div>
<div class="line"><a id="l00120" name="l00120"></a><span class="lineno">  120</span>        curr_pt_map, prev_pt_map, prev_stamp_as_time, updated_time_step,</div>
<div class="line"><a id="l00121" name="l00121"></a><span class="lineno">  121</span>        prev_yaw);  <span class="comment">// Position returned is that of prev_pt_map NOT curr_pt_map</span></div>
<div class="line"><a id="l00122" name="l00122"></a><span class="lineno">  122</span>      curr_state = std::get&lt;0&gt;(res);</div>
<div class="line"><a id="l00123" name="l00123"></a><span class="lineno">  123</span>      prev_yaw = std::get&lt;1&gt;(res);</div>
<div class="line"><a id="l00124" name="l00124"></a><span class="lineno">  124</span>      <span class="comment">// Compute out_msg pose</span></div>
<div class="line"><a id="l00125" name="l00125"></a><span class="lineno">  125</span>      out_msg.pose.pose =</div>
<div class="line"><a id="l00126" name="l00126"></a><span class="lineno">  126</span>        curr_state</div>
<div class="line"><a id="l00127" name="l00127"></a><span class="lineno">  127</span>          .predicted_position;  <span class="comment">// Orientation computed from first point in offsets with location</span></div>
<div class="line"><a id="l00128" name="l00128"></a><span class="lineno">  128</span>      out_msg.velocity.twist = curr_state.predicted_velocity;  <span class="comment">// Velocity derived from first point</span></div>
<div class="line"><a id="l00129" name="l00129"></a><span class="lineno">  129</span> </div>
<div class="line"><a id="l00130" name="l00130"></a><span class="lineno">  130</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00131" name="l00131"></a><span class="lineno">  131</span>      <span class="comment">// NOTE: This is where the time increment happens but it feels incorrect.</span></div>
<div class="line"><a id="l00132" name="l00132"></a><span class="lineno">  132</span>      <span class="comment">// since the corresponding data is actually from the original prev_state stamp</span></div>
<div class="line"><a id="l00133" name="l00133"></a><span class="lineno">  133</span>      rclcpp::Time prev_stamp_as_time =</div>
<div class="line"><a id="l00134" name="l00134"></a><span class="lineno">  134</span>        rclcpp::Time(prev_state.header.stamp) + mobility_path_point_delta_t;</div>
<div class="line"><a id="l00135" name="l00135"></a><span class="lineno">  135</span>      rclcpp::Time updated_time_step = prev_stamp_as_time + mobility_path_point_delta_t;</div>
<div class="line"><a id="l00136" name="l00136"></a><span class="lineno">  136</span> </div>
<div class="line"><a id="l00137" name="l00137"></a><span class="lineno">  137</span>      <span class="keyword">auto</span> res = <a class="code hl_function" href="namespacemotion__computation_1_1conversion_1_1impl.html#abb4c108e6903a12b1dff436ef0e6d825">impl::composePredictedState</a>(</div>
<div class="line"><a id="l00138" name="l00138"></a><span class="lineno">  138</span>        curr_pt_map, prev_pt_map, prev_stamp_as_time, updated_time_step, prev_yaw);</div>
<div class="line"><a id="l00139" name="l00139"></a><span class="lineno">  139</span>      curr_state = std::get&lt;0&gt;(res);</div>
<div class="line"><a id="l00140" name="l00140"></a><span class="lineno">  140</span>      prev_yaw = std::get&lt;1&gt;(res);</div>
<div class="line"><a id="l00141" name="l00141"></a><span class="lineno">  141</span>      out_msg.predictions.push_back(curr_state);</div>
<div class="line"><a id="l00142" name="l00142"></a><span class="lineno">  142</span>    }</div>
<div class="line"><a id="l00143" name="l00143"></a><span class="lineno">  143</span> </div>
<div class="line"><a id="l00144" name="l00144"></a><span class="lineno">  144</span>    <span class="keywordflow">if</span> (</div>
<div class="line"><a id="l00145" name="l00145"></a><span class="lineno">  145</span>      <a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a> == in_msg.trajectory.offsets.size() -</div>
<div class="line"><a id="l00146" name="l00146"></a><span class="lineno">  146</span>             1)  <span class="comment">// if last point, copy the prev_state velocity &amp; orientation to the last point too</span></div>
<div class="line"><a id="l00147" name="l00147"></a><span class="lineno">  147</span>    {</div>
<div class="line"><a id="l00148" name="l00148"></a><span class="lineno">  148</span>      curr_state.predicted_position.position.x = curr_pt_map.x();</div>
<div class="line"><a id="l00149" name="l00149"></a><span class="lineno">  149</span>      curr_state.predicted_position.position.y = curr_pt_map.y();</div>
<div class="line"><a id="l00150" name="l00150"></a><span class="lineno">  150</span>      curr_state.predicted_position.position.z = curr_pt_map.z();</div>
<div class="line"><a id="l00151" name="l00151"></a><span class="lineno">  151</span>      out_msg.predictions.push_back(curr_state);</div>
<div class="line"><a id="l00152" name="l00152"></a><span class="lineno">  152</span>    }</div>
<div class="line"><a id="l00153" name="l00153"></a><span class="lineno">  153</span> </div>
<div class="line"><a id="l00154" name="l00154"></a><span class="lineno">  154</span>    prev_state = curr_state;</div>
<div class="line"><a id="l00155" name="l00155"></a><span class="lineno">  155</span>    prev_pt_map = curr_pt_map;</div>
<div class="line"><a id="l00156" name="l00156"></a><span class="lineno">  156</span>  }</div>
<div class="line"><a id="l00157" name="l00157"></a><span class="lineno">  157</span> </div>
<div class="line"><a id="l00158" name="l00158"></a><span class="lineno">  158</span>  <a class="code hl_function" href="namespacemotion__computation_1_1conversion_1_1impl.html#aa87a85102ac70d15b834d6e1cd3d9429">impl::calculateAngVelocityOfPredictedStates</a>(out_msg);</div>
<div class="line"><a id="l00159" name="l00159"></a><span class="lineno">  159</span> </div>
<div class="line"><a id="l00160" name="l00160"></a><span class="lineno">  160</span>  <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00161" name="l00161"></a><span class="lineno">  161</span>}</div>
<div class="line"><a id="l00162" name="l00162"></a><span class="lineno">  162</span> </div>
<div class="line"><a id="l00163" name="l00163"></a><span class="lineno">  163</span><span class="keyword">namespace </span>impl</div>
<div class="line"><a id="l00164" name="l00164"></a><span class="lineno">  164</span>{</div>
<div class="line"><a id="l00165" name="l00165"></a><span class="lineno">  165</span> </div>
<div class="line"><a id="l00166" name="l00166"></a><span class="lineno"><a class="line" href="namespacemotion__computation_1_1conversion_1_1impl.html#abb4c108e6903a12b1dff436ef0e6d825">  166</a></span>std::pair&lt;carma_perception_msgs::msg::PredictedState, double&gt; <a class="code hl_function" href="namespacemotion__computation_1_1conversion_1_1impl.html#abb4c108e6903a12b1dff436ef0e6d825">composePredictedState</a>(</div>
<div class="line"><a id="l00167" name="l00167"></a><span class="lineno">  167</span>  <span class="keyword">const</span> tf2::Vector3 &amp; curr_pt, <span class="keyword">const</span> tf2::Vector3 &amp; prev_pt, <span class="keyword">const</span> rclcpp::Time &amp; prev_time_stamp,</div>
<div class="line"><a id="l00168" name="l00168"></a><span class="lineno">  168</span>  <span class="keyword">const</span> rclcpp::Time &amp; curr_time_stamp, <span class="keywordtype">double</span> prev_yaw)</div>
<div class="line"><a id="l00169" name="l00169"></a><span class="lineno">  169</span>{</div>
<div class="line"><a id="l00170" name="l00170"></a><span class="lineno">  170</span>  carma_perception_msgs::msg::PredictedState output_state;</div>
<div class="line"><a id="l00171" name="l00171"></a><span class="lineno">  171</span>  <span class="comment">// Set Position</span></div>
<div class="line"><a id="l00172" name="l00172"></a><span class="lineno">  172</span>  output_state.predicted_position.position.x = prev_pt.x();</div>
<div class="line"><a id="l00173" name="l00173"></a><span class="lineno">  173</span>  output_state.predicted_position.position.y = prev_pt.y();</div>
<div class="line"><a id="l00174" name="l00174"></a><span class="lineno">  174</span>  output_state.predicted_position.position.z = prev_pt.z();</div>
<div class="line"><a id="l00175" name="l00175"></a><span class="lineno">  175</span> </div>
<div class="line"><a id="l00176" name="l00176"></a><span class="lineno">  176</span>  <span class="comment">// Set Orientation</span></div>
<div class="line"><a id="l00177" name="l00177"></a><span class="lineno">  177</span>  Eigen::Vector2d vehicle_vector = {curr_pt.x() - prev_pt.x(), curr_pt.y() - prev_pt.y()};</div>
<div class="line"><a id="l00178" name="l00178"></a><span class="lineno">  178</span>  Eigen::Vector2d x_axis = {1, 0};</div>
<div class="line"><a id="l00179" name="l00179"></a><span class="lineno">  179</span>  <span class="keywordtype">double</span> yaw = 0.0;</div>
<div class="line"><a id="l00180" name="l00180"></a><span class="lineno">  180</span>  <span class="keywordflow">if</span> (</div>
<div class="line"><a id="l00181" name="l00181"></a><span class="lineno">  181</span>    vehicle_vector.norm() &lt;</div>
<div class="line"><a id="l00182" name="l00182"></a><span class="lineno">  182</span>    0.000001) {  <span class="comment">// If there is zero magnitude use previous yaw to avoid divide by 0</span></div>
<div class="line"><a id="l00183" name="l00183"></a><span class="lineno">  183</span>    yaw = prev_yaw;</div>
<div class="line"><a id="l00184" name="l00184"></a><span class="lineno">  184</span>    RCLCPP_DEBUG_STREAM(</div>
<div class="line"><a id="l00185" name="l00185"></a><span class="lineno">  185</span>      rclcpp::get_logger(<span class="stringliteral">&quot;motion_computation::conversion&quot;</span>),</div>
<div class="line"><a id="l00186" name="l00186"></a><span class="lineno">  186</span>      <span class="stringliteral">&quot;Two identical points sent for predicting heading. Forced to use previous yaw or 0 if &quot;</span></div>
<div class="line"><a id="l00187" name="l00187"></a><span class="lineno">  187</span>      <span class="stringliteral">&quot;first &quot;</span></div>
<div class="line"><a id="l00188" name="l00188"></a><span class="lineno">  188</span>      <span class="stringliteral">&quot;point&quot;</span>);</div>
<div class="line"><a id="l00189" name="l00189"></a><span class="lineno">  189</span>  } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00190" name="l00190"></a><span class="lineno">  190</span>    yaw = std::acos(vehicle_vector.dot(x_axis) / (vehicle_vector.norm() * x_axis.norm()));</div>
<div class="line"><a id="l00191" name="l00191"></a><span class="lineno">  191</span>  }</div>
<div class="line"><a id="l00192" name="l00192"></a><span class="lineno">  192</span> </div>
<div class="line"><a id="l00193" name="l00193"></a><span class="lineno">  193</span>  tf2::Quaternion vehicle_orientation;</div>
<div class="line"><a id="l00194" name="l00194"></a><span class="lineno">  194</span>  vehicle_orientation.setRPY(0, 0, yaw);</div>
<div class="line"><a id="l00195" name="l00195"></a><span class="lineno">  195</span>  output_state.predicted_position.orientation.x = vehicle_orientation.getX();</div>
<div class="line"><a id="l00196" name="l00196"></a><span class="lineno">  196</span>  output_state.predicted_position.orientation.y = vehicle_orientation.getY();</div>
<div class="line"><a id="l00197" name="l00197"></a><span class="lineno">  197</span>  output_state.predicted_position.orientation.z = vehicle_orientation.getZ();</div>
<div class="line"><a id="l00198" name="l00198"></a><span class="lineno">  198</span>  output_state.predicted_position.orientation.w = vehicle_orientation.getW();</div>
<div class="line"><a id="l00199" name="l00199"></a><span class="lineno">  199</span> </div>
<div class="line"><a id="l00200" name="l00200"></a><span class="lineno">  200</span>  <span class="comment">// Set velocity</span></div>
<div class="line"><a id="l00201" name="l00201"></a><span class="lineno">  201</span>  output_state.predicted_velocity.linear.x =</div>
<div class="line"><a id="l00202" name="l00202"></a><span class="lineno">  202</span> </div>
<div class="line"><a id="l00203" name="l00203"></a><span class="lineno">  203</span>    vehicle_vector.norm() / (curr_time_stamp - prev_time_stamp).seconds();</div>
<div class="line"><a id="l00204" name="l00204"></a><span class="lineno">  204</span> </div>
<div class="line"><a id="l00205" name="l00205"></a><span class="lineno">  205</span>  <span class="comment">// Set timestamp</span></div>
<div class="line"><a id="l00206" name="l00206"></a><span class="lineno">  206</span>  output_state.header.stamp = builtin_interfaces::msg::Time(prev_time_stamp);</div>
<div class="line"><a id="l00207" name="l00207"></a><span class="lineno">  207</span> </div>
<div class="line"><a id="l00208" name="l00208"></a><span class="lineno">  208</span>  <span class="keywordflow">return</span> std::make_pair(output_state, yaw);</div>
<div class="line"><a id="l00209" name="l00209"></a><span class="lineno">  209</span>}</div>
<div class="line"><a id="l00210" name="l00210"></a><span class="lineno">  210</span> </div>
<div class="line"><a id="l00211" name="l00211"></a><span class="lineno"><a class="line" href="namespacemotion__computation_1_1conversion_1_1impl.html#aa87a85102ac70d15b834d6e1cd3d9429">  211</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="namespacemotion__computation_1_1conversion_1_1impl.html#aa87a85102ac70d15b834d6e1cd3d9429">calculateAngVelocityOfPredictedStates</a>(carma_perception_msgs::msg::ExternalObject &amp; <span class="keywordtype">object</span>)</div>
<div class="line"><a id="l00212" name="l00212"></a><span class="lineno">  212</span>{</div>
<div class="line"><a id="l00213" name="l00213"></a><span class="lineno">  213</span>  <span class="keywordflow">if</span> (!<span class="keywordtype">object</span>.dynamic_obj || <span class="keywordtype">object</span>.predictions.size() == 0) {</div>
<div class="line"><a id="l00214" name="l00214"></a><span class="lineno">  214</span>    <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00215" name="l00215"></a><span class="lineno">  215</span>  }</div>
<div class="line"><a id="l00216" name="l00216"></a><span class="lineno">  216</span> </div>
<div class="line"><a id="l00217" name="l00217"></a><span class="lineno">  217</span>  <span class="comment">// Object&#39;s current angular velocity</span></div>
<div class="line"><a id="l00218" name="l00218"></a><span class="lineno">  218</span>  <span class="keywordtype">double</span> dt = (rclcpp::Time(<span class="keywordtype">object</span>.header.stamp) - rclcpp::Time(<span class="keywordtype">object</span>.predictions[0].header.stamp))</div>
<div class="line"><a id="l00219" name="l00219"></a><span class="lineno">  219</span>                .seconds();</div>
<div class="line"><a id="l00220" name="l00220"></a><span class="lineno">  220</span>  <span class="keywordtype">object</span>.velocity.twist.angular.z =</div>
<div class="line"><a id="l00221" name="l00221"></a><span class="lineno">  221</span>    (<a class="code hl_function" href="namespacemotion__computation_1_1conversion_1_1impl.html#a3dcbeb3180ab008815e6e7749796d147">impl::getYawFromQuaternionMsg</a>(<span class="keywordtype">object</span>.pose.pose.orientation) -</div>
<div class="line"><a id="l00222" name="l00222"></a><span class="lineno">  222</span>     <a class="code hl_function" href="namespacemotion__computation_1_1conversion_1_1impl.html#a3dcbeb3180ab008815e6e7749796d147">impl::getYawFromQuaternionMsg</a>(<span class="keywordtype">object</span>.predictions[0].predicted_position.orientation)) /</div>
<div class="line"><a id="l00223" name="l00223"></a><span class="lineno">  223</span>    dt;</div>
<div class="line"><a id="l00224" name="l00224"></a><span class="lineno">  224</span> </div>
<div class="line"><a id="l00225" name="l00225"></a><span class="lineno">  225</span>  <span class="comment">// Predictions&#39; angular velocities</span></div>
<div class="line"><a id="l00226" name="l00226"></a><span class="lineno">  226</span>  <span class="keyword">auto</span> prev_orient = <span class="keywordtype">object</span>.pose.pose.orientation;</div>
<div class="line"><a id="l00227" name="l00227"></a><span class="lineno">  227</span>  <span class="keyword">auto</span> prev_time = rclcpp::Time(<span class="keywordtype">object</span>.predictions[0].header.stamp);</div>
<div class="line"><a id="l00228" name="l00228"></a><span class="lineno">  228</span>  <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp; pred : <span class="keywordtype">object</span>.predictions) {</div>
<div class="line"><a id="l00229" name="l00229"></a><span class="lineno">  229</span>    dt = (rclcpp::Time(pred.header.stamp) - prev_time).seconds();</div>
<div class="line"><a id="l00230" name="l00230"></a><span class="lineno">  230</span>    pred.predicted_velocity.angular.z =</div>
<div class="line"><a id="l00231" name="l00231"></a><span class="lineno">  231</span>      (<a class="code hl_function" href="namespacemotion__computation_1_1conversion_1_1impl.html#a3dcbeb3180ab008815e6e7749796d147">impl::getYawFromQuaternionMsg</a>(prev_orient) -</div>
<div class="line"><a id="l00232" name="l00232"></a><span class="lineno">  232</span>       <a class="code hl_function" href="namespacemotion__computation_1_1conversion_1_1impl.html#a3dcbeb3180ab008815e6e7749796d147">impl::getYawFromQuaternionMsg</a>(pred.predicted_position.orientation)) /</div>
<div class="line"><a id="l00233" name="l00233"></a><span class="lineno">  233</span>      dt;</div>
<div class="line"><a id="l00234" name="l00234"></a><span class="lineno">  234</span>  }</div>
<div class="line"><a id="l00235" name="l00235"></a><span class="lineno">  235</span>}</div>
<div class="line"><a id="l00236" name="l00236"></a><span class="lineno">  236</span> </div>
<div class="line"><a id="l00237" name="l00237"></a><span class="lineno"><a class="line" href="namespacemotion__computation_1_1conversion_1_1impl.html#a3dcbeb3180ab008815e6e7749796d147">  237</a></span><span class="keywordtype">double</span> <a class="code hl_function" href="namespacemotion__computation_1_1conversion_1_1impl.html#a3dcbeb3180ab008815e6e7749796d147">getYawFromQuaternionMsg</a>(<span class="keyword">const</span> geometry_msgs::msg::Quaternion &amp; quaternion)</div>
<div class="line"><a id="l00238" name="l00238"></a><span class="lineno">  238</span>{</div>
<div class="line"><a id="l00239" name="l00239"></a><span class="lineno">  239</span>  tf2::Quaternion orientation;</div>
<div class="line"><a id="l00240" name="l00240"></a><span class="lineno">  240</span>  orientation.setX(quaternion.x);</div>
<div class="line"><a id="l00241" name="l00241"></a><span class="lineno">  241</span>  orientation.setY(quaternion.y);</div>
<div class="line"><a id="l00242" name="l00242"></a><span class="lineno">  242</span>  orientation.setZ(quaternion.z);</div>
<div class="line"><a id="l00243" name="l00243"></a><span class="lineno">  243</span>  orientation.setW(quaternion.w);</div>
<div class="line"><a id="l00244" name="l00244"></a><span class="lineno">  244</span> </div>
<div class="line"><a id="l00245" name="l00245"></a><span class="lineno">  245</span>  <span class="keywordtype">double</span> roll;</div>
<div class="line"><a id="l00246" name="l00246"></a><span class="lineno">  246</span>  <span class="keywordtype">double</span> pitch;</div>
<div class="line"><a id="l00247" name="l00247"></a><span class="lineno">  247</span>  <span class="keywordtype">double</span> yaw;</div>
<div class="line"><a id="l00248" name="l00248"></a><span class="lineno">  248</span>  tf2::Matrix3x3(orientation).getRPY(roll, pitch, yaw);</div>
<div class="line"><a id="l00249" name="l00249"></a><span class="lineno">  249</span> </div>
<div class="line"><a id="l00250" name="l00250"></a><span class="lineno">  250</span>  <span class="keywordflow">return</span> yaw;</div>
<div class="line"><a id="l00251" name="l00251"></a><span class="lineno">  251</span>}</div>
<div class="line"><a id="l00252" name="l00252"></a><span class="lineno">  252</span> </div>
<div class="line"><a id="l00253" name="l00253"></a><span class="lineno"><a class="line" href="namespacemotion__computation_1_1conversion_1_1impl.html#aa543f123dea7c2e5476ed7e17e25456f">  253</a></span>tf2::Vector3 <a class="code hl_function" href="namespacemotion__computation_1_1conversion_1_1impl.html#aa543f123dea7c2e5476ed7e17e25456f">transform_to_map_frame</a>(</div>
<div class="line"><a id="l00254" name="l00254"></a><span class="lineno">  254</span>  <span class="keyword">const</span> tf2::Vector3 &amp; ecef_point, <span class="keyword">const</span> lanelet::projection::LocalFrameProjector &amp; map_projector)</div>
<div class="line"><a id="l00255" name="l00255"></a><span class="lineno">  255</span>{</div>
<div class="line"><a id="l00256" name="l00256"></a><span class="lineno">  256</span>  lanelet::BasicPoint3d map_point = map_projector.projectECEF(</div>
<div class="line"><a id="l00257" name="l00257"></a><span class="lineno">  257</span>    {ecef_point.x(), ecef_point.y(), ecef_point.z()},</div>
<div class="line"><a id="l00258" name="l00258"></a><span class="lineno">  258</span>    -1);  <span class="comment">// Input should already be converted to m</span></div>
<div class="line"><a id="l00259" name="l00259"></a><span class="lineno">  259</span> </div>
<div class="line"><a id="l00260" name="l00260"></a><span class="lineno">  260</span>  <span class="keywordflow">return</span> tf2::Vector3(map_point.x(), map_point.y(), map_point.z());</div>
<div class="line"><a id="l00261" name="l00261"></a><span class="lineno">  261</span>}</div>
<div class="line"><a id="l00262" name="l00262"></a><span class="lineno">  262</span>}  <span class="comment">// namespace impl</span></div>
<div class="line"><a id="l00263" name="l00263"></a><span class="lineno">  263</span> </div>
<div class="line"><a id="l00264" name="l00264"></a><span class="lineno">  264</span>}  <span class="comment">// namespace conversion</span></div>
<div class="line"><a id="l00265" name="l00265"></a><span class="lineno">  265</span> </div>
<div class="line"><a id="l00266" name="l00266"></a><span class="lineno">  266</span>}  <span class="comment">// namespace motion_computation</span></div>
<div class="ttc" id="amobility__path__to__external__object__helpers_8hpp_html"><div class="ttname"><a href="mobility__path__to__external__object__helpers_8hpp.html">mobility_path_to_external_object_helpers.hpp</a></div></div>
<div class="ttc" id="anamespacemotion__computation_1_1conversion_1_1impl_html_a3dcbeb3180ab008815e6e7749796d147"><div class="ttname"><a href="namespacemotion__computation_1_1conversion_1_1impl.html#a3dcbeb3180ab008815e6e7749796d147">motion_computation::conversion::impl::getYawFromQuaternionMsg</a></div><div class="ttdeci">double getYawFromQuaternionMsg(const geometry_msgs::msg::Quaternion &amp;quaternion)</div><div class="ttdoc">Gets the yaw angle in degrees described by the provided quaternion.</div><div class="ttdef"><b>Definition:</b> <a href="mobility__path__to__external__object_8cpp_source.html#l00237">mobility_path_to_external_object.cpp:237</a></div></div>
<div class="ttc" id="anamespacemotion__computation_1_1conversion_1_1impl_html_aa543f123dea7c2e5476ed7e17e25456f"><div class="ttname"><a href="namespacemotion__computation_1_1conversion_1_1impl.html#aa543f123dea7c2e5476ed7e17e25456f">motion_computation::conversion::impl::transform_to_map_frame</a></div><div class="ttdeci">tf2::Vector3 transform_to_map_frame(const tf2::Vector3 &amp;ecef_point, const lanelet::projection::LocalFrameProjector &amp;map_projector)</div><div class="ttdoc">Transforms ecef point to map frame using internally saved map transform.</div><div class="ttdef"><b>Definition:</b> <a href="mobility__path__to__external__object_8cpp_source.html#l00253">mobility_path_to_external_object.cpp:253</a></div></div>
<div class="ttc" id="anamespacemotion__computation_1_1conversion_1_1impl_html_aa87a85102ac70d15b834d6e1cd3d9429"><div class="ttname"><a href="namespacemotion__computation_1_1conversion_1_1impl.html#aa87a85102ac70d15b834d6e1cd3d9429">motion_computation::conversion::impl::calculateAngVelocityOfPredictedStates</a></div><div class="ttdeci">void calculateAngVelocityOfPredictedStates(carma_perception_msgs::msg::ExternalObject &amp;object)</div><div class="ttdoc">Helper function to fill in the angular velocity of the external object.</div><div class="ttdef"><b>Definition:</b> <a href="mobility__path__to__external__object_8cpp_source.html#l00211">mobility_path_to_external_object.cpp:211</a></div></div>
<div class="ttc" id="anamespacemotion__computation_1_1conversion_1_1impl_html_abb4c108e6903a12b1dff436ef0e6d825"><div class="ttname"><a href="namespacemotion__computation_1_1conversion_1_1impl.html#abb4c108e6903a12b1dff436ef0e6d825">motion_computation::conversion::impl::composePredictedState</a></div><div class="ttdeci">std::pair&lt; carma_perception_msgs::msg::PredictedState, double &gt; composePredictedState(const tf2::Vector3 &amp;curr_pt, const tf2::Vector3 &amp;prev_pt, const rclcpp::Time &amp;prev_time_stamp, const rclcpp::Time &amp;curr_time_stamp, double prev_yaw)</div><div class="ttdoc">Composes a PredictedState message form a provided current point and previous point....</div><div class="ttdef"><b>Definition:</b> <a href="mobility__path__to__external__object_8cpp_source.html#l00166">mobility_path_to_external_object.cpp:166</a></div></div>
<div class="ttc" id="anamespacemotion__computation_1_1conversion_html_a9884e63460f3d5f5e2b755354984dc29"><div class="ttname"><a href="namespacemotion__computation_1_1conversion.html#a9884e63460f3d5f5e2b755354984dc29">motion_computation::conversion::convert</a></div><div class="ttdeci">void convert(const carma_v2x_msgs::msg::PSM &amp;in_msg, carma_perception_msgs::msg::ExternalObject &amp;out_msg, const std::string &amp;map_frame_id, double pred_period, double pred_step_size, const lanelet::projection::LocalFrameProjector &amp;map_projector, const tf2::Quaternion &amp;ned_in_map_rotation, rclcpp::node_interfaces::NodeClockInterface::SharedPtr node_clock)</div><div class="ttdef"><b>Definition:</b> <a href="psm__to__external__object__convertor_8cpp_source.html#l00038">psm_to_external_object_convertor.cpp:38</a></div></div>
<div class="ttc" id="anamespacemotion__computation_html"><div class="ttname"><a href="namespacemotion__computation.html">motion_computation</a></div><div class="ttdef"><b>Definition:</b> <a href="mobility__path__to__external__object__helpers_8hpp_source.html#l00028">mobility_path_to_external_object_helpers.hpp:29</a></div></div>
<div class="ttc" id="anamespaceprocess__bag_html_af102a02c97622dd30b0dbf7bafb0d199"><div class="ttname"><a href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">process_bag.i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="process__bag_8py_source.html#l00059">process_bag.py:59</a></div></div>
<div class="ttc" id="astdint_8h_html_a435d1572bf3f880d55459d9805097f62"><div class="ttname"><a href="stdint_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a></div><div class="ttdeci">unsigned int uint32_t</div><div class="ttdef"><b>Definition:</b> <a href="stdint_8h_source.html#l00126">stdint.h:126</a></div></div>
<div class="ttc" id="astdint_8h_html_aba7bc1797add20fe3efdf37ced1182c5"><div class="ttname"><a href="stdint_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a></div><div class="ttdeci">unsigned char uint8_t</div><div class="ttdef"><b>Definition:</b> <a href="stdint_8h_source.html#l00124">stdint.h:124</a></div></div>
<div class="ttc" id="astdint_8h_html_aec6fcb673ff035718c238c8c9d544c47"><div class="ttname"><a href="stdint_8h.html#aec6fcb673ff035718c238c8c9d544c47">uint64_t</a></div><div class="ttdeci">unsigned __int64 uint64_t</div><div class="ttdef"><b>Definition:</b> <a href="stdint_8h_source.html#l00136">stdint.h:136</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_63e6aad264477fa7f28f31d2fc233dbe.html">motion_computation</a></li><li class="navelem"><a class="el" href="dir_54c025c2a7d69c52f0ce93d682ccc770.html">src</a></li><li class="navelem"><a class="el" href="mobility__path__to__external__object_8cpp.html">mobility_path_to_external_object.cpp</a></li>
    <li class="footer">Generated on Thu Sep 28 2023 16:05:18 for Carma-platform by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.4 </li>
  </ul>
</div>
</body>
</html>
