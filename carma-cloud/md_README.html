<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Carma-cloud: README</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Carma-cloud<span id="projectnumber">&#160;v4.2.0</span>
   </div>
   <div id="projectbrief">CARMAcloud provides some of the infrastructure components for CARMA. It enables users to define geofences, rules of practice, replay storms to test weather-related rules of practice, as well as monitor CARMA-enabled vehicles and the messages and controls exchanged with them.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md_README.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">README </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p >| CicleCI Build Status | |---&mdash;| <a href="https://circleci.com/gh/usdot-fhwa-stol/carma-cloud"><img src="https://circleci.com/gh/usdot-fhwa-stol/carma-cloud.svg?style=svg" alt="CircleCI" style="pointer-events: none;" class="inline"/></a></p>
<h1><a class="anchor" id="autotoc_md0"></a>
CARMAcloud</h1>
<h2><a class="anchor" id="autotoc_md1"></a>
Documentation</h2>
<p >CARMAcloud provides some of the infrastructure components for CARMA. It enables users to define geofences, rules of practice, replay storms to test weather-related rules of practice, as well as monitor CARMA-enabled vehicles and the messages and controls exchanged with them. Additional documentation can be found on the <a href="https://usdot-fhwa-stol.github.io/documentation/carma-cloud/">Doxygen Source Code Documentation page</a>.</p>
<h2><a class="anchor" id="autotoc_md2"></a>
Deployment</h2>
<p >CARMAcloud can be deployed on a Linux server. Ensure you have a properly configured git client and Java Development Kit before executing the following commands (some paths may have to be updated depending on the version and installation of the JDK): </p><div class="fragment"><div class="line">#!/bin/bash</div>
<div class="line"># java and javac must be executable from the command line</div>
<div class="line"> </div>
<div class="line"># update and get required packages</div>
<div class="line">sudo apt-get update</div>
<div class="line">sudo apt-get install pkg-config sqlite3 libsqlite3-dev iptables</div>
<div class="line"> </div>
<div class="line"># download, compile, and install proj needed to process XODR files</div>
<div class="line">cd /tmp</div>
<div class="line">wget https://download.osgeo.org/proj/proj-6.1.1.tar.gz</div>
<div class="line">tar -xzf proj-6.1.1.tar.gz</div>
<div class="line">mv proj-6.1.1 proj</div>
<div class="line">cd proj</div>
<div class="line">./configure</div>
<div class="line">make</div>
<div class="line">sudo make install</div>
<div class="line">rm -rf proj</div>
<div class="line">rm -f proj-6.1.1.tar.gz</div>
<div class="line"> </div>
<div class="line"># get Apache Tomcat</div>
<div class="line">cd /tmp</div>
<div class="line">wget https://archive.apache.org/dist/tomcat/tomcat-9/v9.0.34/bin/apache-tomcat-9.0.34.tar.gz</div>
<div class="line">tar -xzf apache-tomcat-9.0.34.tar.gz</div>
<div class="line">mv apache-tomcat-9.0.34 tomcat</div>
<div class="line">rm -rf tomcat/webapps/ROOT</div>
<div class="line">rm -rf tomcat/webapps/docs</div>
<div class="line">rm -rf tomcat/webapps/examples</div>
<div class="line">rm -rf tomcat/webapps/host-manager</div>
<div class="line">rm -rf tomcat/webapps/manager</div>
<div class="line">rm -f apache-tomcat-9.0.34.tar.gz</div>
<div class="line"> </div>
<div class="line"># get source code and compile</div>
<div class="line">git clone https://github.com/usdot-fhwa-stol/carma-cloud.git carma-cloud</div>
<div class="line">mkdir -p tomcat/webapps/carmacloud/ROOT/WEB-INF/classes</div>
<div class="line">find ./carma-cloud/src -name &quot;*.java&quot; &gt; sources.txt</div>
<div class="line">javac -cp &quot;tomcat/lib/servlet-api.jar:carma-cloud/lib/*&quot; -d tomcat/webapps/carmacloud/ROOT/WEB-INF/classes @sources.txt</div>
<div class="line">rm -f sources.txt</div>
<div class="line"> </div>
<div class="line"># configure webapp</div>
<div class="line">chmod 755 carma-cloud/*.sh</div>
<div class="line">mv carma-cloud/iptables.sh tomcat</div>
<div class="line">mv carma-cloud/end_cc.sh tomcat</div>
<div class="line">mv carma-cloud/start_cc.sh tomcat</div>
<div class="line">mkdir -p tomcat/work/carmacloud/xodr</div>
<div class="line">mkdir -p tomcat/work/carmacloud/validate/xodr</div>
<div class="line">mv carma-cloud/web/WEB-INF/web.xml tomcat/webapps/carmacloud/ROOT/WEB-INF/</div>
<div class="line">mv carma-cloud/web/WEB-INF/log4j2.properties tomcat/webapps/carmacloud/ROOT/WEB-INF/classes/</div>
<div class="line">mv -n carma-cloud/web/* tomcat/webapps/carmacloud/ROOT/</div>
<div class="line">sudo mv carma-cloud/lib/libcs2cswrapper.so /usr/lib/</div>
<div class="line">mv carma-cloud/lib tomcat/webapps/carmacloud/ROOT/WEB-INF/</div>
<div class="line">touch tomcat/webapps/carmacloud/event.csv</div>
<div class="line">mv carma-cloud/osmbin/rop.csv tomcat/webapps/carmacloud/</div>
<div class="line">mv carma-cloud/osmbin/storm.csv tomcat/webapps/carmacloud/</div>
<div class="line">mv carma-cloud/osmbin/units.csv tomcat/webapps/carmacloud/</div>
<div class="line">gunzip carma-cloud/osmbin/*.gz</div>
<div class="line">mv carma-cloud/osmbin tomcat/webapps/carmacloud/</div>
<div class="line">java -cp tomcat/webapps/carmacloud/ROOT/WEB-INF/classes/:tomcat/lib/servlet-api.jar cc.ws.UserMgr ccadmin admin_testpw &gt; tomcat/webapps/carmacloud/user.csv</div>
<div class="line">rm -rf carma-cloud</div>
<div class="line"> </div>
<div class="line"># configure network and set privileges</div>
<div class="line">sed -i &#39;/&lt;\/Engine&gt;/ i \ \ \ \ \  &lt;Host name=&quot;carmacloud&quot; appBase=&quot;webapps/carmacloud&quot; unpackWARs=&quot;false&quot; autoDeploy=&quot;false&quot;&gt;\n      &lt;/Host&gt;&#39; tomcat/conf/server.xml </div>
<div class="line">echo -e &#39;127.0.0.1\tcarmacloud&#39; | sudo tee -a /etc/hosts</div>
<div class="line">sudo groupadd tomcat</div>
<div class="line">sudo useradd -g tomcat -m tomcat</div>
<div class="line">chmod g+r tomcat/conf/*</div>
<div class="line">chmod -R o-rwx tomcat/webapps/*</div>
<div class="line">sudo chown -R root:tomcat tomcat</div>
<div class="line">sudo chown -R tomcat:tomcat tomcat/logs</div>
<div class="line">sudo chown -R tomcat:tomcat tomcat/temp</div>
<div class="line">sudo chown -R tomcat:tomcat tomcat/work</div>
<div class="line">sudo mv tomcat /opt/</div>
<div class="line"> </div>
<div class="line"># the iptables script is needed to redirect ports 80 and 443 to 8080 and 8443</div>
<div class="line"># and is only necessary to execute once when the machine is restarted</div>
<div class="line"># sudo /opt/tomcat/iptables.sh</div>
<div class="line"> </div>
<div class="line"># these commands are needed when the v2xhub is using SSH tunneling</div>
<div class="line"># echo -e &#39;127.0.0.1\ttcmreplyhost&#39; | sudo tee -a /etc/hosts</div>
<div class="line"># sudo groupadd v2xhub</div>
<div class="line"># sudo useradd -g v2xhub -m v2xhub</div>
<div class="line"> </div>
<div class="line"># start tomcat using /opt/tomcat/start_cc.sh</div>
<div class="line"># stop tomcat using /opt/tomcat/end_cc.sh</div>
</div><!-- fragment --><p> These commands will download the CARMAcloud source code from github, necessary dependencies, and the tomcat webserver. Changes to the tomcat version might be necessary if version 9.0.34 is no longer available on the Apache mirror. You can also download tomcat directly from the tomcat website. Tomcat cannot bind the port 80 when ran as the tomcat user, so iptables is used to redirect port 80 to 8080. Next the java code will be compiled and the .class files will be placed in the correct directory. Tomcat's server.xml file will have the carmacloud host entry inserted in the correct location. Carmacloud will be added to the /etc/hosts file. The java command that runs <a class="el" href="classcc_1_1ws_1_1UserMgr.html">cc.ws.UserMgr</a> will create the ccadmin user for the system. It is suggested to change to password to something more secure by replacing "admin_testpw" with the desired password in the command. Groups and users for tomcat and v2xhub will be created. </p>
<h2><a class="anchor" id="autotoc_md3"></a>
Configuration</h2>
<p >The Tomcat webserver must be configured to run on the deployment server. Click <a href="https://tomcat.apache.org/tomcat-9.0-doc/index.html">here</a> to find the documentation for Tomcat. There are many configuration items to considered but two that must be addressed for any deployment of the system are adding the domain name and SSL Certificate to the server.xml file. Proper security measures dealing with file permissions should be taken as well. According to Tomcat's <a href="https://tomcat.apache.org/tomcat-9.0-doc/security-howto.html#System_Properties">documentation</a> a tomcat user and group should be created in the operating system. The standard configuration for file permissions is to have all Tomcat files owned by root with group tomcat. Owner should have read/write permissions, group should have read permission, and world has no permissions. The exceptions are the logs, temp and work directory that are owned by the tomcat user rather than root. Additional users can be added to CARMAcloud by running the following command and replacing &lt;username&gt; and &lt;password&gt; with the desired user name and password respectively: </p><div class="fragment"><div class="line">java -cp /opt/tomcat/webapps/carmacloud/ROOT/WEB-INF/classes/:/opt/tomcat/lib/servlet-api.jar cc.ws.UserMgr &lt;username&gt; &lt;password&gt; &gt;&gt; /opt/tomcat/webapps/carmacloud/user.csv</div>
</div><!-- fragment --><p> Additionally, you will need to generate an <a href="https://account.mapbox.com/access-tokens/">access token</a> from Mapbox, and replace the text &lt;your access token goes here&gt; with your access token in the /opt/tomcat/webapps/carmacloud/ROOT/script/map.js file. The domain names in /opt/tomcat/webapps/ROOT/mapbox/sourcelayers.json and /opt/tomcat/webapps/ROOT/mapbox/validatexodr_sourcelayers.json files must be updated to match the domain name the Mapbox access token is associated with. File paths may need to be updated in web.xml for the servlets which describe where to find and save data files for CARMACloud. XODR files to be processed must be placed into the /opt/tomcat/work/carmacloud/xodr folder before starting the system. To easily navigate around XODR generated traffic control sets, add shortcut center coordinates to the /opt/tomcat/webapps/carmacloud/ROOT/mapbox/jumpto.json object in the format "label": [lon, lat]. Once everything is configured for the deployment, convenience scripts have been included to start and stop Tomcat which can be ran with the following commands: </p><div class="fragment"><div class="line">/opt/tomcat/start_cc.sh</div>
<div class="line">/opt/tomcat/end_cc.sh</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md4"></a>
Bounds File for IHP2 Speed Harmonization</h3>
<p >This file allows the configuration of subsegments to be used for the IHP2 Speed Harmonization algorithm. The file consists of sections separated by a blank line. Each section has n number of lines. Each line describes a rectangular polygon that represents one subsegment for the algorithm. The first polygon of each section is the furthest downstream subsegment of a path along a road. Polygons must be defined by four points such that all lanes in a single direction of travel are encompassed by the polygon. The first point needs to be at the beginning of the subsegment, in regards to direction of travel, closest to the left edge of the lanes. The second point then follows the direction of travel to the end of the subsegment’s left edge. The third point is at the end of the subsegment’s right edge. The fourth point is at the beginning of the subsegment’s left edge. Arranging the points in this order should result in an open polygon with a clockwise order of points. The maxspeed traffic controls generated by the algorithm will have the geometries of these polygons. <br  />
 Example:</p>
<blockquote class="doxtable">
<p >&zwj;x<sub>0</sub><sub>0</sub>,y<sub>0</sub><sub>0</sub>,x<sub>0</sub><sub>1</sub>,y<sub>0</sub><sub>1</sub>,x<sub>0</sub><sub>2</sub>,y<sub>0</sub><sub>2</sub>,x<sub>0</sub><sub>3</sub>,y<sub>0</sub><sub>3</sub> // furthest downstream subsegment of path 0 <br  />
 x<sub>1</sub><sub>0</sub>,y<sub>1</sub><sub>0</sub>,x<sub>1</sub><sub>1</sub>,y<sub>1</sub><sub>1</sub>,x<sub>1</sub><sub>2</sub>,y<sub>1</sub><sub>2</sub>,x<sub>1</sub><sub>3</sub>,y<sub>1</sub><sub>3</sub> <br  />
 ... <br  />
 x<sub>(n-2)</sub><sub>0</sub>,y<sub>(n-2)</sub><sub>0</sub>,x<sub>(n-2)</sub><sub>1</sub>,y<sub>(n-2)</sub><sub>1</sub>,x<sub>(n-2)</sub><sub>2</sub>,y<sub>(n-2)</sub><sub>2</sub>,x<sub>(n-2)</sub><sub>3</sub>,y<sub>(n-2)</sub><sub>3</sub> <br  />
 x<sub>(n-1)</sub><sub>0</sub>,y<sub>(n-1)</sub><sub>0</sub>,x<sub>(n-1)</sub><sub>1</sub>,y<sub>(n-1)</sub><sub>1</sub>,x<sub>(n-1)</sub><sub>2</sub>,y<sub>(n-1)</sub><sub>2</sub>,x<sub>(n-1)</sub><sub>3</sub>,y<sub>(n-1)</sub><sub>3</sub> <br  />
 <br  />
 x<sub>0</sub><sub>0</sub>,y<sub>0</sub><sub>0</sub>,x<sub>0</sub><sub>1</sub>,y<sub>0</sub><sub>1</sub>,x<sub>0</sub><sub>2</sub>,y<sub>0</sub><sub>2</sub>,x<sub>0</sub><sub>3</sub>,y<sub>0</sub><sub>3</sub> // furthest downstream subsegment of path 1 <br  />
 x<sub>1</sub><sub>0</sub>,y<sub>1</sub><sub>0</sub>,x<sub>1</sub><sub>1</sub>,y<sub>1</sub><sub>1</sub>,x<sub>1</sub><sub>2</sub>,y<sub>1</sub><sub>2</sub>,x<sub>1</sub><sub>3</sub>,y<sub>1</sub><sub>3</sub> <br  />
 ... <br  />
 x<sub>(n-2)</sub><sub>0</sub>,y<sub>(n-2)</sub><sub>0</sub>,x<sub>(n-2)</sub><sub>1</sub>,y<sub>(n-2)</sub><sub>1</sub>,x<sub>(n-2)</sub><sub>2</sub>,y<sub>(n-2)</sub><sub>2</sub>,x<sub>(n-2)</sub><sub>3</sub>,y<sub>(n-2)</sub><sub>3</sub> <br  />
 x<sub>(n-1)</sub><sub>0</sub>,y<sub>(n-1)</sub><sub>0</sub>,x<sub>(n-1)</sub><sub>1</sub>,y<sub>(n-1)</sub><sub>1</sub>,x<sub>(n-1)</sub><sub>2</sub>,y<sub>(n-1)</sub><sub>2</sub>,x<sub>(n-1)</sub><sub>3</sub>,y<sub>(n-1)</sub><sub>3</sub> <br  />
 </p>
</blockquote>
<h2><a class="anchor" id="autotoc_md5"></a>
Contribution</h2>
<p >Welcome to the CARMA contributing guide. Please read this guide to learn about our development process, how to propose pull requests and improvements, and how to build and test your changes to this project. CARMA Contributing Guide</p>
<h2><a class="anchor" id="autotoc_md6"></a>
Code of Conduct</h2>
<p >Please read our CARMA Code of Conduct which outlines our expectations for participants within the CARMA community, as well as steps to reporting unacceptable behavior. We are committed to providing a welcoming and inspiring community for all and expect our code of conduct to be honored. Anyone who violates this code of conduct may be banned from the community.</p>
<h2><a class="anchor" id="autotoc_md7"></a>
Attribution</h2>
<p >The development team would like to acknowledge the people who have made direct contributions to the design and code in this repository. CARMA Attribution</p>
<h2><a class="anchor" id="autotoc_md8"></a>
License</h2>
<p >By contributing to the Federal Highway Administration (FHWA) Connected Automated Research Mobility Applications (CARMA), you agree that your contributions will be licensed under its Apache License 2.0 license. CARMA License</p>
<h2><a class="anchor" id="autotoc_md9"></a>
Contact</h2>
<p >Please click on the CARMA logo below to visit the Federal Highway Adminstration(FHWA) CARMA website. For more information, contact <a href="#" onclick="location.href='mai'+'lto:'+'CAR'+'MA'+'@do'+'t.'+'gov'; return false;">CARMA<span class="obfuscator">.nosp@m.</span>@dot<span class="obfuscator">.nosp@m.</span>.gov</a>.</p>
<p ><a href="https://highways.dot.gov/research/research-programs/operations/CARMA"><img src="docs/image/CARMA_icon2.png" alt="CARMA Image" class="inline"/></a> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Wed Oct 19 2022 20:37:43 for Carma-cloud by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.4 </li>
  </ul>
</div>
</body>
</html>
