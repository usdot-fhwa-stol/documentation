<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Carma-platform: approaching_emergency_vehicle_plugin/src/approaching_emergency_vehicle_plugin_node.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Carma-platform<span id="projectnumber">&#160;v4.2.0</span>
   </div>
   <div id="projectbrief">CARMA Platform is built on robot operating system (ROS) and utilizes open source software (OSS) that enables Cooperative Driving Automation (CDA) features to allow Automated Driving Systems to interact and cooperate with infrastructure and other vehicles through communication.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('approaching__emergency__vehicle__plugin__node_8cpp_source.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle"><div class="title">approaching_emergency_vehicle_plugin_node.cpp</div></div>
</div><!--header-->
<div class="contents">
<a href="approaching__emergency__vehicle__plugin__node_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a id="l00001" name="l00001"></a><span class="lineno">    1</span><span class="comment">/*</span></div>
<div class="line"><a id="l00002" name="l00002"></a><span class="lineno">    2</span><span class="comment"> * Copyright (C) 2022-2023 LEIDOS.</span></div>
<div class="line"><a id="l00003" name="l00003"></a><span class="lineno">    3</span><span class="comment"> *</span></div>
<div class="line"><a id="l00004" name="l00004"></a><span class="lineno">    4</span><span class="comment"> * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); you may not</span></div>
<div class="line"><a id="l00005" name="l00005"></a><span class="lineno">    5</span><span class="comment"> * use this file except in compliance with the License. You may obtain a copy of</span></div>
<div class="line"><a id="l00006" name="l00006"></a><span class="lineno">    6</span><span class="comment"> * the License at</span></div>
<div class="line"><a id="l00007" name="l00007"></a><span class="lineno">    7</span><span class="comment"> *</span></div>
<div class="line"><a id="l00008" name="l00008"></a><span class="lineno">    8</span><span class="comment"> * http://www.apache.org/licenses/LICENSE-2.0</span></div>
<div class="line"><a id="l00009" name="l00009"></a><span class="lineno">    9</span><span class="comment"> *</span></div>
<div class="line"><a id="l00010" name="l00010"></a><span class="lineno">   10</span><span class="comment"> * Unless required by applicable law or agreed to in writing, software</span></div>
<div class="line"><a id="l00011" name="l00011"></a><span class="lineno">   11</span><span class="comment"> * distributed under the License is distributed on an &quot;AS IS&quot; BASIS, WITHOUT</span></div>
<div class="line"><a id="l00012" name="l00012"></a><span class="lineno">   12</span><span class="comment"> * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the</span></div>
<div class="line"><a id="l00013" name="l00013"></a><span class="lineno">   13</span><span class="comment"> * License for the specific language governing permissions and limitations under</span></div>
<div class="line"><a id="l00014" name="l00014"></a><span class="lineno">   14</span><span class="comment"> * the License.</span></div>
<div class="line"><a id="l00015" name="l00015"></a><span class="lineno">   15</span><span class="comment"> */</span></div>
<div class="line"><a id="l00016" name="l00016"></a><span class="lineno">   16</span><span class="preprocessor">#include &quot;<a class="code" href="approaching__emergency__vehicle__plugin__node_8hpp.html">approaching_emergency_vehicle_plugin/approaching_emergency_vehicle_plugin_node.hpp</a>&quot;</span></div>
<div class="line"><a id="l00017" name="l00017"></a><span class="lineno">   17</span> </div>
<div class="line"><a id="l00018" name="l00018"></a><span class="lineno">   18</span><span class="keyword">namespace </span><a class="code hl_namespace" href="namespaceapproaching__emergency__vehicle__plugin.html">approaching_emergency_vehicle_plugin</a></div>
<div class="line"><a id="l00019" name="l00019"></a><span class="lineno">   19</span>{</div>
<div class="line"><a id="l00020" name="l00020"></a><span class="lineno">   20</span>  <span class="keyword">namespace </span>std_ph = std::placeholders;</div>
<div class="line"><a id="l00021" name="l00021"></a><span class="lineno">   21</span> </div>
<div class="line"><a id="l00022" name="l00022"></a><span class="lineno"><a class="line" href="namespaceapproaching__emergency__vehicle__plugin_1_1anonymous__namespace_02approaching__emergenc6b477e4cfd274375085cbaf134e12178.html">   22</a></span>  <span class="keyword">namespace </span>{</div>
<div class="line"><a id="l00027" name="l00027"></a><span class="lineno"><a class="line" href="namespaceapproaching__emergency__vehicle__plugin_1_1anonymous__namespace_02approaching__emergenc6b477e4cfd274375085cbaf134e12178.html#a824526918073d730865d3616fded75c4">   27</a></span>    <span class="keywordtype">double</span> <a class="code hl_function" href="namespaceapproaching__emergency__vehicle__plugin_1_1anonymous__namespace_02approaching__emergenc6b477e4cfd274375085cbaf134e12178.html#a824526918073d730865d3616fded75c4">getManeuverEndSpeed</a>(<span class="keyword">const</span> carma_planning_msgs::msg::Maneuver&amp; mvr) { </div>
<div class="line"><a id="l00028" name="l00028"></a><span class="lineno">   28</span>      <span class="keywordflow">switch</span>(mvr.type) {</div>
<div class="line"><a id="l00029" name="l00029"></a><span class="lineno">   29</span>        <span class="keywordflow">case</span> carma_planning_msgs::msg::Maneuver::LANE_FOLLOWING:</div>
<div class="line"><a id="l00030" name="l00030"></a><span class="lineno">   30</span>          <span class="keywordflow">return</span> mvr.lane_following_maneuver.end_speed;</div>
<div class="line"><a id="l00031" name="l00031"></a><span class="lineno">   31</span>        <span class="keywordflow">case</span> carma_planning_msgs::msg::Maneuver::LANE_CHANGE:</div>
<div class="line"><a id="l00032" name="l00032"></a><span class="lineno">   32</span>          <span class="keywordflow">return</span> mvr.lane_change_maneuver.end_speed;</div>
<div class="line"><a id="l00033" name="l00033"></a><span class="lineno">   33</span>        <span class="keywordflow">case</span> carma_planning_msgs::msg::Maneuver::STOP_AND_WAIT:</div>
<div class="line"><a id="l00034" name="l00034"></a><span class="lineno">   34</span>          <span class="keywordflow">return</span> 0;</div>
<div class="line"><a id="l00035" name="l00035"></a><span class="lineno">   35</span>        <span class="keywordflow">default</span>:</div>
<div class="line"><a id="l00036" name="l00036"></a><span class="lineno">   36</span>          <span class="keywordflow">return</span> 0;</div>
<div class="line"><a id="l00037" name="l00037"></a><span class="lineno">   37</span>      }</div>
<div class="line"><a id="l00038" name="l00038"></a><span class="lineno">   38</span>    }</div>
<div class="line"><a id="l00039" name="l00039"></a><span class="lineno">   39</span>  }</div>
<div class="line"><a id="l00040" name="l00040"></a><span class="lineno">   40</span> </div>
<div class="line"><a id="l00041" name="l00041"></a><span class="lineno"><a class="line" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a64b2e3d4c85214a564d689882a2506b3">   41</a></span>  <a class="code hl_function" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a64b2e3d4c85214a564d689882a2506b3">ApproachingEmergencyVehiclePlugin::ApproachingEmergencyVehiclePlugin</a>(<span class="keyword">const</span> rclcpp::NodeOptions &amp;options)</div>
<div class="line"><a id="l00042" name="l00042"></a><span class="lineno">   42</span>      : <a class="code hl_namespace" href="namespacecarma__guidance__plugins.html">carma_guidance_plugins</a>::StrategicPlugin(options)</div>
<div class="line"><a id="l00043" name="l00043"></a><span class="lineno">   43</span>  {</div>
<div class="line"><a id="l00044" name="l00044"></a><span class="lineno">   44</span>    <span class="comment">// Create initial config</span></div>
<div class="line"><a id="l00045" name="l00045"></a><span class="lineno">   45</span>    <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a> = <a class="code hl_struct" href="structapproaching__emergency__vehicle__plugin_1_1Config.html">Config</a>();</div>
<div class="line"><a id="l00046" name="l00046"></a><span class="lineno">   46</span> </div>
<div class="line"><a id="l00047" name="l00047"></a><span class="lineno">   47</span>    <span class="comment">// Declare parameters</span></div>
<div class="line"><a id="l00048" name="l00048"></a><span class="lineno">   48</span>    <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a3f55d992021d18a02478cbc07ef0bb25">passing_threshold</a> = declare_parameter&lt;double&gt;(<span class="stringliteral">&quot;passing_threshold&quot;</span>, <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a3f55d992021d18a02478cbc07ef0bb25">passing_threshold</a>);</div>
<div class="line"><a id="l00049" name="l00049"></a><span class="lineno">   49</span>    <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a78537e382e029464ea6fa1d1e9053cd5">approaching_threshold</a> = declare_parameter&lt;double&gt;(<span class="stringliteral">&quot;approaching_threshold&quot;</span>, <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a78537e382e029464ea6fa1d1e9053cd5">approaching_threshold</a>);</div>
<div class="line"><a id="l00050" name="l00050"></a><span class="lineno">   50</span>    <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a7573a5e45947f7d8fa3504161936bd19">finished_passing_threshold</a> = declare_parameter&lt;double&gt;(<span class="stringliteral">&quot;finished_passing_threshold&quot;</span>, <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a7573a5e45947f7d8fa3504161936bd19">finished_passing_threshold</a>);</div>
<div class="line"><a id="l00051" name="l00051"></a><span class="lineno">   51</span>    <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a2617bd4b6850d11f938dfd39efb0ad1c">min_lane_following_duration_before_lane_change</a> = declare_parameter&lt;double&gt;(<span class="stringliteral">&quot;min_lane_following_duration_before_lane_change&quot;</span>, <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a2617bd4b6850d11f938dfd39efb0ad1c">min_lane_following_duration_before_lane_change</a>);</div>
<div class="line"><a id="l00052" name="l00052"></a><span class="lineno">   52</span>    <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a2e6f2566571a01c095800f712e8ee183">bsm_processing_frequency</a> = declare_parameter&lt;double&gt;(<span class="stringliteral">&quot;bsm_processing_frequency&quot;</span>, <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a2e6f2566571a01c095800f712e8ee183">bsm_processing_frequency</a>);</div>
<div class="line"><a id="l00053" name="l00053"></a><span class="lineno">   53</span>    <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#acd12c1b7c7c6546c81679ace095f0c7c">speed_limit_reduction_during_passing</a> = declare_parameter&lt;double&gt;(<span class="stringliteral">&quot;speed_limit_reduction_during_passing&quot;</span>, <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#acd12c1b7c7c6546c81679ace095f0c7c">speed_limit_reduction_during_passing</a>);</div>
<div class="line"><a id="l00054" name="l00054"></a><span class="lineno">   54</span>    <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a7d48d943b50100d1c3e2099c36070da9">minimum_reduced_speed_limit</a> = declare_parameter&lt;double&gt;(<span class="stringliteral">&quot;minimum_reduced_speed_limit&quot;</span>, <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a7d48d943b50100d1c3e2099c36070da9">minimum_reduced_speed_limit</a>);</div>
<div class="line"><a id="l00055" name="l00055"></a><span class="lineno">   55</span>    <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a64b3bef57508c81e9403778f1415d3be">default_speed_limit</a> = declare_parameter&lt;double&gt;(<span class="stringliteral">&quot;default_speed_limit&quot;</span>, <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a64b3bef57508c81e9403778f1415d3be">default_speed_limit</a>);</div>
<div class="line"><a id="l00056" name="l00056"></a><span class="lineno">   56</span>    <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#ad8731d21c88e346dd0d379680afdde72">reduced_speed_buffer</a> = declare_parameter&lt;double&gt;(<span class="stringliteral">&quot;reduced_speed_buffer&quot;</span>, <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#ad8731d21c88e346dd0d379680afdde72">reduced_speed_buffer</a>);</div>
<div class="line"><a id="l00057" name="l00057"></a><span class="lineno">   57</span>    <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#ae64572ff061924d56fa9998852a2a945">timeout_check_frequency</a> = declare_parameter&lt;double&gt;(<span class="stringliteral">&quot;timeout_check_frequency&quot;</span>, <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#ae64572ff061924d56fa9998852a2a945">timeout_check_frequency</a>);</div>
<div class="line"><a id="l00058" name="l00058"></a><span class="lineno">   58</span>    <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a021c15bd670c461bd74b23f40ce28594">timeout_duration</a> = declare_parameter&lt;double&gt;(<span class="stringliteral">&quot;timeout_duration&quot;</span>, <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a021c15bd670c461bd74b23f40ce28594">timeout_duration</a>);</div>
<div class="line"><a id="l00059" name="l00059"></a><span class="lineno">   59</span>    <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a82d53d570af61ab41e04d4a27243102e">minimal_plan_duration</a> = declare_parameter&lt;double&gt;(<span class="stringliteral">&quot;minimal_plan_duration&quot;</span>, <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a82d53d570af61ab41e04d4a27243102e">minimal_plan_duration</a>);</div>
<div class="line"><a id="l00060" name="l00060"></a><span class="lineno">   60</span>    <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a725f395f09130e206956a7deb30f6644">buffer_distance_before_stopping</a> = declare_parameter&lt;double&gt;(<span class="stringliteral">&quot;buffer_distance_before_stopping&quot;</span>, <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a725f395f09130e206956a7deb30f6644">buffer_distance_before_stopping</a>);</div>
<div class="line"><a id="l00061" name="l00061"></a><span class="lineno">   61</span>    <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a789e82d1b4c4ebcfe2019fd9808019d8">stopping_accel_limit_multiplier</a> = declare_parameter&lt;double&gt;(<span class="stringliteral">&quot;stopping_accel_limit_multiplier&quot;</span>, <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a789e82d1b4c4ebcfe2019fd9808019d8">stopping_accel_limit_multiplier</a>);</div>
<div class="line"><a id="l00062" name="l00062"></a><span class="lineno">   62</span>    <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a1b30e6e0c5ce1e2eefa70b1af6e941eb">vehicle_acceleration_limit</a> = declare_parameter&lt;double&gt;(<span class="stringliteral">&quot;vehicle_acceleration_limit&quot;</span>, <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a1b30e6e0c5ce1e2eefa70b1af6e941eb">vehicle_acceleration_limit</a>);</div>
<div class="line"><a id="l00063" name="l00063"></a><span class="lineno">   63</span>    <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#ae1af2f64a5f86e70ea737bb9b0370cdd">route_end_point_buffer</a> = declare_parameter&lt;double&gt;(<span class="stringliteral">&quot;route_end_point_buffer&quot;</span>, <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#ae1af2f64a5f86e70ea737bb9b0370cdd">route_end_point_buffer</a>);</div>
<div class="line"><a id="l00064" name="l00064"></a><span class="lineno">   64</span>    <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#abf16d22f1b3443854a970a490e2cc97d">approaching_erv_status_publication_frequency</a> = declare_parameter&lt;double&gt;(<span class="stringliteral">&quot;approaching_erv_status_publication_frequency&quot;</span>, <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#abf16d22f1b3443854a970a490e2cc97d">approaching_erv_status_publication_frequency</a>);</div>
<div class="line"><a id="l00065" name="l00065"></a><span class="lineno">   65</span>    <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a0bacd4168f75ca1d5c784847ebf52598">warning_broadcast_frequency</a> = declare_parameter&lt;double&gt;(<span class="stringliteral">&quot;warning_broadcast_frequency&quot;</span>, <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a0bacd4168f75ca1d5c784847ebf52598">warning_broadcast_frequency</a>);</div>
<div class="line"><a id="l00066" name="l00066"></a><span class="lineno">   66</span>    <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a357d49d8f1e6e554bf550a1f873c63bc">max_warning_broadcasts</a> = declare_parameter&lt;int&gt;(<span class="stringliteral">&quot;max_warning_broadcasts&quot;</span>, <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a357d49d8f1e6e554bf550a1f873c63bc">max_warning_broadcasts</a>);</div>
<div class="line"><a id="l00067" name="l00067"></a><span class="lineno">   67</span>    <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#afe9dff631c6c75497bbecfe6f6029753">vehicle_length</a> = declare_parameter&lt;double&gt;(<span class="stringliteral">&quot;vehicle_length&quot;</span>, <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#afe9dff631c6c75497bbecfe6f6029753">vehicle_length</a>);</div>
<div class="line"><a id="l00068" name="l00068"></a><span class="lineno">   68</span>    <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a2bad9c38f2c863cb52ce08c89c2ed0f8">lane_following_plugin</a> = declare_parameter&lt;std::string&gt;(<span class="stringliteral">&quot;lane_following_plugin&quot;</span>, <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a2bad9c38f2c863cb52ce08c89c2ed0f8">lane_following_plugin</a>);</div>
<div class="line"><a id="l00069" name="l00069"></a><span class="lineno">   69</span>    <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a6dd3156876736b67368486db8f4fcc7f">lane_change_plugin</a> = declare_parameter&lt;std::string&gt;(<span class="stringliteral">&quot;lane_change_plugin&quot;</span>, <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a6dd3156876736b67368486db8f4fcc7f">lane_change_plugin</a>);</div>
<div class="line"><a id="l00070" name="l00070"></a><span class="lineno">   70</span>    <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#aa70358d5fbdea25512a0e0dd2750a3ea">vehicle_id</a> = declare_parameter&lt;std::string&gt;(<span class="stringliteral">&quot;vehicle_id&quot;</span>, <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#aa70358d5fbdea25512a0e0dd2750a3ea">vehicle_id</a>);</div>
<div class="line"><a id="l00071" name="l00071"></a><span class="lineno">   71</span> </div>
<div class="line"><a id="l00072" name="l00072"></a><span class="lineno">   72</span>    <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a34b6121fd1201177d180f616f635a260">erv_world_model_</a>.reset(<span class="keyword">new</span> <a class="code hl_class" href="classcarma__wm_1_1CARMAWorldModel.html">carma_wm::CARMAWorldModel</a>);</div>
<div class="line"><a id="l00073" name="l00073"></a><span class="lineno">   73</span>  }</div>
<div class="line"><a id="l00074" name="l00074"></a><span class="lineno">   74</span> </div>
<div class="line"><a id="l00075" name="l00075"></a><span class="lineno"><a class="line" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a0f6b68218b4b0b130f8d14e5610b8980">   75</a></span>  rcl_interfaces::msg::SetParametersResult <a class="code hl_function" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a0f6b68218b4b0b130f8d14e5610b8980">ApproachingEmergencyVehiclePlugin::parameter_update_callback</a>(<span class="keyword">const</span> std::vector&lt;rclcpp::Parameter&gt; &amp;parameters)</div>
<div class="line"><a id="l00076" name="l00076"></a><span class="lineno">   76</span>  {</div>
<div class="line"><a id="l00077" name="l00077"></a><span class="lineno">   77</span>    <span class="keyword">auto</span> error_1 = update_params&lt;double&gt;({</div>
<div class="line"><a id="l00078" name="l00078"></a><span class="lineno">   78</span>        {<span class="stringliteral">&quot;passing_threshold&quot;</span>, <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a3f55d992021d18a02478cbc07ef0bb25">passing_threshold</a>},</div>
<div class="line"><a id="l00079" name="l00079"></a><span class="lineno">   79</span>        {<span class="stringliteral">&quot;approaching_threshold&quot;</span>, <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a78537e382e029464ea6fa1d1e9053cd5">approaching_threshold</a>},</div>
<div class="line"><a id="l00080" name="l00080"></a><span class="lineno">   80</span>        {<span class="stringliteral">&quot;finished_passing_threshold&quot;</span>, <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a7573a5e45947f7d8fa3504161936bd19">finished_passing_threshold</a>},</div>
<div class="line"><a id="l00081" name="l00081"></a><span class="lineno">   81</span>        {<span class="stringliteral">&quot;min_lane_following_duration_before_lane_change&quot;</span>, <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a2617bd4b6850d11f938dfd39efb0ad1c">min_lane_following_duration_before_lane_change</a>},</div>
<div class="line"><a id="l00082" name="l00082"></a><span class="lineno">   82</span>        {<span class="stringliteral">&quot;bsm_processing_frequency&quot;</span>, <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a2e6f2566571a01c095800f712e8ee183">bsm_processing_frequency</a>},</div>
<div class="line"><a id="l00083" name="l00083"></a><span class="lineno">   83</span>        {<span class="stringliteral">&quot;speed_limit_reduction_during_passing&quot;</span>, <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#acd12c1b7c7c6546c81679ace095f0c7c">speed_limit_reduction_during_passing</a>},</div>
<div class="line"><a id="l00084" name="l00084"></a><span class="lineno">   84</span>        {<span class="stringliteral">&quot;minimum_reduced_speed_limit&quot;</span>, <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a7d48d943b50100d1c3e2099c36070da9">minimum_reduced_speed_limit</a>},</div>
<div class="line"><a id="l00085" name="l00085"></a><span class="lineno">   85</span>        {<span class="stringliteral">&quot;default_speed_limit&quot;</span>, <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a64b3bef57508c81e9403778f1415d3be">default_speed_limit</a>},</div>
<div class="line"><a id="l00086" name="l00086"></a><span class="lineno">   86</span>        {<span class="stringliteral">&quot;reduced_speed_buffer&quot;</span>, <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#ad8731d21c88e346dd0d379680afdde72">reduced_speed_buffer</a>},</div>
<div class="line"><a id="l00087" name="l00087"></a><span class="lineno">   87</span>        {<span class="stringliteral">&quot;timeout_check_frequency&quot;</span>, <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#ae64572ff061924d56fa9998852a2a945">timeout_check_frequency</a>},</div>
<div class="line"><a id="l00088" name="l00088"></a><span class="lineno">   88</span>        {<span class="stringliteral">&quot;timeout_duration&quot;</span>, <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a021c15bd670c461bd74b23f40ce28594">timeout_duration</a>},</div>
<div class="line"><a id="l00089" name="l00089"></a><span class="lineno">   89</span>        {<span class="stringliteral">&quot;minimal_plan_duration&quot;</span>, <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a82d53d570af61ab41e04d4a27243102e">minimal_plan_duration</a>},</div>
<div class="line"><a id="l00090" name="l00090"></a><span class="lineno">   90</span>        {<span class="stringliteral">&quot;buffer_distance_before_stopping&quot;</span>, <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a725f395f09130e206956a7deb30f6644">buffer_distance_before_stopping</a>},</div>
<div class="line"><a id="l00091" name="l00091"></a><span class="lineno">   91</span>        {<span class="stringliteral">&quot;stopping_accel_limit_multiplier&quot;</span>, <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a789e82d1b4c4ebcfe2019fd9808019d8">stopping_accel_limit_multiplier</a>},</div>
<div class="line"><a id="l00092" name="l00092"></a><span class="lineno">   92</span>        {<span class="stringliteral">&quot;vehicle_acceleration_limit&quot;</span>, <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a1b30e6e0c5ce1e2eefa70b1af6e941eb">vehicle_acceleration_limit</a>},</div>
<div class="line"><a id="l00093" name="l00093"></a><span class="lineno">   93</span>        {<span class="stringliteral">&quot;route_end_point_buffer&quot;</span>, <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#ae1af2f64a5f86e70ea737bb9b0370cdd">route_end_point_buffer</a>},</div>
<div class="line"><a id="l00094" name="l00094"></a><span class="lineno">   94</span>        {<span class="stringliteral">&quot;approaching_erv_status_publication_frequency&quot;</span>, <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#abf16d22f1b3443854a970a490e2cc97d">approaching_erv_status_publication_frequency</a>},</div>
<div class="line"><a id="l00095" name="l00095"></a><span class="lineno">   95</span>        {<span class="stringliteral">&quot;warning_broadcast_frequency&quot;</span>, <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a0bacd4168f75ca1d5c784847ebf52598">warning_broadcast_frequency</a>},</div>
<div class="line"><a id="l00096" name="l00096"></a><span class="lineno">   96</span>        {<span class="stringliteral">&quot;vehicle_length&quot;</span>, <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#afe9dff631c6c75497bbecfe6f6029753">vehicle_length</a>}</div>
<div class="line"><a id="l00097" name="l00097"></a><span class="lineno">   97</span>    }, parameters);</div>
<div class="line"><a id="l00098" name="l00098"></a><span class="lineno">   98</span> </div>
<div class="line"><a id="l00099" name="l00099"></a><span class="lineno">   99</span>    <span class="keyword">auto</span> error_2 = update_params&lt;int&gt;({</div>
<div class="line"><a id="l00100" name="l00100"></a><span class="lineno">  100</span>        {<span class="stringliteral">&quot;max_warning_broadcasts&quot;</span>, <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a357d49d8f1e6e554bf550a1f873c63bc">max_warning_broadcasts</a>}</div>
<div class="line"><a id="l00101" name="l00101"></a><span class="lineno">  101</span>    }, parameters);</div>
<div class="line"><a id="l00102" name="l00102"></a><span class="lineno">  102</span> </div>
<div class="line"><a id="l00103" name="l00103"></a><span class="lineno">  103</span>    <span class="keyword">auto</span> error_3 = update_params&lt;std::string&gt;({</div>
<div class="line"><a id="l00104" name="l00104"></a><span class="lineno">  104</span>        {<span class="stringliteral">&quot;lane_following_plugin&quot;</span>, <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a2bad9c38f2c863cb52ce08c89c2ed0f8">lane_following_plugin</a>},</div>
<div class="line"><a id="l00105" name="l00105"></a><span class="lineno">  105</span>        {<span class="stringliteral">&quot;lane_change_plugin&quot;</span>, <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a6dd3156876736b67368486db8f4fcc7f">lane_change_plugin</a>},</div>
<div class="line"><a id="l00106" name="l00106"></a><span class="lineno">  106</span>        {<span class="stringliteral">&quot;stop_and_wait_plugin&quot;</span>, <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a859e48c953178140090bbf4d89744f86">stop_and_wait_plugin</a>},</div>
<div class="line"><a id="l00107" name="l00107"></a><span class="lineno">  107</span>        {<span class="stringliteral">&quot;vehicle_id&quot;</span>, <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#aa70358d5fbdea25512a0e0dd2750a3ea">vehicle_id</a>}</div>
<div class="line"><a id="l00108" name="l00108"></a><span class="lineno">  108</span>    }, parameters);</div>
<div class="line"><a id="l00109" name="l00109"></a><span class="lineno">  109</span> </div>
<div class="line"><a id="l00110" name="l00110"></a><span class="lineno">  110</span>    rcl_interfaces::msg::SetParametersResult result;</div>
<div class="line"><a id="l00111" name="l00111"></a><span class="lineno">  111</span> </div>
<div class="line"><a id="l00112" name="l00112"></a><span class="lineno">  112</span>    result.successful = !error_1 &amp;&amp; !error_2 &amp;&amp; !error_3;</div>
<div class="line"><a id="l00113" name="l00113"></a><span class="lineno">  113</span> </div>
<div class="line"><a id="l00114" name="l00114"></a><span class="lineno">  114</span>    <span class="keywordflow">return</span> result;</div>
<div class="line"><a id="l00115" name="l00115"></a><span class="lineno">  115</span>  }</div>
<div class="line"><a id="l00116" name="l00116"></a><span class="lineno">  116</span> </div>
<div class="line"><a id="l00117" name="l00117"></a><span class="lineno"><a class="line" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a66731fd9e4c54bcf32d9d00b666bf955">  117</a></span>  carma_ros2_utils::CallbackReturn <a class="code hl_function" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a66731fd9e4c54bcf32d9d00b666bf955">ApproachingEmergencyVehiclePlugin::on_configure_plugin</a>()</div>
<div class="line"><a id="l00118" name="l00118"></a><span class="lineno">  118</span>  {</div>
<div class="line"><a id="l00119" name="l00119"></a><span class="lineno">  119</span>    RCLCPP_INFO_STREAM(rclcpp::get_logger(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6d19969dc5f588661e25aa3575127405">logger_name</a>), <span class="stringliteral">&quot;ApproachingEmergencyVehiclePlugin trying to configure&quot;</span>);</div>
<div class="line"><a id="l00120" name="l00120"></a><span class="lineno">  120</span> </div>
<div class="line"><a id="l00121" name="l00121"></a><span class="lineno">  121</span>    <span class="comment">// Reset config</span></div>
<div class="line"><a id="l00122" name="l00122"></a><span class="lineno">  122</span>    <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a> = <a class="code hl_struct" href="structapproaching__emergency__vehicle__plugin_1_1Config.html">Config</a>();</div>
<div class="line"><a id="l00123" name="l00123"></a><span class="lineno">  123</span> </div>
<div class="line"><a id="l00124" name="l00124"></a><span class="lineno">  124</span>    <span class="comment">// Load parameters</span></div>
<div class="line"><a id="l00125" name="l00125"></a><span class="lineno">  125</span>    get_parameter&lt;double&gt;(<span class="stringliteral">&quot;passing_threshold&quot;</span>, <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a3f55d992021d18a02478cbc07ef0bb25">passing_threshold</a>);</div>
<div class="line"><a id="l00126" name="l00126"></a><span class="lineno">  126</span>    get_parameter&lt;double&gt;(<span class="stringliteral">&quot;approaching_threshold&quot;</span>, <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a78537e382e029464ea6fa1d1e9053cd5">approaching_threshold</a>);</div>
<div class="line"><a id="l00127" name="l00127"></a><span class="lineno">  127</span>    get_parameter&lt;double&gt;(<span class="stringliteral">&quot;finished_passing_threshold&quot;</span>, <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a7573a5e45947f7d8fa3504161936bd19">finished_passing_threshold</a>);</div>
<div class="line"><a id="l00128" name="l00128"></a><span class="lineno">  128</span>    get_parameter&lt;double&gt;(<span class="stringliteral">&quot;min_lane_following_duration_before_lane_change&quot;</span>, <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a2617bd4b6850d11f938dfd39efb0ad1c">min_lane_following_duration_before_lane_change</a>);</div>
<div class="line"><a id="l00129" name="l00129"></a><span class="lineno">  129</span>    get_parameter&lt;double&gt;(<span class="stringliteral">&quot;bsm_processing_frequency&quot;</span>, <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a2e6f2566571a01c095800f712e8ee183">bsm_processing_frequency</a>);</div>
<div class="line"><a id="l00130" name="l00130"></a><span class="lineno">  130</span>    get_parameter&lt;double&gt;(<span class="stringliteral">&quot;speed_limit_reduction_during_passing&quot;</span>, <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#acd12c1b7c7c6546c81679ace095f0c7c">speed_limit_reduction_during_passing</a>);</div>
<div class="line"><a id="l00131" name="l00131"></a><span class="lineno">  131</span>    get_parameter&lt;double&gt;(<span class="stringliteral">&quot;minimum_reduced_speed_limit&quot;</span>, <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a7d48d943b50100d1c3e2099c36070da9">minimum_reduced_speed_limit</a>);</div>
<div class="line"><a id="l00132" name="l00132"></a><span class="lineno">  132</span>    get_parameter&lt;double&gt;(<span class="stringliteral">&quot;default_speed_limit&quot;</span>, <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a64b3bef57508c81e9403778f1415d3be">default_speed_limit</a>);</div>
<div class="line"><a id="l00133" name="l00133"></a><span class="lineno">  133</span>    get_parameter&lt;double&gt;(<span class="stringliteral">&quot;reduced_speed_buffer&quot;</span>, <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#ad8731d21c88e346dd0d379680afdde72">reduced_speed_buffer</a>);</div>
<div class="line"><a id="l00134" name="l00134"></a><span class="lineno">  134</span>    get_parameter&lt;double&gt;(<span class="stringliteral">&quot;timeout_check_frequency&quot;</span>, <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#ae64572ff061924d56fa9998852a2a945">timeout_check_frequency</a>);</div>
<div class="line"><a id="l00135" name="l00135"></a><span class="lineno">  135</span>    get_parameter&lt;double&gt;(<span class="stringliteral">&quot;timeout_duration&quot;</span>, <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a021c15bd670c461bd74b23f40ce28594">timeout_duration</a>);</div>
<div class="line"><a id="l00136" name="l00136"></a><span class="lineno">  136</span>    get_parameter&lt;double&gt;(<span class="stringliteral">&quot;minimal_plan_duration&quot;</span>, <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a82d53d570af61ab41e04d4a27243102e">minimal_plan_duration</a>);</div>
<div class="line"><a id="l00137" name="l00137"></a><span class="lineno">  137</span>    get_parameter&lt;double&gt;(<span class="stringliteral">&quot;buffer_distance_before_stopping&quot;</span>, <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a725f395f09130e206956a7deb30f6644">buffer_distance_before_stopping</a>);</div>
<div class="line"><a id="l00138" name="l00138"></a><span class="lineno">  138</span>    get_parameter&lt;double&gt;(<span class="stringliteral">&quot;stopping_accel_limit_multiplier&quot;</span>, <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a789e82d1b4c4ebcfe2019fd9808019d8">stopping_accel_limit_multiplier</a>);</div>
<div class="line"><a id="l00139" name="l00139"></a><span class="lineno">  139</span>    get_parameter&lt;double&gt;(<span class="stringliteral">&quot;vehicle_acceleration_limit&quot;</span>, <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a1b30e6e0c5ce1e2eefa70b1af6e941eb">vehicle_acceleration_limit</a>);</div>
<div class="line"><a id="l00140" name="l00140"></a><span class="lineno">  140</span>    get_parameter&lt;double&gt;(<span class="stringliteral">&quot;route_end_point_buffer&quot;</span>, <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#ae1af2f64a5f86e70ea737bb9b0370cdd">route_end_point_buffer</a>);</div>
<div class="line"><a id="l00141" name="l00141"></a><span class="lineno">  141</span>    get_parameter&lt;double&gt;(<span class="stringliteral">&quot;approaching_erv_status_publication_frequency&quot;</span>, <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#abf16d22f1b3443854a970a490e2cc97d">approaching_erv_status_publication_frequency</a>);</div>
<div class="line"><a id="l00142" name="l00142"></a><span class="lineno">  142</span>    get_parameter&lt;double&gt;(<span class="stringliteral">&quot;warning_broadcast_frequency&quot;</span>, <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a0bacd4168f75ca1d5c784847ebf52598">warning_broadcast_frequency</a>);</div>
<div class="line"><a id="l00143" name="l00143"></a><span class="lineno">  143</span>    get_parameter&lt;double&gt;(<span class="stringliteral">&quot;vehicle_length&quot;</span>, <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#afe9dff631c6c75497bbecfe6f6029753">vehicle_length</a>);</div>
<div class="line"><a id="l00144" name="l00144"></a><span class="lineno">  144</span>    get_parameter&lt;int&gt;(<span class="stringliteral">&quot;max_warning_broadcasts&quot;</span>, <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a357d49d8f1e6e554bf550a1f873c63bc">max_warning_broadcasts</a>);</div>
<div class="line"><a id="l00145" name="l00145"></a><span class="lineno">  145</span>    get_parameter&lt;std::string&gt;(<span class="stringliteral">&quot;lane_following_plugin&quot;</span>, <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a2bad9c38f2c863cb52ce08c89c2ed0f8">lane_following_plugin</a>);</div>
<div class="line"><a id="l00146" name="l00146"></a><span class="lineno">  146</span>    get_parameter&lt;std::string&gt;(<span class="stringliteral">&quot;lane_change_plugin&quot;</span>, <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a6dd3156876736b67368486db8f4fcc7f">lane_change_plugin</a>);</div>
<div class="line"><a id="l00147" name="l00147"></a><span class="lineno">  147</span>    get_parameter&lt;std::string&gt;(<span class="stringliteral">&quot;vehicle_id&quot;</span>, <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#aa70358d5fbdea25512a0e0dd2750a3ea">vehicle_id</a>);</div>
<div class="line"><a id="l00148" name="l00148"></a><span class="lineno">  148</span> </div>
<div class="line"><a id="l00149" name="l00149"></a><span class="lineno">  149</span>    RCLCPP_INFO_STREAM(rclcpp::get_logger(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6d19969dc5f588661e25aa3575127405">logger_name</a>), <span class="stringliteral">&quot;ApproachingEmergencyVehiclePlugin Config: &quot;</span> &lt;&lt; <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>);</div>
<div class="line"><a id="l00150" name="l00150"></a><span class="lineno">  150</span> </div>
<div class="line"><a id="l00151" name="l00151"></a><span class="lineno">  151</span>    <span class="comment">// Register runtime parameter update callback</span></div>
<div class="line"><a id="l00152" name="l00152"></a><span class="lineno">  152</span>    add_on_set_parameters_callback(std::bind(&amp;<a class="code hl_function" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a0f6b68218b4b0b130f8d14e5610b8980">ApproachingEmergencyVehiclePlugin::parameter_update_callback</a>, <span class="keyword">this</span>, std_ph::_1));</div>
<div class="line"><a id="l00153" name="l00153"></a><span class="lineno">  153</span> </div>
<div class="line"><a id="l00154" name="l00154"></a><span class="lineno">  154</span>    <span class="comment">// Setup subscribers</span></div>
<div class="line"><a id="l00155" name="l00155"></a><span class="lineno">  155</span>    <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a30c5c0501e991b36887ce37fea83d8ab">incoming_bsm_sub_</a> = create_subscription&lt;carma_v2x_msgs::msg::BSM&gt;(<span class="stringliteral">&quot;incoming_bsm&quot;</span>, 1,</div>
<div class="line"><a id="l00156" name="l00156"></a><span class="lineno">  156</span>                                            std::bind(&amp;<a class="code hl_function" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#aaa56c5f7f80a2f087d52d150d15cf469">ApproachingEmergencyVehiclePlugin::incomingBsmCallback</a>, <span class="keyword">this</span>, std_ph::_1));</div>
<div class="line"><a id="l00157" name="l00157"></a><span class="lineno">  157</span> </div>
<div class="line"><a id="l00158" name="l00158"></a><span class="lineno">  158</span>    <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a595311fe524963efff473b1aa6212d68">georeference_sub_</a> = create_subscription&lt;std_msgs::msg::String&gt;(<span class="stringliteral">&quot;georeference&quot;</span>, 10,</div>
<div class="line"><a id="l00159" name="l00159"></a><span class="lineno">  159</span>                                            std::bind(&amp;<a class="code hl_function" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#ae82911dd196e06a718423a36e46599fb">ApproachingEmergencyVehiclePlugin::georeferenceCallback</a>, <span class="keyword">this</span>, std_ph::_1));</div>
<div class="line"><a id="l00160" name="l00160"></a><span class="lineno">  160</span> </div>
<div class="line"><a id="l00161" name="l00161"></a><span class="lineno">  161</span>    <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#ab39e60f85abebb640a6609b08a4c0c56">route_state_sub_</a> = create_subscription&lt;carma_planning_msgs::msg::RouteState&gt;(<span class="stringliteral">&quot;route_state&quot;</span>, 10,</div>
<div class="line"><a id="l00162" name="l00162"></a><span class="lineno">  162</span>                                          std::bind(&amp;<a class="code hl_function" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a7476fdeab16d06ec8f63a227c3442509">ApproachingEmergencyVehiclePlugin::routeStateCallback</a>, <span class="keyword">this</span>, std_ph::_1));</div>
<div class="line"><a id="l00163" name="l00163"></a><span class="lineno">  163</span> </div>
<div class="line"><a id="l00164" name="l00164"></a><span class="lineno">  164</span>    <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a094474a9865cfbf427db6712038c1598">twist_sub_</a> = create_subscription&lt;geometry_msgs::msg::TwistStamped&gt;(<span class="stringliteral">&quot;current_velocity&quot;</span>, 10,</div>
<div class="line"><a id="l00165" name="l00165"></a><span class="lineno">  165</span>                                          std::bind(&amp;<a class="code hl_function" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#adfbecd63581b2c61f8e7311b9f4ab7bf">ApproachingEmergencyVehiclePlugin::twistCallback</a>, <span class="keyword">this</span>, std_ph::_1));</div>
<div class="line"><a id="l00166" name="l00166"></a><span class="lineno">  166</span> </div>
<div class="line"><a id="l00167" name="l00167"></a><span class="lineno">  167</span>    <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a1bd11a952f02b0438dc2ccdb2be84fd7">incoming_emergency_vehicle_ack_sub_</a> = create_subscription&lt;carma_v2x_msgs::msg::EmergencyVehicleAck&gt;(<span class="stringliteral">&quot;incoming_emergency_vehicle_ack&quot;</span>, 10,</div>
<div class="line"><a id="l00168" name="l00168"></a><span class="lineno">  168</span>                                                              std::bind(&amp;<a class="code hl_function" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a7ef61c32915b20b724e484a9d360bba6">ApproachingEmergencyVehiclePlugin::incomingEmergencyVehicleAckCallback</a>, <span class="keyword">this</span>, std_ph::_1));</div>
<div class="line"><a id="l00169" name="l00169"></a><span class="lineno">  169</span> </div>
<div class="line"><a id="l00170" name="l00170"></a><span class="lineno">  170</span>    <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#ae68527687b83a7f7e110227227f4ca86">guidance_state_sub_</a> = create_subscription&lt;carma_planning_msgs::msg::GuidanceState&gt;(<span class="stringliteral">&quot;state&quot;</span>, 1,</div>
<div class="line"><a id="l00171" name="l00171"></a><span class="lineno">  171</span>                                          std::bind(&amp;<a class="code hl_function" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a7c6d5af8582efd73bf65759b5d94a31b">ApproachingEmergencyVehiclePlugin::guidanceStateCallback</a>, <span class="keyword">this</span>, std_ph::_1));</div>
<div class="line"><a id="l00172" name="l00172"></a><span class="lineno">  172</span> </div>
<div class="line"><a id="l00173" name="l00173"></a><span class="lineno">  173</span>    <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a0ff341dde225f7a9c2998ff6ca667380">route_sub_</a> = create_subscription&lt;carma_planning_msgs::msg::Route&gt;(<span class="stringliteral">&quot;route&quot;</span>, 1,</div>
<div class="line"><a id="l00174" name="l00174"></a><span class="lineno">  174</span>                                          std::bind(&amp;<a class="code hl_function" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#acd5999c8b36406c5768b731e948515a7">ApproachingEmergencyVehiclePlugin::routeCallback</a>, <span class="keyword">this</span>, std_ph::_1));</div>
<div class="line"><a id="l00175" name="l00175"></a><span class="lineno">  175</span> </div>
<div class="line"><a id="l00176" name="l00176"></a><span class="lineno">  176</span>    <span class="comment">// Setup publishers</span></div>
<div class="line"><a id="l00177" name="l00177"></a><span class="lineno">  177</span>    <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a73cec161f50fc84eda21769703f992c1">outgoing_emergency_vehicle_response_pub_</a> = create_publisher&lt;carma_v2x_msgs::msg::EmergencyVehicleResponse&gt;(<span class="stringliteral">&quot;outgoing_emergency_vehicle_response&quot;</span>, 10);</div>
<div class="line"><a id="l00178" name="l00178"></a><span class="lineno">  178</span> </div>
<div class="line"><a id="l00179" name="l00179"></a><span class="lineno">  179</span>    <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a3d4f7411cbacc2aa4b5ffc0eac18e72d">approaching_erv_status_pub_</a> = create_publisher&lt;carma_msgs::msg::UIInstructions&gt;(<span class="stringliteral">&quot;approaching_erv_status&quot;</span>, 10);</div>
<div class="line"><a id="l00180" name="l00180"></a><span class="lineno">  180</span> </div>
<div class="line"><a id="l00181" name="l00181"></a><span class="lineno">  181</span>    <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a1d4bc5024634987d7de58ae0ea86e215">hazard_light_cmd_pub_</a> = create_publisher&lt;std_msgs::msg::Bool&gt;(<span class="stringliteral">&quot;hazard_light_status&quot;</span>, 10);</div>
<div class="line"><a id="l00182" name="l00182"></a><span class="lineno">  182</span> </div>
<div class="line"><a id="l00183" name="l00183"></a><span class="lineno">  183</span>    <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a61b742aab762fff7983b3a1bf1a148b1">wm_</a> = <a class="code hl_function" href="classcarma__guidance__plugins_1_1PluginBaseNode.html#a50b54d5c4cc5180eeef0c78c55f70ec3">get_world_model</a>();</div>
<div class="line"><a id="l00184" name="l00184"></a><span class="lineno">  184</span> </div>
<div class="line"><a id="l00185" name="l00185"></a><span class="lineno">  185</span>    <span class="comment">// Return success if everything initialized successfully</span></div>
<div class="line"><a id="l00186" name="l00186"></a><span class="lineno">  186</span>    <span class="keywordflow">return</span> CallbackReturn::SUCCESS;</div>
<div class="line"><a id="l00187" name="l00187"></a><span class="lineno">  187</span>  }</div>
<div class="line"><a id="l00188" name="l00188"></a><span class="lineno">  188</span>  </div>
<div class="line"><a id="l00189" name="l00189"></a><span class="lineno"><a class="line" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a205bc91715867790de8d53f07c998a5f">  189</a></span>  carma_ros2_utils::CallbackReturn <a class="code hl_function" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a205bc91715867790de8d53f07c998a5f">ApproachingEmergencyVehiclePlugin::on_activate_plugin</a>()</div>
<div class="line"><a id="l00190" name="l00190"></a><span class="lineno">  190</span>  {</div>
<div class="line"><a id="l00191" name="l00191"></a><span class="lineno">  191</span>    <span class="comment">// Timer setup for generating a BSM</span></div>
<div class="line"><a id="l00192" name="l00192"></a><span class="lineno">  192</span>    <span class="keywordtype">int</span> erv_timeout_check_period_ms = (1 / <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#ae64572ff061924d56fa9998852a2a945">timeout_check_frequency</a>) * 1000; <span class="comment">// Conversion from frequency (Hz) to milliseconds time period</span></div>
<div class="line"><a id="l00193" name="l00193"></a><span class="lineno">  193</span>    <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a98318d5a9df6dfd338904e09e3fc273d">erv_timeout_timer_</a> = create_timer(get_clock(),</div>
<div class="line"><a id="l00194" name="l00194"></a><span class="lineno">  194</span>                          std::chrono::milliseconds(erv_timeout_check_period_ms),</div>
<div class="line"><a id="l00195" name="l00195"></a><span class="lineno">  195</span>                          std::bind(&amp;<a class="code hl_function" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a4a69c80c2408d169a77507645d624343">ApproachingEmergencyVehiclePlugin::checkForErvTimeout</a>, <span class="keyword">this</span>));</div>
<div class="line"><a id="l00196" name="l00196"></a><span class="lineno">  196</span> </div>
<div class="line"><a id="l00197" name="l00197"></a><span class="lineno">  197</span>    <span class="comment">// Timer setup for broadcasting EmergencyVehicleResponse warning message to an approaching ERV when the ego vehicle cannot change lanes out of the ERV&#39;s path</span></div>
<div class="line"><a id="l00198" name="l00198"></a><span class="lineno">  198</span>    <span class="keywordtype">int</span> emergency_vehicle_response_period_ms = (1 / <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a0bacd4168f75ca1d5c784847ebf52598">warning_broadcast_frequency</a>) * 1000; <span class="comment">// Conversion from frequency (Hz) to milliseconds time period</span></div>
<div class="line"><a id="l00199" name="l00199"></a><span class="lineno">  199</span>    <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#af5fddb700b315c676f4fcd1726dbf689">warning_broadcast_timer_</a> = create_timer(get_clock(),</div>
<div class="line"><a id="l00200" name="l00200"></a><span class="lineno">  200</span>                          std::chrono::milliseconds(emergency_vehicle_response_period_ms),</div>
<div class="line"><a id="l00201" name="l00201"></a><span class="lineno">  201</span>                          std::bind(&amp;<a class="code hl_function" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a313a23c801916d4e005326e2dcd7d57f">ApproachingEmergencyVehiclePlugin::broadcastWarningToErv</a>, <span class="keyword">this</span>));</div>
<div class="line"><a id="l00202" name="l00202"></a><span class="lineno">  202</span> </div>
<div class="line"><a id="l00203" name="l00203"></a><span class="lineno">  203</span>    <span class="comment">// Timer setup for publishing approaching ERV status update to the Web UI</span></div>
<div class="line"><a id="l00204" name="l00204"></a><span class="lineno">  204</span>    <span class="keywordtype">int</span> approaching_erv_status_period_ms = (1 / <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#abf16d22f1b3443854a970a490e2cc97d">approaching_erv_status_publication_frequency</a>) * 1000; <span class="comment">// Conversion from frequency (Hz) to milliseconds time period</span></div>
<div class="line"><a id="l00205" name="l00205"></a><span class="lineno">  205</span>    <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#aee090b42ea237395e287293d49f63f55">approaching_emergency_vehicle_status_timer_</a> = create_timer(get_clock(),</div>
<div class="line"><a id="l00206" name="l00206"></a><span class="lineno">  206</span>                          std::chrono::milliseconds(approaching_erv_status_period_ms),</div>
<div class="line"><a id="l00207" name="l00207"></a><span class="lineno">  207</span>                          std::bind(&amp;<a class="code hl_function" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a179dc5d96a5f9c0a775cdcd5a11df346">ApproachingEmergencyVehiclePlugin::publishApproachingErvStatus</a>, <span class="keyword">this</span>));</div>
<div class="line"><a id="l00208" name="l00208"></a><span class="lineno">  208</span> </div>
<div class="line"><a id="l00209" name="l00209"></a><span class="lineno">  209</span>    <span class="comment">// Timer setup for publishing hazard light ON/OFF status boolean</span></div>
<div class="line"><a id="l00210" name="l00210"></a><span class="lineno">  210</span>    <span class="keywordtype">int</span> hazard_light_status_ms = (1 / 30) * 1000; <span class="comment">// Conversion from frequency 30(Hz) to milliseconds time period</span></div>
<div class="line"><a id="l00211" name="l00211"></a><span class="lineno">  211</span>    <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#aa7487cfc92e82c63e0e99c155f384daa">hazard_light_timer_</a> = create_timer(get_clock(),</div>
<div class="line"><a id="l00212" name="l00212"></a><span class="lineno">  212</span>                          std::chrono::milliseconds(hazard_light_status_ms),</div>
<div class="line"><a id="l00213" name="l00213"></a><span class="lineno">  213</span>                          std::bind(&amp;<a class="code hl_function" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a92b0b752cbda0de62fd6f5b535aec238">ApproachingEmergencyVehiclePlugin::publishHazardLightStatus</a>, <span class="keyword">this</span>));</div>
<div class="line"><a id="l00214" name="l00214"></a><span class="lineno">  214</span> </div>
<div class="line"><a id="l00215" name="l00215"></a><span class="lineno">  215</span>    <span class="keywordflow">return</span> CallbackReturn::SUCCESS;</div>
<div class="line"><a id="l00216" name="l00216"></a><span class="lineno">  216</span>  }</div>
<div class="line"><a id="l00217" name="l00217"></a><span class="lineno">  217</span> </div>
<div class="line"><a id="l00218" name="l00218"></a><span class="lineno"><a class="line" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a92b0b752cbda0de62fd6f5b535aec238">  218</a></span>  <span class="keywordtype">void</span> <a class="code hl_function" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a92b0b752cbda0de62fd6f5b535aec238">ApproachingEmergencyVehiclePlugin::publishHazardLightStatus</a>()</div>
<div class="line"><a id="l00219" name="l00219"></a><span class="lineno">  219</span>  {</div>
<div class="line"><a id="l00220" name="l00220"></a><span class="lineno">  220</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a36f8f9b65fe9f2ebe9bbb09f3b1e2d8e">transition_table_</a>.<a class="code hl_function" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehicleTransitionTable.html#a4c74448ef5d30dcda8bbc4fecf054199">getState</a>() == <a class="code hl_enumvalue" href="namespaceapproaching__emergency__vehicle__plugin.html#aeb182d0e6c9d53e276e1b9935aff0630abe5a505910aae73e4a99392e4b36e99a">ApproachingEmergencyVehicleState::SLOWING_DOWN_FOR_ERV</a> &amp;&amp;</div>
<div class="line"><a id="l00221" name="l00221"></a><span class="lineno">  221</span>    <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6c454433ce5dedbf0f32bfb38f1404ed">has_tracked_erv_</a> &amp;&amp;</div>
<div class="line"><a id="l00222" name="l00222"></a><span class="lineno">  222</span>    <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a676b5bf0f041728d2413650885c9bd36">tracked_erv_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1ErvInformation.html#ac34d23f97859c1239886108d1e8c7828">lane_index</a> == <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a79f461d7ccc9669dc1b63a1826652861">ego_lane_index_</a>)</div>
<div class="line"><a id="l00223" name="l00223"></a><span class="lineno">  223</span>    {</div>
<div class="line"><a id="l00224" name="l00224"></a><span class="lineno">  224</span>      <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a8686dd7233e4181ec00daf3cfb77c705">hazard_light_cmd_</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00225" name="l00225"></a><span class="lineno">  225</span>    }</div>
<div class="line"><a id="l00226" name="l00226"></a><span class="lineno">  226</span>    <span class="keywordflow">else</span></div>
<div class="line"><a id="l00227" name="l00227"></a><span class="lineno">  227</span>    {</div>
<div class="line"><a id="l00228" name="l00228"></a><span class="lineno">  228</span>      <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a8686dd7233e4181ec00daf3cfb77c705">hazard_light_cmd_</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00229" name="l00229"></a><span class="lineno">  229</span>    }</div>
<div class="line"><a id="l00230" name="l00230"></a><span class="lineno">  230</span>    std_msgs::msg::Bool msg;</div>
<div class="line"><a id="l00231" name="l00231"></a><span class="lineno">  231</span>    msg.data = <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a8686dd7233e4181ec00daf3cfb77c705">hazard_light_cmd_</a>;</div>
<div class="line"><a id="l00232" name="l00232"></a><span class="lineno">  232</span>    <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a1d4bc5024634987d7de58ae0ea86e215">hazard_light_cmd_pub_</a>-&gt;publish(msg);</div>
<div class="line"><a id="l00233" name="l00233"></a><span class="lineno">  233</span>  }</div>
<div class="line"><a id="l00234" name="l00234"></a><span class="lineno">  234</span> </div>
<div class="line"><a id="l00235" name="l00235"></a><span class="lineno"><a class="line" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a4a69c80c2408d169a77507645d624343">  235</a></span>  <span class="keywordtype">void</span> <a class="code hl_function" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a4a69c80c2408d169a77507645d624343">ApproachingEmergencyVehiclePlugin::checkForErvTimeout</a>(){</div>
<div class="line"><a id="l00236" name="l00236"></a><span class="lineno">  236</span>    <span class="comment">// Trigger timeout event if a timeout has occurred for the currently tracked ERV</span></div>
<div class="line"><a id="l00237" name="l00237"></a><span class="lineno">  237</span>    <span class="keywordflow">if</span>(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6c454433ce5dedbf0f32bfb38f1404ed">has_tracked_erv_</a>){</div>
<div class="line"><a id="l00238" name="l00238"></a><span class="lineno">  238</span>      <span class="keywordtype">double</span> seconds_since_prev_update = (this-&gt;get_clock()-&gt;now() - <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a676b5bf0f041728d2413650885c9bd36">tracked_erv_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1ErvInformation.html#a6966afb86227f0e5edef2a03b142265a">latest_update_time</a>).seconds();</div>
<div class="line"><a id="l00239" name="l00239"></a><span class="lineno">  239</span> </div>
<div class="line"><a id="l00240" name="l00240"></a><span class="lineno">  240</span>      <span class="keywordflow">if</span>(seconds_since_prev_update &gt;= <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a021c15bd670c461bd74b23f40ce28594">timeout_duration</a>){</div>
<div class="line"><a id="l00241" name="l00241"></a><span class="lineno">  241</span>        RCLCPP_ERROR_STREAM(rclcpp::get_logger(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6d19969dc5f588661e25aa3575127405">logger_name</a>), <span class="stringliteral">&quot;Timeout occurred for ERV &quot;</span> &lt;&lt; <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a676b5bf0f041728d2413650885c9bd36">tracked_erv_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1ErvInformation.html#a2d25462696d7933e72bc33239c42287d">vehicle_id</a>);</div>
<div class="line"><a id="l00242" name="l00242"></a><span class="lineno">  242</span>        <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6c454433ce5dedbf0f32bfb38f1404ed">has_tracked_erv_</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00243" name="l00243"></a><span class="lineno">  243</span>        <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a529d40caad413492d989ab91eb48fdb6">has_planned_upcoming_lc_</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00244" name="l00244"></a><span class="lineno">  244</span>        <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a36f8f9b65fe9f2ebe9bbb09f3b1e2d8e">transition_table_</a>.<a class="code hl_function" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehicleTransitionTable.html#a8e2158634e7011225335a2674e08f305">event</a>(<a class="code hl_enumvalue" href="namespaceapproaching__emergency__vehicle__plugin.html#ae26e1cd128942ddf2ca8eccadb66a6caa9c81e8ddfa49697b5d0ec5d8eeb79674">ApproachingEmergencyVehicleEvent::ERV_UPDATE_TIMEOUT</a>);</div>
<div class="line"><a id="l00245" name="l00245"></a><span class="lineno">  245</span>      }</div>
<div class="line"><a id="l00246" name="l00246"></a><span class="lineno">  246</span>    }</div>
<div class="line"><a id="l00247" name="l00247"></a><span class="lineno">  247</span>  }</div>
<div class="line"><a id="l00248" name="l00248"></a><span class="lineno">  248</span> </div>
<div class="line"><a id="l00249" name="l00249"></a><span class="lineno"><a class="line" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a313a23c801916d4e005326e2dcd7d57f">  249</a></span>  <span class="keywordtype">void</span> <a class="code hl_function" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a313a23c801916d4e005326e2dcd7d57f">ApproachingEmergencyVehiclePlugin::broadcastWarningToErv</a>(){</div>
<div class="line"><a id="l00250" name="l00250"></a><span class="lineno">  250</span>    <span class="keywordflow">if</span>(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6c454433ce5dedbf0f32bfb38f1404ed">has_tracked_erv_</a> &amp;&amp; <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#ae65a1837d9f53d1d6fd7d240eb866585">should_broadcast_warnings_</a>){</div>
<div class="line"><a id="l00251" name="l00251"></a><span class="lineno">  251</span>      RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6d19969dc5f588661e25aa3575127405">logger_name</a>), <span class="stringliteral">&quot;Sending a warning message to &quot;</span> &lt;&lt; <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a676b5bf0f041728d2413650885c9bd36">tracked_erv_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1ErvInformation.html#a2d25462696d7933e72bc33239c42287d">vehicle_id</a>);</div>
<div class="line"><a id="l00252" name="l00252"></a><span class="lineno">  252</span> </div>
<div class="line"><a id="l00253" name="l00253"></a><span class="lineno">  253</span>      carma_v2x_msgs::msg::EmergencyVehicleResponse msg;</div>
<div class="line"><a id="l00254" name="l00254"></a><span class="lineno">  254</span>      msg.m_header.sender_id = <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#aa70358d5fbdea25512a0e0dd2750a3ea">vehicle_id</a>;</div>
<div class="line"><a id="l00255" name="l00255"></a><span class="lineno">  255</span>      msg.m_header.recipient_id = <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a676b5bf0f041728d2413650885c9bd36">tracked_erv_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1ErvInformation.html#a2d25462696d7933e72bc33239c42287d">vehicle_id</a>;</div>
<div class="line"><a id="l00256" name="l00256"></a><span class="lineno">  256</span> </div>
<div class="line"><a id="l00257" name="l00257"></a><span class="lineno">  257</span>      msg.can_change_lanes = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00258" name="l00258"></a><span class="lineno">  258</span>      msg.reason_exists = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00259" name="l00259"></a><span class="lineno">  259</span>      msg.reason = <span class="stringliteral">&quot;Vehicle &quot;</span> + <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#aa70358d5fbdea25512a0e0dd2750a3ea">vehicle_id</a> + <span class="stringliteral">&quot; is unable to change lanes.&quot;</span>;</div>
<div class="line"><a id="l00260" name="l00260"></a><span class="lineno">  260</span> </div>
<div class="line"><a id="l00261" name="l00261"></a><span class="lineno">  261</span>      <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a85e8e1b36feedaeeccc56f68eb072c4d">num_warnings_broadcasted_</a>++;</div>
<div class="line"><a id="l00262" name="l00262"></a><span class="lineno">  262</span> </div>
<div class="line"><a id="l00263" name="l00263"></a><span class="lineno">  263</span>      <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a73cec161f50fc84eda21769703f992c1">outgoing_emergency_vehicle_response_pub_</a>-&gt;publish(msg);</div>
<div class="line"><a id="l00264" name="l00264"></a><span class="lineno">  264</span> </div>
<div class="line"><a id="l00265" name="l00265"></a><span class="lineno">  265</span>      <span class="comment">// Reset counter and boolean flag if the maximum number of warnings have been broadcasted</span></div>
<div class="line"><a id="l00266" name="l00266"></a><span class="lineno">  266</span>      <span class="keywordflow">if</span>(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a85e8e1b36feedaeeccc56f68eb072c4d">num_warnings_broadcasted_</a> &gt;= <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a357d49d8f1e6e554bf550a1f873c63bc">max_warning_broadcasts</a>){</div>
<div class="line"><a id="l00267" name="l00267"></a><span class="lineno">  267</span>        RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6d19969dc5f588661e25aa3575127405">logger_name</a>), <span class="stringliteral">&quot;Maximum number of warning messages sent to &quot;</span> &lt;&lt; <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a676b5bf0f041728d2413650885c9bd36">tracked_erv_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1ErvInformation.html#a2d25462696d7933e72bc33239c42287d">vehicle_id</a>);</div>
<div class="line"><a id="l00268" name="l00268"></a><span class="lineno">  268</span>        <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a85e8e1b36feedaeeccc56f68eb072c4d">num_warnings_broadcasted_</a> = 0;</div>
<div class="line"><a id="l00269" name="l00269"></a><span class="lineno">  269</span>        <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#ae65a1837d9f53d1d6fd7d240eb866585">should_broadcast_warnings_</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00270" name="l00270"></a><span class="lineno">  270</span>      }</div>
<div class="line"><a id="l00271" name="l00271"></a><span class="lineno">  271</span>    }</div>
<div class="line"><a id="l00272" name="l00272"></a><span class="lineno">  272</span>  }</div>
<div class="line"><a id="l00273" name="l00273"></a><span class="lineno">  273</span> </div>
<div class="line"><a id="l00274" name="l00274"></a><span class="lineno"><a class="line" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a179dc5d96a5f9c0a775cdcd5a11df346">  274</a></span>  <span class="keywordtype">void</span> <a class="code hl_function" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a179dc5d96a5f9c0a775cdcd5a11df346">ApproachingEmergencyVehiclePlugin::publishApproachingErvStatus</a>(){</div>
<div class="line"><a id="l00275" name="l00275"></a><span class="lineno">  275</span>    <span class="comment">// Generate the status message and publish it to the applicable ROS topic</span></div>
<div class="line"><a id="l00276" name="l00276"></a><span class="lineno">  276</span>    carma_msgs::msg::UIInstructions status_msg = <a class="code hl_function" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#af67c4c7e6f31d34c1b2f0807548a7e1f">generateApproachingErvStatusMessage</a>();</div>
<div class="line"><a id="l00277" name="l00277"></a><span class="lineno">  277</span>    <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a3d4f7411cbacc2aa4b5ffc0eac18e72d">approaching_erv_status_pub_</a>-&gt;publish(status_msg);</div>
<div class="line"><a id="l00278" name="l00278"></a><span class="lineno">  278</span>  }</div>
<div class="line"><a id="l00279" name="l00279"></a><span class="lineno">  279</span>  </div>
<div class="line"><a id="l00280" name="l00280"></a><span class="lineno"><a class="line" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#af67c4c7e6f31d34c1b2f0807548a7e1f">  280</a></span>  carma_msgs::msg::UIInstructions <a class="code hl_function" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#af67c4c7e6f31d34c1b2f0807548a7e1f">ApproachingEmergencyVehiclePlugin::generateApproachingErvStatusMessage</a>(){</div>
<div class="line"><a id="l00281" name="l00281"></a><span class="lineno">  281</span>    <span class="comment">// Initialize the message that will be returned by this function</span></div>
<div class="line"><a id="l00282" name="l00282"></a><span class="lineno">  282</span>    carma_msgs::msg::UIInstructions status_msg;</div>
<div class="line"><a id="l00283" name="l00283"></a><span class="lineno">  283</span>    status_msg.type = carma_msgs::msg::UIInstructions::INFO;</div>
<div class="line"><a id="l00284" name="l00284"></a><span class="lineno">  284</span> </div>
<div class="line"><a id="l00294" name="l00294"></a><span class="lineno">  294</span>    boost::format fmter(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#af3cfbd2bb62c4365b119e8d7630dbc7a">APPROACHING_ERV_STATUS_PARAMS</a>);</div>
<div class="line"><a id="l00295" name="l00295"></a><span class="lineno">  295</span>    </div>
<div class="line"><a id="l00296" name="l00296"></a><span class="lineno">  296</span>    <span class="comment">// Index 0 of formatted string; indicates whether an ERV that is approaching the ego vehicle is being tracked</span></div>
<div class="line"><a id="l00297" name="l00297"></a><span class="lineno">  297</span>    <span class="keywordflow">if</span>(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6c454433ce5dedbf0f32bfb38f1404ed">has_tracked_erv_</a> &amp;&amp; <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a676b5bf0f041728d2413650885c9bd36">tracked_erv_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1ErvInformation.html#a54055d98a4a44a8b89d7e69b1c161f0b">seconds_until_passing</a> &lt;= <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a78537e382e029464ea6fa1d1e9053cd5">approaching_threshold</a>){</div>
<div class="line"><a id="l00298" name="l00298"></a><span class="lineno">  298</span>      fmter %<span class="keyword">true</span>;</div>
<div class="line"><a id="l00299" name="l00299"></a><span class="lineno">  299</span>    }</div>
<div class="line"><a id="l00300" name="l00300"></a><span class="lineno">  300</span>    <span class="keywordflow">else</span>{</div>
<div class="line"><a id="l00301" name="l00301"></a><span class="lineno">  301</span>      fmter %<span class="keyword">false</span>;</div>
<div class="line"><a id="l00302" name="l00302"></a><span class="lineno">  302</span>    }</div>
<div class="line"><a id="l00303" name="l00303"></a><span class="lineno">  303</span> </div>
<div class="line"><a id="l00304" name="l00304"></a><span class="lineno">  304</span>    <span class="comment">// Index 1 of formatted string; indicates estimated time until tracked ERV passes the ego vehicle</span></div>
<div class="line"><a id="l00305" name="l00305"></a><span class="lineno">  305</span>    fmter %<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a676b5bf0f041728d2413650885c9bd36">tracked_erv_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1ErvInformation.html#a54055d98a4a44a8b89d7e69b1c161f0b">seconds_until_passing</a>;</div>
<div class="line"><a id="l00306" name="l00306"></a><span class="lineno">  306</span> </div>
<div class="line"><a id="l00307" name="l00307"></a><span class="lineno">  307</span>    <span class="comment">// Add Index 2 of formatted string based on this plugin&#39;s current ApproachingEmergencyVehicleState</span></div>
<div class="line"><a id="l00308" name="l00308"></a><span class="lineno">  308</span>    <span class="keywordflow">switch</span> (<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a36f8f9b65fe9f2ebe9bbb09f3b1e2d8e">transition_table_</a>.<a class="code hl_function" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehicleTransitionTable.html#a4c74448ef5d30dcda8bbc4fecf054199">getState</a>())</div>
<div class="line"><a id="l00309" name="l00309"></a><span class="lineno">  309</span>    {</div>
<div class="line"><a id="l00310" name="l00310"></a><span class="lineno">  310</span>      <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="namespaceapproaching__emergency__vehicle__plugin.html#aeb182d0e6c9d53e276e1b9935aff0630a3dc495a5c3931df7278a227f93d6b70a">ApproachingEmergencyVehicleState::NO_APPROACHING_ERV</a>:</div>
<div class="line"><a id="l00311" name="l00311"></a><span class="lineno">  311</span>        fmter %<span class="stringliteral">&quot;No action.&quot;</span>;</div>
<div class="line"><a id="l00312" name="l00312"></a><span class="lineno">  312</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00313" name="l00313"></a><span class="lineno">  313</span> </div>
<div class="line"><a id="l00314" name="l00314"></a><span class="lineno">  314</span>      <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="namespaceapproaching__emergency__vehicle__plugin.html#aeb182d0e6c9d53e276e1b9935aff0630a0773e3336b946c578edbc4f3768a93e2">ApproachingEmergencyVehicleState::MOVING_OVER_FOR_APPROACHING_ERV</a>:</div>
<div class="line"><a id="l00315" name="l00315"></a><span class="lineno">  315</span>        <span class="comment">// Add ego vehicle action based on the direction of the upcoming lane change</span></div>
<div class="line"><a id="l00316" name="l00316"></a><span class="lineno">  316</span>        <span class="keywordflow">if</span>(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a2ca981bae82972205b3877b06054d09d">upcoming_lc_params_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1UpcomingLaneChangeParameters.html#aaba665f5ee18db85363601f0c385fd5a">is_right_lane_change</a>){</div>
<div class="line"><a id="l00317" name="l00317"></a><span class="lineno">  317</span>          fmter %<span class="stringliteral">&quot;Approaching ERV is in our lane. Attempting to change lanes to the right.&quot;</span>;</div>
<div class="line"><a id="l00318" name="l00318"></a><span class="lineno">  318</span>        }</div>
<div class="line"><a id="l00319" name="l00319"></a><span class="lineno">  319</span>        <span class="keywordflow">else</span>{</div>
<div class="line"><a id="l00320" name="l00320"></a><span class="lineno">  320</span>          fmter %<span class="stringliteral">&quot;Approaching ERV is in our lane. Attempting to change lanes to the left.&quot;</span>;</div>
<div class="line"><a id="l00321" name="l00321"></a><span class="lineno">  321</span>        }</div>
<div class="line"><a id="l00322" name="l00322"></a><span class="lineno">  322</span> </div>
<div class="line"><a id="l00323" name="l00323"></a><span class="lineno">  323</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00324" name="l00324"></a><span class="lineno">  324</span> </div>
<div class="line"><a id="l00325" name="l00325"></a><span class="lineno">  325</span>      <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="namespaceapproaching__emergency__vehicle__plugin.html#aeb182d0e6c9d53e276e1b9935aff0630abe5a505910aae73e4a99392e4b36e99a">ApproachingEmergencyVehicleState::SLOWING_DOWN_FOR_ERV</a>:</div>
<div class="line"><a id="l00326" name="l00326"></a><span class="lineno">  326</span>        <span class="comment">// Add ego vehicle action based on whether the current speed is near the reduced target speed of the latest maneuver plan&#39;s first maneuver</span></div>
<div class="line"><a id="l00327" name="l00327"></a><span class="lineno">  327</span>        <span class="keywordflow">if</span>(!<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a9dd99137e46dfb95193ac1df49ef5f83">latest_maneuver_plan_</a>.maneuvers.empty()){</div>
<div class="line"><a id="l00328" name="l00328"></a><span class="lineno">  328</span>          <span class="comment">// Extract the target speed in m/s from the latest maneuver plan&#39;s first maneuver and convert it to mph</span></div>
<div class="line"><a id="l00329" name="l00329"></a><span class="lineno">  329</span>          <span class="keywordtype">double</span> target_speed_ms = <a class="code hl_function" href="namespaceapproaching__emergency__vehicle__plugin_1_1anonymous__namespace_02approaching__emergenc6b477e4cfd274375085cbaf134e12178.html#a824526918073d730865d3616fded75c4">getManeuverEndSpeed</a>(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a9dd99137e46dfb95193ac1df49ef5f83">latest_maneuver_plan_</a>.maneuvers[0]);</div>
<div class="line"><a id="l00330" name="l00330"></a><span class="lineno">  330</span>          <span class="keywordtype">int</span> target_speed_mph = std::round(target_speed_ms * <a class="code hl_variable" href="namespaceapproaching__emergency__vehicle__plugin.html#a2dbb3f37c243c291470089b3d68d82e4">METERS_PER_SEC_TO_MILES_PER_HOUR</a>);</div>
<div class="line"><a id="l00331" name="l00331"></a><span class="lineno">  331</span> </div>
<div class="line"><a id="l00332" name="l00332"></a><span class="lineno">  332</span>          <span class="keywordflow">if</span>(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a79f461d7ccc9669dc1b63a1826652861">ego_lane_index_</a> == <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a676b5bf0f041728d2413650885c9bd36">tracked_erv_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1ErvInformation.html#ac34d23f97859c1239886108d1e8c7828">lane_index</a>){</div>
<div class="line"><a id="l00333" name="l00333"></a><span class="lineno">  333</span>            <span class="keywordflow">if</span>(!<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#affd5c4e6991e268409a8a021be436347">is_maintaining_non_reduced_speed_</a>){</div>
<div class="line"><a id="l00334" name="l00334"></a><span class="lineno">  334</span>              <span class="keywordflow">if</span>(abs(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a76eff02c20d84af747204e3904244be3">current_speed_</a> - target_speed_ms) &lt;= <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#ad8731d21c88e346dd0d379680afdde72">reduced_speed_buffer</a>){</div>
<div class="line"><a id="l00335" name="l00335"></a><span class="lineno">  335</span>                fmter %(<span class="stringliteral">&quot;Approaching ERV is in our lane and a lane change is not possible. Remaining in the current lane at a reduced speed of &quot;</span> + <a class="code hl_function" href="namespacecarma__cooperative__perception.html#a64b708654c8aecb09122d39577df31b5">std::to_string</a>(target_speed_mph) + <span class="stringliteral">&quot; mph.&quot;</span>);</div>
<div class="line"><a id="l00336" name="l00336"></a><span class="lineno">  336</span>              }</div>
<div class="line"><a id="l00337" name="l00337"></a><span class="lineno">  337</span>              <span class="keywordflow">else</span>{</div>
<div class="line"><a id="l00338" name="l00338"></a><span class="lineno">  338</span>                fmter %(<span class="stringliteral">&quot;Approaching ERV is in our lane and a lane change is not possible. Remaining in the current lane and slowing down to a reduced speed of &quot;</span> + <a class="code hl_function" href="namespacecarma__cooperative__perception.html#a64b708654c8aecb09122d39577df31b5">std::to_string</a>(target_speed_mph) + <span class="stringliteral">&quot; mph.&quot;</span>);</div>
<div class="line"><a id="l00339" name="l00339"></a><span class="lineno">  339</span>              }</div>
<div class="line"><a id="l00340" name="l00340"></a><span class="lineno">  340</span>            }</div>
<div class="line"><a id="l00341" name="l00341"></a><span class="lineno">  341</span>            <span class="keywordflow">else</span>{</div>
<div class="line"><a id="l00342" name="l00342"></a><span class="lineno">  342</span>              <span class="keywordtype">int</span> non_reduced_speed_to_maintain_mph = std::round(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a69840d1c02ccdf825a638165e40a1ece">non_reduced_speed_to_maintain_</a> * <a class="code hl_variable" href="namespaceapproaching__emergency__vehicle__plugin.html#a2dbb3f37c243c291470089b3d68d82e4">METERS_PER_SEC_TO_MILES_PER_HOUR</a>);</div>
<div class="line"><a id="l00343" name="l00343"></a><span class="lineno">  343</span>              fmter %(<span class="stringliteral">&quot;Approaching ERV is in our lane and a lane change is not possible. Remaining in the current lane and maintaining a speed of &quot;</span> + <a class="code hl_function" href="namespacecarma__cooperative__perception.html#a64b708654c8aecb09122d39577df31b5">std::to_string</a>(non_reduced_speed_to_maintain_mph) + <span class="stringliteral">&quot; mph.&quot;</span>);</div>
<div class="line"><a id="l00344" name="l00344"></a><span class="lineno">  344</span>            }</div>
<div class="line"><a id="l00345" name="l00345"></a><span class="lineno">  345</span>          }</div>
<div class="line"><a id="l00346" name="l00346"></a><span class="lineno">  346</span>          <span class="keywordflow">else</span>{</div>
<div class="line"><a id="l00347" name="l00347"></a><span class="lineno">  347</span>            <span class="keywordflow">if</span>(abs(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a76eff02c20d84af747204e3904244be3">current_speed_</a> - target_speed_ms) &lt;= <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#ad8731d21c88e346dd0d379680afdde72">reduced_speed_buffer</a>){</div>
<div class="line"><a id="l00348" name="l00348"></a><span class="lineno">  348</span>              fmter %(<span class="stringliteral">&quot;Approaching ERV is in adjacent lane. Remaining in the current lane at a reduced speed of &quot;</span> + <a class="code hl_function" href="namespacecarma__cooperative__perception.html#a64b708654c8aecb09122d39577df31b5">std::to_string</a>(target_speed_mph) + <span class="stringliteral">&quot; mph.&quot;</span>);</div>
<div class="line"><a id="l00349" name="l00349"></a><span class="lineno">  349</span>            }</div>
<div class="line"><a id="l00350" name="l00350"></a><span class="lineno">  350</span>            <span class="keywordflow">else</span>{</div>
<div class="line"><a id="l00351" name="l00351"></a><span class="lineno">  351</span>              fmter %(<span class="stringliteral">&quot;Approaching ERV is in adjacent lane. Remaining in the current lane and slowing down to a reduced speed of &quot;</span> + <a class="code hl_function" href="namespacecarma__cooperative__perception.html#a64b708654c8aecb09122d39577df31b5">std::to_string</a>(target_speed_mph) + <span class="stringliteral">&quot; mph.&quot;</span>);</div>
<div class="line"><a id="l00352" name="l00352"></a><span class="lineno">  352</span>            }</div>
<div class="line"><a id="l00353" name="l00353"></a><span class="lineno">  353</span>          }</div>
<div class="line"><a id="l00354" name="l00354"></a><span class="lineno">  354</span>        }</div>
<div class="line"><a id="l00355" name="l00355"></a><span class="lineno">  355</span>        <span class="keywordflow">else</span>{</div>
<div class="line"><a id="l00356" name="l00356"></a><span class="lineno">  356</span>          <span class="keywordflow">throw</span> std::invalid_argument(<span class="stringliteral">&quot;State is SLOWING_DOWN_FOR_ERV but latest maneuver plan is empty!&quot;</span>);</div>
<div class="line"><a id="l00357" name="l00357"></a><span class="lineno">  357</span>        }</div>
<div class="line"><a id="l00358" name="l00358"></a><span class="lineno">  358</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00359" name="l00359"></a><span class="lineno">  359</span> </div>
<div class="line"><a id="l00360" name="l00360"></a><span class="lineno">  360</span>      <span class="keywordflow">default</span>:</div>
<div class="line"><a id="l00361" name="l00361"></a><span class="lineno">  361</span>        <span class="keywordflow">throw</span> std::invalid_argument(<span class="stringliteral">&quot;Transition table in unsupported state&quot;</span>);</div>
<div class="line"><a id="l00362" name="l00362"></a><span class="lineno">  362</span>    }</div>
<div class="line"><a id="l00363" name="l00363"></a><span class="lineno">  363</span> </div>
<div class="line"><a id="l00364" name="l00364"></a><span class="lineno">  364</span>    <span class="comment">// Add formatted string to status message</span></div>
<div class="line"><a id="l00365" name="l00365"></a><span class="lineno">  365</span>    std::string str = fmter.str();</div>
<div class="line"><a id="l00366" name="l00366"></a><span class="lineno">  366</span>    status_msg.msg = str;</div>
<div class="line"><a id="l00367" name="l00367"></a><span class="lineno">  367</span> </div>
<div class="line"><a id="l00368" name="l00368"></a><span class="lineno">  368</span>    <span class="keywordflow">return</span> status_msg;</div>
<div class="line"><a id="l00369" name="l00369"></a><span class="lineno">  369</span>  }</div>
<div class="line"><a id="l00370" name="l00370"></a><span class="lineno">  370</span> </div>
<div class="line"><a id="l00371" name="l00371"></a><span class="lineno"><a class="line" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#aa089a4bd3f2c7e1106439f5e6670c38a">  371</a></span>  boost::optional&lt;lanelet::BasicPoint2d&gt; <a class="code hl_function" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#aa089a4bd3f2c7e1106439f5e6670c38a">ApproachingEmergencyVehiclePlugin::getErvPositionInMap</a>(<span class="keyword">const</span> <span class="keywordtype">double</span>&amp; current_latitude, <span class="keyword">const</span> <span class="keywordtype">double</span>&amp; current_longitude){</div>
<div class="line"><a id="l00372" name="l00372"></a><span class="lineno">  372</span>    <span class="comment">// Check if the map projection is available</span></div>
<div class="line"><a id="l00373" name="l00373"></a><span class="lineno">  373</span>    <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a2aab26ef3fcf308380b14a034b5963b8">map_projector_</a>) {</div>
<div class="line"><a id="l00374" name="l00374"></a><span class="lineno">  374</span>      <span class="keywordflow">throw</span> std::invalid_argument(<span class="stringliteral">&quot;Attempting to get ERV&#39;s current position in map before map projection was set&quot;</span>);</div>
<div class="line"><a id="l00375" name="l00375"></a><span class="lineno">  375</span>    }</div>
<div class="line"><a id="l00376" name="l00376"></a><span class="lineno">  376</span>      </div>
<div class="line"><a id="l00377" name="l00377"></a><span class="lineno">  377</span>    <span class="comment">// Build map projector</span></div>
<div class="line"><a id="l00378" name="l00378"></a><span class="lineno">  378</span>    lanelet::projection::LocalFrameProjector projector(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a2aab26ef3fcf308380b14a034b5963b8">map_projector_</a>.get().c_str());</div>
<div class="line"><a id="l00379" name="l00379"></a><span class="lineno">  379</span> </div>
<div class="line"><a id="l00380" name="l00380"></a><span class="lineno">  380</span>    <span class="comment">// Create vector to hold ERV&#39;s projected current position</span></div>
<div class="line"><a id="l00381" name="l00381"></a><span class="lineno">  381</span>    std::vector&lt;lanelet::BasicPoint3d&gt; erv_current_position_projected_vec;</div>
<div class="line"><a id="l00382" name="l00382"></a><span class="lineno">  382</span> </div>
<div class="line"><a id="l00383" name="l00383"></a><span class="lineno">  383</span>    <span class="comment">// Add ERV&#39;s current location to the beginning of erv_current_position_projected_vec</span></div>
<div class="line"><a id="l00384" name="l00384"></a><span class="lineno">  384</span>    lanelet::GPSPoint current_erv_location;</div>
<div class="line"><a id="l00385" name="l00385"></a><span class="lineno">  385</span>    current_erv_location.lat = current_latitude;</div>
<div class="line"><a id="l00386" name="l00386"></a><span class="lineno">  386</span>    current_erv_location.lon = current_longitude;</div>
<div class="line"><a id="l00387" name="l00387"></a><span class="lineno">  387</span> </div>
<div class="line"><a id="l00388" name="l00388"></a><span class="lineno">  388</span>    <span class="comment">// Convert ERV&#39;s projected position to its position in the map frame</span></div>
<div class="line"><a id="l00389" name="l00389"></a><span class="lineno">  389</span>    erv_current_position_projected_vec.emplace_back(projector.forward(current_erv_location));</div>
<div class="line"><a id="l00390" name="l00390"></a><span class="lineno">  390</span>    <span class="keyword">auto</span> erv_current_position_in_map_vec = lanelet::utils::transform(erv_current_position_projected_vec, [](<span class="keyword">auto</span> <a class="code hl_variable" href="pointer_8h.html#aeeddce917cf130d62c370b8f216026dd">a</a>) { <span class="keywordflow">return</span> lanelet::traits::to2D(<a class="code hl_variable" href="pointer_8h.html#aeeddce917cf130d62c370b8f216026dd">a</a>); });</div>
<div class="line"><a id="l00391" name="l00391"></a><span class="lineno">  391</span> </div>
<div class="line"><a id="l00392" name="l00392"></a><span class="lineno">  392</span>    <span class="comment">// Conduct size check since only the first element is being returned</span></div>
<div class="line"><a id="l00393" name="l00393"></a><span class="lineno">  393</span>    <span class="keywordflow">if</span>(!erv_current_position_in_map_vec.empty()){</div>
<div class="line"><a id="l00394" name="l00394"></a><span class="lineno">  394</span>      <span class="keywordflow">return</span> erv_current_position_in_map_vec[0];</div>
<div class="line"><a id="l00395" name="l00395"></a><span class="lineno">  395</span>    }</div>
<div class="line"><a id="l00396" name="l00396"></a><span class="lineno">  396</span>    <span class="keywordflow">else</span>{</div>
<div class="line"><a id="l00397" name="l00397"></a><span class="lineno">  397</span>      <span class="keywordflow">return</span> boost::optional&lt;lanelet::BasicPoint2d&gt;();</div>
<div class="line"><a id="l00398" name="l00398"></a><span class="lineno">  398</span>    }</div>
<div class="line"><a id="l00399" name="l00399"></a><span class="lineno">  399</span>  }</div>
<div class="line"><a id="l00400" name="l00400"></a><span class="lineno">  400</span> </div>
<div class="line"><a id="l00401" name="l00401"></a><span class="lineno"><a class="line" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#ac93a5ead1728d2b37a778ce416f80f2b">  401</a></span>  boost::optional&lt;ErvInformation&gt; <a class="code hl_function" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#ac93a5ead1728d2b37a778ce416f80f2b">ApproachingEmergencyVehiclePlugin::getErvInformationFromBsm</a>(carma_v2x_msgs::msg::BSM::UniquePtr msg){</div>
<div class="line"><a id="l00402" name="l00402"></a><span class="lineno">  402</span>    <span class="comment">// Initialize ErvInformation object, which will be populated with information from this BSM if it is from an ERV</span></div>
<div class="line"><a id="l00403" name="l00403"></a><span class="lineno">  403</span>    <a class="code hl_struct" href="structapproaching__emergency__vehicle__plugin_1_1ErvInformation.html">ErvInformation</a> erv_information;</div>
<div class="line"><a id="l00404" name="l00404"></a><span class="lineno">  404</span> </div>
<div class="line"><a id="l00405" name="l00405"></a><span class="lineno">  405</span>    <span class="comment">// Get vehicle_id from the BSM</span></div>
<div class="line"><a id="l00406" name="l00406"></a><span class="lineno">  406</span>    std::stringstream ss;</div>
<div class="line"><a id="l00407" name="l00407"></a><span class="lineno">  407</span>    <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> <a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a> = 0; <a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a> &lt; msg-&gt;core_data.id.size(); ++<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>){</div>
<div class="line"><a id="l00408" name="l00408"></a><span class="lineno">  408</span>      ss &lt;&lt; std::setfill(<span class="charliteral">&#39;0&#39;</span>) &lt;&lt; std::setw(2) &lt;&lt; std::hex &lt;&lt; (unsigned)msg-&gt;core_data.id.at(<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>);</div>
<div class="line"><a id="l00409" name="l00409"></a><span class="lineno">  409</span>    }</div>
<div class="line"><a id="l00410" name="l00410"></a><span class="lineno">  410</span>    erv_information.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1ErvInformation.html#a2d25462696d7933e72bc33239c42287d">vehicle_id</a> = ss.str();</div>
<div class="line"><a id="l00411" name="l00411"></a><span class="lineno">  411</span> </div>
<div class="line"><a id="l00412" name="l00412"></a><span class="lineno">  412</span>    <span class="comment">// Check whether vehicle&#39;s lights and sirens are active</span></div>
<div class="line"><a id="l00413" name="l00413"></a><span class="lineno">  413</span>    <span class="keywordtype">bool</span> has_active_lights_and_sirens = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00414" name="l00414"></a><span class="lineno">  414</span>    <span class="keywordflow">if</span>(msg-&gt;presence_vector &amp; carma_v2x_msgs::msg::BSM::HAS_PART_II){</div>
<div class="line"><a id="l00415" name="l00415"></a><span class="lineno">  415</span> </div>
<div class="line"><a id="l00416" name="l00416"></a><span class="lineno">  416</span>      <span class="comment">// Parse BSM Part II Content to determine whether the vehicle&#39;s lights and sirens are active</span></div>
<div class="line"><a id="l00417" name="l00417"></a><span class="lineno">  417</span>      <span class="keywordflow">if</span>(msg-&gt;part_ii.size() &gt; 0){</div>
<div class="line"><a id="l00418" name="l00418"></a><span class="lineno">  418</span>        <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> <a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a> = 0; <a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a> &lt; msg-&gt;part_ii.size(); ++<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>){</div>
<div class="line"><a id="l00419" name="l00419"></a><span class="lineno">  419</span> </div>
<div class="line"><a id="l00420" name="l00420"></a><span class="lineno">  420</span>          <span class="comment">// special_vehicle_extensions contain the status of the vehicle&#39;s lights and sirens</span></div>
<div class="line"><a id="l00421" name="l00421"></a><span class="lineno">  421</span>          <span class="keywordflow">if</span>(msg-&gt;part_ii[<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>].part_ii_id == carma_v2x_msgs::msg::BSMPartIIExtension::SPECIAL_VEHICLE_EXT){</div>
<div class="line"><a id="l00422" name="l00422"></a><span class="lineno">  422</span>            carma_v2x_msgs::msg::SpecialVehicleExtensions special_vehicle_ext = msg-&gt;part_ii[<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>].special_vehicle_extensions;</div>
<div class="line"><a id="l00423" name="l00423"></a><span class="lineno">  423</span> </div>
<div class="line"><a id="l00424" name="l00424"></a><span class="lineno">  424</span>            <span class="keywordflow">if</span>(special_vehicle_ext.presence_vector &amp; carma_v2x_msgs::msg::SpecialVehicleExtensions::HAS_VEHICLE_ALERTS){</div>
<div class="line"><a id="l00425" name="l00425"></a><span class="lineno">  425</span>              <span class="keywordflow">if</span>(special_vehicle_ext.vehicle_alerts.siren_use.siren_in_use == j2735_v2x_msgs::msg::SirenInUse::IN_USE</div>
<div class="line"><a id="l00426" name="l00426"></a><span class="lineno">  426</span>                &amp;&amp; special_vehicle_ext.vehicle_alerts.lights_use.lightbar_in_use == j2735_v2x_msgs::msg::LightbarInUse::IN_USE){</div>
<div class="line"><a id="l00427" name="l00427"></a><span class="lineno">  427</span>                  has_active_lights_and_sirens = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00428" name="l00428"></a><span class="lineno">  428</span>              }</div>
<div class="line"><a id="l00429" name="l00429"></a><span class="lineno">  429</span>            }</div>
<div class="line"><a id="l00430" name="l00430"></a><span class="lineno">  430</span>          }</div>
<div class="line"><a id="l00431" name="l00431"></a><span class="lineno">  431</span>        }</div>
<div class="line"><a id="l00432" name="l00432"></a><span class="lineno">  432</span>      }</div>
<div class="line"><a id="l00433" name="l00433"></a><span class="lineno">  433</span>    }</div>
<div class="line"><a id="l00434" name="l00434"></a><span class="lineno">  434</span> </div>
<div class="line"><a id="l00435" name="l00435"></a><span class="lineno">  435</span>    <span class="keywordflow">if</span>(!has_active_lights_and_sirens){</div>
<div class="line"><a id="l00436" name="l00436"></a><span class="lineno">  436</span>      <span class="comment">// BSM is not a valid ERV BSM since the lights and sirens are not both active; return an empty object</span></div>
<div class="line"><a id="l00437" name="l00437"></a><span class="lineno">  437</span>      RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6d19969dc5f588661e25aa3575127405">logger_name</a>), <span class="stringliteral">&quot;BSM is not a valid ERV BSM since the lights and sirens are not both active; return an empty object&quot;</span>);</div>
<div class="line"><a id="l00438" name="l00438"></a><span class="lineno">  438</span> </div>
<div class="line"><a id="l00439" name="l00439"></a><span class="lineno">  439</span>      <span class="keywordflow">return</span> boost::optional&lt;ErvInformation&gt;();</div>
<div class="line"><a id="l00440" name="l00440"></a><span class="lineno">  440</span>    }</div>
<div class="line"><a id="l00441" name="l00441"></a><span class="lineno">  441</span> </div>
<div class="line"><a id="l00442" name="l00442"></a><span class="lineno">  442</span>    <span class="comment">// Get vehicle&#39;s current speed from the BSM</span></div>
<div class="line"><a id="l00443" name="l00443"></a><span class="lineno">  443</span>    <span class="keywordflow">if</span>(msg-&gt;core_data.presence_vector &amp; carma_v2x_msgs::msg::BSMCoreData::SPEED_AVAILABLE){</div>
<div class="line"><a id="l00444" name="l00444"></a><span class="lineno">  444</span>      erv_information.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1ErvInformation.html#a9940a792d030a2d124a2b04fb51fd27f">current_speed</a> = msg-&gt;core_data.speed;</div>
<div class="line"><a id="l00445" name="l00445"></a><span class="lineno">  445</span>    }</div>
<div class="line"><a id="l00446" name="l00446"></a><span class="lineno">  446</span>    <span class="keywordflow">else</span>{</div>
<div class="line"><a id="l00447" name="l00447"></a><span class="lineno">  447</span>      <span class="comment">// BSM is not a valid ERV BSM since current speed is not included; return an empty object</span></div>
<div class="line"><a id="l00448" name="l00448"></a><span class="lineno">  448</span>      RCLCPP_ERROR_STREAM(rclcpp::get_logger(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6d19969dc5f588661e25aa3575127405">logger_name</a>), <span class="stringliteral">&quot;BSM is not a valid ERV BSM since current speed is not included; return an empty object&quot;</span>);</div>
<div class="line"><a id="l00449" name="l00449"></a><span class="lineno">  449</span> </div>
<div class="line"><a id="l00450" name="l00450"></a><span class="lineno">  450</span>      <span class="keywordflow">return</span> boost::optional&lt;ErvInformation&gt;();</div>
<div class="line"><a id="l00451" name="l00451"></a><span class="lineno">  451</span>    }</div>
<div class="line"><a id="l00452" name="l00452"></a><span class="lineno">  452</span> </div>
<div class="line"><a id="l00453" name="l00453"></a><span class="lineno">  453</span>    <span class="keywordflow">if</span>(erv_information.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1ErvInformation.html#a9940a792d030a2d124a2b04fb51fd27f">current_speed</a> &lt;= <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a76eff02c20d84af747204e3904244be3">current_speed_</a>){</div>
<div class="line"><a id="l00454" name="l00454"></a><span class="lineno">  454</span>      RCLCPP_ERROR_STREAM(rclcpp::get_logger(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6d19969dc5f588661e25aa3575127405">logger_name</a>), <span class="stringliteral">&quot;Ignoring received BSM since ERV speed of &quot;</span> &lt;&lt; erv_information.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1ErvInformation.html#a9940a792d030a2d124a2b04fb51fd27f">current_speed</a> &lt;&lt; <span class="stringliteral">&quot; is less than ego speed of &quot;</span> &lt;&lt; <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a76eff02c20d84af747204e3904244be3">current_speed_</a>);</div>
<div class="line"><a id="l00455" name="l00455"></a><span class="lineno">  455</span>      <span class="keywordflow">return</span> boost::optional&lt;ErvInformation&gt;();</div>
<div class="line"><a id="l00456" name="l00456"></a><span class="lineno">  456</span>    }</div>
<div class="line"><a id="l00457" name="l00457"></a><span class="lineno">  457</span> </div>
<div class="line"><a id="l00458" name="l00458"></a><span class="lineno">  458</span>    <span class="comment">// Get vehicle&#39;s current latitude from the BSM</span></div>
<div class="line"><a id="l00459" name="l00459"></a><span class="lineno">  459</span>    <span class="keywordflow">if</span>(msg-&gt;core_data.presence_vector &amp; carma_v2x_msgs::msg::BSMCoreData::LATITUDE_AVAILABLE){</div>
<div class="line"><a id="l00460" name="l00460"></a><span class="lineno">  460</span>      erv_information.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1ErvInformation.html#abfab4e3dd4ca3fba7e4581488cb7b5e3">current_latitude</a> = msg-&gt;core_data.latitude;</div>
<div class="line"><a id="l00461" name="l00461"></a><span class="lineno">  461</span>    }</div>
<div class="line"><a id="l00462" name="l00462"></a><span class="lineno">  462</span>    <span class="keywordflow">else</span>{</div>
<div class="line"><a id="l00463" name="l00463"></a><span class="lineno">  463</span>      RCLCPP_ERROR_STREAM(rclcpp::get_logger(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6d19969dc5f588661e25aa3575127405">logger_name</a>), <span class="stringliteral">&quot;No latitude available&quot;</span>);</div>
<div class="line"><a id="l00464" name="l00464"></a><span class="lineno">  464</span> </div>
<div class="line"><a id="l00465" name="l00465"></a><span class="lineno">  465</span>      <span class="comment">// BSM is not a valid ERV BSM since current latitude is not included; return an empty object</span></div>
<div class="line"><a id="l00466" name="l00466"></a><span class="lineno">  466</span>      <span class="keywordflow">return</span> boost::optional&lt;ErvInformation&gt;();</div>
<div class="line"><a id="l00467" name="l00467"></a><span class="lineno">  467</span>    }</div>
<div class="line"><a id="l00468" name="l00468"></a><span class="lineno">  468</span> </div>
<div class="line"><a id="l00469" name="l00469"></a><span class="lineno">  469</span>    <span class="comment">// Get vehicle&#39;s current longitude from the BSM</span></div>
<div class="line"><a id="l00470" name="l00470"></a><span class="lineno">  470</span>    <span class="keywordflow">if</span>(msg-&gt;core_data.presence_vector &amp; carma_v2x_msgs::msg::BSMCoreData::LONGITUDE_AVAILABLE){</div>
<div class="line"><a id="l00471" name="l00471"></a><span class="lineno">  471</span> </div>
<div class="line"><a id="l00472" name="l00472"></a><span class="lineno">  472</span>      erv_information.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1ErvInformation.html#af0375acd994c05aea49759b8ed9ef544">current_longitude</a> = msg-&gt;core_data.longitude;</div>
<div class="line"><a id="l00473" name="l00473"></a><span class="lineno">  473</span>    }</div>
<div class="line"><a id="l00474" name="l00474"></a><span class="lineno">  474</span>    <span class="keywordflow">else</span>{</div>
<div class="line"><a id="l00475" name="l00475"></a><span class="lineno">  475</span>      <span class="comment">// BSM is not a valid ERV BSM since current longitude is not included; return an empty object</span></div>
<div class="line"><a id="l00476" name="l00476"></a><span class="lineno">  476</span>      RCLCPP_ERROR_STREAM(rclcpp::get_logger(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6d19969dc5f588661e25aa3575127405">logger_name</a>), <span class="stringliteral">&quot;No longitude available&quot;</span>);</div>
<div class="line"><a id="l00477" name="l00477"></a><span class="lineno">  477</span> </div>
<div class="line"><a id="l00478" name="l00478"></a><span class="lineno">  478</span>      <span class="keywordflow">return</span> boost::optional&lt;ErvInformation&gt;();</div>
<div class="line"><a id="l00479" name="l00479"></a><span class="lineno">  479</span>    }</div>
<div class="line"><a id="l00480" name="l00480"></a><span class="lineno">  480</span> </div>
<div class="line"><a id="l00481" name="l00481"></a><span class="lineno">  481</span>    <span class="comment">// Get vehicle&#39;s current position in the map frame from the BSM</span></div>
<div class="line"><a id="l00482" name="l00482"></a><span class="lineno">  482</span>    boost::optional&lt;lanelet::BasicPoint2d&gt; erv_position_in_map = <a class="code hl_function" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#aa089a4bd3f2c7e1106439f5e6670c38a">getErvPositionInMap</a>(erv_information.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1ErvInformation.html#abfab4e3dd4ca3fba7e4581488cb7b5e3">current_latitude</a>, erv_information.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1ErvInformation.html#af0375acd994c05aea49759b8ed9ef544">current_longitude</a>);</div>
<div class="line"><a id="l00483" name="l00483"></a><span class="lineno">  483</span>    </div>
<div class="line"><a id="l00484" name="l00484"></a><span class="lineno">  484</span>    <span class="keywordflow">if</span>(erv_position_in_map){</div>
<div class="line"><a id="l00485" name="l00485"></a><span class="lineno">  485</span>      erv_information.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1ErvInformation.html#a530fa1cfa45c494906acb6d55da222e7">current_position_in_map</a> = *erv_position_in_map;</div>
<div class="line"><a id="l00486" name="l00486"></a><span class="lineno">  486</span>    }</div>
<div class="line"><a id="l00487" name="l00487"></a><span class="lineno">  487</span> </div>
<div class="line"><a id="l00488" name="l00488"></a><span class="lineno">  488</span>    <span class="comment">// Get vehicle&#39;s route destination points from the BSM</span></div>
<div class="line"><a id="l00489" name="l00489"></a><span class="lineno">  489</span>    std::vector&lt;carma_v2x_msgs::msg::Position3D&gt; erv_destination_points;</div>
<div class="line"><a id="l00490" name="l00490"></a><span class="lineno">  490</span>    <span class="keywordflow">if</span>(msg-&gt;presence_vector &amp; carma_v2x_msgs::msg::BSM::HAS_REGIONAL){</div>
<div class="line"><a id="l00491" name="l00491"></a><span class="lineno">  491</span> </div>
<div class="line"><a id="l00492" name="l00492"></a><span class="lineno">  492</span>      <span class="comment">// Parse BSM Regional Extensions to determine whether BSM includes the ERV&#39;s route destination points</span></div>
<div class="line"><a id="l00493" name="l00493"></a><span class="lineno">  493</span>      <span class="keywordflow">if</span>(msg-&gt;regional.size() &gt; 0){</div>
<div class="line"><a id="l00494" name="l00494"></a><span class="lineno">  494</span>        <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> <a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a> = 0; <a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a> &lt; msg-&gt;regional.size(); ++<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>){</div>
<div class="line"><a id="l00495" name="l00495"></a><span class="lineno">  495</span>          <span class="keywordflow">if</span>(msg-&gt;regional[<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>].regional_extension_id == carma_v2x_msgs::msg::BSMRegionalExtension::ROUTE_DESTINATIONS){</div>
<div class="line"><a id="l00496" name="l00496"></a><span class="lineno">  496</span>            erv_destination_points = msg-&gt;regional[<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>].route_destination_points;</div>
<div class="line"><a id="l00497" name="l00497"></a><span class="lineno">  497</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00498" name="l00498"></a><span class="lineno">  498</span>          }</div>
<div class="line"><a id="l00499" name="l00499"></a><span class="lineno">  499</span>        }</div>
<div class="line"><a id="l00500" name="l00500"></a><span class="lineno">  500</span>      }</div>
<div class="line"><a id="l00501" name="l00501"></a><span class="lineno">  501</span>    }</div>
<div class="line"><a id="l00502" name="l00502"></a><span class="lineno">  502</span>    </div>
<div class="line"><a id="l00503" name="l00503"></a><span class="lineno">  503</span>    <span class="keywordflow">if</span>(erv_destination_points.empty()){</div>
<div class="line"><a id="l00504" name="l00504"></a><span class="lineno">  504</span>      RCLCPP_ERROR_STREAM(rclcpp::get_logger(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6d19969dc5f588661e25aa3575127405">logger_name</a>), <span class="stringliteral">&quot;ERV&#39;s BSM does not contain any future destination points&quot;</span>);</div>
<div class="line"><a id="l00505" name="l00505"></a><span class="lineno">  505</span>      </div>
<div class="line"><a id="l00506" name="l00506"></a><span class="lineno">  506</span>      <span class="comment">// BSM is not a valid ERV BSM since it does not include destination points; return an empty object</span></div>
<div class="line"><a id="l00507" name="l00507"></a><span class="lineno">  507</span>      <span class="keywordflow">return</span> boost::optional&lt;ErvInformation&gt;();</div>
<div class="line"><a id="l00508" name="l00508"></a><span class="lineno">  508</span>    }</div>
<div class="line"><a id="l00509" name="l00509"></a><span class="lineno">  509</span> </div>
<div class="line"><a id="l00510" name="l00510"></a><span class="lineno">  510</span>    <span class="comment">// Update the latest processing time of this ERV</span></div>
<div class="line"><a id="l00511" name="l00511"></a><span class="lineno">  511</span>    <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a9b9ff2e431bc51b33cf12b95fec17ba8">latest_erv_update_times_</a>[erv_information.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1ErvInformation.html#a2d25462696d7933e72bc33239c42287d">vehicle_id</a>] = this-&gt;now();</div>
<div class="line"><a id="l00512" name="l00512"></a><span class="lineno">  512</span> </div>
<div class="line"><a id="l00513" name="l00513"></a><span class="lineno">  513</span>    <span class="comment">// Generate ERV&#39;s route based on its current position and its destination points</span></div>
<div class="line"><a id="l00514" name="l00514"></a><span class="lineno">  514</span>    lanelet::Optional&lt;lanelet::routing::Route&gt; erv_future_route = <a class="code hl_function" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a2b2e55868ad43d0a08fccc9e4c188443">generateErvRoute</a>(erv_information.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1ErvInformation.html#abfab4e3dd4ca3fba7e4581488cb7b5e3">current_latitude</a>, erv_information.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1ErvInformation.html#af0375acd994c05aea49759b8ed9ef544">current_longitude</a>, erv_destination_points);</div>
<div class="line"><a id="l00515" name="l00515"></a><span class="lineno">  515</span> </div>
<div class="line"><a id="l00516" name="l00516"></a><span class="lineno">  516</span>    <span class="keywordflow">if</span>(!erv_future_route){</div>
<div class="line"><a id="l00517" name="l00517"></a><span class="lineno">  517</span>      <span class="comment">// ERV cannot be tracked since its route could not be generated; return an empty object</span></div>
<div class="line"><a id="l00518" name="l00518"></a><span class="lineno">  518</span>      RCLCPP_ERROR_STREAM(rclcpp::get_logger(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6d19969dc5f588661e25aa3575127405">logger_name</a>), <span class="stringliteral">&quot;The ERV&#39;s route could not be generated&quot;</span>);</div>
<div class="line"><a id="l00519" name="l00519"></a><span class="lineno">  519</span> </div>
<div class="line"><a id="l00520" name="l00520"></a><span class="lineno">  520</span>      <span class="keywordflow">return</span> boost::optional&lt;ErvInformation&gt;();</div>
<div class="line"><a id="l00521" name="l00521"></a><span class="lineno">  521</span>    }</div>
<div class="line"><a id="l00522" name="l00522"></a><span class="lineno">  522</span>    </div>
<div class="line"><a id="l00523" name="l00523"></a><span class="lineno">  523</span>    <span class="comment">// Determine the ERV&#39;s current lane index</span></div>
<div class="line"><a id="l00524" name="l00524"></a><span class="lineno">  524</span>    <span class="comment">// Note: For &#39;lane index&#39;, 0 is rightmost lane, 1 is second rightmost, etc.; Only the current travel direction is considered</span></div>
<div class="line"><a id="l00525" name="l00525"></a><span class="lineno">  525</span>    <span class="keywordflow">if</span>(!erv_future_route.get().shortestPath().empty()){</div>
<div class="line"><a id="l00526" name="l00526"></a><span class="lineno">  526</span>      lanelet::ConstLanelet erv_current_lanelet = erv_future_route.get().shortestPath()[0];</div>
<div class="line"><a id="l00527" name="l00527"></a><span class="lineno">  527</span> </div>
<div class="line"><a id="l00528" name="l00528"></a><span class="lineno">  528</span>      <span class="comment">// NOTE: this logic checks if the ERV and CMV are on a same direction or not. </span></div>
<div class="line"><a id="l00529" name="l00529"></a><span class="lineno">  529</span>      <span class="comment">// Currently this check is sufficient to happen only once due to the use case scenarios</span></div>
<div class="line"><a id="l00530" name="l00530"></a><span class="lineno">  530</span>      <span class="keywordflow">if</span> (<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a89890b783f6dd3f5f943b7308afb5ca2">is_same_direction_</a>.find(erv_information.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1ErvInformation.html#a2d25462696d7933e72bc33239c42287d">vehicle_id</a>) == <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a89890b783f6dd3f5f943b7308afb5ca2">is_same_direction_</a>.end()) </div>
<div class="line"><a id="l00531" name="l00531"></a><span class="lineno">  531</span>      {</div>
<div class="line"><a id="l00532" name="l00532"></a><span class="lineno">  532</span>        <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a89890b783f6dd3f5f943b7308afb5ca2">is_same_direction_</a>[erv_information.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1ErvInformation.html#a2d25462696d7933e72bc33239c42287d">vehicle_id</a>] = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00533" name="l00533"></a><span class="lineno">  533</span>        <span class="keywordflow">for</span> (<span class="keyword">auto</span> llt: erv_future_route.get().shortestPath()) <span class="comment">// checks if ERV is on the same path assuming CMV got all of its planned route when detected</span></div>
<div class="line"><a id="l00534" name="l00534"></a><span class="lineno">  534</span>        {</div>
<div class="line"><a id="l00535" name="l00535"></a><span class="lineno">  535</span>          <span class="keywordflow">if</span> (<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a61b742aab762fff7983b3a1bf1a148b1">wm_</a>-&gt;getRoute()-&gt;contains(llt))</div>
<div class="line"><a id="l00536" name="l00536"></a><span class="lineno">  536</span>          {</div>
<div class="line"><a id="l00537" name="l00537"></a><span class="lineno">  537</span>            <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a89890b783f6dd3f5f943b7308afb5ca2">is_same_direction_</a>[erv_information.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1ErvInformation.html#a2d25462696d7933e72bc33239c42287d">vehicle_id</a>] = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00538" name="l00538"></a><span class="lineno">  538</span> </div>
<div class="line"><a id="l00539" name="l00539"></a><span class="lineno">  539</span>            RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6d19969dc5f588661e25aa3575127405">logger_name</a>), <span class="stringliteral">&quot;Detected that ERV: &quot;</span> &lt;&lt; erv_information.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1ErvInformation.html#a2d25462696d7933e72bc33239c42287d">vehicle_id</a> &lt;&lt; <span class="stringliteral">&quot; and CMV are travelling in the SAME direction&quot;</span>);</div>
<div class="line"><a id="l00540" name="l00540"></a><span class="lineno">  540</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00541" name="l00541"></a><span class="lineno">  541</span>          }</div>
<div class="line"><a id="l00542" name="l00542"></a><span class="lineno">  542</span>        }</div>
<div class="line"><a id="l00543" name="l00543"></a><span class="lineno">  543</span>      }</div>
<div class="line"><a id="l00544" name="l00544"></a><span class="lineno">  544</span> </div>
<div class="line"><a id="l00545" name="l00545"></a><span class="lineno">  545</span>      <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a89890b783f6dd3f5f943b7308afb5ca2">is_same_direction_</a>[erv_information.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1ErvInformation.html#a2d25462696d7933e72bc33239c42287d">vehicle_id</a>])  <span class="comment">// opposite direction</span></div>
<div class="line"><a id="l00546" name="l00546"></a><span class="lineno">  546</span>      {</div>
<div class="line"><a id="l00547" name="l00547"></a><span class="lineno">  547</span>        RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6d19969dc5f588661e25aa3575127405">logger_name</a>), <span class="stringliteral">&quot;Detected that ERV and CMV are travelling in DIFFERENT directions&quot;</span>);</div>
<div class="line"><a id="l00548" name="l00548"></a><span class="lineno">  548</span>        <span class="keywordflow">return</span> boost::optional&lt;ErvInformation&gt;(); <span class="comment">// if opposite direction, do not track</span></div>
<div class="line"><a id="l00549" name="l00549"></a><span class="lineno">  549</span>      }</div>
<div class="line"><a id="l00550" name="l00550"></a><span class="lineno">  550</span> </div>
<div class="line"><a id="l00551" name="l00551"></a><span class="lineno">  551</span>      <span class="comment">// Get ERV&#39;s lane index</span></div>
<div class="line"><a id="l00552" name="l00552"></a><span class="lineno">  552</span>      <span class="keywordtype">int</span> lane_index = <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a61b742aab762fff7983b3a1bf1a148b1">wm_</a>-&gt;getMapRoutingGraph()-&gt;rights(erv_current_lanelet).size();</div>
<div class="line"><a id="l00553" name="l00553"></a><span class="lineno">  553</span> </div>
<div class="line"><a id="l00554" name="l00554"></a><span class="lineno">  554</span>      <span class="comment">// A currently-tracked ERV must report the same lane index twice in a row before it is assigned the new lane index</span></div>
<div class="line"><a id="l00555" name="l00555"></a><span class="lineno">  555</span>      <span class="keywordflow">if</span>(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6c454433ce5dedbf0f32bfb38f1404ed">has_tracked_erv_</a>){</div>
<div class="line"><a id="l00556" name="l00556"></a><span class="lineno">  556</span>        <span class="keywordflow">if</span>(lane_index == <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a676b5bf0f041728d2413650885c9bd36">tracked_erv_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1ErvInformation.html#a632381dfd37c45c5440d7bbe8ac2b634">previous_lane_index</a>){</div>
<div class="line"><a id="l00557" name="l00557"></a><span class="lineno">  557</span>          erv_information.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1ErvInformation.html#ac34d23f97859c1239886108d1e8c7828">lane_index</a> = lane_index;</div>
<div class="line"><a id="l00558" name="l00558"></a><span class="lineno">  558</span>        }</div>
<div class="line"><a id="l00559" name="l00559"></a><span class="lineno">  559</span>        <span class="keywordflow">else</span>{</div>
<div class="line"><a id="l00560" name="l00560"></a><span class="lineno">  560</span>          erv_information.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1ErvInformation.html#ac34d23f97859c1239886108d1e8c7828">lane_index</a> = <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a676b5bf0f041728d2413650885c9bd36">tracked_erv_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1ErvInformation.html#a632381dfd37c45c5440d7bbe8ac2b634">previous_lane_index</a>;</div>
<div class="line"><a id="l00561" name="l00561"></a><span class="lineno">  561</span>          RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6d19969dc5f588661e25aa3575127405">logger_name</a>), <span class="stringliteral">&quot;Detected first new lane index of &quot;</span> &lt;&lt; lane_index &lt;&lt; <span class="stringliteral">&quot;, ERV&#39;s lane index will remain &quot;</span> &lt;&lt; <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a676b5bf0f041728d2413650885c9bd36">tracked_erv_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1ErvInformation.html#a632381dfd37c45c5440d7bbe8ac2b634">previous_lane_index</a>);</div>
<div class="line"><a id="l00562" name="l00562"></a><span class="lineno">  562</span>        }</div>
<div class="line"><a id="l00563" name="l00563"></a><span class="lineno">  563</span> </div>
<div class="line"><a id="l00564" name="l00564"></a><span class="lineno">  564</span>        erv_information.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1ErvInformation.html#a632381dfd37c45c5440d7bbe8ac2b634">previous_lane_index</a> = lane_index;</div>
<div class="line"><a id="l00565" name="l00565"></a><span class="lineno">  565</span>      }</div>
<div class="line"><a id="l00566" name="l00566"></a><span class="lineno">  566</span>      <span class="keywordflow">else</span>{</div>
<div class="line"><a id="l00567" name="l00567"></a><span class="lineno">  567</span>        RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6d19969dc5f588661e25aa3575127405">logger_name</a>), <span class="stringliteral">&quot;First time detecting this ERV, it&#39;s lane index will be &quot;</span> &lt;&lt; lane_index);</div>
<div class="line"><a id="l00568" name="l00568"></a><span class="lineno">  568</span>        erv_information.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1ErvInformation.html#ac34d23f97859c1239886108d1e8c7828">lane_index</a> = lane_index;</div>
<div class="line"><a id="l00569" name="l00569"></a><span class="lineno">  569</span>        erv_information.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1ErvInformation.html#a632381dfd37c45c5440d7bbe8ac2b634">previous_lane_index</a> = lane_index;</div>
<div class="line"><a id="l00570" name="l00570"></a><span class="lineno">  570</span>      }</div>
<div class="line"><a id="l00571" name="l00571"></a><span class="lineno">  571</span> </div>
<div class="line"><a id="l00572" name="l00572"></a><span class="lineno">  572</span>     </div>
<div class="line"><a id="l00573" name="l00573"></a><span class="lineno">  573</span>      RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6d19969dc5f588661e25aa3575127405">logger_name</a>), <span class="stringliteral">&quot;ERV&#39;s lane index is &quot;</span> &lt;&lt; erv_information.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1ErvInformation.html#ac34d23f97859c1239886108d1e8c7828">lane_index</a>);</div>
<div class="line"><a id="l00574" name="l00574"></a><span class="lineno">  574</span> </div>
<div class="line"><a id="l00575" name="l00575"></a><span class="lineno">  575</span>    }</div>
<div class="line"><a id="l00576" name="l00576"></a><span class="lineno">  576</span>    <span class="keywordflow">else</span>{</div>
<div class="line"><a id="l00577" name="l00577"></a><span class="lineno">  577</span>      RCLCPP_ERROR_STREAM(rclcpp::get_logger(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6d19969dc5f588661e25aa3575127405">logger_name</a>), <span class="stringliteral">&quot;ERV&#39;s shortest path is empty!&quot;</span>);</div>
<div class="line"><a id="l00578" name="l00578"></a><span class="lineno">  578</span>    }</div>
<div class="line"><a id="l00579" name="l00579"></a><span class="lineno">  579</span> </div>
<div class="line"><a id="l00580" name="l00580"></a><span class="lineno">  580</span>    <span class="comment">// Get intersecting lanelet between ERV&#39;s future route and ego vehicle&#39;s future shortest path</span></div>
<div class="line"><a id="l00581" name="l00581"></a><span class="lineno">  581</span>    RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6d19969dc5f588661e25aa3575127405">logger_name</a>), <span class="stringliteral">&quot;Calling getRouteIntersectingLanelet&quot;</span>); </div>
<div class="line"><a id="l00582" name="l00582"></a><span class="lineno">  582</span>    boost::optional&lt;lanelet::ConstLanelet&gt; intersecting_lanelet = <a class="code hl_function" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a0f62756c7dc36020b71d584066065743">getRouteIntersectingLanelet</a>(erv_future_route.get());</div>
<div class="line"><a id="l00583" name="l00583"></a><span class="lineno">  583</span>    RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6d19969dc5f588661e25aa3575127405">logger_name</a>), <span class="stringliteral">&quot;Done calling getRouteIntersectingLanelet&quot;</span>); </div>
<div class="line"><a id="l00584" name="l00584"></a><span class="lineno">  584</span> </div>
<div class="line"><a id="l00585" name="l00585"></a><span class="lineno">  585</span>    <span class="keywordflow">if</span>(intersecting_lanelet){</div>
<div class="line"><a id="l00586" name="l00586"></a><span class="lineno">  586</span>      erv_information.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1ErvInformation.html#ae3384c5e028e78ee1691738c53698e02">intersecting_lanelet</a> = *intersecting_lanelet;</div>
<div class="line"><a id="l00587" name="l00587"></a><span class="lineno">  587</span>    }</div>
<div class="line"><a id="l00588" name="l00588"></a><span class="lineno">  588</span>    <span class="keywordflow">else</span>{</div>
<div class="line"><a id="l00589" name="l00589"></a><span class="lineno">  589</span>      <span class="comment">// No intersecting lanelet between ERV and ego vehicle was found; return an empty object</span></div>
<div class="line"><a id="l00590" name="l00590"></a><span class="lineno">  590</span>      RCLCPP_ERROR_STREAM(rclcpp::get_logger(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6d19969dc5f588661e25aa3575127405">logger_name</a>), <span class="stringliteral">&quot;No intersecting lanelet between the ERV&#39;s future route and the ego vehicle&#39;s future route was found.&quot;</span>);</div>
<div class="line"><a id="l00591" name="l00591"></a><span class="lineno">  591</span> </div>
<div class="line"><a id="l00592" name="l00592"></a><span class="lineno">  592</span>      <span class="keywordflow">return</span> boost::optional&lt;ErvInformation&gt;();</div>
<div class="line"><a id="l00593" name="l00593"></a><span class="lineno">  593</span>    }</div>
<div class="line"><a id="l00594" name="l00594"></a><span class="lineno">  594</span> </div>
<div class="line"><a id="l00595" name="l00595"></a><span class="lineno">  595</span>    <span class="comment">// Get the time (seconds) until the ERV passes the ego vehicle</span></div>
<div class="line"><a id="l00596" name="l00596"></a><span class="lineno">  596</span>    RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6d19969dc5f588661e25aa3575127405">logger_name</a>), <span class="stringliteral">&quot;Calling getSecondsUntilPassing()&quot;</span>); </div>
<div class="line"><a id="l00597" name="l00597"></a><span class="lineno">  597</span>    boost::optional&lt;double&gt; seconds_until_passing = <a class="code hl_function" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a856426089b0cbb71bb94001268548652">getSecondsUntilPassing</a>(erv_future_route, erv_information.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1ErvInformation.html#a530fa1cfa45c494906acb6d55da222e7">current_position_in_map</a>, erv_information.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1ErvInformation.html#a9940a792d030a2d124a2b04fb51fd27f">current_speed</a>, erv_information.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1ErvInformation.html#ae3384c5e028e78ee1691738c53698e02">intersecting_lanelet</a>);</div>
<div class="line"><a id="l00598" name="l00598"></a><span class="lineno">  598</span>    RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6d19969dc5f588661e25aa3575127405">logger_name</a>), <span class="stringliteral">&quot;Done calling getSecondsUntilPassing()&quot;</span>); </div>
<div class="line"><a id="l00599" name="l00599"></a><span class="lineno">  599</span> </div>
<div class="line"><a id="l00600" name="l00600"></a><span class="lineno">  600</span>    <span class="keywordflow">if</span>(seconds_until_passing){</div>
<div class="line"><a id="l00601" name="l00601"></a><span class="lineno">  601</span>      erv_information.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1ErvInformation.html#a54055d98a4a44a8b89d7e69b1c161f0b">seconds_until_passing</a> = seconds_until_passing.get();</div>
<div class="line"><a id="l00602" name="l00602"></a><span class="lineno">  602</span>      RCLCPP_INFO_STREAM(rclcpp::get_logger(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6d19969dc5f588661e25aa3575127405">logger_name</a>), <span class="stringliteral">&quot;Detected approaching ERV that is passing ego vehicle in &quot;</span> &lt;&lt; seconds_until_passing.get() &lt;&lt; <span class="stringliteral">&quot; seconds&quot;</span>);</div>
<div class="line"><a id="l00603" name="l00603"></a><span class="lineno">  603</span>    }</div>
<div class="line"><a id="l00604" name="l00604"></a><span class="lineno">  604</span>    <span class="keywordflow">else</span>{</div>
<div class="line"><a id="l00605" name="l00605"></a><span class="lineno">  605</span>      RCLCPP_ERROR_STREAM(rclcpp::get_logger(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6d19969dc5f588661e25aa3575127405">logger_name</a>), <span class="stringliteral">&quot;Detected ERV is not approaching the ego vehicle&quot;</span>);</div>
<div class="line"><a id="l00606" name="l00606"></a><span class="lineno">  606</span> </div>
<div class="line"><a id="l00607" name="l00607"></a><span class="lineno">  607</span>      <span class="comment">// ERV will not be tracked since it is not considered to be approaching the ego vehicle; return an empty object</span></div>
<div class="line"><a id="l00608" name="l00608"></a><span class="lineno">  608</span>      <span class="keywordflow">return</span> boost::optional&lt;ErvInformation&gt;();</div>
<div class="line"><a id="l00609" name="l00609"></a><span class="lineno">  609</span>    }</div>
<div class="line"><a id="l00610" name="l00610"></a><span class="lineno">  610</span> </div>
<div class="line"><a id="l00611" name="l00611"></a><span class="lineno">  611</span>    <span class="keywordflow">return</span> erv_information;</div>
<div class="line"><a id="l00612" name="l00612"></a><span class="lineno">  612</span>  }</div>
<div class="line"><a id="l00613" name="l00613"></a><span class="lineno">  613</span> </div>
<div class="line"><a id="l00614" name="l00614"></a><span class="lineno"><a class="line" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#ae82911dd196e06a718423a36e46599fb">  614</a></span>  <span class="keywordtype">void</span> <a class="code hl_function" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#ae82911dd196e06a718423a36e46599fb">ApproachingEmergencyVehiclePlugin::georeferenceCallback</a>(<span class="keyword">const</span> std_msgs::msg::String::UniquePtr msg) </div>
<div class="line"><a id="l00615" name="l00615"></a><span class="lineno">  615</span>  {</div>
<div class="line"><a id="l00616" name="l00616"></a><span class="lineno">  616</span>    <span class="comment">// Build projector from proj string</span></div>
<div class="line"><a id="l00617" name="l00617"></a><span class="lineno">  617</span>    <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a2aab26ef3fcf308380b14a034b5963b8">map_projector_</a> = msg-&gt;data;</div>
<div class="line"><a id="l00618" name="l00618"></a><span class="lineno">  618</span>  }</div>
<div class="line"><a id="l00619" name="l00619"></a><span class="lineno">  619</span> </div>
<div class="line"><a id="l00620" name="l00620"></a><span class="lineno"><a class="line" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a7ef61c32915b20b724e484a9d360bba6">  620</a></span>  <span class="keywordtype">void</span> <a class="code hl_function" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a7ef61c32915b20b724e484a9d360bba6">ApproachingEmergencyVehiclePlugin::incomingEmergencyVehicleAckCallback</a>(<span class="keyword">const</span> carma_v2x_msgs::msg::EmergencyVehicleAck::UniquePtr msg) </div>
<div class="line"><a id="l00621" name="l00621"></a><span class="lineno">  621</span>  {</div>
<div class="line"><a id="l00622" name="l00622"></a><span class="lineno">  622</span>    <span class="comment">// Only process message if it is from the currently-tracked ERV and it is intended for the ego vehicle</span></div>
<div class="line"><a id="l00623" name="l00623"></a><span class="lineno">  623</span>    <span class="keywordflow">if</span>(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6c454433ce5dedbf0f32bfb38f1404ed">has_tracked_erv_</a> &amp;&amp; (msg-&gt;m_header.sender_id == <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a676b5bf0f041728d2413650885c9bd36">tracked_erv_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1ErvInformation.html#a2d25462696d7933e72bc33239c42287d">vehicle_id</a>) &amp;&amp; (msg-&gt;m_header.recipient_id == <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#aa70358d5fbdea25512a0e0dd2750a3ea">vehicle_id</a>)){</div>
<div class="line"><a id="l00624" name="l00624"></a><span class="lineno">  624</span>      RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6d19969dc5f588661e25aa3575127405">logger_name</a>), <span class="stringliteral">&quot;EmergencyVehicleAck received from ERV &quot;</span> &lt;&lt; <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a676b5bf0f041728d2413650885c9bd36">tracked_erv_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1ErvInformation.html#a2d25462696d7933e72bc33239c42287d">vehicle_id</a>);</div>
<div class="line"><a id="l00625" name="l00625"></a><span class="lineno">  625</span> </div>
<div class="line"><a id="l00626" name="l00626"></a><span class="lineno">  626</span>      <span class="comment">// Reset counter and boolean flag to stop warning messages from being broadcasted</span></div>
<div class="line"><a id="l00627" name="l00627"></a><span class="lineno">  627</span>      <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a85e8e1b36feedaeeccc56f68eb072c4d">num_warnings_broadcasted_</a> = 0;</div>
<div class="line"><a id="l00628" name="l00628"></a><span class="lineno">  628</span>      <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#ae65a1837d9f53d1d6fd7d240eb866585">should_broadcast_warnings_</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00629" name="l00629"></a><span class="lineno">  629</span>    }</div>
<div class="line"><a id="l00630" name="l00630"></a><span class="lineno">  630</span>  }</div>
<div class="line"><a id="l00631" name="l00631"></a><span class="lineno">  631</span> </div>
<div class="line"><a id="l00632" name="l00632"></a><span class="lineno">  632</span> </div>
<div class="line"><a id="l00633" name="l00633"></a><span class="lineno"><a class="line" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a2b2e55868ad43d0a08fccc9e4c188443">  633</a></span>  lanelet::Optional&lt;lanelet::routing::Route&gt; <a class="code hl_function" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a2b2e55868ad43d0a08fccc9e4c188443">ApproachingEmergencyVehiclePlugin::generateErvRoute</a>(<span class="keywordtype">double</span> current_latitude, <span class="keywordtype">double</span> current_longitude, </div>
<div class="line"><a id="l00634" name="l00634"></a><span class="lineno">  634</span>                                                                             std::vector&lt;carma_v2x_msgs::msg::Position3D&gt; erv_destination_points){</div>
<div class="line"><a id="l00635" name="l00635"></a><span class="lineno">  635</span>    <span class="comment">// Check if the map projection is available</span></div>
<div class="line"><a id="l00636" name="l00636"></a><span class="lineno">  636</span>    <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a2aab26ef3fcf308380b14a034b5963b8">map_projector_</a>) {</div>
<div class="line"><a id="l00637" name="l00637"></a><span class="lineno">  637</span>      <span class="keywordflow">throw</span> std::invalid_argument(<span class="stringliteral">&quot;Attempting to generate an ERV&#39;s route before map projection was set&quot;</span>);</div>
<div class="line"><a id="l00638" name="l00638"></a><span class="lineno">  638</span>    }</div>
<div class="line"><a id="l00639" name="l00639"></a><span class="lineno">  639</span>      </div>
<div class="line"><a id="l00640" name="l00640"></a><span class="lineno">  640</span>    <span class="comment">// Build map projector</span></div>
<div class="line"><a id="l00641" name="l00641"></a><span class="lineno">  641</span>    lanelet::projection::LocalFrameProjector projector(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a2aab26ef3fcf308380b14a034b5963b8">map_projector_</a>.get().c_str());</div>
<div class="line"><a id="l00642" name="l00642"></a><span class="lineno">  642</span> </div>
<div class="line"><a id="l00643" name="l00643"></a><span class="lineno">  643</span>    <span class="comment">// Create vector to hold ERV&#39;s destination points</span></div>
<div class="line"><a id="l00644" name="l00644"></a><span class="lineno">  644</span>    std::vector&lt;lanelet::BasicPoint3d&gt; erv_destination_points_projected;</div>
<div class="line"><a id="l00645" name="l00645"></a><span class="lineno">  645</span> </div>
<div class="line"><a id="l00646" name="l00646"></a><span class="lineno">  646</span>    <span class="comment">// Add ERV&#39;s current location to the beginning of erv_destination_points</span></div>
<div class="line"><a id="l00647" name="l00647"></a><span class="lineno">  647</span>    lanelet::GPSPoint current_erv_location;</div>
<div class="line"><a id="l00648" name="l00648"></a><span class="lineno">  648</span> </div>
<div class="line"><a id="l00649" name="l00649"></a><span class="lineno">  649</span>    current_erv_location.lat = current_latitude;</div>
<div class="line"><a id="l00650" name="l00650"></a><span class="lineno">  650</span>    current_erv_location.lon = current_longitude;</div>
<div class="line"><a id="l00651" name="l00651"></a><span class="lineno">  651</span> </div>
<div class="line"><a id="l00652" name="l00652"></a><span class="lineno">  652</span>   </div>
<div class="line"><a id="l00653" name="l00653"></a><span class="lineno">  653</span> </div>
<div class="line"><a id="l00654" name="l00654"></a><span class="lineno">  654</span>    <span class="comment">// Add ERV&#39;s future destination points to erv_destination_points</span></div>
<div class="line"><a id="l00655" name="l00655"></a><span class="lineno">  655</span>    <span class="keywordflow">if</span>(erv_destination_points.size() &gt; 0){</div>
<div class="line"><a id="l00656" name="l00656"></a><span class="lineno">  656</span>      <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> <a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a> = 0; <a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a> &lt; erv_destination_points.size(); ++<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>){</div>
<div class="line"><a id="l00657" name="l00657"></a><span class="lineno">  657</span>        carma_v2x_msgs::msg::Position3D position_3d_point = erv_destination_points[<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>];</div>
<div class="line"><a id="l00658" name="l00658"></a><span class="lineno">  658</span>        </div>
<div class="line"><a id="l00659" name="l00659"></a><span class="lineno">  659</span>        lanelet::GPSPoint erv_destination_point;</div>
<div class="line"><a id="l00660" name="l00660"></a><span class="lineno">  660</span>        erv_destination_point.lon = position_3d_point.longitude;</div>
<div class="line"><a id="l00661" name="l00661"></a><span class="lineno">  661</span>        erv_destination_point.lat = position_3d_point.latitude;</div>
<div class="line"><a id="l00662" name="l00662"></a><span class="lineno">  662</span> </div>
<div class="line"><a id="l00663" name="l00663"></a><span class="lineno">  663</span>        <span class="keywordflow">if</span>(position_3d_point.elevation_exists){</div>
<div class="line"><a id="l00664" name="l00664"></a><span class="lineno">  664</span>          erv_destination_point.ele = position_3d_point.elevation;</div>
<div class="line"><a id="l00665" name="l00665"></a><span class="lineno">  665</span>        }</div>
<div class="line"><a id="l00666" name="l00666"></a><span class="lineno">  666</span> </div>
<div class="line"><a id="l00667" name="l00667"></a><span class="lineno">  667</span>        erv_destination_points_projected.emplace_back(projector.forward(erv_destination_point));</div>
<div class="line"><a id="l00668" name="l00668"></a><span class="lineno">  668</span>      }</div>
<div class="line"><a id="l00669" name="l00669"></a><span class="lineno">  669</span>    }</div>
<div class="line"><a id="l00670" name="l00670"></a><span class="lineno">  670</span> </div>
<div class="line"><a id="l00671" name="l00671"></a><span class="lineno">  671</span>    <span class="comment">// Convert ERV destination points to map frame</span></div>
<div class="line"><a id="l00672" name="l00672"></a><span class="lineno">  672</span>    <span class="keyword">auto</span> erv_destination_points_in_map = lanelet::utils::transform(erv_destination_points_projected, [](<span class="keyword">auto</span> <a class="code hl_variable" href="pointer_8h.html#aeeddce917cf130d62c370b8f216026dd">a</a>) { <span class="keywordflow">return</span> lanelet::traits::to2D(<a class="code hl_variable" href="pointer_8h.html#aeeddce917cf130d62c370b8f216026dd">a</a>); });</div>
<div class="line"><a id="l00673" name="l00673"></a><span class="lineno">  673</span> </div>
<div class="line"><a id="l00674" name="l00674"></a><span class="lineno">  674</span>    <span class="keyword">auto</span> cmv_location = lanelet::traits::to2D(projector.forward(current_erv_location));</div>
<div class="line"><a id="l00675" name="l00675"></a><span class="lineno">  675</span>    <span class="keyword">auto</span> shortened_erv_destination_points_in_map = <a class="code hl_function" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#ac0d01b34e40eac594bb92652acbf7a8e">filter_points_ahead</a>(cmv_location, erv_destination_points_in_map);</div>
<div class="line"><a id="l00676" name="l00676"></a><span class="lineno">  676</span> </div>
<div class="line"><a id="l00677" name="l00677"></a><span class="lineno">  677</span>    <span class="keywordflow">if</span>(shortened_erv_destination_points_in_map.empty())</div>
<div class="line"><a id="l00678" name="l00678"></a><span class="lineno">  678</span>    {</div>
<div class="line"><a id="l00679" name="l00679"></a><span class="lineno">  679</span>        RCLCPP_ERROR_STREAM(rclcpp::get_logger(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6d19969dc5f588661e25aa3575127405">logger_name</a>), <span class="stringliteral">&quot;ERV has passed all the destination points!&quot;</span>);</div>
<div class="line"><a id="l00680" name="l00680"></a><span class="lineno">  680</span> </div>
<div class="line"><a id="l00681" name="l00681"></a><span class="lineno">  681</span>        <span class="comment">// Return empty route</span></div>
<div class="line"><a id="l00682" name="l00682"></a><span class="lineno">  682</span>        <span class="keywordflow">return</span> lanelet::Optional&lt;lanelet::routing::Route&gt;();</div>
<div class="line"><a id="l00683" name="l00683"></a><span class="lineno">  683</span>    }</div>
<div class="line"><a id="l00684" name="l00684"></a><span class="lineno">  684</span> </div>
<div class="line"><a id="l00685" name="l00685"></a><span class="lineno">  685</span>    <span class="comment">// Verify that ERV destination points are geometrically in the map</span></div>
<div class="line"><a id="l00686" name="l00686"></a><span class="lineno">  686</span>    <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> <a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a> = 0; <a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a> &lt; shortened_erv_destination_points_in_map.size(); ++<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>){</div>
<div class="line"><a id="l00687" name="l00687"></a><span class="lineno">  687</span>      <span class="keyword">auto</span> pt = shortened_erv_destination_points_in_map[<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>];</div>
<div class="line"><a id="l00688" name="l00688"></a><span class="lineno">  688</span> </div>
<div class="line"><a id="l00689" name="l00689"></a><span class="lineno">  689</span>      <span class="comment">// Return empty route if a destination point is not contained within the map</span></div>
<div class="line"><a id="l00690" name="l00690"></a><span class="lineno">  690</span>      <span class="keywordflow">if</span>((<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a61b742aab762fff7983b3a1bf1a148b1">wm_</a>-&gt;getLaneletsFromPoint(shortened_erv_destination_points_in_map[<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>])).empty()){</div>
<div class="line"><a id="l00691" name="l00691"></a><span class="lineno">  691</span>        RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6d19969dc5f588661e25aa3575127405">logger_name</a>), <span class="stringliteral">&quot;ERV destination point &quot;</span> &lt;&lt; <a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a> </div>
<div class="line"><a id="l00692" name="l00692"></a><span class="lineno">  692</span>                &lt;&lt; <span class="stringliteral">&quot; is not contained in a lanelet map; x: &quot;</span> &lt;&lt; pt.x() &lt;&lt; <span class="stringliteral">&quot; y: &quot;</span> &lt;&lt; pt.y());</div>
<div class="line"><a id="l00693" name="l00693"></a><span class="lineno">  693</span> </div>
<div class="line"><a id="l00694" name="l00694"></a><span class="lineno">  694</span>        <span class="keywordflow">return</span> lanelet::Optional&lt;lanelet::routing::Route&gt;();</div>
<div class="line"><a id="l00695" name="l00695"></a><span class="lineno">  695</span>      }</div>
<div class="line"><a id="l00696" name="l00696"></a><span class="lineno">  696</span>    }</div>
<div class="line"><a id="l00697" name="l00697"></a><span class="lineno">  697</span> </div>
<div class="line"><a id="l00698" name="l00698"></a><span class="lineno">  698</span>    <span class="comment">// Obtain ERV&#39;s starting lanelet</span></div>
<div class="line"><a id="l00699" name="l00699"></a><span class="lineno">  699</span>    <span class="keyword">auto</span> starting_lanelet_vector = lanelet::geometry::findNearest(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a61b742aab762fff7983b3a1bf1a148b1">wm_</a>-&gt;getMap()-&gt;laneletLayer, cmv_location, 1);</div>
<div class="line"><a id="l00700" name="l00700"></a><span class="lineno">  700</span>    <span class="keywordflow">if</span>(starting_lanelet_vector.empty())</div>
<div class="line"><a id="l00701" name="l00701"></a><span class="lineno">  701</span>    {</div>
<div class="line"><a id="l00702" name="l00702"></a><span class="lineno">  702</span>        RCLCPP_ERROR_STREAM(rclcpp::get_logger(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6d19969dc5f588661e25aa3575127405">logger_name</a>), <span class="stringliteral">&quot;Found no lanelets in the map. ERV routing cannot be completed.&quot;</span>);</div>
<div class="line"><a id="l00703" name="l00703"></a><span class="lineno">  703</span> </div>
<div class="line"><a id="l00704" name="l00704"></a><span class="lineno">  704</span>        <span class="comment">// Return empty route</span></div>
<div class="line"><a id="l00705" name="l00705"></a><span class="lineno">  705</span>        <span class="keywordflow">return</span> lanelet::Optional&lt;lanelet::routing::Route&gt;();</div>
<div class="line"><a id="l00706" name="l00706"></a><span class="lineno">  706</span>    }</div>
<div class="line"><a id="l00707" name="l00707"></a><span class="lineno">  707</span>    <span class="keyword">auto</span> starting_lanelet = lanelet::ConstLanelet(starting_lanelet_vector[0].second.constData());</div>
<div class="line"><a id="l00708" name="l00708"></a><span class="lineno">  708</span> </div>
<div class="line"><a id="l00709" name="l00709"></a><span class="lineno">  709</span>    <span class="comment">// Obtain ERV&#39;s ending lanelet</span></div>
<div class="line"><a id="l00710" name="l00710"></a><span class="lineno">  710</span>    <span class="keyword">auto</span> ending_lanelet_vector = lanelet::geometry::findNearest(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a61b742aab762fff7983b3a1bf1a148b1">wm_</a>-&gt;getMap()-&gt;laneletLayer, shortened_erv_destination_points_in_map.back(), 1);</div>
<div class="line"><a id="l00711" name="l00711"></a><span class="lineno">  711</span>    <span class="keyword">auto</span> ending_lanelet = lanelet::ConstLanelet(ending_lanelet_vector[0].second.constData());</div>
<div class="line"><a id="l00712" name="l00712"></a><span class="lineno">  712</span>    RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6d19969dc5f588661e25aa3575127405">logger_name</a>), <span class="stringliteral">&quot;ending_lanelet: &quot;</span> &lt;&lt; ending_lanelet.id());</div>
<div class="line"><a id="l00713" name="l00713"></a><span class="lineno">  713</span>    RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6d19969dc5f588661e25aa3575127405">logger_name</a>), <span class="stringliteral">&quot;starting_lanelet: &quot;</span> &lt;&lt; starting_lanelet.id());</div>
<div class="line"><a id="l00714" name="l00714"></a><span class="lineno">  714</span> </div>
<div class="line"><a id="l00715" name="l00715"></a><span class="lineno">  715</span>    <span class="comment">// Obtain ERV&#39;s via lanelets</span></div>
<div class="line"><a id="l00716" name="l00716"></a><span class="lineno">  716</span>    std::vector&lt;lanelet::BasicPoint2d&gt; via = std::vector&lt;lanelet::BasicPoint2d&gt;(shortened_erv_destination_points_in_map.begin(), shortened_erv_destination_points_in_map.end() - 1);</div>
<div class="line"><a id="l00717" name="l00717"></a><span class="lineno">  717</span>    lanelet::ConstLanelets via_lanelets_vector;</div>
<div class="line"><a id="l00718" name="l00718"></a><span class="lineno">  718</span>    <span class="keywordflow">for</span>(<span class="keyword">const</span> <span class="keyword">auto</span>&amp; <a class="code hl_variable" href="namespaceprocess__traj__logs.html#ab81a05c3d1d100117b6781d7dedf8a29">point</a> : via){</div>
<div class="line"><a id="l00719" name="l00719"></a><span class="lineno">  719</span>      <span class="keyword">auto</span> lanelet_vector = lanelet::geometry::findNearest(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a61b742aab762fff7983b3a1bf1a148b1">wm_</a>-&gt;getMap()-&gt;laneletLayer, <a class="code hl_variable" href="namespaceprocess__traj__logs.html#ab81a05c3d1d100117b6781d7dedf8a29">point</a>, 1);</div>
<div class="line"><a id="l00720" name="l00720"></a><span class="lineno">  720</span>      <span class="keyword">auto</span> chosen_lanelet_to_emplace = lanelet::ConstLanelet(lanelet_vector[0].second.constData());</div>
<div class="line"><a id="l00721" name="l00721"></a><span class="lineno">  721</span>      RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6d19969dc5f588661e25aa3575127405">logger_name</a>), <span class="stringliteral">&quot;chosen_lanelet_to_emplace: &quot;</span> &lt;&lt; chosen_lanelet_to_emplace.id());</div>
<div class="line"><a id="l00722" name="l00722"></a><span class="lineno">  722</span> </div>
<div class="line"><a id="l00723" name="l00723"></a><span class="lineno">  723</span>      <span class="keywordflow">if</span> (chosen_lanelet_to_emplace.id() != starting_lanelet.id())  <span class="comment">// if id is same, it fails to route</span></div>
<div class="line"><a id="l00724" name="l00724"></a><span class="lineno">  724</span>        via_lanelets_vector.emplace_back(chosen_lanelet_to_emplace);</div>
<div class="line"><a id="l00725" name="l00725"></a><span class="lineno">  725</span>      <span class="keywordflow">else</span></div>
<div class="line"><a id="l00726" name="l00726"></a><span class="lineno">  726</span>      {</div>
<div class="line"><a id="l00727" name="l00727"></a><span class="lineno">  727</span>        RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6d19969dc5f588661e25aa3575127405">logger_name</a>), <span class="stringliteral">&quot;======&gt; id was found same: &quot;</span> &lt;&lt; chosen_lanelet_to_emplace.id());</div>
<div class="line"><a id="l00728" name="l00728"></a><span class="lineno">  728</span>      }</div>
<div class="line"><a id="l00729" name="l00729"></a><span class="lineno">  729</span>    }</div>
<div class="line"><a id="l00730" name="l00730"></a><span class="lineno">  730</span> </div>
<div class="line"><a id="l00731" name="l00731"></a><span class="lineno">  731</span>    <span class="comment">// Generate the ERV&#39;s route</span></div>
<div class="line"><a id="l00732" name="l00732"></a><span class="lineno">  732</span>    <span class="keyword">auto</span> erv_route = <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a61b742aab762fff7983b3a1bf1a148b1">wm_</a>-&gt;getMapRoutingGraph()-&gt;getRouteVia(starting_lanelet, via_lanelets_vector, ending_lanelet);</div>
<div class="line"><a id="l00733" name="l00733"></a><span class="lineno">  733</span> </div>
<div class="line"><a id="l00734" name="l00734"></a><span class="lineno">  734</span>    <span class="keywordflow">return</span> erv_route;</div>
<div class="line"><a id="l00735" name="l00735"></a><span class="lineno">  735</span>  }</div>
<div class="line"><a id="l00736" name="l00736"></a><span class="lineno">  736</span> </div>
<div class="line"><a id="l00737" name="l00737"></a><span class="lineno"><a class="line" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#ac0d01b34e40eac594bb92652acbf7a8e">  737</a></span>  std::vector&lt;lanelet::BasicPoint2d&gt; <a class="code hl_function" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#ac0d01b34e40eac594bb92652acbf7a8e">ApproachingEmergencyVehiclePlugin::filter_points_ahead</a>(<span class="keyword">const</span> lanelet::BasicPoint2d&amp; reference_point, <span class="keyword">const</span> std::vector&lt;lanelet::BasicPoint2d&gt;&amp; original_points)<span class="keyword"> const</span></div>
<div class="line"><a id="l00738" name="l00738"></a><span class="lineno">  738</span><span class="keyword">  </span>{</div>
<div class="line"><a id="l00739" name="l00739"></a><span class="lineno">  739</span>    <span class="keywordflow">if</span> (original_points.size() &lt;= 1)</div>
<div class="line"><a id="l00740" name="l00740"></a><span class="lineno">  740</span>    {</div>
<div class="line"><a id="l00741" name="l00741"></a><span class="lineno">  741</span>      <span class="keywordflow">return</span> original_points;</div>
<div class="line"><a id="l00742" name="l00742"></a><span class="lineno">  742</span>    }</div>
<div class="line"><a id="l00743" name="l00743"></a><span class="lineno">  743</span>    </div>
<div class="line"><a id="l00744" name="l00744"></a><span class="lineno">  744</span>    <span class="comment">// extend the list by extrapolating last two points</span></div>
<div class="line"><a id="l00745" name="l00745"></a><span class="lineno">  745</span>    <span class="keyword">auto</span> extended_points = original_points;</div>
<div class="line"><a id="l00746" name="l00746"></a><span class="lineno">  746</span>    <span class="keywordtype">double</span> last_dx = (original_points.end() - 1 ) -&gt;<a class="code hl_variable" href="namespaceprocess__traj__logs.html#af3ba6144a2d35a4990f1a8d04632a052">x</a>() - (original_points.end() - 2 ) -&gt;<a class="code hl_variable" href="namespaceprocess__traj__logs.html#af3ba6144a2d35a4990f1a8d04632a052">x</a>();</div>
<div class="line"><a id="l00747" name="l00747"></a><span class="lineno">  747</span>    <span class="keywordtype">double</span> last_dy = (original_points.end() - 1 ) -&gt;<a class="code hl_variable" href="namespaceprocess__traj__logs.html#a05bdb238bfbf3836fb0aa69c5aa1bb48">y</a>() - (original_points.end() - 2 ) -&gt;<a class="code hl_variable" href="namespaceprocess__traj__logs.html#a05bdb238bfbf3836fb0aa69c5aa1bb48">y</a>();</div>
<div class="line"><a id="l00748" name="l00748"></a><span class="lineno">  748</span>    lanelet::BasicPoint2d extended_point = {(original_points.end() - 1 ) -&gt;<a class="code hl_variable" href="namespaceprocess__traj__logs.html#af3ba6144a2d35a4990f1a8d04632a052">x</a>() + last_dx, (original_points.end() - 1 ) -&gt;<a class="code hl_variable" href="namespaceprocess__traj__logs.html#a05bdb238bfbf3836fb0aa69c5aa1bb48">y</a>() + last_dy};</div>
<div class="line"><a id="l00749" name="l00749"></a><span class="lineno">  749</span>    extended_points.push_back(extended_point);</div>
<div class="line"><a id="l00750" name="l00750"></a><span class="lineno">  750</span> </div>
<div class="line"><a id="l00751" name="l00751"></a><span class="lineno">  751</span>    <span class="keywordtype">size_t</span> <a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a> = 0;</div>
<div class="line"><a id="l00752" name="l00752"></a><span class="lineno">  752</span>    <span class="keywordtype">size_t</span> closest_idx;</div>
<div class="line"><a id="l00753" name="l00753"></a><span class="lineno">  753</span>    <span class="keywordtype">double</span> closest_dist = DBL_MAX;</div>
<div class="line"><a id="l00754" name="l00754"></a><span class="lineno">  754</span>    <span class="keywordflow">while</span> (<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a> &lt; extended_points.size() - 1)</div>
<div class="line"><a id="l00755" name="l00755"></a><span class="lineno">  755</span>    {</div>
<div class="line"><a id="l00756" name="l00756"></a><span class="lineno">  756</span>      <span class="comment">// Calculate vectors</span></div>
<div class="line"><a id="l00757" name="l00757"></a><span class="lineno">  757</span>      <span class="keywordtype">double</span> v1x = reference_point.x() - extended_points[<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>].x();</div>
<div class="line"><a id="l00758" name="l00758"></a><span class="lineno">  758</span> </div>
<div class="line"><a id="l00759" name="l00759"></a><span class="lineno">  759</span>      <span class="keywordtype">double</span> v1y = reference_point.y() - extended_points[<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>].y();</div>
<div class="line"><a id="l00760" name="l00760"></a><span class="lineno">  760</span>      <span class="keywordtype">double</span> v2x = extended_points[<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>+1].x() - extended_points[<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>].x();</div>
<div class="line"><a id="l00761" name="l00761"></a><span class="lineno">  761</span>      <span class="keywordtype">double</span> v2y = extended_points[<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>+1].y() - extended_points[<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>].y();</div>
<div class="line"><a id="l00762" name="l00762"></a><span class="lineno">  762</span> </div>
<div class="line"><a id="l00763" name="l00763"></a><span class="lineno">  763</span>      RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6d19969dc5f588661e25aa3575127405">logger_name</a>), <span class="stringliteral">&quot;reference_point x: &quot;</span> &lt;&lt; reference_point.x() &lt;&lt; <span class="stringliteral">&quot;, y: &quot;</span> &lt;&lt; reference_point.y());</div>
<div class="line"><a id="l00764" name="l00764"></a><span class="lineno">  764</span>      RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6d19969dc5f588661e25aa3575127405">logger_name</a>), <span class="stringliteral">&quot;extended_points x: &quot;</span> &lt;&lt; extended_points[<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>].<a class="code hl_variable" href="namespaceprocess__traj__logs.html#af3ba6144a2d35a4990f1a8d04632a052">x</a>() &lt;&lt; <span class="stringliteral">&quot;, y: &quot;</span> &lt;&lt; extended_points[<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>].<a class="code hl_variable" href="namespaceprocess__traj__logs.html#a05bdb238bfbf3836fb0aa69c5aa1bb48">y</a>());</div>
<div class="line"><a id="l00765" name="l00765"></a><span class="lineno">  765</span> </div>
<div class="line"><a id="l00766" name="l00766"></a><span class="lineno">  766</span> </div>
<div class="line"><a id="l00767" name="l00767"></a><span class="lineno">  767</span>      <span class="comment">// Calculate dot product</span></div>
<div class="line"><a id="l00768" name="l00768"></a><span class="lineno">  768</span>      <span class="keywordtype">double</span> dotProduct = v1x * v2x + v1y * v2y;</div>
<div class="line"><a id="l00769" name="l00769"></a><span class="lineno">  769</span> </div>
<div class="line"><a id="l00770" name="l00770"></a><span class="lineno">  770</span>      <span class="comment">// Calculate magnitudes</span></div>
<div class="line"><a id="l00771" name="l00771"></a><span class="lineno">  771</span>      <span class="keywordtype">double</span> v1Mag = sqrt(v1x * v1x + v1y * v1y);</div>
<div class="line"><a id="l00772" name="l00772"></a><span class="lineno">  772</span>      <span class="keywordtype">double</span> v2Mag = sqrt(v2x * v2x + v2y * v2y);</div>
<div class="line"><a id="l00773" name="l00773"></a><span class="lineno">  773</span> </div>
<div class="line"><a id="l00774" name="l00774"></a><span class="lineno">  774</span>      <span class="comment">// Calculate angle in radians</span></div>
<div class="line"><a id="l00775" name="l00775"></a><span class="lineno">  775</span>      <span class="keywordtype">double</span> angleRad = acos(dotProduct / (v1Mag * v2Mag));</div>
<div class="line"><a id="l00776" name="l00776"></a><span class="lineno">  776</span> </div>
<div class="line"><a id="l00777" name="l00777"></a><span class="lineno">  777</span>      <span class="comment">// Angle between the vectors above 90 degrees means the point i is ahead</span></div>
<div class="line"><a id="l00778" name="l00778"></a><span class="lineno">  778</span>      <span class="keywordflow">if</span> (angleRad &gt;= M_PI / 2) </div>
<div class="line"><a id="l00779" name="l00779"></a><span class="lineno">  779</span>      {</div>
<div class="line"><a id="l00780" name="l00780"></a><span class="lineno">  780</span>        <span class="keywordtype">double</span> dx = reference_point.x() - extended_points[<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>].x(); </div>
<div class="line"><a id="l00781" name="l00781"></a><span class="lineno">  781</span>        <span class="keywordtype">double</span> dy = reference_point.y() - extended_points[<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>].y();</div>
<div class="line"><a id="l00782" name="l00782"></a><span class="lineno">  782</span>        <span class="keywordtype">double</span> distance = sqrt (dx * dx + dy * dy);</div>
<div class="line"><a id="l00783" name="l00783"></a><span class="lineno">  783</span>        <span class="keywordflow">if</span> (distance &lt; closest_dist) <span class="comment">// get closest point to the reference point from the multiple possible points </span></div>
<div class="line"><a id="l00784" name="l00784"></a><span class="lineno">  784</span>        {</div>
<div class="line"><a id="l00785" name="l00785"></a><span class="lineno">  785</span>          closest_dist = distance;</div>
<div class="line"><a id="l00786" name="l00786"></a><span class="lineno">  786</span>          closest_idx = <a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>;</div>
<div class="line"><a id="l00787" name="l00787"></a><span class="lineno">  787</span>          RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6d19969dc5f588661e25aa3575127405">logger_name</a>), <span class="stringliteral">&quot;closest_dist: &quot;</span> &lt;&lt; closest_dist &lt;&lt; <span class="stringliteral">&quot;, closest_idx&quot;</span> &lt;&lt; closest_idx);</div>
<div class="line"><a id="l00788" name="l00788"></a><span class="lineno">  788</span> </div>
<div class="line"><a id="l00789" name="l00789"></a><span class="lineno">  789</span>        }</div>
<div class="line"><a id="l00790" name="l00790"></a><span class="lineno">  790</span>      }</div>
<div class="line"><a id="l00791" name="l00791"></a><span class="lineno">  791</span>      <a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a> ++;</div>
<div class="line"><a id="l00792" name="l00792"></a><span class="lineno">  792</span>    }</div>
<div class="line"><a id="l00793" name="l00793"></a><span class="lineno">  793</span> </div>
<div class="line"><a id="l00794" name="l00794"></a><span class="lineno">  794</span>    <span class="keywordtype">double</span> dx = reference_point.x() - original_points.back().x(); </div>
<div class="line"><a id="l00795" name="l00795"></a><span class="lineno">  795</span>    <span class="keywordtype">double</span> dy = reference_point.y() - original_points.back().y();</div>
<div class="line"><a id="l00796" name="l00796"></a><span class="lineno">  796</span>    <span class="keywordtype">double</span> distance = sqrt (dx * dx + dy * dy);</div>
<div class="line"><a id="l00797" name="l00797"></a><span class="lineno">  797</span> </div>
<div class="line"><a id="l00798" name="l00798"></a><span class="lineno">  798</span>    <span class="comment">// last point is still closer to the reference point, all points have passed</span></div>
<div class="line"><a id="l00799" name="l00799"></a><span class="lineno">  799</span>    <span class="comment">// note that if the optimal point is the last one, this check fails as intended</span></div>
<div class="line"><a id="l00800" name="l00800"></a><span class="lineno">  800</span>    <span class="keywordflow">if</span> (distance &lt; closest_dist) </div>
<div class="line"><a id="l00801" name="l00801"></a><span class="lineno">  801</span>    {</div>
<div class="line"><a id="l00802" name="l00802"></a><span class="lineno">  802</span>      RCLCPP_ERROR_STREAM(rclcpp::get_logger(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6d19969dc5f588661e25aa3575127405">logger_name</a>), <span class="stringliteral">&quot;Returning empty here&quot;</span>);</div>
<div class="line"><a id="l00803" name="l00803"></a><span class="lineno">  803</span>      </div>
<div class="line"><a id="l00804" name="l00804"></a><span class="lineno">  804</span>      <span class="keywordflow">return</span> {};</div>
<div class="line"><a id="l00805" name="l00805"></a><span class="lineno">  805</span>    }</div>
<div class="line"><a id="l00806" name="l00806"></a><span class="lineno">  806</span> </div>
<div class="line"><a id="l00807" name="l00807"></a><span class="lineno">  807</span>    <span class="keywordflow">return</span> std::vector&lt;lanelet::BasicPoint2d&gt;(original_points.begin() + closest_idx, original_points.end());</div>
<div class="line"><a id="l00808" name="l00808"></a><span class="lineno">  808</span>  }</div>
<div class="line"><a id="l00809" name="l00809"></a><span class="lineno"><a class="line" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#aaa56c5f7f80a2f087d52d150d15cf469">  809</a></span>  <span class="keywordtype">void</span> <a class="code hl_function" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#aaa56c5f7f80a2f087d52d150d15cf469">ApproachingEmergencyVehiclePlugin::incomingBsmCallback</a>(carma_v2x_msgs::msg::BSM::UniquePtr msg)</div>
<div class="line"><a id="l00810" name="l00810"></a><span class="lineno">  810</span>  {</div>
<div class="line"><a id="l00811" name="l00811"></a><span class="lineno">  811</span>    <span class="comment">// Only process incoming BSMs if guidance is currently engaged</span></div>
<div class="line"><a id="l00812" name="l00812"></a><span class="lineno">  812</span>    <span class="keywordflow">if</span>(!<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a2195e788f403f7fd401ef4f45fdf5d76">is_guidance_engaged_</a>){</div>
<div class="line"><a id="l00813" name="l00813"></a><span class="lineno">  813</span>      <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00814" name="l00814"></a><span class="lineno">  814</span>    }</div>
<div class="line"><a id="l00815" name="l00815"></a><span class="lineno">  815</span> </div>
<div class="line"><a id="l00816" name="l00816"></a><span class="lineno">  816</span>    <span class="comment">// Get the vehicle ID associated with the received BSM</span></div>
<div class="line"><a id="l00817" name="l00817"></a><span class="lineno">  817</span>    std::stringstream ss;</div>
<div class="line"><a id="l00818" name="l00818"></a><span class="lineno">  818</span>    <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> <a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a> = 0; <a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a> &lt; msg-&gt;core_data.id.size(); ++<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>){</div>
<div class="line"><a id="l00819" name="l00819"></a><span class="lineno">  819</span>      ss &lt;&lt; std::setfill(<span class="charliteral">&#39;0&#39;</span>) &lt;&lt; std::setw(2) &lt;&lt; std::hex &lt;&lt; (unsigned)msg-&gt;core_data.id.at(<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>);</div>
<div class="line"><a id="l00820" name="l00820"></a><span class="lineno">  820</span>    }</div>
<div class="line"><a id="l00821" name="l00821"></a><span class="lineno">  821</span>    std::string erv_vehicle_id = ss.str();</div>
<div class="line"><a id="l00822" name="l00822"></a><span class="lineno">  822</span>    RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6d19969dc5f588661e25aa3575127405">logger_name</a>), <span class="stringliteral">&quot;Received a BSM from &quot;</span> &lt;&lt; erv_vehicle_id);</div>
<div class="line"><a id="l00823" name="l00823"></a><span class="lineno">  823</span> </div>
<div class="line"><a id="l00824" name="l00824"></a><span class="lineno">  824</span>    <span class="keywordflow">if</span>(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6c454433ce5dedbf0f32bfb38f1404ed">has_tracked_erv_</a>){</div>
<div class="line"><a id="l00825" name="l00825"></a><span class="lineno">  825</span>      <span class="comment">// If there is already an ERV approaching the ego vehicle, only process this BSM further if it is from that ERV and enough time has passed since the previously processed BSM</span></div>
<div class="line"><a id="l00826" name="l00826"></a><span class="lineno">  826</span> </div>
<div class="line"><a id="l00827" name="l00827"></a><span class="lineno">  827</span>      <span class="keywordflow">if</span>(erv_vehicle_id == <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a676b5bf0f041728d2413650885c9bd36">tracked_erv_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1ErvInformation.html#a2d25462696d7933e72bc33239c42287d">vehicle_id</a>){</div>
<div class="line"><a id="l00828" name="l00828"></a><span class="lineno">  828</span>        <span class="keywordtype">double</span> seconds_since_prev_processed_bsm = (this-&gt;now() - <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a676b5bf0f041728d2413650885c9bd36">tracked_erv_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1ErvInformation.html#a6966afb86227f0e5edef2a03b142265a">latest_update_time</a>).seconds();</div>
<div class="line"><a id="l00829" name="l00829"></a><span class="lineno">  829</span> </div>
<div class="line"><a id="l00830" name="l00830"></a><span class="lineno">  830</span>        <span class="keywordflow">if</span>(seconds_since_prev_processed_bsm &lt; (1.0 / <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a2e6f2566571a01c095800f712e8ee183">bsm_processing_frequency</a>)){</div>
<div class="line"><a id="l00831" name="l00831"></a><span class="lineno">  831</span>          <span class="comment">// Do not process ERV&#39;s BSM further since not enough time has passed since its previously processed BSM</span></div>
<div class="line"><a id="l00832" name="l00832"></a><span class="lineno">  832</span>          RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6d19969dc5f588661e25aa3575127405">logger_name</a>), <span class="stringliteral">&quot;Ignoring BSM from tracked ERV &quot;</span> &lt;&lt; erv_vehicle_id &lt;&lt; <span class="stringliteral">&quot; since a BSM from it was processed &quot;</span> &lt;&lt; seconds_since_prev_processed_bsm &lt;&lt; <span class="stringliteral">&quot; seconds ago&quot;</span>);</div>
<div class="line"><a id="l00833" name="l00833"></a><span class="lineno">  833</span>          <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00834" name="l00834"></a><span class="lineno">  834</span>        }</div>
<div class="line"><a id="l00835" name="l00835"></a><span class="lineno">  835</span>      }</div>
<div class="line"><a id="l00836" name="l00836"></a><span class="lineno">  836</span>      <span class="keywordflow">else</span>{</div>
<div class="line"><a id="l00837" name="l00837"></a><span class="lineno">  837</span>        <span class="comment">// Do not process BSM further since it is not for the currently tracked ERV</span></div>
<div class="line"><a id="l00838" name="l00838"></a><span class="lineno">  838</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00839" name="l00839"></a><span class="lineno">  839</span>      }</div>
<div class="line"><a id="l00840" name="l00840"></a><span class="lineno">  840</span>    }</div>
<div class="line"><a id="l00841" name="l00841"></a><span class="lineno">  841</span>    <span class="keywordflow">else</span>{</div>
<div class="line"><a id="l00842" name="l00842"></a><span class="lineno">  842</span> </div>
<div class="line"><a id="l00843" name="l00843"></a><span class="lineno">  843</span>      <span class="comment">// If BSM is from a detected active ERV, only process it further if enough time has passed since the previously processed BSM from this ERV</span></div>
<div class="line"><a id="l00844" name="l00844"></a><span class="lineno">  844</span>      <span class="keywordflow">if</span> (<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a9b9ff2e431bc51b33cf12b95fec17ba8">latest_erv_update_times_</a>.find(erv_vehicle_id) != <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a9b9ff2e431bc51b33cf12b95fec17ba8">latest_erv_update_times_</a>.end()){</div>
<div class="line"><a id="l00845" name="l00845"></a><span class="lineno">  845</span>        <span class="keywordtype">double</span> seconds_since_prev_processed_bsm = (this-&gt;now() - <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a9b9ff2e431bc51b33cf12b95fec17ba8">latest_erv_update_times_</a>[erv_vehicle_id]).seconds();</div>
<div class="line"><a id="l00846" name="l00846"></a><span class="lineno">  846</span> </div>
<div class="line"><a id="l00847" name="l00847"></a><span class="lineno">  847</span>        <span class="keywordflow">if</span>(seconds_since_prev_processed_bsm &lt; (1.0 / <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a2e6f2566571a01c095800f712e8ee183">bsm_processing_frequency</a>)){</div>
<div class="line"><a id="l00848" name="l00848"></a><span class="lineno">  848</span>          <span class="comment">// Do not process ERV&#39;s BSM further since not enough time has passed since its previously processed BSM</span></div>
<div class="line"><a id="l00849" name="l00849"></a><span class="lineno">  849</span>          RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6d19969dc5f588661e25aa3575127405">logger_name</a>), <span class="stringliteral">&quot;Ignoring BSM from non tracked ERV &quot;</span> &lt;&lt; erv_vehicle_id &lt;&lt; <span class="stringliteral">&quot; since a BSM from it was processed &quot;</span> &lt;&lt; seconds_since_prev_processed_bsm &lt;&lt; <span class="stringliteral">&quot; seconds ago&quot;</span>);</div>
<div class="line"><a id="l00850" name="l00850"></a><span class="lineno">  850</span>          <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00851" name="l00851"></a><span class="lineno">  851</span>        }</div>
<div class="line"><a id="l00852" name="l00852"></a><span class="lineno">  852</span>      }</div>
<div class="line"><a id="l00853" name="l00853"></a><span class="lineno">  853</span>    }</div>
<div class="line"><a id="l00854" name="l00854"></a><span class="lineno">  854</span> </div>
<div class="line"><a id="l00855" name="l00855"></a><span class="lineno">  855</span>    <span class="comment">// Get ErvInformation object with information from the BSM if it is from an active ERV that is approaching the ego vehicle</span></div>
<div class="line"><a id="l00856" name="l00856"></a><span class="lineno">  856</span>    boost::optional&lt;ErvInformation&gt; erv_information = <a class="code hl_function" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#ac93a5ead1728d2b37a778ce416f80f2b">getErvInformationFromBsm</a>(std::move(msg));</div>
<div class="line"><a id="l00857" name="l00857"></a><span class="lineno">  857</span>    <span class="keywordflow">if</span>(!erv_information){</div>
<div class="line"><a id="l00858" name="l00858"></a><span class="lineno">  858</span>        RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6d19969dc5f588661e25aa3575127405">logger_name</a>), <span class="stringliteral">&quot;BSM is not from an active ERV that is approaching the ego vehicle.&quot;</span>);</div>
<div class="line"><a id="l00859" name="l00859"></a><span class="lineno">  859</span> </div>
<div class="line"><a id="l00860" name="l00860"></a><span class="lineno">  860</span>        <span class="keywordflow">if</span>(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6c454433ce5dedbf0f32bfb38f1404ed">has_tracked_erv_</a>){</div>
<div class="line"><a id="l00861" name="l00861"></a><span class="lineno">  861</span>          RCLCPP_INFO_STREAM(rclcpp::get_logger(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6d19969dc5f588661e25aa3575127405">logger_name</a>), <span class="stringliteral">&quot;BSM was from the currently tracked approaching ERV! ERV is no longer approaching.&quot;</span>);</div>
<div class="line"><a id="l00862" name="l00862"></a><span class="lineno">  862</span>          <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6c454433ce5dedbf0f32bfb38f1404ed">has_tracked_erv_</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00863" name="l00863"></a><span class="lineno">  863</span>          <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a529d40caad413492d989ab91eb48fdb6">has_planned_upcoming_lc_</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00864" name="l00864"></a><span class="lineno">  864</span>          <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a36f8f9b65fe9f2ebe9bbb09f3b1e2d8e">transition_table_</a>.<a class="code hl_function" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehicleTransitionTable.html#a8e2158634e7011225335a2674e08f305">event</a>(<a class="code hl_enumvalue" href="namespaceapproaching__emergency__vehicle__plugin.html#ae26e1cd128942ddf2ca8eccadb66a6caa3dc495a5c3931df7278a227f93d6b70a">ApproachingEmergencyVehicleEvent::NO_APPROACHING_ERV</a>);</div>
<div class="line"><a id="l00865" name="l00865"></a><span class="lineno">  865</span>        }</div>
<div class="line"><a id="l00866" name="l00866"></a><span class="lineno">  866</span> </div>
<div class="line"><a id="l00867" name="l00867"></a><span class="lineno">  867</span>      <span class="comment">// BSM is not from an active ERV that is approaching the ego vehicle</span></div>
<div class="line"><a id="l00868" name="l00868"></a><span class="lineno">  868</span>      <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00869" name="l00869"></a><span class="lineno">  869</span>    }</div>
<div class="line"><a id="l00870" name="l00870"></a><span class="lineno">  870</span>    <span class="keywordflow">else</span>{</div>
<div class="line"><a id="l00871" name="l00871"></a><span class="lineno">  871</span>      <span class="comment">// Update tracked ERV information since this is an active ERV that is approaching the ego vehicle</span></div>
<div class="line"><a id="l00872" name="l00872"></a><span class="lineno">  872</span>      <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a676b5bf0f041728d2413650885c9bd36">tracked_erv_</a> = *erv_information;</div>
<div class="line"><a id="l00873" name="l00873"></a><span class="lineno">  873</span>      <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a676b5bf0f041728d2413650885c9bd36">tracked_erv_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1ErvInformation.html#a6966afb86227f0e5edef2a03b142265a">latest_update_time</a> = this-&gt;now();</div>
<div class="line"><a id="l00874" name="l00874"></a><span class="lineno">  874</span> </div>
<div class="line"><a id="l00875" name="l00875"></a><span class="lineno">  875</span>      <span class="keywordflow">if</span>(!<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6c454433ce5dedbf0f32bfb38f1404ed">has_tracked_erv_</a>){</div>
<div class="line"><a id="l00876" name="l00876"></a><span class="lineno">  876</span>        <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6c454433ce5dedbf0f32bfb38f1404ed">has_tracked_erv_</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00877" name="l00877"></a><span class="lineno">  877</span>      }</div>
<div class="line"><a id="l00878" name="l00878"></a><span class="lineno">  878</span>    }</div>
<div class="line"><a id="l00879" name="l00879"></a><span class="lineno">  879</span> </div>
<div class="line"><a id="l00880" name="l00880"></a><span class="lineno">  880</span>    <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00881" name="l00881"></a><span class="lineno">  881</span>  }</div>
<div class="line"><a id="l00882" name="l00882"></a><span class="lineno">  882</span> </div>
<div class="line"><a id="l00883" name="l00883"></a><span class="lineno"><a class="line" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a856426089b0cbb71bb94001268548652">  883</a></span>  boost::optional&lt;double&gt; <a class="code hl_function" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a856426089b0cbb71bb94001268548652">ApproachingEmergencyVehiclePlugin::getSecondsUntilPassing</a>(lanelet::Optional&lt;lanelet::routing::Route&gt;&amp; erv_future_route, <span class="keyword">const</span> lanelet::BasicPoint2d&amp; erv_position_in_map, </div>
<div class="line"><a id="l00884" name="l00884"></a><span class="lineno">  884</span>                                                                   <span class="keyword">const</span> <span class="keywordtype">double</span>&amp; erv_current_speed, lanelet::ConstLanelet&amp; intersecting_lanelet){</div>
<div class="line"><a id="l00885" name="l00885"></a><span class="lineno">  885</span> </div>
<div class="line"><a id="l00886" name="l00886"></a><span class="lineno">  886</span>    <span class="comment">// Obtain ego vehicle and ERV distances to the end of the intersecting lanelet so neither vehicle will currently be past that point</span></div>
<div class="line"><a id="l00887" name="l00887"></a><span class="lineno">  887</span>    lanelet::ConstLineString2d intersecting_centerline = lanelet::utils::to2D(intersecting_lanelet.centerline());</div>
<div class="line"><a id="l00888" name="l00888"></a><span class="lineno">  888</span>    lanelet::BasicPoint2d intersecting_end_point = intersecting_centerline.back();</div>
<div class="line"><a id="l00889" name="l00889"></a><span class="lineno">  889</span> </div>
<div class="line"><a id="l00890" name="l00890"></a><span class="lineno">  890</span>    <span class="comment">// Get ego vehicle&#39;s (its rear bumper) distance to the intersecting lanelet&#39;s centerline endpoint</span></div>
<div class="line"><a id="l00891" name="l00891"></a><span class="lineno">  891</span>    <span class="keywordtype">double</span> ego_dist_to_lanelet = <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a61b742aab762fff7983b3a1bf1a148b1">wm_</a>-&gt;routeTrackPos(intersecting_end_point).downtrack - (<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#aab5aa7ece8a925faed95d97a4c007b23">latest_route_state_</a>.down_track - <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#afe9dff631c6c75497bbecfe6f6029753">vehicle_length</a>);</div>
<div class="line"><a id="l00892" name="l00892"></a><span class="lineno">  892</span> </div>
<div class="line"><a id="l00893" name="l00893"></a><span class="lineno">  893</span>    <span class="comment">// Set erv_world_model_ route to the erv_future_route</span></div>
<div class="line"><a id="l00894" name="l00894"></a><span class="lineno">  894</span>    lanelet::routing::Route <a class="code hl_namespace" href="namespaceroute.html">route</a> = std::move(*erv_future_route);</div>
<div class="line"><a id="l00895" name="l00895"></a><span class="lineno">  895</span>    <a class="code hl_typedef" href="namespacecarma__wm.html#ae21cba9eaf353a58738fc2c1773c5ffa">carma_wm::LaneletRoutePtr</a> erv_future_route_ptr = std::make_shared&lt;lanelet::routing::Route&gt;(std::move(<a class="code hl_namespace" href="namespaceroute.html">route</a>));</div>
<div class="line"><a id="l00896" name="l00896"></a><span class="lineno">  896</span>    <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a34b6121fd1201177d180f616f635a260">erv_world_model_</a>-&gt;setRoute(erv_future_route_ptr);</div>
<div class="line"><a id="l00897" name="l00897"></a><span class="lineno">  897</span> </div>
<div class="line"><a id="l00898" name="l00898"></a><span class="lineno">  898</span>    <span class="comment">// Get ERV&#39;s distance to the intersecting lanelet&#39;s centerline endpoint</span></div>
<div class="line"><a id="l00899" name="l00899"></a><span class="lineno">  899</span>    <span class="keywordtype">double</span> erv_dist_to_lanelet = <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a34b6121fd1201177d180f616f635a260">erv_world_model_</a>-&gt;routeTrackPos(intersecting_end_point).downtrack - <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a34b6121fd1201177d180f616f635a260">erv_world_model_</a>-&gt;routeTrackPos(erv_position_in_map).downtrack;</div>
<div class="line"><a id="l00900" name="l00900"></a><span class="lineno">  900</span> </div>
<div class="line"><a id="l00901" name="l00901"></a><span class="lineno">  901</span>    <span class="keywordflow">if</span>(erv_dist_to_lanelet &lt; ego_dist_to_lanelet){</div>
<div class="line"><a id="l00902" name="l00902"></a><span class="lineno">  902</span>      <span class="comment">// When ERV is in front of the ego vehicle, only process further if the ERV is actively passing the ego vehicle</span></div>
<div class="line"><a id="l00903" name="l00903"></a><span class="lineno">  903</span> </div>
<div class="line"><a id="l00904" name="l00904"></a><span class="lineno">  904</span>      <span class="keywordflow">if</span>(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a36f8f9b65fe9f2ebe9bbb09f3b1e2d8e">transition_table_</a>.<a class="code hl_function" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehicleTransitionTable.html#a4c74448ef5d30dcda8bbc4fecf054199">getState</a>() != <a class="code hl_enumvalue" href="namespaceapproaching__emergency__vehicle__plugin.html#aeb182d0e6c9d53e276e1b9935aff0630abe5a505910aae73e4a99392e4b36e99a">ApproachingEmergencyVehicleState::SLOWING_DOWN_FOR_ERV</a>){</div>
<div class="line"><a id="l00905" name="l00905"></a><span class="lineno">  905</span>        RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6d19969dc5f588661e25aa3575127405">logger_name</a>), <span class="stringliteral">&quot;Detected ERV is in front of the ego vehicle&quot;</span>);</div>
<div class="line"><a id="l00906" name="l00906"></a><span class="lineno">  906</span>        <span class="keywordflow">return</span> boost::optional&lt;double&gt;();</div>
<div class="line"><a id="l00907" name="l00907"></a><span class="lineno">  907</span>      }</div>
<div class="line"><a id="l00908" name="l00908"></a><span class="lineno">  908</span>      <span class="keywordflow">else</span>{</div>
<div class="line"><a id="l00909" name="l00909"></a><span class="lineno">  909</span>        <span class="comment">// This ERV is actively passing the ego vehicle until its distance in front of the ego vehicle is at least config_.finished_passing_threshold</span></div>
<div class="line"><a id="l00910" name="l00910"></a><span class="lineno">  910</span>        <span class="keywordflow">if</span>((ego_dist_to_lanelet - erv_dist_to_lanelet) &lt; <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a7573a5e45947f7d8fa3504161936bd19">finished_passing_threshold</a>){</div>
<div class="line"><a id="l00911" name="l00911"></a><span class="lineno">  911</span>          <span class="comment">// Return zero to indicate that the ERV is currently passing the ego vehicle</span></div>
<div class="line"><a id="l00912" name="l00912"></a><span class="lineno">  912</span>          <span class="keywordflow">return</span> 0.0;</div>
<div class="line"><a id="l00913" name="l00913"></a><span class="lineno">  913</span>        }</div>
<div class="line"><a id="l00914" name="l00914"></a><span class="lineno">  914</span>        <span class="keywordflow">else</span>{</div>
<div class="line"><a id="l00915" name="l00915"></a><span class="lineno">  915</span>          RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6d19969dc5f588661e25aa3575127405">logger_name</a>), <span class="stringliteral">&quot;ERV has passed the ego vehicle&quot;</span>);</div>
<div class="line"><a id="l00916" name="l00916"></a><span class="lineno">  916</span>          <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6c454433ce5dedbf0f32bfb38f1404ed">has_tracked_erv_</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00917" name="l00917"></a><span class="lineno">  917</span>          <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a529d40caad413492d989ab91eb48fdb6">has_planned_upcoming_lc_</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00918" name="l00918"></a><span class="lineno">  918</span>          <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a36f8f9b65fe9f2ebe9bbb09f3b1e2d8e">transition_table_</a>.<a class="code hl_function" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehicleTransitionTable.html#a8e2158634e7011225335a2674e08f305">event</a>(<a class="code hl_enumvalue" href="namespaceapproaching__emergency__vehicle__plugin.html#ae26e1cd128942ddf2ca8eccadb66a6caa859695dc48d2267825f817444e92d311">ApproachingEmergencyVehicleEvent::ERV_PASSED</a>);</div>
<div class="line"><a id="l00919" name="l00919"></a><span class="lineno">  919</span>          <span class="keywordflow">return</span> boost::optional&lt;double&gt;();</div>
<div class="line"><a id="l00920" name="l00920"></a><span class="lineno">  920</span>        }</div>
<div class="line"><a id="l00921" name="l00921"></a><span class="lineno">  921</span>      }</div>
<div class="line"><a id="l00922" name="l00922"></a><span class="lineno">  922</span>    }</div>
<div class="line"><a id="l00923" name="l00923"></a><span class="lineno">  923</span>    <span class="keywordflow">else</span>{</div>
<div class="line"><a id="l00924" name="l00924"></a><span class="lineno">  924</span>      <span class="comment">// When ERV is behind the ego vehicle, only process further if the ERV is travelling faster than the ego vehicle</span></div>
<div class="line"><a id="l00925" name="l00925"></a><span class="lineno">  925</span> </div>
<div class="line"><a id="l00926" name="l00926"></a><span class="lineno">  926</span>      <span class="keywordflow">if</span>(erv_current_speed &lt; <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a76eff02c20d84af747204e3904244be3">current_speed_</a>){</div>
<div class="line"><a id="l00927" name="l00927"></a><span class="lineno">  927</span>        RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6d19969dc5f588661e25aa3575127405">logger_name</a>), <span class="stringliteral">&quot;Detected ERV is travelling slower than the ego vehicle, and will not pass the ego vehicle&quot;</span>);</div>
<div class="line"><a id="l00928" name="l00928"></a><span class="lineno">  928</span>        <span class="keywordflow">return</span> boost::optional&lt;double&gt;();</div>
<div class="line"><a id="l00929" name="l00929"></a><span class="lineno">  929</span>      }</div>
<div class="line"><a id="l00930" name="l00930"></a><span class="lineno">  930</span>      <span class="keywordflow">else</span>{</div>
<div class="line"><a id="l00931" name="l00931"></a><span class="lineno">  931</span>        <span class="comment">// Calculate seconds_until_passing and protect against division by zero</span></div>
<div class="line"><a id="l00932" name="l00932"></a><span class="lineno">  932</span>        <span class="keywordtype">double</span> delta_speed = erv_current_speed - <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a76eff02c20d84af747204e3904244be3">current_speed_</a>;</div>
<div class="line"><a id="l00933" name="l00933"></a><span class="lineno">  933</span> </div>
<div class="line"><a id="l00934" name="l00934"></a><span class="lineno">  934</span>        <span class="keywordflow">if</span>(delta_speed == 0.0){</div>
<div class="line"><a id="l00935" name="l00935"></a><span class="lineno">  935</span>          delta_speed = <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a47e5e1d18269f94b5090ba65a6e70f89">epsilon_</a>;</div>
<div class="line"><a id="l00936" name="l00936"></a><span class="lineno">  936</span>        }</div>
<div class="line"><a id="l00937" name="l00937"></a><span class="lineno">  937</span>        <span class="keywordtype">double</span> seconds_until_passing = (erv_dist_to_lanelet - ego_dist_to_lanelet) / delta_speed;</div>
<div class="line"><a id="l00938" name="l00938"></a><span class="lineno">  938</span> </div>
<div class="line"><a id="l00939" name="l00939"></a><span class="lineno">  939</span>        <span class="keywordflow">return</span> seconds_until_passing;</div>
<div class="line"><a id="l00940" name="l00940"></a><span class="lineno">  940</span>      }</div>
<div class="line"><a id="l00941" name="l00941"></a><span class="lineno">  941</span>    }</div>
<div class="line"><a id="l00942" name="l00942"></a><span class="lineno">  942</span>  }</div>
<div class="line"><a id="l00943" name="l00943"></a><span class="lineno">  943</span> </div>
<div class="line"><a id="l00944" name="l00944"></a><span class="lineno"><a class="line" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a0f62756c7dc36020b71d584066065743">  944</a></span>  boost::optional&lt;lanelet::ConstLanelet&gt; <a class="code hl_function" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a0f62756c7dc36020b71d584066065743">ApproachingEmergencyVehiclePlugin::getRouteIntersectingLanelet</a>(<span class="keyword">const</span> lanelet::routing::Route&amp; erv_future_route){</div>
<div class="line"><a id="l00945" name="l00945"></a><span class="lineno">  945</span> </div>
<div class="line"><a id="l00946" name="l00946"></a><span class="lineno">  946</span>    <span class="keywordflow">if</span>(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#afbe916ee3589bbffbbd19939fd242a98">future_route_lanelet_ids_</a>.empty()){</div>
<div class="line"><a id="l00947" name="l00947"></a><span class="lineno">  947</span>      RCLCPP_WARN_STREAM(rclcpp::get_logger(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6d19969dc5f588661e25aa3575127405">logger_name</a>), <span class="stringliteral">&quot;Remaining route lanelets for the ego vehicle not found; plugin cannot compute the intersecting lanelet.&quot;</span>); </div>
<div class="line"><a id="l00948" name="l00948"></a><span class="lineno">  948</span>      <span class="keywordflow">return</span> boost::optional&lt;lanelet::ConstLanelet&gt;();</div>
<div class="line"><a id="l00949" name="l00949"></a><span class="lineno">  949</span>    }</div>
<div class="line"><a id="l00950" name="l00950"></a><span class="lineno">  950</span> </div>
<div class="line"><a id="l00951" name="l00951"></a><span class="lineno">  951</span>    <span class="comment">// Get current downtrack from latest_route_state_</span></div>
<div class="line"><a id="l00952" name="l00952"></a><span class="lineno">  952</span>    <span class="keywordtype">double</span> current_downtrack = <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#aab5aa7ece8a925faed95d97a4c007b23">latest_route_state_</a>.down_track;</div>
<div class="line"><a id="l00953" name="l00953"></a><span class="lineno">  953</span> </div>
<div class="line"><a id="l00954" name="l00954"></a><span class="lineno">  954</span>    <span class="comment">// Find first successful intersecting lanelet between ERV route and ego route with a lanelet starting downtrack greater than current downtrack.</span></div>
<div class="line"><a id="l00955" name="l00955"></a><span class="lineno">  955</span>    <span class="comment">// Additionally, remove lanelets from future_route_lanelet_ids_ that the ego vehicle has passed.</span></div>
<div class="line"><a id="l00956" name="l00956"></a><span class="lineno">  956</span>    <span class="keywordflow">for</span>(<span class="keyword">auto</span> it = <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#afbe916ee3589bbffbbd19939fd242a98">future_route_lanelet_ids_</a>.begin(); it != <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#afbe916ee3589bbffbbd19939fd242a98">future_route_lanelet_ids_</a>.end();){</div>
<div class="line"><a id="l00957" name="l00957"></a><span class="lineno">  957</span>      <span class="comment">// Get lanelet</span></div>
<div class="line"><a id="l00958" name="l00958"></a><span class="lineno">  958</span>      lanelet::Id ego_route_lanelet_id = *it;</div>
<div class="line"><a id="l00959" name="l00959"></a><span class="lineno">  959</span>      lanelet::ConstLanelet ego_route_lanelet = <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a61b742aab762fff7983b3a1bf1a148b1">wm_</a>-&gt;getMap()-&gt;laneletLayer.get(ego_route_lanelet_id);</div>
<div class="line"><a id="l00960" name="l00960"></a><span class="lineno">  960</span> </div>
<div class="line"><a id="l00961" name="l00961"></a><span class="lineno">  961</span>      <span class="comment">// Get lanelet&#39;s centerline end point downtrack</span></div>
<div class="line"><a id="l00962" name="l00962"></a><span class="lineno">  962</span>      lanelet::BasicPoint2d ego_route_lanelet_centerline_end = lanelet::utils::to2D(ego_route_lanelet.centerline()).back();</div>
<div class="line"><a id="l00963" name="l00963"></a><span class="lineno">  963</span>      <span class="keywordtype">double</span> ego_route_lanelet_centerline_end_downtrack = <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a61b742aab762fff7983b3a1bf1a148b1">wm_</a>-&gt;routeTrackPos(ego_route_lanelet_centerline_end).downtrack;</div>
<div class="line"><a id="l00964" name="l00964"></a><span class="lineno">  964</span> </div>
<div class="line"><a id="l00965" name="l00965"></a><span class="lineno">  965</span>      <span class="keywordflow">if</span>(current_downtrack &gt; ego_route_lanelet_centerline_end_downtrack){</div>
<div class="line"><a id="l00966" name="l00966"></a><span class="lineno">  966</span>        <span class="comment">// If current downtrack is greater than lanelet ending downtrack, remove lanelet from future route lanelet and continue</span></div>
<div class="line"><a id="l00967" name="l00967"></a><span class="lineno">  967</span>        <span class="comment">// NOTE: Iterator is not updated since an element is being erased</span></div>
<div class="line"><a id="l00968" name="l00968"></a><span class="lineno">  968</span>        RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6d19969dc5f588661e25aa3575127405">logger_name</a>), <span class="stringliteral">&quot;Removing passed lanelet &quot;</span> &lt;&lt; ego_route_lanelet_id); </div>
<div class="line"><a id="l00969" name="l00969"></a><span class="lineno">  969</span>        <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#afbe916ee3589bbffbbd19939fd242a98">future_route_lanelet_ids_</a>.erase(it);</div>
<div class="line"><a id="l00970" name="l00970"></a><span class="lineno">  970</span>      }</div>
<div class="line"><a id="l00971" name="l00971"></a><span class="lineno">  971</span>      <span class="keywordflow">else</span>{</div>
<div class="line"><a id="l00972" name="l00972"></a><span class="lineno">  972</span>        <span class="comment">// If lanelet exists in both, return it as the intersecting lanelet</span></div>
<div class="line"><a id="l00973" name="l00973"></a><span class="lineno">  973</span>        <span class="keywordflow">if</span>(erv_future_route.contains(ego_route_lanelet)){</div>
<div class="line"><a id="l00974" name="l00974"></a><span class="lineno">  974</span>          RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6d19969dc5f588661e25aa3575127405">logger_name</a>), <span class="stringliteral">&quot;Found intersecting lanelet &quot;</span> &lt;&lt; ego_route_lanelet_id); </div>
<div class="line"><a id="l00975" name="l00975"></a><span class="lineno">  975</span>          <span class="keywordflow">return</span> boost::optional&lt;lanelet::ConstLanelet&gt;(ego_route_lanelet);</div>
<div class="line"><a id="l00976" name="l00976"></a><span class="lineno">  976</span>        }</div>
<div class="line"><a id="l00977" name="l00977"></a><span class="lineno">  977</span>        <span class="keywordflow">else</span>{</div>
<div class="line"><a id="l00978" name="l00978"></a><span class="lineno">  978</span>          <span class="comment">// Increase iterator</span></div>
<div class="line"><a id="l00979" name="l00979"></a><span class="lineno">  979</span>          ++it;</div>
<div class="line"><a id="l00980" name="l00980"></a><span class="lineno">  980</span>        }</div>
<div class="line"><a id="l00981" name="l00981"></a><span class="lineno">  981</span>      }</div>
<div class="line"><a id="l00982" name="l00982"></a><span class="lineno">  982</span>    }</div>
<div class="line"><a id="l00983" name="l00983"></a><span class="lineno">  983</span>  }</div>
<div class="line"><a id="l00984" name="l00984"></a><span class="lineno">  984</span> </div>
<div class="line"><a id="l00985" name="l00985"></a><span class="lineno"><a class="line" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a7476fdeab16d06ec8f63a227c3442509">  985</a></span>  <span class="keywordtype">void</span> <a class="code hl_function" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a7476fdeab16d06ec8f63a227c3442509">ApproachingEmergencyVehiclePlugin::routeStateCallback</a>(carma_planning_msgs::msg::RouteState::UniquePtr msg)</div>
<div class="line"><a id="l00986" name="l00986"></a><span class="lineno">  986</span>  {</div>
<div class="line"><a id="l00987" name="l00987"></a><span class="lineno">  987</span>    <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#aab5aa7ece8a925faed95d97a4c007b23">latest_route_state_</a> = *msg;</div>
<div class="line"><a id="l00988" name="l00988"></a><span class="lineno">  988</span>  }</div>
<div class="line"><a id="l00989" name="l00989"></a><span class="lineno">  989</span> </div>
<div class="line"><a id="l00990" name="l00990"></a><span class="lineno"><a class="line" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#adfbecd63581b2c61f8e7311b9f4ab7bf">  990</a></span>  <span class="keywordtype">void</span> <a class="code hl_function" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#adfbecd63581b2c61f8e7311b9f4ab7bf">ApproachingEmergencyVehiclePlugin::twistCallback</a>(geometry_msgs::msg::TwistStamped::UniquePtr msg){</div>
<div class="line"><a id="l00991" name="l00991"></a><span class="lineno">  991</span>    <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a76eff02c20d84af747204e3904244be3">current_speed_</a> = msg-&gt;twist.linear.x;</div>
<div class="line"><a id="l00992" name="l00992"></a><span class="lineno">  992</span>  }</div>
<div class="line"><a id="l00993" name="l00993"></a><span class="lineno">  993</span> </div>
<div class="line"><a id="l00994" name="l00994"></a><span class="lineno"><a class="line" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a7c6d5af8582efd73bf65759b5d94a31b">  994</a></span>  <span class="keywordtype">void</span> <a class="code hl_function" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a7c6d5af8582efd73bf65759b5d94a31b">ApproachingEmergencyVehiclePlugin::guidanceStateCallback</a>(carma_planning_msgs::msg::GuidanceState::UniquePtr msg){</div>
<div class="line"><a id="l00995" name="l00995"></a><span class="lineno">  995</span>    <span class="keywordflow">if</span>(msg-&gt;state == <a class="code hl_enumvalue" href="namespacelightbar__manager.html#aab380495443d8cbd852a707cf8478f49aa1efdd482908b789c53ae09fd2ec72fc">carma_planning_msgs::msg::GuidanceState::ENGAGED</a>){</div>
<div class="line"><a id="l00996" name="l00996"></a><span class="lineno">  996</span>      <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a2195e788f403f7fd401ef4f45fdf5d76">is_guidance_engaged_</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00997" name="l00997"></a><span class="lineno">  997</span>    }</div>
<div class="line"><a id="l00998" name="l00998"></a><span class="lineno">  998</span>    <span class="keywordflow">else</span>{</div>
<div class="line"><a id="l00999" name="l00999"></a><span class="lineno">  999</span>      <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a2195e788f403f7fd401ef4f45fdf5d76">is_guidance_engaged_</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l01000" name="l01000"></a><span class="lineno"> 1000</span>    }</div>
<div class="line"><a id="l01001" name="l01001"></a><span class="lineno"> 1001</span>  }</div>
<div class="line"><a id="l01002" name="l01002"></a><span class="lineno"> 1002</span> </div>
<div class="line"><a id="l01003" name="l01003"></a><span class="lineno"><a class="line" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#acd5999c8b36406c5768b731e948515a7"> 1003</a></span>  <span class="keywordtype">void</span> <a class="code hl_function" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#acd5999c8b36406c5768b731e948515a7">ApproachingEmergencyVehiclePlugin::routeCallback</a>(carma_planning_msgs::msg::Route::UniquePtr msg){</div>
<div class="line"><a id="l01004" name="l01004"></a><span class="lineno"> 1004</span>    RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6d19969dc5f588661e25aa3575127405">logger_name</a>), <span class="stringliteral">&quot;Received route callback&quot;</span>); </div>
<div class="line"><a id="l01005" name="l01005"></a><span class="lineno"> 1005</span>    std::vector&lt;int&gt; new_future_route_lanelet_ids;</div>
<div class="line"><a id="l01006" name="l01006"></a><span class="lineno"> 1006</span> </div>
<div class="line"><a id="l01007" name="l01007"></a><span class="lineno"> 1007</span>    <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> <a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a> = 0; <a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a> &lt; msg-&gt;route_path_lanelet_ids.size(); ++<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>){</div>
<div class="line"><a id="l01008" name="l01008"></a><span class="lineno"> 1008</span>      RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6d19969dc5f588661e25aa3575127405">logger_name</a>), <span class="stringliteral">&quot;New route lanelet: &quot;</span> &lt;&lt; msg-&gt;route_path_lanelet_ids[<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>]); </div>
<div class="line"><a id="l01009" name="l01009"></a><span class="lineno"> 1009</span>      new_future_route_lanelet_ids.push_back(msg-&gt;route_path_lanelet_ids[<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>]);</div>
<div class="line"><a id="l01010" name="l01010"></a><span class="lineno"> 1010</span>    }</div>
<div class="line"><a id="l01011" name="l01011"></a><span class="lineno"> 1011</span>    </div>
<div class="line"><a id="l01012" name="l01012"></a><span class="lineno"> 1012</span>    <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#afbe916ee3589bbffbbd19939fd242a98">future_route_lanelet_ids_</a> = new_future_route_lanelet_ids;</div>
<div class="line"><a id="l01013" name="l01013"></a><span class="lineno"> 1013</span>  }</div>
<div class="line"><a id="l01014" name="l01014"></a><span class="lineno"> 1014</span> </div>
<div class="line"><a id="l01015" name="l01015"></a><span class="lineno"><a class="line" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#ac057c7b9bb7723c2089604dd3776c8e9"> 1015</a></span>  <span class="keywordtype">double</span> <a class="code hl_function" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#ac057c7b9bb7723c2089604dd3776c8e9">ApproachingEmergencyVehiclePlugin::getLaneletSpeedLimit</a>(<span class="keyword">const</span> lanelet::ConstLanelet&amp; <a class="code hl_namespace" href="namespacelanelet.html">lanelet</a>)</div>
<div class="line"><a id="l01016" name="l01016"></a><span class="lineno"> 1016</span>  {</div>
<div class="line"><a id="l01017" name="l01017"></a><span class="lineno"> 1017</span>    <span class="keywordtype">double</span> speed_limit = <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a64b3bef57508c81e9403778f1415d3be">default_speed_limit</a>;</div>
<div class="line"><a id="l01018" name="l01018"></a><span class="lineno"> 1018</span> </div>
<div class="line"><a id="l01019" name="l01019"></a><span class="lineno"> 1019</span>    lanelet::Optional&lt;carma_wm::TrafficRulesConstPtr&gt; traffic_rules = <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a61b742aab762fff7983b3a1bf1a148b1">wm_</a>-&gt;getTrafficRules();</div>
<div class="line"><a id="l01020" name="l01020"></a><span class="lineno"> 1020</span>    <span class="keywordflow">if</span> (traffic_rules)</div>
<div class="line"><a id="l01021" name="l01021"></a><span class="lineno"> 1021</span>    {</div>
<div class="line"><a id="l01022" name="l01022"></a><span class="lineno"> 1022</span>      speed_limit =(*traffic_rules)-&gt;speedLimit(<a class="code hl_namespace" href="namespacelanelet.html">lanelet</a>).speedLimit.value();</div>
<div class="line"><a id="l01023" name="l01023"></a><span class="lineno"> 1023</span>    }</div>
<div class="line"><a id="l01024" name="l01024"></a><span class="lineno"> 1024</span>    <span class="keywordflow">else</span></div>
<div class="line"><a id="l01025" name="l01025"></a><span class="lineno"> 1025</span>    {</div>
<div class="line"><a id="l01026" name="l01026"></a><span class="lineno"> 1026</span>      <span class="keywordflow">throw</span> std::invalid_argument(<span class="stringliteral">&quot;No speed limit could be found since valid traffic rules object could not be built&quot;</span>);</div>
<div class="line"><a id="l01027" name="l01027"></a><span class="lineno"> 1027</span>    }</div>
<div class="line"><a id="l01028" name="l01028"></a><span class="lineno"> 1028</span>    </div>
<div class="line"><a id="l01029" name="l01029"></a><span class="lineno"> 1029</span>    <span class="keywordflow">return</span> speed_limit;</div>
<div class="line"><a id="l01030" name="l01030"></a><span class="lineno"> 1030</span>  }</div>
<div class="line"><a id="l01031" name="l01031"></a><span class="lineno"> 1031</span> </div>
<div class="line"><a id="l01032" name="l01032"></a><span class="lineno"><a class="line" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a17ee49842e3def04d87e6318ab477fb2"> 1032</a></span>  rclcpp::Duration <a class="code hl_function" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a17ee49842e3def04d87e6318ab477fb2">ApproachingEmergencyVehiclePlugin::getManeuverDuration</a>(<span class="keyword">const</span> carma_planning_msgs::msg::Maneuver &amp;maneuver, <span class="keywordtype">double</span> epsilon)<span class="keyword"> const</span></div>
<div class="line"><a id="l01033" name="l01033"></a><span class="lineno"> 1033</span><span class="keyword">  </span>{</div>
<div class="line"><a id="l01034" name="l01034"></a><span class="lineno"> 1034</span>    <span class="keywordtype">double</span> maneuver_start_speed = <a class="code hl_define" href="approaching__emergency__vehicle__plugin__node_8hpp.html#a066f948508e087006568cb6c9b0674a7">GET_MANEUVER_PROPERTY</a>(maneuver, start_speed);</div>
<div class="line"><a id="l01035" name="l01035"></a><span class="lineno"> 1035</span>    <span class="keywordtype">double</span> maneuver_end_speed = <a class="code hl_function" href="namespaceapproaching__emergency__vehicle__plugin_1_1anonymous__namespace_02approaching__emergenc6b477e4cfd274375085cbaf134e12178.html#a824526918073d730865d3616fded75c4">getManeuverEndSpeed</a>(maneuver);</div>
<div class="line"><a id="l01036" name="l01036"></a><span class="lineno"> 1036</span>    <span class="keywordtype">double</span> sum_start_and_end_speed = maneuver_start_speed + maneuver_end_speed;</div>
<div class="line"><a id="l01037" name="l01037"></a><span class="lineno"> 1037</span> </div>
<div class="line"><a id="l01038" name="l01038"></a><span class="lineno"> 1038</span>    <span class="keywordflow">if</span>(sum_start_and_end_speed &lt; epsilon){</div>
<div class="line"><a id="l01039" name="l01039"></a><span class="lineno"> 1039</span>        <span class="keywordflow">throw</span> std::invalid_argument(<span class="stringliteral">&quot;Maneuver start and ending speed is zero&quot;</span>);</div>
<div class="line"><a id="l01040" name="l01040"></a><span class="lineno"> 1040</span>    }</div>
<div class="line"><a id="l01041" name="l01041"></a><span class="lineno"> 1041</span> </div>
<div class="line"><a id="l01042" name="l01042"></a><span class="lineno"> 1042</span>    rclcpp::Duration maneuver_duration{0,0};</div>
<div class="line"><a id="l01043" name="l01043"></a><span class="lineno"> 1043</span>    <span class="keywordtype">double</span> maneuver_start_dist = <a class="code hl_define" href="approaching__emergency__vehicle__plugin__node_8hpp.html#a066f948508e087006568cb6c9b0674a7">GET_MANEUVER_PROPERTY</a>(maneuver, start_dist);</div>
<div class="line"><a id="l01044" name="l01044"></a><span class="lineno"> 1044</span>    <span class="keywordtype">double</span> maneuver_end_dist = <a class="code hl_define" href="approaching__emergency__vehicle__plugin__node_8hpp.html#a066f948508e087006568cb6c9b0674a7">GET_MANEUVER_PROPERTY</a>(maneuver, end_dist);</div>
<div class="line"><a id="l01045" name="l01045"></a><span class="lineno"> 1045</span> </div>
<div class="line"><a id="l01046" name="l01046"></a><span class="lineno"> 1046</span>    RCLCPP_ERROR_STREAM(rclcpp::get_logger(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6d19969dc5f588661e25aa3575127405">logger_name</a>),<span class="stringliteral">&quot;maneuver_end_dist: &quot;</span> &lt;&lt; maneuver_end_dist &lt;&lt; <span class="stringliteral">&quot;, maneuver_start_dist: &quot;</span> &lt;&lt; maneuver_start_dist &lt;&lt; <span class="stringliteral">&quot;, sum_start_and_end_speed: &quot;</span> &lt;&lt; sum_start_and_end_speed);</div>
<div class="line"><a id="l01047" name="l01047"></a><span class="lineno"> 1047</span> </div>
<div class="line"><a id="l01048" name="l01048"></a><span class="lineno"> 1048</span>    maneuver_duration = rclcpp::Duration((maneuver_end_dist - maneuver_start_dist) / (0.5 * sum_start_and_end_speed) * 1e9);</div>
<div class="line"><a id="l01049" name="l01049"></a><span class="lineno"> 1049</span> </div>
<div class="line"><a id="l01050" name="l01050"></a><span class="lineno"> 1050</span>    <span class="keywordflow">return</span> maneuver_duration;</div>
<div class="line"><a id="l01051" name="l01051"></a><span class="lineno"> 1051</span>  }</div>
<div class="line"><a id="l01052" name="l01052"></a><span class="lineno"> 1052</span> </div>
<div class="line"><a id="l01053" name="l01053"></a><span class="lineno"><a class="line" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a34d39426c0a919ae1bd003dccb4e7ac0"> 1053</a></span>  carma_planning_msgs::msg::Maneuver <a class="code hl_function" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a34d39426c0a919ae1bd003dccb4e7ac0">ApproachingEmergencyVehiclePlugin::composeLaneFollowingManeuverMessage</a>(<span class="keywordtype">double</span> start_dist, <span class="keywordtype">double</span> end_dist, </div>
<div class="line"><a id="l01054" name="l01054"></a><span class="lineno"> 1054</span>                                          <span class="keywordtype">double</span> start_speed, <span class="keywordtype">double</span> target_speed, <span class="keywordtype">int</span> lanelet_id, rclcpp::Time&amp; start_time)<span class="keyword"> const</span></div>
<div class="line"><a id="l01055" name="l01055"></a><span class="lineno"> 1055</span><span class="keyword">  </span>{</div>
<div class="line"><a id="l01056" name="l01056"></a><span class="lineno"> 1056</span>    carma_planning_msgs::msg::Maneuver maneuver_msg;</div>
<div class="line"><a id="l01057" name="l01057"></a><span class="lineno"> 1057</span> </div>
<div class="line"><a id="l01058" name="l01058"></a><span class="lineno"> 1058</span>    maneuver_msg.type = carma_planning_msgs::msg::Maneuver::LANE_FOLLOWING;</div>
<div class="line"><a id="l01059" name="l01059"></a><span class="lineno"> 1059</span>    maneuver_msg.lane_following_maneuver.parameters.negotiation_type = carma_planning_msgs::msg::ManeuverParameters::NO_NEGOTIATION;</div>
<div class="line"><a id="l01060" name="l01060"></a><span class="lineno"> 1060</span>    maneuver_msg.lane_following_maneuver.parameters.presence_vector = carma_planning_msgs::msg::ManeuverParameters::HAS_TACTICAL_PLUGIN;</div>
<div class="line"><a id="l01061" name="l01061"></a><span class="lineno"> 1061</span>    maneuver_msg.lane_following_maneuver.parameters.planning_tactical_plugin = <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a2bad9c38f2c863cb52ce08c89c2ed0f8">lane_following_plugin</a>;</div>
<div class="line"><a id="l01062" name="l01062"></a><span class="lineno"> 1062</span>    maneuver_msg.lane_following_maneuver.parameters.planning_strategic_plugin = <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#acc8f2519628142b5c30afab417e28dd7">strategic_plugin_name_</a>;</div>
<div class="line"><a id="l01063" name="l01063"></a><span class="lineno"> 1063</span>    maneuver_msg.lane_following_maneuver.start_dist = start_dist;</div>
<div class="line"><a id="l01064" name="l01064"></a><span class="lineno"> 1064</span>    maneuver_msg.lane_following_maneuver.start_speed = start_speed;</div>
<div class="line"><a id="l01065" name="l01065"></a><span class="lineno"> 1065</span>    maneuver_msg.lane_following_maneuver.start_time = start_time;</div>
<div class="line"><a id="l01066" name="l01066"></a><span class="lineno"> 1066</span>    maneuver_msg.lane_following_maneuver.end_dist = end_dist;</div>
<div class="line"><a id="l01067" name="l01067"></a><span class="lineno"> 1067</span>    maneuver_msg.lane_following_maneuver.end_speed = target_speed;</div>
<div class="line"><a id="l01068" name="l01068"></a><span class="lineno"> 1068</span>    maneuver_msg.lane_following_maneuver.lane_ids = { <a class="code hl_function" href="namespacecarma__cooperative__perception.html#a64b708654c8aecb09122d39577df31b5">std::to_string</a>(lanelet_id) };</div>
<div class="line"><a id="l01069" name="l01069"></a><span class="lineno"> 1069</span> </div>
<div class="line"><a id="l01070" name="l01070"></a><span class="lineno"> 1070</span>    rclcpp::Duration maneuver_duration = <a class="code hl_function" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a17ee49842e3def04d87e6318ab477fb2">getManeuverDuration</a>(maneuver_msg, <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a47e5e1d18269f94b5090ba65a6e70f89">epsilon_</a>);</div>
<div class="line"><a id="l01071" name="l01071"></a><span class="lineno"> 1071</span>    maneuver_msg.lane_following_maneuver.end_time = start_time + maneuver_duration;</div>
<div class="line"><a id="l01072" name="l01072"></a><span class="lineno"> 1072</span> </div>
<div class="line"><a id="l01073" name="l01073"></a><span class="lineno"> 1073</span>    RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6d19969dc5f588661e25aa3575127405">logger_name</a>), <span class="stringliteral">&quot;Composed lane follow maneuver for lanelet ID:&quot;</span> &lt;&lt; lanelet_id &lt;&lt; <span class="stringliteral">&quot; with duration &quot;</span> &lt;&lt; maneuver_duration.seconds());</div>
<div class="line"><a id="l01074" name="l01074"></a><span class="lineno"> 1074</span>    RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6d19969dc5f588661e25aa3575127405">logger_name</a>), <span class="stringliteral">&quot;start speed: &quot;</span> &lt;&lt; start_speed &lt;&lt; <span class="stringliteral">&quot;, end speed: &quot;</span> &lt;&lt; target_speed);</div>
<div class="line"><a id="l01075" name="l01075"></a><span class="lineno"> 1075</span>    RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6d19969dc5f588661e25aa3575127405">logger_name</a>), <span class="stringliteral">&quot;start dist: &quot;</span> &lt;&lt; start_dist &lt;&lt; <span class="stringliteral">&quot;, end dist: &quot;</span> &lt;&lt; end_dist);</div>
<div class="line"><a id="l01076" name="l01076"></a><span class="lineno"> 1076</span> </div>
<div class="line"><a id="l01077" name="l01077"></a><span class="lineno"> 1077</span>    <span class="keywordflow">return</span> maneuver_msg;</div>
<div class="line"><a id="l01078" name="l01078"></a><span class="lineno"> 1078</span>  }</div>
<div class="line"><a id="l01079" name="l01079"></a><span class="lineno"> 1079</span> </div>
<div class="line"><a id="l01080" name="l01080"></a><span class="lineno"><a class="line" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a957435426e98f4b2b420a5d5c0ddc9c7"> 1080</a></span>  carma_planning_msgs::msg::Maneuver <a class="code hl_function" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a957435426e98f4b2b420a5d5c0ddc9c7">ApproachingEmergencyVehiclePlugin::composeLaneChangeManeuverMessage</a>(<span class="keywordtype">double</span> start_dist, <span class="keywordtype">double</span> end_dist, </div>
<div class="line"><a id="l01081" name="l01081"></a><span class="lineno"> 1081</span>                                          <span class="keywordtype">double</span> start_speed, <span class="keywordtype">double</span> target_speed, lanelet::Id starting_lane_id, lanelet::Id ending_lane_id, rclcpp::Time&amp; start_time)<span class="keyword"> const</span></div>
<div class="line"><a id="l01082" name="l01082"></a><span class="lineno"> 1082</span><span class="keyword">  </span>{</div>
<div class="line"><a id="l01083" name="l01083"></a><span class="lineno"> 1083</span>    carma_planning_msgs::msg::Maneuver maneuver_msg;</div>
<div class="line"><a id="l01084" name="l01084"></a><span class="lineno"> 1084</span>    maneuver_msg.type = carma_planning_msgs::msg::Maneuver::LANE_CHANGE;</div>
<div class="line"><a id="l01085" name="l01085"></a><span class="lineno"> 1085</span>    maneuver_msg.lane_change_maneuver.parameters.negotiation_type = carma_planning_msgs::msg::ManeuverParameters::NO_NEGOTIATION;</div>
<div class="line"><a id="l01086" name="l01086"></a><span class="lineno"> 1086</span>    maneuver_msg.lane_change_maneuver.parameters.presence_vector = carma_planning_msgs::msg::ManeuverParameters::HAS_TACTICAL_PLUGIN;</div>
<div class="line"><a id="l01087" name="l01087"></a><span class="lineno"> 1087</span>    maneuver_msg.lane_change_maneuver.parameters.planning_tactical_plugin = <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a6dd3156876736b67368486db8f4fcc7f">lane_change_plugin</a>;</div>
<div class="line"><a id="l01088" name="l01088"></a><span class="lineno"> 1088</span>    maneuver_msg.lane_change_maneuver.parameters.planning_strategic_plugin = <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#acc8f2519628142b5c30afab417e28dd7">strategic_plugin_name_</a>;</div>
<div class="line"><a id="l01089" name="l01089"></a><span class="lineno"> 1089</span>    maneuver_msg.lane_change_maneuver.start_dist = start_dist;</div>
<div class="line"><a id="l01090" name="l01090"></a><span class="lineno"> 1090</span>    maneuver_msg.lane_change_maneuver.start_speed = start_speed;</div>
<div class="line"><a id="l01091" name="l01091"></a><span class="lineno"> 1091</span>    maneuver_msg.lane_change_maneuver.start_time = start_time;</div>
<div class="line"><a id="l01092" name="l01092"></a><span class="lineno"> 1092</span>    maneuver_msg.lane_change_maneuver.end_dist = end_dist;</div>
<div class="line"><a id="l01093" name="l01093"></a><span class="lineno"> 1093</span>    maneuver_msg.lane_change_maneuver.end_speed = target_speed;</div>
<div class="line"><a id="l01094" name="l01094"></a><span class="lineno"> 1094</span>    maneuver_msg.lane_change_maneuver.starting_lane_id = <a class="code hl_function" href="namespacecarma__cooperative__perception.html#a64b708654c8aecb09122d39577df31b5">std::to_string</a>(starting_lane_id);</div>
<div class="line"><a id="l01095" name="l01095"></a><span class="lineno"> 1095</span>    maneuver_msg.lane_change_maneuver.ending_lane_id = <a class="code hl_function" href="namespacecarma__cooperative__perception.html#a64b708654c8aecb09122d39577df31b5">std::to_string</a>(ending_lane_id);</div>
<div class="line"><a id="l01096" name="l01096"></a><span class="lineno"> 1096</span> </div>
<div class="line"><a id="l01097" name="l01097"></a><span class="lineno"> 1097</span>    rclcpp::Duration maneuver_duration = <a class="code hl_function" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a17ee49842e3def04d87e6318ab477fb2">getManeuverDuration</a>(maneuver_msg, <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a47e5e1d18269f94b5090ba65a6e70f89">epsilon_</a>);</div>
<div class="line"><a id="l01098" name="l01098"></a><span class="lineno"> 1098</span>    maneuver_msg.lane_change_maneuver.end_time = start_time + maneuver_duration;</div>
<div class="line"><a id="l01099" name="l01099"></a><span class="lineno"> 1099</span> </div>
<div class="line"><a id="l01100" name="l01100"></a><span class="lineno"> 1100</span>    <span class="comment">// Preserve lane change maneuver ID from previous plan to maintain identical trajectory generation across separate maneuver plans</span></div>
<div class="line"><a id="l01101" name="l01101"></a><span class="lineno"> 1101</span>    <span class="keywordflow">if</span>(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a529d40caad413492d989ab91eb48fdb6">has_planned_upcoming_lc_</a>){</div>
<div class="line"><a id="l01102" name="l01102"></a><span class="lineno"> 1102</span>      maneuver_msg.lane_change_maneuver.parameters.maneuver_id = <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a2ca981bae82972205b3877b06054d09d">upcoming_lc_params_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1UpcomingLaneChangeParameters.html#ae48fc7188493fdd07e58d765a78ffd17">maneuver_id</a>;</div>
<div class="line"><a id="l01103" name="l01103"></a><span class="lineno"> 1103</span>    }</div>
<div class="line"><a id="l01104" name="l01104"></a><span class="lineno"> 1104</span>    <span class="keywordflow">else</span>{</div>
<div class="line"><a id="l01105" name="l01105"></a><span class="lineno"> 1105</span>      <span class="keyword">static</span> <span class="keyword">auto</span> gen = boost::uuids::random_generator(); <span class="comment">// Initialize uuid generator</span></div>
<div class="line"><a id="l01106" name="l01106"></a><span class="lineno"> 1106</span>      maneuver_msg.lane_change_maneuver.parameters.maneuver_id = boost::lexical_cast&lt;std::string&gt;(gen()); <span class="comment">// generate uuid and convert to string</span></div>
<div class="line"><a id="l01107" name="l01107"></a><span class="lineno"> 1107</span>    }</div>
<div class="line"><a id="l01108" name="l01108"></a><span class="lineno"> 1108</span> </div>
<div class="line"><a id="l01109" name="l01109"></a><span class="lineno"> 1109</span>    RCLCPP_DEBUG_STREAM(get_logger(),<span class="stringliteral">&quot;Creating lane change id: &quot;</span>  &lt;&lt; maneuver_msg.lane_change_maneuver.parameters.maneuver_id &lt;&lt; <span class="stringliteral">&quot;start dist: &quot;</span> &lt;&lt; start_dist &lt;&lt; <span class="stringliteral">&quot; end dist: &quot;</span> &lt;&lt; end_dist &lt;&lt; <span class="stringliteral">&quot; Starting llt: &quot;</span> &lt;&lt; starting_lane_id &lt;&lt; <span class="stringliteral">&quot; Ending llt: &quot;</span> &lt;&lt; ending_lane_id);</div>
<div class="line"><a id="l01110" name="l01110"></a><span class="lineno"> 1110</span>    RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6d19969dc5f588661e25aa3575127405">logger_name</a>), <span class="stringliteral">&quot;start speed: &quot;</span> &lt;&lt; start_speed &lt;&lt; <span class="stringliteral">&quot;, end speed: &quot;</span> &lt;&lt; target_speed &lt;&lt; <span class="stringliteral">&quot;, duration: &quot;</span> &lt;&lt; maneuver_duration.seconds());</div>
<div class="line"><a id="l01111" name="l01111"></a><span class="lineno"> 1111</span>    RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6d19969dc5f588661e25aa3575127405">logger_name</a>), <span class="stringliteral">&quot;start dist: &quot;</span> &lt;&lt; start_dist &lt;&lt; <span class="stringliteral">&quot;, end dist: &quot;</span> &lt;&lt; end_dist);</div>
<div class="line"><a id="l01112" name="l01112"></a><span class="lineno"> 1112</span> </div>
<div class="line"><a id="l01113" name="l01113"></a><span class="lineno"> 1113</span>    <span class="keywordflow">return</span> maneuver_msg;</div>
<div class="line"><a id="l01114" name="l01114"></a><span class="lineno"> 1114</span>  }</div>
<div class="line"><a id="l01115" name="l01115"></a><span class="lineno"> 1115</span> </div>
<div class="line"><a id="l01116" name="l01116"></a><span class="lineno"><a class="line" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a81a6611597163cc41ba54a8598759091"> 1116</a></span>  carma_planning_msgs::msg::Maneuver <a class="code hl_function" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a81a6611597163cc41ba54a8598759091">ApproachingEmergencyVehiclePlugin::composeStopAndWaitManeuverMessage</a>(<span class="keywordtype">double</span> start_dist, <span class="keywordtype">double</span> end_dist, <span class="keywordtype">double</span> start_speed, </div>
<div class="line"><a id="l01117" name="l01117"></a><span class="lineno"> 1117</span>                                                        lanelet::Id starting_lane_id, lanelet::Id ending_lane_id, <span class="keywordtype">double</span> stopping_deceleration, rclcpp::Time&amp; start_time)<span class="keyword"> const</span></div>
<div class="line"><a id="l01118" name="l01118"></a><span class="lineno"> 1118</span><span class="keyword">  </span>{</div>
<div class="line"><a id="l01119" name="l01119"></a><span class="lineno"> 1119</span>    carma_planning_msgs::msg::Maneuver maneuver_msg;</div>
<div class="line"><a id="l01120" name="l01120"></a><span class="lineno"> 1120</span>    maneuver_msg.type = carma_planning_msgs::msg::Maneuver::STOP_AND_WAIT;</div>
<div class="line"><a id="l01121" name="l01121"></a><span class="lineno"> 1121</span>    maneuver_msg.stop_and_wait_maneuver.parameters.negotiation_type = carma_planning_msgs::msg::ManeuverParameters::NO_NEGOTIATION;</div>
<div class="line"><a id="l01122" name="l01122"></a><span class="lineno"> 1122</span>    maneuver_msg.stop_and_wait_maneuver.parameters.presence_vector = carma_planning_msgs::msg::ManeuverParameters::HAS_TACTICAL_PLUGIN</div>
<div class="line"><a id="l01123" name="l01123"></a><span class="lineno"> 1123</span>                                                                    | carma_planning_msgs::msg::ManeuverParameters::HAS_FLOAT_META_DATA;</div>
<div class="line"><a id="l01124" name="l01124"></a><span class="lineno"> 1124</span>    maneuver_msg.stop_and_wait_maneuver.parameters.planning_tactical_plugin = <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a859e48c953178140090bbf4d89744f86">stop_and_wait_plugin</a>;</div>
<div class="line"><a id="l01125" name="l01125"></a><span class="lineno"> 1125</span>    maneuver_msg.stop_and_wait_maneuver.parameters.planning_strategic_plugin = <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#acc8f2519628142b5c30afab417e28dd7">strategic_plugin_name_</a>;</div>
<div class="line"><a id="l01126" name="l01126"></a><span class="lineno"> 1126</span>    maneuver_msg.stop_and_wait_maneuver.start_time = start_time;</div>
<div class="line"><a id="l01127" name="l01127"></a><span class="lineno"> 1127</span>    maneuver_msg.stop_and_wait_maneuver.start_dist = start_dist;</div>
<div class="line"><a id="l01128" name="l01128"></a><span class="lineno"> 1128</span>    maneuver_msg.stop_and_wait_maneuver.start_speed = start_speed;</div>
<div class="line"><a id="l01129" name="l01129"></a><span class="lineno"> 1129</span>    maneuver_msg.stop_and_wait_maneuver.end_dist = end_dist;</div>
<div class="line"><a id="l01130" name="l01130"></a><span class="lineno"> 1130</span>    maneuver_msg.stop_and_wait_maneuver.starting_lane_id = <a class="code hl_function" href="namespacecarma__cooperative__perception.html#a64b708654c8aecb09122d39577df31b5">std::to_string</a>(starting_lane_id);</div>
<div class="line"><a id="l01131" name="l01131"></a><span class="lineno"> 1131</span>    maneuver_msg.stop_and_wait_maneuver.ending_lane_id = <a class="code hl_function" href="namespacecarma__cooperative__perception.html#a64b708654c8aecb09122d39577df31b5">std::to_string</a>(ending_lane_id);</div>
<div class="line"><a id="l01132" name="l01132"></a><span class="lineno"> 1132</span> </div>
<div class="line"><a id="l01133" name="l01133"></a><span class="lineno"> 1133</span>    rclcpp::Duration maneuver_duration = <a class="code hl_function" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a17ee49842e3def04d87e6318ab477fb2">getManeuverDuration</a>(maneuver_msg, <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a47e5e1d18269f94b5090ba65a6e70f89">epsilon_</a>);</div>
<div class="line"><a id="l01134" name="l01134"></a><span class="lineno"> 1134</span>    maneuver_msg.stop_and_wait_maneuver.end_time = start_time + maneuver_duration;</div>
<div class="line"><a id="l01135" name="l01135"></a><span class="lineno"> 1135</span> </div>
<div class="line"><a id="l01136" name="l01136"></a><span class="lineno"> 1136</span>    <span class="comment">// Set the meta-data for the StopAndWait Maneuver to define the buffer in the route end point stopping location</span></div>
<div class="line"><a id="l01137" name="l01137"></a><span class="lineno"> 1137</span>    maneuver_msg.stop_and_wait_maneuver.parameters.float_valued_meta_data.push_back(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#ae1af2f64a5f86e70ea737bb9b0370cdd">route_end_point_buffer</a>);</div>
<div class="line"><a id="l01138" name="l01138"></a><span class="lineno"> 1138</span>    maneuver_msg.stop_and_wait_maneuver.parameters.float_valued_meta_data.push_back(stopping_deceleration);</div>
<div class="line"><a id="l01139" name="l01139"></a><span class="lineno"> 1139</span> </div>
<div class="line"><a id="l01140" name="l01140"></a><span class="lineno"> 1140</span>    <span class="keyword">static</span> <span class="keyword">auto</span> gen = boost::uuids::random_generator(); <span class="comment">// Initialize uuid generator</span></div>
<div class="line"><a id="l01141" name="l01141"></a><span class="lineno"> 1141</span>    maneuver_msg.stop_and_wait_maneuver.parameters.maneuver_id = boost::lexical_cast&lt;std::string&gt;(gen()); <span class="comment">// generate uuid and convert to string</span></div>
<div class="line"><a id="l01142" name="l01142"></a><span class="lineno"> 1142</span> </div>
<div class="line"><a id="l01143" name="l01143"></a><span class="lineno"> 1143</span>    RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6d19969dc5f588661e25aa3575127405">logger_name</a>), <span class="stringliteral">&quot;Composed stop and wait maneuver for with start lanelet:&quot;</span> &lt;&lt; starting_lane_id &lt;&lt; <span class="stringliteral">&quot;, end lanelet: &quot;</span> &lt;&lt; ending_lane_id &lt;&lt; <span class="stringliteral">&quot; with duration &quot;</span> &lt;&lt; maneuver_duration.seconds());</div>
<div class="line"><a id="l01144" name="l01144"></a><span class="lineno"> 1144</span>    RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6d19969dc5f588661e25aa3575127405">logger_name</a>), <span class="stringliteral">&quot;start speed: &quot;</span> &lt;&lt; start_speed);</div>
<div class="line"><a id="l01145" name="l01145"></a><span class="lineno"> 1145</span>    RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6d19969dc5f588661e25aa3575127405">logger_name</a>), <span class="stringliteral">&quot;start dist: &quot;</span> &lt;&lt; start_dist &lt;&lt; <span class="stringliteral">&quot;, end dist: &quot;</span> &lt;&lt; end_dist);</div>
<div class="line"><a id="l01146" name="l01146"></a><span class="lineno"> 1146</span> </div>
<div class="line"><a id="l01147" name="l01147"></a><span class="lineno"> 1147</span>    <span class="keywordflow">return</span> maneuver_msg;</div>
<div class="line"><a id="l01148" name="l01148"></a><span class="lineno"> 1148</span>  }</div>
<div class="line"><a id="l01149" name="l01149"></a><span class="lineno"> 1149</span> </div>
<div class="line"><a id="l01150" name="l01150"></a><span class="lineno"><a class="line" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a5f4cb3c7b1c37290745bcba2f8e3c603"> 1150</a></span>  <span class="keywordtype">void</span> <a class="code hl_function" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a5f4cb3c7b1c37290745bcba2f8e3c603">ApproachingEmergencyVehiclePlugin::addStopAndWaitToEndOfPlan</a>(carma_planning_msgs::srv::PlanManeuvers::Response::SharedPtr resp, </div>
<div class="line"><a id="l01151" name="l01151"></a><span class="lineno"> 1151</span>                          <span class="keywordtype">double</span> downtrack_progress, <span class="keywordtype">double</span> stop_maneuver_beginning_downtrack, <span class="keywordtype">double</span> end_of_route_downtrack, </div>
<div class="line"><a id="l01152" name="l01152"></a><span class="lineno"> 1152</span>                          <span class="keywordtype">double</span> stopping_entry_speed, <span class="keywordtype">double</span> stopping_deceleration, <span class="keywordtype">double</span> current_lanelet_ending_downtrack,</div>
<div class="line"><a id="l01153" name="l01153"></a><span class="lineno"> 1153</span>                          lanelet::ConstLanelet current_lanelet, rclcpp::Time time_progress)</div>
<div class="line"><a id="l01154" name="l01154"></a><span class="lineno"> 1154</span>  {</div>
<div class="line"><a id="l01155" name="l01155"></a><span class="lineno"> 1155</span>    RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6d19969dc5f588661e25aa3575127405">logger_name</a>), <span class="stringliteral">&quot;Maneuver plan is reaching the end of the route&quot;</span>);</div>
<div class="line"><a id="l01156" name="l01156"></a><span class="lineno"> 1156</span> </div>
<div class="line"><a id="l01157" name="l01157"></a><span class="lineno"> 1157</span>    <span class="comment">// Add a lane follow maneuver before the stop and wait maneuver if the distance before stop_maneuver_beginning_downtrack is too large</span></div>
<div class="line"><a id="l01158" name="l01158"></a><span class="lineno"> 1158</span>    <span class="keywordflow">if</span>((stop_maneuver_beginning_downtrack - downtrack_progress) &gt;= <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a725f395f09130e206956a7deb30f6644">buffer_distance_before_stopping</a>){</div>
<div class="line"><a id="l01159" name="l01159"></a><span class="lineno"> 1159</span>      <span class="comment">// Compose lane follow maneuver and update downtrack_progress</span></div>
<div class="line"><a id="l01160" name="l01160"></a><span class="lineno"> 1160</span>      resp-&gt;new_plan.maneuvers.push_back(<a class="code hl_function" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a34d39426c0a919ae1bd003dccb4e7ac0">composeLaneFollowingManeuverMessage</a>(downtrack_progress, stop_maneuver_beginning_downtrack,  </div>
<div class="line"><a id="l01161" name="l01161"></a><span class="lineno"> 1161</span>                            stopping_entry_speed, stopping_entry_speed, current_lanelet.id(), time_progress));</div>
<div class="line"><a id="l01162" name="l01162"></a><span class="lineno"> 1162</span>      </div>
<div class="line"><a id="l01163" name="l01163"></a><span class="lineno"> 1163</span>      downtrack_progress = stop_maneuver_beginning_downtrack;</div>
<div class="line"><a id="l01164" name="l01164"></a><span class="lineno"> 1164</span>      time_progress += <a class="code hl_function" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a17ee49842e3def04d87e6318ab477fb2">getManeuverDuration</a>(resp-&gt;new_plan.maneuvers.back(), <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a47e5e1d18269f94b5090ba65a6e70f89">epsilon_</a>);</div>
<div class="line"><a id="l01165" name="l01165"></a><span class="lineno"> 1165</span>    }</div>
<div class="line"><a id="l01166" name="l01166"></a><span class="lineno"> 1166</span> </div>
<div class="line"><a id="l01167" name="l01167"></a><span class="lineno"> 1167</span>    <span class="comment">// Get the starting lanelet ID for the stop and wait maneuver</span></div>
<div class="line"><a id="l01168" name="l01168"></a><span class="lineno"> 1168</span>    lanelet::Id start_lane_id = current_lanelet.id();</div>
<div class="line"><a id="l01169" name="l01169"></a><span class="lineno"> 1169</span> </div>
<div class="line"><a id="l01170" name="l01170"></a><span class="lineno"> 1170</span>    <span class="comment">// Identify the ending lanelet for the stop and wait maneuver</span></div>
<div class="line"><a id="l01171" name="l01171"></a><span class="lineno"> 1171</span>    <span class="keywordflow">while</span>(current_lanelet_ending_downtrack &lt; end_of_route_downtrack){</div>
<div class="line"><a id="l01172" name="l01172"></a><span class="lineno"> 1172</span>      <span class="comment">// Get the next lanelet in the current lane if it exists</span></div>
<div class="line"><a id="l01173" name="l01173"></a><span class="lineno"> 1173</span>      <span class="keywordflow">if</span>(!<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a61b742aab762fff7983b3a1bf1a148b1">wm_</a>-&gt;getMapRoutingGraph()-&gt;following(current_lanelet, <span class="keyword">false</span>).empty()){</div>
<div class="line"><a id="l01174" name="l01174"></a><span class="lineno"> 1174</span>        current_lanelet = <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a61b742aab762fff7983b3a1bf1a148b1">wm_</a>-&gt;getMapRoutingGraph()-&gt;following(current_lanelet, <span class="keyword">false</span>).front();</div>
<div class="line"><a id="l01175" name="l01175"></a><span class="lineno"> 1175</span>      }</div>
<div class="line"><a id="l01176" name="l01176"></a><span class="lineno"> 1176</span>      <span class="keywordflow">else</span>{</div>
<div class="line"><a id="l01177" name="l01177"></a><span class="lineno"> 1177</span>        RCLCPP_WARN_STREAM(rclcpp::get_logger(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6d19969dc5f588661e25aa3575127405">logger_name</a>), <span class="stringliteral">&quot;A following lanelet in the current lane could not be found; returning empty plan&quot;</span>);</div>
<div class="line"><a id="l01178" name="l01178"></a><span class="lineno"> 1178</span>        resp-&gt;new_plan.maneuvers = {};</div>
<div class="line"><a id="l01179" name="l01179"></a><span class="lineno"> 1179</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01180" name="l01180"></a><span class="lineno"> 1180</span>      }          </div>
<div class="line"><a id="l01181" name="l01181"></a><span class="lineno"> 1181</span> </div>
<div class="line"><a id="l01182" name="l01182"></a><span class="lineno"> 1182</span>      <span class="comment">// Check whether the next lanelet is on the route</span></div>
<div class="line"><a id="l01183" name="l01183"></a><span class="lineno"> 1183</span>      <span class="keywordflow">if</span>(!<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a61b742aab762fff7983b3a1bf1a148b1">wm_</a>-&gt;getRoute()-&gt;contains(current_lanelet)){</div>
<div class="line"><a id="l01184" name="l01184"></a><span class="lineno"> 1184</span>        RCLCPP_WARN_STREAM(rclcpp::get_logger(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6d19969dc5f588661e25aa3575127405">logger_name</a>), <span class="stringliteral">&quot;The next lanelet in the current lane is not on the route; returning empty plan&quot;</span>);</div>
<div class="line"><a id="l01185" name="l01185"></a><span class="lineno"> 1185</span>        resp-&gt;new_plan.maneuvers = {};</div>
<div class="line"><a id="l01186" name="l01186"></a><span class="lineno"> 1186</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01187" name="l01187"></a><span class="lineno"> 1187</span>      }</div>
<div class="line"><a id="l01188" name="l01188"></a><span class="lineno"> 1188</span> </div>
<div class="line"><a id="l01189" name="l01189"></a><span class="lineno"> 1189</span>      <span class="comment">// Break from loop if lanelet&#39;s ending downtrack is after the route end downtrack; this is the maneuver&#39;s ending lanelet </span></div>
<div class="line"><a id="l01190" name="l01190"></a><span class="lineno"> 1190</span>      current_lanelet_ending_downtrack = <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a61b742aab762fff7983b3a1bf1a148b1">wm_</a>-&gt;routeTrackPos(current_lanelet.centerline2d().back()).downtrack;</div>
<div class="line"><a id="l01191" name="l01191"></a><span class="lineno"> 1191</span>      <span class="keywordflow">if</span>(current_lanelet_ending_downtrack &gt;= end_of_route_downtrack){</div>
<div class="line"><a id="l01192" name="l01192"></a><span class="lineno"> 1192</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01193" name="l01193"></a><span class="lineno"> 1193</span>      }</div>
<div class="line"><a id="l01194" name="l01194"></a><span class="lineno"> 1194</span>    }</div>
<div class="line"><a id="l01195" name="l01195"></a><span class="lineno"> 1195</span> </div>
<div class="line"><a id="l01196" name="l01196"></a><span class="lineno"> 1196</span>    <span class="comment">// Add stop and wait maneuver to maneuver plan</span></div>
<div class="line"><a id="l01197" name="l01197"></a><span class="lineno"> 1197</span>    resp-&gt;new_plan.maneuvers.push_back(<a class="code hl_function" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a81a6611597163cc41ba54a8598759091">composeStopAndWaitManeuverMessage</a>(downtrack_progress, end_of_route_downtrack,</div>
<div class="line"><a id="l01198" name="l01198"></a><span class="lineno"> 1198</span>                  stopping_entry_speed, start_lane_id, current_lanelet.id(), stopping_deceleration, time_progress));</div>
<div class="line"><a id="l01199" name="l01199"></a><span class="lineno"> 1199</span>  }</div>
<div class="line"><a id="l01200" name="l01200"></a><span class="lineno"> 1200</span> </div>
<div class="line"><a id="l01201" name="l01201"></a><span class="lineno"><a class="line" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a868b40d4e5aa64b34aae8ef5a6ae967a"> 1201</a></span>  <span class="keywordtype">void</span> <a class="code hl_function" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a868b40d4e5aa64b34aae8ef5a6ae967a">ApproachingEmergencyVehiclePlugin::generateReducedSpeedLaneFollowingeManeuverPlan</a>(</div>
<div class="line"><a id="l01202" name="l01202"></a><span class="lineno"> 1202</span>    carma_planning_msgs::srv::PlanManeuvers::Response::SharedPtr resp,</div>
<div class="line"><a id="l01203" name="l01203"></a><span class="lineno"> 1203</span>    lanelet::ConstLanelet current_lanelet, <span class="keywordtype">double</span> downtrack_progress, <span class="keywordtype">double</span> current_lanelet_ending_downtrack,</div>
<div class="line"><a id="l01204" name="l01204"></a><span class="lineno"> 1204</span>    <span class="keywordtype">double</span> speed_progress, <span class="keywordtype">double</span> target_speed, rclcpp::Time time_progress, <span class="keywordtype">bool</span> is_maintaining_non_reduced_speed)</div>
<div class="line"><a id="l01205" name="l01205"></a><span class="lineno"> 1205</span>  {</div>
<div class="line"><a id="l01206" name="l01206"></a><span class="lineno"> 1206</span>    RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6d19969dc5f588661e25aa3575127405">logger_name</a>), <span class="stringliteral">&quot;Generating remain-in-lane maneuver plan&quot;</span>);</div>
<div class="line"><a id="l01207" name="l01207"></a><span class="lineno"> 1207</span> </div>
<div class="line"><a id="l01208" name="l01208"></a><span class="lineno"> 1208</span>    <span class="comment">// Reset planned lane change flag since plugin will not be planning for an upcoming lane change</span></div>
<div class="line"><a id="l01209" name="l01209"></a><span class="lineno"> 1209</span>    <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a529d40caad413492d989ab91eb48fdb6">has_planned_upcoming_lc_</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l01210" name="l01210"></a><span class="lineno"> 1210</span> </div>
<div class="line"><a id="l01211" name="l01211"></a><span class="lineno"> 1211</span>    <span class="comment">// Update maneuver target speed to be a speed being maintained or a reduced speed below the speed limit</span></div>
<div class="line"><a id="l01212" name="l01212"></a><span class="lineno"> 1212</span>    <span class="keywordflow">if</span>(is_maintaining_non_reduced_speed){</div>
<div class="line"><a id="l01213" name="l01213"></a><span class="lineno"> 1213</span>      <span class="comment">// ERV is close enough that if the ego vehicle slows down it could cause a safety hazard; set target speed to maintain a non-reduced speed</span></div>
<div class="line"><a id="l01214" name="l01214"></a><span class="lineno"> 1214</span>      target_speed = <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a69840d1c02ccdf825a638165e40a1ece">non_reduced_speed_to_maintain_</a>;</div>
<div class="line"><a id="l01215" name="l01215"></a><span class="lineno"> 1215</span>    }</div>
<div class="line"><a id="l01216" name="l01216"></a><span class="lineno"> 1216</span>    <span class="keywordflow">else</span>{</div>
<div class="line"><a id="l01217" name="l01217"></a><span class="lineno"> 1217</span>      <span class="comment">// Reduce target_speed since this method is triggered when an ERV is approaching the ego vehicle</span></div>
<div class="line"><a id="l01218" name="l01218"></a><span class="lineno"> 1218</span>      target_speed = std::max((target_speed - <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#acd12c1b7c7c6546c81679ace095f0c7c">speed_limit_reduction_during_passing</a>), <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a7d48d943b50100d1c3e2099c36070da9">minimum_reduced_speed_limit</a>);</div>
<div class="line"><a id="l01219" name="l01219"></a><span class="lineno"> 1219</span>      RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6d19969dc5f588661e25aa3575127405">logger_name</a>), <span class="stringliteral">&quot;Maneuver target speed reduced to &quot;</span> &lt;&lt; target_speed);</div>
<div class="line"><a id="l01220" name="l01220"></a><span class="lineno"> 1220</span>    }</div>
<div class="line"><a id="l01221" name="l01221"></a><span class="lineno"> 1221</span> </div>
<div class="line"><a id="l01222" name="l01222"></a><span class="lineno"> 1222</span>    <span class="keywordtype">double</span> maneuver_plan_ending_downtrack = downtrack_progress + <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a82d53d570af61ab41e04d4a27243102e">minimal_plan_duration</a> * target_speed;</div>
<div class="line"><a id="l01223" name="l01223"></a><span class="lineno"> 1223</span>    RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6d19969dc5f588661e25aa3575127405">logger_name</a>), <span class="stringliteral">&quot;Ending downtrack based on plan duration: &quot;</span> &lt;&lt; maneuver_plan_ending_downtrack);</div>
<div class="line"><a id="l01224" name="l01224"></a><span class="lineno"> 1224</span> </div>
<div class="line"><a id="l01225" name="l01225"></a><span class="lineno"> 1225</span>    maneuver_plan_ending_downtrack = std::min(maneuver_plan_ending_downtrack, <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a61b742aab762fff7983b3a1bf1a148b1">wm_</a>-&gt;getRouteEndTrackPos().downtrack);</div>
<div class="line"><a id="l01226" name="l01226"></a><span class="lineno"> 1226</span>    RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6d19969dc5f588661e25aa3575127405">logger_name</a>), <span class="stringliteral">&quot;Ending downtrack based on end of route: &quot;</span> &lt;&lt; <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a61b742aab762fff7983b3a1bf1a148b1">wm_</a>-&gt;getRouteEndTrackPos().downtrack);</div>
<div class="line"><a id="l01227" name="l01227"></a><span class="lineno"> 1227</span>    RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6d19969dc5f588661e25aa3575127405">logger_name</a>), <span class="stringliteral">&quot;Selected ending downtrack: &quot;</span> &lt;&lt; maneuver_plan_ending_downtrack);</div>
<div class="line"><a id="l01228" name="l01228"></a><span class="lineno"> 1228</span> </div>
<div class="line"><a id="l01229" name="l01229"></a><span class="lineno"> 1229</span>    <span class="comment">// Compute target deceleration for stopping</span></div>
<div class="line"><a id="l01230" name="l01230"></a><span class="lineno"> 1230</span>    <span class="keywordtype">double</span> stopping_deceleration = <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a1b30e6e0c5ce1e2eefa70b1af6e941eb">vehicle_acceleration_limit</a> * <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a789e82d1b4c4ebcfe2019fd9808019d8">stopping_accel_limit_multiplier</a>;</div>
<div class="line"><a id="l01231" name="l01231"></a><span class="lineno"> 1231</span> </div>
<div class="line"><a id="l01232" name="l01232"></a><span class="lineno"> 1232</span>    <span class="comment">// Compute stopping distance where v_f = 0</span></div>
<div class="line"><a id="l01233" name="l01233"></a><span class="lineno"> 1233</span>    <span class="comment">// (v_f^2 - v_i^2) / (2*a) = d </span></div>
<div class="line"><a id="l01234" name="l01234"></a><span class="lineno"> 1234</span>    <span class="keywordtype">double</span> stopping_distance = (target_speed * target_speed) / (2.0 * stopping_deceleration);</div>
<div class="line"><a id="l01235" name="l01235"></a><span class="lineno"> 1235</span>    <span class="keywordtype">double</span> begin_stopping_downtrack = <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a61b742aab762fff7983b3a1bf1a148b1">wm_</a>-&gt;getRouteEndTrackPos().downtrack - stopping_distance;</div>
<div class="line"><a id="l01236" name="l01236"></a><span class="lineno"> 1236</span>    RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6d19969dc5f588661e25aa3575127405">logger_name</a>), <span class="stringliteral">&quot;Stop and wait maneuver must begin by downtrack &quot;</span> &lt;&lt; begin_stopping_downtrack);</div>
<div class="line"><a id="l01237" name="l01237"></a><span class="lineno"> 1237</span> </div>
<div class="line"><a id="l01238" name="l01238"></a><span class="lineno"> 1238</span>    <span class="comment">// Generate maneuver plan</span></div>
<div class="line"><a id="l01239" name="l01239"></a><span class="lineno"> 1239</span>    <span class="keywordflow">while</span>(downtrack_progress &lt; maneuver_plan_ending_downtrack){</div>
<div class="line"><a id="l01240" name="l01240"></a><span class="lineno"> 1240</span> </div>
<div class="line"><a id="l01241" name="l01241"></a><span class="lineno"> 1241</span>      <span class="keywordflow">if</span>(begin_stopping_downtrack &lt;= current_lanelet_ending_downtrack){</div>
<div class="line"><a id="l01242" name="l01242"></a><span class="lineno"> 1242</span>        <span class="comment">// Complete maneuver plan with a stop and wait maneuver if the current lanelet intercepts the stopping downtrack</span></div>
<div class="line"><a id="l01243" name="l01243"></a><span class="lineno"> 1243</span>        <a class="code hl_function" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a5f4cb3c7b1c37290745bcba2f8e3c603">addStopAndWaitToEndOfPlan</a>(resp, downtrack_progress, begin_stopping_downtrack, <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a61b742aab762fff7983b3a1bf1a148b1">wm_</a>-&gt;getRouteEndTrackPos().downtrack, </div>
<div class="line"><a id="l01244" name="l01244"></a><span class="lineno"> 1244</span>                        speed_progress, stopping_deceleration, current_lanelet_ending_downtrack, current_lanelet, time_progress);</div>
<div class="line"><a id="l01245" name="l01245"></a><span class="lineno"> 1245</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01246" name="l01246"></a><span class="lineno"> 1246</span>      }</div>
<div class="line"><a id="l01247" name="l01247"></a><span class="lineno"> 1247</span>      <span class="keywordflow">else</span>{</div>
<div class="line"><a id="l01248" name="l01248"></a><span class="lineno"> 1248</span>        <span class="comment">// Compose lane following maneuver and add it to the response&#39;s maneuver plan</span></div>
<div class="line"><a id="l01249" name="l01249"></a><span class="lineno"> 1249</span>        resp-&gt;new_plan.maneuvers.push_back(<a class="code hl_function" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a34d39426c0a919ae1bd003dccb4e7ac0">composeLaneFollowingManeuverMessage</a>(downtrack_progress, current_lanelet_ending_downtrack,  </div>
<div class="line"><a id="l01250" name="l01250"></a><span class="lineno"> 1250</span>                                speed_progress, target_speed, current_lanelet.id(), time_progress));</div>
<div class="line"><a id="l01251" name="l01251"></a><span class="lineno"> 1251</span> </div>
<div class="line"><a id="l01252" name="l01252"></a><span class="lineno"> 1252</span>        <span class="comment">// Get the next lanelet in the current lane if it exists</span></div>
<div class="line"><a id="l01253" name="l01253"></a><span class="lineno"> 1253</span>        <span class="keywordflow">if</span>(!<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a61b742aab762fff7983b3a1bf1a148b1">wm_</a>-&gt;getMapRoutingGraph()-&gt;following(current_lanelet, <span class="keyword">false</span>).empty())</div>
<div class="line"><a id="l01254" name="l01254"></a><span class="lineno"> 1254</span>        {</div>
<div class="line"><a id="l01255" name="l01255"></a><span class="lineno"> 1255</span>          current_lanelet = <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a61b742aab762fff7983b3a1bf1a148b1">wm_</a>-&gt;getMapRoutingGraph()-&gt;following(current_lanelet, <span class="keyword">false</span>).front();</div>
<div class="line"><a id="l01256" name="l01256"></a><span class="lineno"> 1256</span>        }</div>
<div class="line"><a id="l01257" name="l01257"></a><span class="lineno"> 1257</span>        <span class="keywordflow">else</span></div>
<div class="line"><a id="l01258" name="l01258"></a><span class="lineno"> 1258</span>        {</div>
<div class="line"><a id="l01259" name="l01259"></a><span class="lineno"> 1259</span>          RCLCPP_WARN_STREAM(rclcpp::get_logger(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6d19969dc5f588661e25aa3575127405">logger_name</a>), <span class="stringliteral">&quot;A following lanelet in the current lane could not be found; returning empty plan&quot;</span>);</div>
<div class="line"><a id="l01260" name="l01260"></a><span class="lineno"> 1260</span>          resp-&gt;new_plan.maneuvers = {};</div>
<div class="line"><a id="l01261" name="l01261"></a><span class="lineno"> 1261</span>          <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01262" name="l01262"></a><span class="lineno"> 1262</span>        }</div>
<div class="line"><a id="l01263" name="l01263"></a><span class="lineno"> 1263</span> </div>
<div class="line"><a id="l01264" name="l01264"></a><span class="lineno"> 1264</span>        <span class="comment">// Check whether the next lanelet is on the route</span></div>
<div class="line"><a id="l01265" name="l01265"></a><span class="lineno"> 1265</span>        <span class="keywordflow">if</span>(!<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a61b742aab762fff7983b3a1bf1a148b1">wm_</a>-&gt;getRoute()-&gt;contains(current_lanelet)){</div>
<div class="line"><a id="l01266" name="l01266"></a><span class="lineno"> 1266</span>          RCLCPP_WARN_STREAM(rclcpp::get_logger(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6d19969dc5f588661e25aa3575127405">logger_name</a>), <span class="stringliteral">&quot;The next lanelet in the current lane is not on the route; returning empty plan&quot;</span>);</div>
<div class="line"><a id="l01267" name="l01267"></a><span class="lineno"> 1267</span>          resp-&gt;new_plan.maneuvers = {};</div>
<div class="line"><a id="l01268" name="l01268"></a><span class="lineno"> 1268</span>          <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01269" name="l01269"></a><span class="lineno"> 1269</span>        }</div>
<div class="line"><a id="l01270" name="l01270"></a><span class="lineno"> 1270</span> </div>
<div class="line"><a id="l01271" name="l01271"></a><span class="lineno"> 1271</span>        <span class="comment">// Update the lane follow maneuver parameters for the next maneuver in the plan</span></div>
<div class="line"><a id="l01272" name="l01272"></a><span class="lineno"> 1272</span>        downtrack_progress = <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a61b742aab762fff7983b3a1bf1a148b1">wm_</a>-&gt;routeTrackPos(current_lanelet.centerline2d().front()).downtrack;</div>
<div class="line"><a id="l01273" name="l01273"></a><span class="lineno"> 1273</span>        current_lanelet_ending_downtrack = <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a61b742aab762fff7983b3a1bf1a148b1">wm_</a>-&gt;routeTrackPos(current_lanelet.centerline2d().back()).downtrack;</div>
<div class="line"><a id="l01274" name="l01274"></a><span class="lineno"> 1274</span>        speed_progress = <a class="code hl_function" href="namespaceapproaching__emergency__vehicle__plugin_1_1anonymous__namespace_02approaching__emergenc6b477e4cfd274375085cbaf134e12178.html#a824526918073d730865d3616fded75c4">getManeuverEndSpeed</a>(resp-&gt;new_plan.maneuvers.back());</div>
<div class="line"><a id="l01275" name="l01275"></a><span class="lineno"> 1275</span>        target_speed = <a class="code hl_function" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#ac057c7b9bb7723c2089604dd3776c8e9">getLaneletSpeedLimit</a>(current_lanelet);</div>
<div class="line"><a id="l01276" name="l01276"></a><span class="lineno"> 1276</span> </div>
<div class="line"><a id="l01277" name="l01277"></a><span class="lineno"> 1277</span>        <span class="comment">// Update maneuver target speed to be a speed being maintained or a reduced speed below the speed limit</span></div>
<div class="line"><a id="l01278" name="l01278"></a><span class="lineno"> 1278</span>        <span class="keywordflow">if</span>(is_maintaining_non_reduced_speed){</div>
<div class="line"><a id="l01279" name="l01279"></a><span class="lineno"> 1279</span>          <span class="comment">// ERV is close enough that if the ego vehicle slows down it could cause a safety hazard; set target speed to maintain a non-reduced speed</span></div>
<div class="line"><a id="l01280" name="l01280"></a><span class="lineno"> 1280</span>          target_speed = <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a69840d1c02ccdf825a638165e40a1ece">non_reduced_speed_to_maintain_</a>;</div>
<div class="line"><a id="l01281" name="l01281"></a><span class="lineno"> 1281</span>        }</div>
<div class="line"><a id="l01282" name="l01282"></a><span class="lineno"> 1282</span>        <span class="keywordflow">else</span>{</div>
<div class="line"><a id="l01283" name="l01283"></a><span class="lineno"> 1283</span>          <span class="comment">// Reduce target_speed if an ERV is actively passing the ego vehicle</span></div>
<div class="line"><a id="l01284" name="l01284"></a><span class="lineno"> 1284</span>          target_speed = std::max((target_speed - <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#acd12c1b7c7c6546c81679ace095f0c7c">speed_limit_reduction_during_passing</a>), <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a7d48d943b50100d1c3e2099c36070da9">minimum_reduced_speed_limit</a>);</div>
<div class="line"><a id="l01285" name="l01285"></a><span class="lineno"> 1285</span>          RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6d19969dc5f588661e25aa3575127405">logger_name</a>), <span class="stringliteral">&quot;Maneuver target speed reduced to &quot;</span> &lt;&lt; target_speed);</div>
<div class="line"><a id="l01286" name="l01286"></a><span class="lineno"> 1286</span>        }</div>
<div class="line"><a id="l01287" name="l01287"></a><span class="lineno"> 1287</span> </div>
<div class="line"><a id="l01288" name="l01288"></a><span class="lineno"> 1288</span>        time_progress += <a class="code hl_function" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a17ee49842e3def04d87e6318ab477fb2">getManeuverDuration</a>(resp-&gt;new_plan.maneuvers.back(), <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a47e5e1d18269f94b5090ba65a6e70f89">epsilon_</a>);</div>
<div class="line"><a id="l01289" name="l01289"></a><span class="lineno"> 1289</span> </div>
<div class="line"><a id="l01290" name="l01290"></a><span class="lineno"> 1290</span>        RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6d19969dc5f588661e25aa3575127405">logger_name</a>), <span class="stringliteral">&quot;Next maneuver starting downtrack is &quot;</span> &lt;&lt; downtrack_progress &lt;&lt; <span class="stringliteral">&quot;, end of plan is at &quot;</span> &lt;&lt; maneuver_plan_ending_downtrack);</div>
<div class="line"><a id="l01291" name="l01291"></a><span class="lineno"> 1291</span>      }</div>
<div class="line"><a id="l01292" name="l01292"></a><span class="lineno"> 1292</span>    }</div>
<div class="line"><a id="l01293" name="l01293"></a><span class="lineno"> 1293</span>  }</div>
<div class="line"><a id="l01294" name="l01294"></a><span class="lineno"> 1294</span> </div>
<div class="line"><a id="l01295" name="l01295"></a><span class="lineno"><a class="line" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a211bba5a4b60a28a9ba882262628f653"> 1295</a></span>  <span class="keywordtype">void</span> <a class="code hl_function" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a211bba5a4b60a28a9ba882262628f653">ApproachingEmergencyVehiclePlugin::generateMoveOverManeuverPlan</a>(</div>
<div class="line"><a id="l01296" name="l01296"></a><span class="lineno"> 1296</span>    carma_planning_msgs::srv::PlanManeuvers::Response::SharedPtr resp,</div>
<div class="line"><a id="l01297" name="l01297"></a><span class="lineno"> 1297</span>    lanelet::ConstLanelet current_lanelet, <span class="keywordtype">double</span> downtrack_progress, <span class="keywordtype">double</span> current_lanelet_ending_downtrack,</div>
<div class="line"><a id="l01298" name="l01298"></a><span class="lineno"> 1298</span>    <span class="keywordtype">double</span> speed_progress, <span class="keywordtype">double</span> target_speed, rclcpp::Time time_progress, <span class="keywordtype">int</span> ego_lane_index, <span class="keywordtype">int</span> erv_lane_index)</div>
<div class="line"><a id="l01299" name="l01299"></a><span class="lineno"> 1299</span>  {</div>
<div class="line"><a id="l01300" name="l01300"></a><span class="lineno"> 1300</span>    RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6d19969dc5f588661e25aa3575127405">logger_name</a>), <span class="stringliteral">&quot;Generating move-over maneuver plan&quot;</span>);</div>
<div class="line"><a id="l01301" name="l01301"></a><span class="lineno"> 1301</span> </div>
<div class="line"><a id="l01302" name="l01302"></a><span class="lineno"> 1302</span>    <span class="keywordtype">double</span> maneuver_plan_ending_downtrack = downtrack_progress + <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a82d53d570af61ab41e04d4a27243102e">minimal_plan_duration</a> * target_speed;</div>
<div class="line"><a id="l01303" name="l01303"></a><span class="lineno"> 1303</span>    RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6d19969dc5f588661e25aa3575127405">logger_name</a>), <span class="stringliteral">&quot;Ending downtrack based on plan duration: &quot;</span> &lt;&lt; maneuver_plan_ending_downtrack);</div>
<div class="line"><a id="l01304" name="l01304"></a><span class="lineno"> 1304</span> </div>
<div class="line"><a id="l01305" name="l01305"></a><span class="lineno"> 1305</span>    maneuver_plan_ending_downtrack = std::min(maneuver_plan_ending_downtrack, <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a61b742aab762fff7983b3a1bf1a148b1">wm_</a>-&gt;getRouteEndTrackPos().downtrack);</div>
<div class="line"><a id="l01306" name="l01306"></a><span class="lineno"> 1306</span>    RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6d19969dc5f588661e25aa3575127405">logger_name</a>), <span class="stringliteral">&quot;Ending downtrack based on end of route: &quot;</span> &lt;&lt; <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a61b742aab762fff7983b3a1bf1a148b1">wm_</a>-&gt;getRouteEndTrackPos().downtrack);</div>
<div class="line"><a id="l01307" name="l01307"></a><span class="lineno"> 1307</span>    RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6d19969dc5f588661e25aa3575127405">logger_name</a>), <span class="stringliteral">&quot;Selected ending downtrack: &quot;</span> &lt;&lt; maneuver_plan_ending_downtrack);</div>
<div class="line"><a id="l01308" name="l01308"></a><span class="lineno"> 1308</span> </div>
<div class="line"><a id="l01309" name="l01309"></a><span class="lineno"> 1309</span>    <span class="comment">// Compute target deceleration for stopping</span></div>
<div class="line"><a id="l01310" name="l01310"></a><span class="lineno"> 1310</span>    <span class="keywordtype">double</span> stopping_deceleration = <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a1b30e6e0c5ce1e2eefa70b1af6e941eb">vehicle_acceleration_limit</a> * <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a789e82d1b4c4ebcfe2019fd9808019d8">stopping_accel_limit_multiplier</a>;</div>
<div class="line"><a id="l01311" name="l01311"></a><span class="lineno"> 1311</span> </div>
<div class="line"><a id="l01312" name="l01312"></a><span class="lineno"> 1312</span>    <span class="comment">// Compute stopping distance where v_f = 0</span></div>
<div class="line"><a id="l01313" name="l01313"></a><span class="lineno"> 1313</span>    <span class="comment">// (v_f^2 - v_i^2) / (2*a) = d </span></div>
<div class="line"><a id="l01314" name="l01314"></a><span class="lineno"> 1314</span>    <span class="keywordtype">double</span> stopping_distance = (target_speed * target_speed) / (2.0 * stopping_deceleration);</div>
<div class="line"><a id="l01315" name="l01315"></a><span class="lineno"> 1315</span>    <span class="keywordtype">double</span> begin_stopping_downtrack = <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a61b742aab762fff7983b3a1bf1a148b1">wm_</a>-&gt;getRouteEndTrackPos().downtrack - stopping_distance;</div>
<div class="line"><a id="l01316" name="l01316"></a><span class="lineno"> 1316</span>    RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6d19969dc5f588661e25aa3575127405">logger_name</a>), <span class="stringliteral">&quot;Stop and wait maneuver must begin by downtrack &quot;</span> &lt;&lt; begin_stopping_downtrack);</div>
<div class="line"><a id="l01317" name="l01317"></a><span class="lineno"> 1317</span> </div>
<div class="line"><a id="l01318" name="l01318"></a><span class="lineno"> 1318</span>    <span class="comment">// Generate maneuver plan when there is already a planned upcoming lane change</span></div>
<div class="line"><a id="l01319" name="l01319"></a><span class="lineno"> 1319</span>    <span class="keywordflow">if</span>(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a529d40caad413492d989ab91eb48fdb6">has_planned_upcoming_lc_</a>){</div>
<div class="line"><a id="l01320" name="l01320"></a><span class="lineno"> 1320</span>      <span class="keywordflow">while</span>(downtrack_progress &lt; maneuver_plan_ending_downtrack){</div>
<div class="line"><a id="l01321" name="l01321"></a><span class="lineno"> 1321</span>        <span class="keywordflow">if</span>(begin_stopping_downtrack &lt;= current_lanelet_ending_downtrack){</div>
<div class="line"><a id="l01322" name="l01322"></a><span class="lineno"> 1322</span>          <span class="comment">// Complete maneuver plan with a stop and wait maneuver if the current lanelet intercepts the stopping downtrack</span></div>
<div class="line"><a id="l01323" name="l01323"></a><span class="lineno"> 1323</span>          <a class="code hl_function" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a5f4cb3c7b1c37290745bcba2f8e3c603">addStopAndWaitToEndOfPlan</a>(resp, downtrack_progress, begin_stopping_downtrack, <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a61b742aab762fff7983b3a1bf1a148b1">wm_</a>-&gt;getRouteEndTrackPos().downtrack, </div>
<div class="line"><a id="l01324" name="l01324"></a><span class="lineno"> 1324</span>                          speed_progress, stopping_deceleration, current_lanelet_ending_downtrack, current_lanelet, time_progress);</div>
<div class="line"><a id="l01325" name="l01325"></a><span class="lineno"> 1325</span>          <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01326" name="l01326"></a><span class="lineno"> 1326</span>        }</div>
<div class="line"><a id="l01327" name="l01327"></a><span class="lineno"> 1327</span>        <span class="keywordflow">else</span>{</div>
<div class="line"><a id="l01328" name="l01328"></a><span class="lineno"> 1328</span>          <span class="comment">// Plan lane change maneuver if current downtrack progress is between the starting and ending downtracks of the planned upcoming lane change, otherwise plan lane follow maneuver</span></div>
<div class="line"><a id="l01329" name="l01329"></a><span class="lineno"> 1329</span>          <span class="keywordflow">if</span>(((<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a2ca981bae82972205b3877b06054d09d">upcoming_lc_params_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1UpcomingLaneChangeParameters.html#adbad5c78589d71b5eb495730468a710b">start_dist</a> - <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a47e5e1d18269f94b5090ba65a6e70f89">epsilon_</a>) &lt;= downtrack_progress) &amp;&amp; (downtrack_progress &lt; (<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a2ca981bae82972205b3877b06054d09d">upcoming_lc_params_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1UpcomingLaneChangeParameters.html#a9bc3e7edf423530bb59fff379f84fe0f">end_dist</a> - <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a47e5e1d18269f94b5090ba65a6e70f89">epsilon_</a>))){</div>
<div class="line"><a id="l01330" name="l01330"></a><span class="lineno"> 1330</span>            resp-&gt;new_plan.maneuvers.push_back(<a class="code hl_function" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a957435426e98f4b2b420a5d5c0ddc9c7">composeLaneChangeManeuverMessage</a>(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a2ca981bae82972205b3877b06054d09d">upcoming_lc_params_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1UpcomingLaneChangeParameters.html#adbad5c78589d71b5eb495730468a710b">start_dist</a>, <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a2ca981bae82972205b3877b06054d09d">upcoming_lc_params_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1UpcomingLaneChangeParameters.html#a9bc3e7edf423530bb59fff379f84fe0f">end_dist</a>,  </div>
<div class="line"><a id="l01331" name="l01331"></a><span class="lineno"> 1331</span>                                      <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a2ca981bae82972205b3877b06054d09d">upcoming_lc_params_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1UpcomingLaneChangeParameters.html#a0276d31105789c8076965c78e6167b8b">start_speed</a>, <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a2ca981bae82972205b3877b06054d09d">upcoming_lc_params_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1UpcomingLaneChangeParameters.html#afabe50de6bef9dbcf906f85044b6e56f">end_speed</a>, <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a2ca981bae82972205b3877b06054d09d">upcoming_lc_params_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1UpcomingLaneChangeParameters.html#adccbad754ba6efe6c1b6061620bded43">starting_lanelet</a>.id(), <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a2ca981bae82972205b3877b06054d09d">upcoming_lc_params_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1UpcomingLaneChangeParameters.html#ae583a07d646008f81d0ad1d4ed1201dd">ending_lanelet</a>.id(), time_progress));</div>
<div class="line"><a id="l01332" name="l01332"></a><span class="lineno"> 1332</span>            </div>
<div class="line"><a id="l01333" name="l01333"></a><span class="lineno"> 1333</span>            current_lanelet = <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a2ca981bae82972205b3877b06054d09d">upcoming_lc_params_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1UpcomingLaneChangeParameters.html#ae583a07d646008f81d0ad1d4ed1201dd">ending_lanelet</a>;</div>
<div class="line"><a id="l01334" name="l01334"></a><span class="lineno"> 1334</span>          }</div>
<div class="line"><a id="l01335" name="l01335"></a><span class="lineno"> 1335</span>          <span class="keywordflow">else</span>{</div>
<div class="line"><a id="l01336" name="l01336"></a><span class="lineno"> 1336</span>            resp-&gt;new_plan.maneuvers.push_back(<a class="code hl_function" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a34d39426c0a919ae1bd003dccb4e7ac0">composeLaneFollowingManeuverMessage</a>(downtrack_progress, current_lanelet_ending_downtrack,  </div>
<div class="line"><a id="l01337" name="l01337"></a><span class="lineno"> 1337</span>                                      speed_progress, target_speed, current_lanelet.id(), time_progress));</div>
<div class="line"><a id="l01338" name="l01338"></a><span class="lineno"> 1338</span>          }          </div>
<div class="line"><a id="l01339" name="l01339"></a><span class="lineno"> 1339</span>        </div>
<div class="line"><a id="l01340" name="l01340"></a><span class="lineno"> 1340</span>          <span class="comment">// Get the next lanelet in the current lane if it exists</span></div>
<div class="line"><a id="l01341" name="l01341"></a><span class="lineno"> 1341</span>          <span class="keywordflow">if</span>(!<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a61b742aab762fff7983b3a1bf1a148b1">wm_</a>-&gt;getMapRoutingGraph()-&gt;following(current_lanelet, <span class="keyword">false</span>).empty())</div>
<div class="line"><a id="l01342" name="l01342"></a><span class="lineno"> 1342</span>          {</div>
<div class="line"><a id="l01343" name="l01343"></a><span class="lineno"> 1343</span>            current_lanelet = <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a61b742aab762fff7983b3a1bf1a148b1">wm_</a>-&gt;getMapRoutingGraph()-&gt;following(current_lanelet, <span class="keyword">false</span>).front();</div>
<div class="line"><a id="l01344" name="l01344"></a><span class="lineno"> 1344</span>          }</div>
<div class="line"><a id="l01345" name="l01345"></a><span class="lineno"> 1345</span>          <span class="keywordflow">else</span></div>
<div class="line"><a id="l01346" name="l01346"></a><span class="lineno"> 1346</span>          {</div>
<div class="line"><a id="l01347" name="l01347"></a><span class="lineno"> 1347</span>            RCLCPP_WARN_STREAM(rclcpp::get_logger(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6d19969dc5f588661e25aa3575127405">logger_name</a>), <span class="stringliteral">&quot;A following lanelet in the current lane could not be found; returning empty plan&quot;</span>);</div>
<div class="line"><a id="l01348" name="l01348"></a><span class="lineno"> 1348</span>            resp-&gt;new_plan.maneuvers = {};</div>
<div class="line"><a id="l01349" name="l01349"></a><span class="lineno"> 1349</span>            <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01350" name="l01350"></a><span class="lineno"> 1350</span>          }</div>
<div class="line"><a id="l01351" name="l01351"></a><span class="lineno"> 1351</span> </div>
<div class="line"><a id="l01352" name="l01352"></a><span class="lineno"> 1352</span>          <span class="comment">// Check whether the next lanelet is on the route</span></div>
<div class="line"><a id="l01353" name="l01353"></a><span class="lineno"> 1353</span>          <span class="keywordflow">if</span>(!<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a61b742aab762fff7983b3a1bf1a148b1">wm_</a>-&gt;getRoute()-&gt;contains(current_lanelet)){</div>
<div class="line"><a id="l01354" name="l01354"></a><span class="lineno"> 1354</span>            RCLCPP_WARN_STREAM(rclcpp::get_logger(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6d19969dc5f588661e25aa3575127405">logger_name</a>), <span class="stringliteral">&quot;The next lanelet in the current lane is not on the route; returning empty plan&quot;</span>);</div>
<div class="line"><a id="l01355" name="l01355"></a><span class="lineno"> 1355</span>            resp-&gt;new_plan.maneuvers = {};</div>
<div class="line"><a id="l01356" name="l01356"></a><span class="lineno"> 1356</span>            <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01357" name="l01357"></a><span class="lineno"> 1357</span>          }</div>
<div class="line"><a id="l01358" name="l01358"></a><span class="lineno"> 1358</span> </div>
<div class="line"><a id="l01359" name="l01359"></a><span class="lineno"> 1359</span>          <span class="comment">// Update the maneuver parameters for the next maneuver in the plan</span></div>
<div class="line"><a id="l01360" name="l01360"></a><span class="lineno"> 1360</span>          downtrack_progress = <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a61b742aab762fff7983b3a1bf1a148b1">wm_</a>-&gt;routeTrackPos(current_lanelet.centerline2d().front()).downtrack;</div>
<div class="line"><a id="l01361" name="l01361"></a><span class="lineno"> 1361</span>          current_lanelet_ending_downtrack = <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a61b742aab762fff7983b3a1bf1a148b1">wm_</a>-&gt;routeTrackPos(current_lanelet.centerline2d().back()).downtrack;</div>
<div class="line"><a id="l01362" name="l01362"></a><span class="lineno"> 1362</span>          speed_progress = <a class="code hl_function" href="namespaceapproaching__emergency__vehicle__plugin_1_1anonymous__namespace_02approaching__emergenc6b477e4cfd274375085cbaf134e12178.html#a824526918073d730865d3616fded75c4">getManeuverEndSpeed</a>(resp-&gt;new_plan.maneuvers.back());</div>
<div class="line"><a id="l01363" name="l01363"></a><span class="lineno"> 1363</span>          target_speed = <a class="code hl_function" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#ac057c7b9bb7723c2089604dd3776c8e9">getLaneletSpeedLimit</a>(current_lanelet);</div>
<div class="line"><a id="l01364" name="l01364"></a><span class="lineno"> 1364</span>          time_progress += <a class="code hl_function" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a17ee49842e3def04d87e6318ab477fb2">getManeuverDuration</a>(resp-&gt;new_plan.maneuvers.back(), <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a47e5e1d18269f94b5090ba65a6e70f89">epsilon_</a>);</div>
<div class="line"><a id="l01365" name="l01365"></a><span class="lineno"> 1365</span> </div>
<div class="line"><a id="l01366" name="l01366"></a><span class="lineno"> 1366</span>          RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6d19969dc5f588661e25aa3575127405">logger_name</a>), <span class="stringliteral">&quot;Next maneuver starting downtrack is &quot;</span> &lt;&lt; downtrack_progress &lt;&lt; <span class="stringliteral">&quot;, end of plan is at &quot;</span> &lt;&lt; maneuver_plan_ending_downtrack);</div>
<div class="line"><a id="l01367" name="l01367"></a><span class="lineno"> 1367</span>        }</div>
<div class="line"><a id="l01368" name="l01368"></a><span class="lineno"> 1368</span>      }</div>
<div class="line"><a id="l01369" name="l01369"></a><span class="lineno"> 1369</span>    }</div>
<div class="line"><a id="l01370" name="l01370"></a><span class="lineno"> 1370</span>    <span class="keywordflow">else</span>{</div>
<div class="line"><a id="l01371" name="l01371"></a><span class="lineno"> 1371</span>      <span class="keywordtype">bool</span> completed_initial_lane_following = <span class="keyword">false</span>; <span class="comment">// Flag to indicate whether sufficient lane following has been planned before the lane change</span></div>
<div class="line"><a id="l01372" name="l01372"></a><span class="lineno"> 1372</span>      <span class="keywordtype">double</span> initial_lane_following_duration = 0.0; <span class="comment">// Object to store the duration of lane following planned before the lane change</span></div>
<div class="line"><a id="l01373" name="l01373"></a><span class="lineno"> 1373</span> </div>
<div class="line"><a id="l01374" name="l01374"></a><span class="lineno"> 1374</span>      <span class="keywordflow">while</span>(downtrack_progress &lt; maneuver_plan_ending_downtrack){</div>
<div class="line"><a id="l01375" name="l01375"></a><span class="lineno"> 1375</span> </div>
<div class="line"><a id="l01376" name="l01376"></a><span class="lineno"> 1376</span>        <span class="keywordflow">if</span>(begin_stopping_downtrack &lt;= current_lanelet_ending_downtrack){</div>
<div class="line"><a id="l01377" name="l01377"></a><span class="lineno"> 1377</span>          <span class="comment">// Complete maneuver plan with a stop and wait maneuver if the current lanelet intercepts the stopping downtrack</span></div>
<div class="line"><a id="l01378" name="l01378"></a><span class="lineno"> 1378</span>          <a class="code hl_function" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a5f4cb3c7b1c37290745bcba2f8e3c603">addStopAndWaitToEndOfPlan</a>(resp, downtrack_progress, begin_stopping_downtrack, <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a61b742aab762fff7983b3a1bf1a148b1">wm_</a>-&gt;getRouteEndTrackPos().downtrack, </div>
<div class="line"><a id="l01379" name="l01379"></a><span class="lineno"> 1379</span>                          speed_progress, stopping_deceleration, current_lanelet_ending_downtrack, current_lanelet, time_progress);</div>
<div class="line"><a id="l01380" name="l01380"></a><span class="lineno"> 1380</span>          <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01381" name="l01381"></a><span class="lineno"> 1381</span>        }</div>
<div class="line"><a id="l01382" name="l01382"></a><span class="lineno"> 1382</span>        <span class="keywordflow">else</span>{</div>
<div class="line"><a id="l01383" name="l01383"></a><span class="lineno"> 1383</span>          <span class="comment">// First maneuver(s) are lane-following to enable sufficient time to activate turn signals before conducting lane change</span></div>
<div class="line"><a id="l01384" name="l01384"></a><span class="lineno"> 1384</span>          <span class="keywordflow">if</span>(!completed_initial_lane_following){</div>
<div class="line"><a id="l01385" name="l01385"></a><span class="lineno"> 1385</span>            resp-&gt;new_plan.maneuvers.push_back(<a class="code hl_function" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a34d39426c0a919ae1bd003dccb4e7ac0">composeLaneFollowingManeuverMessage</a>(downtrack_progress, current_lanelet_ending_downtrack,  </div>
<div class="line"><a id="l01386" name="l01386"></a><span class="lineno"> 1386</span>                                    speed_progress, target_speed, current_lanelet.id(), time_progress));</div>
<div class="line"><a id="l01387" name="l01387"></a><span class="lineno"> 1387</span> </div>
<div class="line"><a id="l01388" name="l01388"></a><span class="lineno"> 1388</span>            initial_lane_following_duration += <a class="code hl_function" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a17ee49842e3def04d87e6318ab477fb2">getManeuverDuration</a>(resp-&gt;new_plan.maneuvers.back(), <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a47e5e1d18269f94b5090ba65a6e70f89">epsilon_</a>).seconds();</div>
<div class="line"><a id="l01389" name="l01389"></a><span class="lineno"> 1389</span>            RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6d19969dc5f588661e25aa3575127405">logger_name</a>), <span class="stringliteral">&quot;Seconds of lane following before lane change: &quot;</span> &lt;&lt; initial_lane_following_duration);</div>
<div class="line"><a id="l01390" name="l01390"></a><span class="lineno"> 1390</span> </div>
<div class="line"><a id="l01391" name="l01391"></a><span class="lineno"> 1391</span>            <span class="keywordflow">if</span>(initial_lane_following_duration &gt;= <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a2617bd4b6850d11f938dfd39efb0ad1c">min_lane_following_duration_before_lane_change</a>){</div>
<div class="line"><a id="l01392" name="l01392"></a><span class="lineno"> 1392</span>              RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6d19969dc5f588661e25aa3575127405">logger_name</a>), <span class="stringliteral">&quot;Minimum lane following duration before lane change satisfied.&quot;</span>);</div>
<div class="line"><a id="l01393" name="l01393"></a><span class="lineno"> 1393</span>              completed_initial_lane_following = <span class="keyword">true</span>;</div>
<div class="line"><a id="l01394" name="l01394"></a><span class="lineno"> 1394</span>            }</div>
<div class="line"><a id="l01395" name="l01395"></a><span class="lineno"> 1395</span>          }</div>
<div class="line"><a id="l01396" name="l01396"></a><span class="lineno"> 1396</span>          <span class="keywordflow">else</span>{</div>
<div class="line"><a id="l01397" name="l01397"></a><span class="lineno"> 1397</span> </div>
<div class="line"><a id="l01398" name="l01398"></a><span class="lineno"> 1398</span>            <span class="keywordflow">if</span>(!<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a529d40caad413492d989ab91eb48fdb6">has_planned_upcoming_lc_</a>){</div>
<div class="line"><a id="l01399" name="l01399"></a><span class="lineno"> 1399</span>              <span class="comment">// Initialize UpcomingLaneChangeParameters object to store information regarding the planned lane change maneuver</span></div>
<div class="line"><a id="l01400" name="l01400"></a><span class="lineno"> 1400</span>              <a class="code hl_struct" href="structapproaching__emergency__vehicle__plugin_1_1UpcomingLaneChangeParameters.html">UpcomingLaneChangeParameters</a> new_lc_params;</div>
<div class="line"><a id="l01401" name="l01401"></a><span class="lineno"> 1401</span> </div>
<div class="line"><a id="l01402" name="l01402"></a><span class="lineno"> 1402</span>              <span class="comment">// Determine if left lane change or right lane change required, and get the target lanelet</span></div>
<div class="line"><a id="l01403" name="l01403"></a><span class="lineno"> 1403</span>              lanelet::Optional&lt;lanelet::ConstLanelet&gt; target_lanelet;</div>
<div class="line"><a id="l01404" name="l01404"></a><span class="lineno"> 1404</span>              <span class="keywordflow">if</span>(ego_lane_index != erv_lane_index){</div>
<div class="line"><a id="l01405" name="l01405"></a><span class="lineno"> 1405</span>                RCLCPP_WARN_STREAM(rclcpp::get_logger(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6d19969dc5f588661e25aa3575127405">logger_name</a>), <span class="stringliteral">&quot;Planning a move-over maneuver plan when the ego vehicle is not in the ERV&#39;s path! Returning an empty maneuver plan&quot;</span>);</div>
<div class="line"><a id="l01406" name="l01406"></a><span class="lineno"> 1406</span>                resp-&gt;new_plan.maneuvers = {};</div>
<div class="line"><a id="l01407" name="l01407"></a><span class="lineno"> 1407</span>                <span class="keywordflow">return</span>;              </div>
<div class="line"><a id="l01408" name="l01408"></a><span class="lineno"> 1408</span>              }</div>
<div class="line"><a id="l01409" name="l01409"></a><span class="lineno"> 1409</span>              <span class="keywordflow">else</span> <span class="keywordflow">if</span>((ego_lane_index == 0) &amp;&amp; (erv_lane_index == 0)){</div>
<div class="line"><a id="l01410" name="l01410"></a><span class="lineno"> 1410</span>                <span class="comment">// Ego vehicle and ERV are both in the rightmost lane so a left lane change is required</span></div>
<div class="line"><a id="l01411" name="l01411"></a><span class="lineno"> 1411</span>                new_lc_params.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1UpcomingLaneChangeParameters.html#aaba665f5ee18db85363601f0c385fd5a">is_right_lane_change</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l01412" name="l01412"></a><span class="lineno"> 1412</span>                target_lanelet = <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a61b742aab762fff7983b3a1bf1a148b1">wm_</a>-&gt;getMapRoutingGraph()-&gt;left(current_lanelet);   </div>
<div class="line"><a id="l01413" name="l01413"></a><span class="lineno"> 1413</span>                RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6d19969dc5f588661e25aa3575127405">logger_name</a>), <span class="stringliteral">&quot;Composing a left lane change maneuver from lanelet &quot;</span> &lt;&lt; current_lanelet.id());</div>
<div class="line"><a id="l01414" name="l01414"></a><span class="lineno"> 1414</span>              }</div>
<div class="line"><a id="l01415" name="l01415"></a><span class="lineno"> 1415</span>              <span class="keywordflow">else</span>{</div>
<div class="line"><a id="l01416" name="l01416"></a><span class="lineno"> 1416</span>                <span class="comment">// A right lane change is required</span></div>
<div class="line"><a id="l01417" name="l01417"></a><span class="lineno"> 1417</span>                new_lc_params.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1UpcomingLaneChangeParameters.html#aaba665f5ee18db85363601f0c385fd5a">is_right_lane_change</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l01418" name="l01418"></a><span class="lineno"> 1418</span>                target_lanelet = <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a61b742aab762fff7983b3a1bf1a148b1">wm_</a>-&gt;getMapRoutingGraph()-&gt;right(current_lanelet);</div>
<div class="line"><a id="l01419" name="l01419"></a><span class="lineno"> 1419</span>                RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6d19969dc5f588661e25aa3575127405">logger_name</a>), <span class="stringliteral">&quot;Composing a right lane change maneuver from lanelet &quot;</span> &lt;&lt; current_lanelet.id());</div>
<div class="line"><a id="l01420" name="l01420"></a><span class="lineno"> 1420</span>              }</div>
<div class="line"><a id="l01421" name="l01421"></a><span class="lineno"> 1421</span> </div>
<div class="line"><a id="l01422" name="l01422"></a><span class="lineno"> 1422</span>              <span class="comment">// Only compose lane change maneuver if the target lanelet exists, otherwise compose lane follow maneuver</span></div>
<div class="line"><a id="l01423" name="l01423"></a><span class="lineno"> 1423</span>              <span class="keywordflow">if</span>(target_lanelet){</div>
<div class="line"><a id="l01424" name="l01424"></a><span class="lineno"> 1424</span>                resp-&gt;new_plan.maneuvers.push_back(<a class="code hl_function" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a957435426e98f4b2b420a5d5c0ddc9c7">composeLaneChangeManeuverMessage</a>(downtrack_progress, current_lanelet_ending_downtrack,  </div>
<div class="line"><a id="l01425" name="l01425"></a><span class="lineno"> 1425</span>                                        speed_progress, target_speed, current_lanelet.id(), target_lanelet.get().id(), time_progress));</div>
<div class="line"><a id="l01426" name="l01426"></a><span class="lineno"> 1426</span>                </div>
<div class="line"><a id="l01427" name="l01427"></a><span class="lineno"> 1427</span>                <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a529d40caad413492d989ab91eb48fdb6">has_planned_upcoming_lc_</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l01428" name="l01428"></a><span class="lineno"> 1428</span>                </div>
<div class="line"><a id="l01429" name="l01429"></a><span class="lineno"> 1429</span>                new_lc_params.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1UpcomingLaneChangeParameters.html#adccbad754ba6efe6c1b6061620bded43">starting_lanelet</a> = current_lanelet;</div>
<div class="line"><a id="l01430" name="l01430"></a><span class="lineno"> 1430</span>                new_lc_params.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1UpcomingLaneChangeParameters.html#ae583a07d646008f81d0ad1d4ed1201dd">ending_lanelet</a> = target_lanelet.get();</div>
<div class="line"><a id="l01431" name="l01431"></a><span class="lineno"> 1431</span>                new_lc_params.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1UpcomingLaneChangeParameters.html#adbad5c78589d71b5eb495730468a710b">start_dist</a> = downtrack_progress;</div>
<div class="line"><a id="l01432" name="l01432"></a><span class="lineno"> 1432</span>                new_lc_params.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1UpcomingLaneChangeParameters.html#a9bc3e7edf423530bb59fff379f84fe0f">end_dist</a> = current_lanelet_ending_downtrack;</div>
<div class="line"><a id="l01433" name="l01433"></a><span class="lineno"> 1433</span>                new_lc_params.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1UpcomingLaneChangeParameters.html#a0276d31105789c8076965c78e6167b8b">start_speed</a> = speed_progress;</div>
<div class="line"><a id="l01434" name="l01434"></a><span class="lineno"> 1434</span>                new_lc_params.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1UpcomingLaneChangeParameters.html#afabe50de6bef9dbcf906f85044b6e56f">end_speed</a> = target_speed;</div>
<div class="line"><a id="l01435" name="l01435"></a><span class="lineno"> 1435</span>                new_lc_params.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1UpcomingLaneChangeParameters.html#ae48fc7188493fdd07e58d765a78ffd17">maneuver_id</a> = resp-&gt;new_plan.maneuvers.back().lane_change_maneuver.parameters.maneuver_id;</div>
<div class="line"><a id="l01436" name="l01436"></a><span class="lineno"> 1436</span>                <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a2ca981bae82972205b3877b06054d09d">upcoming_lc_params_</a> = new_lc_params;</div>
<div class="line"><a id="l01437" name="l01437"></a><span class="lineno"> 1437</span> </div>
<div class="line"><a id="l01438" name="l01438"></a><span class="lineno"> 1438</span>                current_lanelet = *target_lanelet;</div>
<div class="line"><a id="l01439" name="l01439"></a><span class="lineno"> 1439</span>              }</div>
<div class="line"><a id="l01440" name="l01440"></a><span class="lineno"> 1440</span>              <span class="keywordflow">else</span>{</div>
<div class="line"><a id="l01441" name="l01441"></a><span class="lineno"> 1441</span>                RCLCPP_WARN_STREAM(rclcpp::get_logger(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6d19969dc5f588661e25aa3575127405">logger_name</a>), <span class="stringliteral">&quot;A lane change maneuver from &quot;</span> &lt;&lt; current_lanelet.id() &lt;&lt; <span class="stringliteral">&quot; could not be composed since no target lanelet was found!&quot;</span>);</div>
<div class="line"><a id="l01442" name="l01442"></a><span class="lineno"> 1442</span>                resp-&gt;new_plan.maneuvers.push_back(<a class="code hl_function" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a34d39426c0a919ae1bd003dccb4e7ac0">composeLaneFollowingManeuverMessage</a>(downtrack_progress, current_lanelet_ending_downtrack,  </div>
<div class="line"><a id="l01443" name="l01443"></a><span class="lineno"> 1443</span>                                        speed_progress, target_speed, current_lanelet.id(), time_progress));</div>
<div class="line"><a id="l01444" name="l01444"></a><span class="lineno"> 1444</span>              }</div>
<div class="line"><a id="l01445" name="l01445"></a><span class="lineno"> 1445</span>            }</div>
<div class="line"><a id="l01446" name="l01446"></a><span class="lineno"> 1446</span>            <span class="keywordflow">else</span>{</div>
<div class="line"><a id="l01447" name="l01447"></a><span class="lineno"> 1447</span>              resp-&gt;new_plan.maneuvers.push_back(<a class="code hl_function" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a34d39426c0a919ae1bd003dccb4e7ac0">composeLaneFollowingManeuverMessage</a>(downtrack_progress, current_lanelet_ending_downtrack,  </div>
<div class="line"><a id="l01448" name="l01448"></a><span class="lineno"> 1448</span>                                        speed_progress, target_speed, current_lanelet.id(), time_progress));</div>
<div class="line"><a id="l01449" name="l01449"></a><span class="lineno"> 1449</span>            }</div>
<div class="line"><a id="l01450" name="l01450"></a><span class="lineno"> 1450</span>          }</div>
<div class="line"><a id="l01451" name="l01451"></a><span class="lineno"> 1451</span> </div>
<div class="line"><a id="l01452" name="l01452"></a><span class="lineno"> 1452</span>          <span class="comment">// Get the next lanelet in the current lane if it exists</span></div>
<div class="line"><a id="l01453" name="l01453"></a><span class="lineno"> 1453</span>          <span class="keywordflow">if</span>(!<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a61b742aab762fff7983b3a1bf1a148b1">wm_</a>-&gt;getMapRoutingGraph()-&gt;following(current_lanelet, <span class="keyword">false</span>).empty())</div>
<div class="line"><a id="l01454" name="l01454"></a><span class="lineno"> 1454</span>          {</div>
<div class="line"><a id="l01455" name="l01455"></a><span class="lineno"> 1455</span>            current_lanelet = <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a61b742aab762fff7983b3a1bf1a148b1">wm_</a>-&gt;getMapRoutingGraph()-&gt;following(current_lanelet, <span class="keyword">false</span>).front();</div>
<div class="line"><a id="l01456" name="l01456"></a><span class="lineno"> 1456</span>          }</div>
<div class="line"><a id="l01457" name="l01457"></a><span class="lineno"> 1457</span>          <span class="keywordflow">else</span></div>
<div class="line"><a id="l01458" name="l01458"></a><span class="lineno"> 1458</span>          {</div>
<div class="line"><a id="l01459" name="l01459"></a><span class="lineno"> 1459</span>            RCLCPP_WARN_STREAM(rclcpp::get_logger(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6d19969dc5f588661e25aa3575127405">logger_name</a>), <span class="stringliteral">&quot;A following lanelet in the current lane could not be found; returning empty plan&quot;</span>);</div>
<div class="line"><a id="l01460" name="l01460"></a><span class="lineno"> 1460</span>            resp-&gt;new_plan.maneuvers = {};</div>
<div class="line"><a id="l01461" name="l01461"></a><span class="lineno"> 1461</span>            <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01462" name="l01462"></a><span class="lineno"> 1462</span>          }</div>
<div class="line"><a id="l01463" name="l01463"></a><span class="lineno"> 1463</span> </div>
<div class="line"><a id="l01464" name="l01464"></a><span class="lineno"> 1464</span>          <span class="comment">// Check whether the next lanelet is on the route</span></div>
<div class="line"><a id="l01465" name="l01465"></a><span class="lineno"> 1465</span>          <span class="keywordflow">if</span>(!<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a61b742aab762fff7983b3a1bf1a148b1">wm_</a>-&gt;getRoute()-&gt;contains(current_lanelet)){</div>
<div class="line"><a id="l01466" name="l01466"></a><span class="lineno"> 1466</span>            RCLCPP_WARN_STREAM(rclcpp::get_logger(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6d19969dc5f588661e25aa3575127405">logger_name</a>), <span class="stringliteral">&quot;The next lanelet in the current lane is not on the route; returning empty plan&quot;</span>);</div>
<div class="line"><a id="l01467" name="l01467"></a><span class="lineno"> 1467</span>            resp-&gt;new_plan.maneuvers = {};</div>
<div class="line"><a id="l01468" name="l01468"></a><span class="lineno"> 1468</span>            <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01469" name="l01469"></a><span class="lineno"> 1469</span>          }</div>
<div class="line"><a id="l01470" name="l01470"></a><span class="lineno"> 1470</span> </div>
<div class="line"><a id="l01471" name="l01471"></a><span class="lineno"> 1471</span>          <span class="comment">// Update the maneuver parameters for the next maneuver in the plan</span></div>
<div class="line"><a id="l01472" name="l01472"></a><span class="lineno"> 1472</span>          downtrack_progress = <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a61b742aab762fff7983b3a1bf1a148b1">wm_</a>-&gt;routeTrackPos(current_lanelet.centerline2d().front()).downtrack;</div>
<div class="line"><a id="l01473" name="l01473"></a><span class="lineno"> 1473</span>          current_lanelet_ending_downtrack = <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a61b742aab762fff7983b3a1bf1a148b1">wm_</a>-&gt;routeTrackPos(current_lanelet.centerline2d().back()).downtrack;</div>
<div class="line"><a id="l01474" name="l01474"></a><span class="lineno"> 1474</span>          speed_progress = <a class="code hl_function" href="namespaceapproaching__emergency__vehicle__plugin_1_1anonymous__namespace_02approaching__emergenc6b477e4cfd274375085cbaf134e12178.html#a824526918073d730865d3616fded75c4">getManeuverEndSpeed</a>(resp-&gt;new_plan.maneuvers.back());</div>
<div class="line"><a id="l01475" name="l01475"></a><span class="lineno"> 1475</span>          target_speed = <a class="code hl_function" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#ac057c7b9bb7723c2089604dd3776c8e9">getLaneletSpeedLimit</a>(current_lanelet);</div>
<div class="line"><a id="l01476" name="l01476"></a><span class="lineno"> 1476</span>          time_progress += <a class="code hl_function" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a17ee49842e3def04d87e6318ab477fb2">getManeuverDuration</a>(resp-&gt;new_plan.maneuvers.back(), <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a47e5e1d18269f94b5090ba65a6e70f89">epsilon_</a>);</div>
<div class="line"><a id="l01477" name="l01477"></a><span class="lineno"> 1477</span> </div>
<div class="line"><a id="l01478" name="l01478"></a><span class="lineno"> 1478</span>          RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6d19969dc5f588661e25aa3575127405">logger_name</a>), <span class="stringliteral">&quot;Next maneuver starting downtrack is &quot;</span> &lt;&lt; downtrack_progress &lt;&lt; <span class="stringliteral">&quot;, end of plan is at &quot;</span> &lt;&lt; maneuver_plan_ending_downtrack);</div>
<div class="line"><a id="l01479" name="l01479"></a><span class="lineno"> 1479</span>        }</div>
<div class="line"><a id="l01480" name="l01480"></a><span class="lineno"> 1480</span>      }    </div>
<div class="line"><a id="l01481" name="l01481"></a><span class="lineno"> 1481</span>    }</div>
<div class="line"><a id="l01482" name="l01482"></a><span class="lineno"> 1482</span>  }</div>
<div class="line"><a id="l01483" name="l01483"></a><span class="lineno"> 1483</span> </div>
<div class="line"><a id="l01484" name="l01484"></a><span class="lineno"><a class="line" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a4c0612d6eb08db90723028f4c4ca362f"> 1484</a></span>  boost::optional&lt;lanelet::ConstLanelet&gt; <a class="code hl_function" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a4c0612d6eb08db90723028f4c4ca362f">ApproachingEmergencyVehiclePlugin::getLaneletOnEgoRouteFromMapPosition</a>(<span class="keyword">const</span> <span class="keywordtype">double</span>&amp; x_position, <span class="keyword">const</span> <span class="keywordtype">double</span>&amp; y_position)</div>
<div class="line"><a id="l01485" name="l01485"></a><span class="lineno"> 1485</span>  {</div>
<div class="line"><a id="l01486" name="l01486"></a><span class="lineno"> 1486</span>    <span class="comment">// Get lanelet(s) that the provided map coordinates are contained within</span></div>
<div class="line"><a id="l01487" name="l01487"></a><span class="lineno"> 1487</span>    std::vector&lt;lanelet::ConstLanelet&gt; ego_route_lanelets = <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a61b742aab762fff7983b3a1bf1a148b1">wm_</a>-&gt;getLaneletsFromPoint({x_position, y_position});</div>
<div class="line"><a id="l01488" name="l01488"></a><span class="lineno"> 1488</span>    boost::optional&lt;lanelet::ConstLanelet&gt; ego_route_lanelet;</div>
<div class="line"><a id="l01489" name="l01489"></a><span class="lineno"> 1489</span>    </div>
<div class="line"><a id="l01490" name="l01490"></a><span class="lineno"> 1490</span>    <span class="keywordflow">if</span> (ego_route_lanelets.empty())</div>
<div class="line"><a id="l01491" name="l01491"></a><span class="lineno"> 1491</span>    {</div>
<div class="line"><a id="l01492" name="l01492"></a><span class="lineno"> 1492</span>      RCLCPP_WARN_STREAM(rclcpp::get_logger(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6d19969dc5f588661e25aa3575127405">logger_name</a>), <span class="stringliteral">&quot;Given vehicle position is not on the road.&quot;</span>);</div>
<div class="line"><a id="l01493" name="l01493"></a><span class="lineno"> 1493</span>      <span class="keywordflow">return</span> boost::optional&lt;lanelet::ConstLanelet&gt;();</div>
<div class="line"><a id="l01494" name="l01494"></a><span class="lineno"> 1494</span>    }</div>
<div class="line"><a id="l01495" name="l01495"></a><span class="lineno"> 1495</span> </div>
<div class="line"><a id="l01496" name="l01496"></a><span class="lineno"> 1496</span>    <span class="comment">// Get the lanelet that is on the ego vehicle&#39;s route in case vehicle is located on overlapping lanelets</span></div>
<div class="line"><a id="l01497" name="l01497"></a><span class="lineno"> 1497</span>    <span class="keywordflow">for</span>(<span class="keyword">const</span> <span class="keyword">auto</span>&amp; <a class="code hl_namespace" href="namespacelanelet.html">lanelet</a> : ego_route_lanelets)</div>
<div class="line"><a id="l01498" name="l01498"></a><span class="lineno"> 1498</span>    {</div>
<div class="line"><a id="l01499" name="l01499"></a><span class="lineno"> 1499</span>      <span class="keywordflow">if</span>(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a61b742aab762fff7983b3a1bf1a148b1">wm_</a>-&gt;getRoute()-&gt;contains(<a class="code hl_namespace" href="namespacelanelet.html">lanelet</a>)){</div>
<div class="line"><a id="l01500" name="l01500"></a><span class="lineno"> 1500</span>        ego_route_lanelet = <a class="code hl_namespace" href="namespacelanelet.html">lanelet</a>;</div>
<div class="line"><a id="l01501" name="l01501"></a><span class="lineno"> 1501</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01502" name="l01502"></a><span class="lineno"> 1502</span>      }</div>
<div class="line"><a id="l01503" name="l01503"></a><span class="lineno"> 1503</span>    }</div>
<div class="line"><a id="l01504" name="l01504"></a><span class="lineno"> 1504</span> </div>
<div class="line"><a id="l01505" name="l01505"></a><span class="lineno"> 1505</span>    <span class="keywordflow">return</span> ego_route_lanelet;</div>
<div class="line"><a id="l01506" name="l01506"></a><span class="lineno"> 1506</span>  }</div>
<div class="line"><a id="l01507" name="l01507"></a><span class="lineno"> 1507</span> </div>
<div class="line"><a id="l01508" name="l01508"></a><span class="lineno"><a class="line" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#aad4e194f2513851c1dda17d1bbe0a290"> 1508</a></span>  <span class="keywordtype">void</span> <a class="code hl_function" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#aad4e194f2513851c1dda17d1bbe0a290">ApproachingEmergencyVehiclePlugin::plan_maneuvers_callback</a>(</div>
<div class="line"><a id="l01509" name="l01509"></a><span class="lineno"> 1509</span>    std::shared_ptr&lt;rmw_request_id_t&gt;, </div>
<div class="line"><a id="l01510" name="l01510"></a><span class="lineno"> 1510</span>    carma_planning_msgs::srv::PlanManeuvers::Request::SharedPtr req, </div>
<div class="line"><a id="l01511" name="l01511"></a><span class="lineno"> 1511</span>    carma_planning_msgs::srv::PlanManeuvers::Response::SharedPtr resp)</div>
<div class="line"><a id="l01512" name="l01512"></a><span class="lineno"> 1512</span>  {</div>
<div class="line"><a id="l01513" name="l01513"></a><span class="lineno"> 1513</span>    RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6d19969dc5f588661e25aa3575127405">logger_name</a>), <span class="stringliteral">&quot;Received request to plan maneuvers&quot;</span>);</div>
<div class="line"><a id="l01514" name="l01514"></a><span class="lineno"> 1514</span> </div>
<div class="line"><a id="l01515" name="l01515"></a><span class="lineno"> 1515</span>    <span class="comment">// Check whether ego vehicle is currently in the middle of a lane change, or whether its planned lane change has been completed</span></div>
<div class="line"><a id="l01516" name="l01516"></a><span class="lineno"> 1516</span>    <span class="keywordtype">bool</span> is_currently_lane_changing = <span class="keyword">false</span>;</div>
<div class="line"><a id="l01517" name="l01517"></a><span class="lineno"> 1517</span>    <span class="keywordflow">if</span>(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a529d40caad413492d989ab91eb48fdb6">has_planned_upcoming_lc_</a>){</div>
<div class="line"><a id="l01518" name="l01518"></a><span class="lineno"> 1518</span>      <span class="keywordflow">if</span>((<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a2ca981bae82972205b3877b06054d09d">upcoming_lc_params_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1UpcomingLaneChangeParameters.html#adbad5c78589d71b5eb495730468a710b">start_dist</a> &lt; req-&gt;veh_downtrack) &amp;&amp; (req-&gt;veh_downtrack &lt; <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a2ca981bae82972205b3877b06054d09d">upcoming_lc_params_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1UpcomingLaneChangeParameters.html#a9bc3e7edf423530bb59fff379f84fe0f">end_dist</a>)){</div>
<div class="line"><a id="l01519" name="l01519"></a><span class="lineno"> 1519</span>        is_currently_lane_changing = <span class="keyword">true</span>;</div>
<div class="line"><a id="l01520" name="l01520"></a><span class="lineno"> 1520</span>      }</div>
<div class="line"><a id="l01521" name="l01521"></a><span class="lineno"> 1521</span>      <span class="keywordflow">else</span> <span class="keywordflow">if</span>(req-&gt;veh_downtrack &gt; <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a2ca981bae82972205b3877b06054d09d">upcoming_lc_params_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1UpcomingLaneChangeParameters.html#a9bc3e7edf423530bb59fff379f84fe0f">end_dist</a>){</div>
<div class="line"><a id="l01522" name="l01522"></a><span class="lineno"> 1522</span>        <span class="comment">// Update flag since the planned lane change has been completed</span></div>
<div class="line"><a id="l01523" name="l01523"></a><span class="lineno"> 1523</span>        <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a529d40caad413492d989ab91eb48fdb6">has_planned_upcoming_lc_</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l01524" name="l01524"></a><span class="lineno"> 1524</span>      }</div>
<div class="line"><a id="l01525" name="l01525"></a><span class="lineno"> 1525</span>    }</div>
<div class="line"><a id="l01526" name="l01526"></a><span class="lineno"> 1526</span> </div>
<div class="line"><a id="l01527" name="l01527"></a><span class="lineno"> 1527</span>    boost::optional&lt;lanelet::ConstLanelet&gt; ego_current_lanelet_optional = <a class="code hl_function" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a4c0612d6eb08db90723028f4c4ca362f">getLaneletOnEgoRouteFromMapPosition</a>(req-&gt;veh_x, req-&gt;veh_y);</div>
<div class="line"><a id="l01528" name="l01528"></a><span class="lineno"> 1528</span> </div>
<div class="line"><a id="l01529" name="l01529"></a><span class="lineno"> 1529</span>    <span class="keywordflow">if</span>(ego_current_lanelet_optional){</div>
<div class="line"><a id="l01530" name="l01530"></a><span class="lineno"> 1530</span>      RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6d19969dc5f588661e25aa3575127405">logger_name</a>), <span class="stringliteral">&quot;starting lanelet for maneuver plan is &quot;</span> &lt;&lt; ego_current_lanelet_optional.get().id());</div>
<div class="line"><a id="l01531" name="l01531"></a><span class="lineno"> 1531</span>    }</div>
<div class="line"><a id="l01532" name="l01532"></a><span class="lineno"> 1532</span>    <span class="keywordflow">else</span>{</div>
<div class="line"><a id="l01533" name="l01533"></a><span class="lineno"> 1533</span>      RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6d19969dc5f588661e25aa3575127405">logger_name</a>), <span class="stringliteral">&quot;Given vehicle position is not within a lanelet on the route. Returning empty maneuver plan&quot;</span>);</div>
<div class="line"><a id="l01534" name="l01534"></a><span class="lineno"> 1534</span>      <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01535" name="l01535"></a><span class="lineno"> 1535</span>    }</div>
<div class="line"><a id="l01536" name="l01536"></a><span class="lineno"> 1536</span> </div>
<div class="line"><a id="l01537" name="l01537"></a><span class="lineno"> 1537</span>    <span class="comment">// Get ego vehicle&#39;s current lane index</span></div>
<div class="line"><a id="l01538" name="l01538"></a><span class="lineno"> 1538</span>    <span class="comment">// Note: For &#39;lane index&#39;, 0 is rightmost lane, 1 is second rightmost, etc.; Only the current travel direction is considered</span></div>
<div class="line"><a id="l01539" name="l01539"></a><span class="lineno"> 1539</span>    <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a79f461d7ccc9669dc1b63a1826652861">ego_lane_index_</a> = <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a61b742aab762fff7983b3a1bf1a148b1">wm_</a>-&gt;getMapRoutingGraph()-&gt;rights(ego_current_lanelet_optional.get()).size();</div>
<div class="line"><a id="l01540" name="l01540"></a><span class="lineno"> 1540</span> </div>
<div class="line"><a id="l01541" name="l01541"></a><span class="lineno"> 1541</span>    <span class="comment">// Update state machine if there is currently an ERV being tracked and if ego vehicle is not currently in the middle of a lane change</span></div>
<div class="line"><a id="l01542" name="l01542"></a><span class="lineno"> 1542</span>    <span class="keywordflow">if</span>(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6c454433ce5dedbf0f32bfb38f1404ed">has_tracked_erv_</a> &amp;&amp; !is_currently_lane_changing){</div>
<div class="line"><a id="l01543" name="l01543"></a><span class="lineno"> 1543</span>      <span class="keywordflow">if</span>(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a79f461d7ccc9669dc1b63a1826652861">ego_lane_index_</a> == <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a676b5bf0f041728d2413650885c9bd36">tracked_erv_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1ErvInformation.html#ac34d23f97859c1239886108d1e8c7828">lane_index</a>){</div>
<div class="line"><a id="l01544" name="l01544"></a><span class="lineno"> 1544</span>        <span class="comment">// Trigger state machine transition for case in which the ego vehicle is in the ERV&#39;s path</span></div>
<div class="line"><a id="l01545" name="l01545"></a><span class="lineno"> 1545</span>        RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6d19969dc5f588661e25aa3575127405">logger_name</a>), <span class="stringliteral">&quot;Ego vehicle and ERV are both in lane index &quot;</span> &lt;&lt; <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a79f461d7ccc9669dc1b63a1826652861">ego_lane_index_</a>);</div>
<div class="line"><a id="l01546" name="l01546"></a><span class="lineno"> 1546</span> </div>
<div class="line"><a id="l01547" name="l01547"></a><span class="lineno"> 1547</span>        <span class="keywordflow">if</span>(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a676b5bf0f041728d2413650885c9bd36">tracked_erv_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1ErvInformation.html#a54055d98a4a44a8b89d7e69b1c161f0b">seconds_until_passing</a> &gt;= <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a78537e382e029464ea6fa1d1e9053cd5">approaching_threshold</a>){</div>
<div class="line"><a id="l01548" name="l01548"></a><span class="lineno"> 1548</span>          <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a36f8f9b65fe9f2ebe9bbb09f3b1e2d8e">transition_table_</a>.<a class="code hl_function" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehicleTransitionTable.html#a8e2158634e7011225335a2674e08f305">event</a>(<a class="code hl_enumvalue" href="namespaceapproaching__emergency__vehicle__plugin.html#ae26e1cd128942ddf2ca8eccadb66a6caa3dc495a5c3931df7278a227f93d6b70a">ApproachingEmergencyVehicleEvent::NO_APPROACHING_ERV</a>);</div>
<div class="line"><a id="l01549" name="l01549"></a><span class="lineno"> 1549</span>          <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a529d40caad413492d989ab91eb48fdb6">has_planned_upcoming_lc_</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l01550" name="l01550"></a><span class="lineno"> 1550</span>        }</div>
<div class="line"><a id="l01551" name="l01551"></a><span class="lineno"> 1551</span>        <span class="keywordflow">else</span> <span class="keywordflow">if</span>((<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a3f55d992021d18a02478cbc07ef0bb25">passing_threshold</a> &lt;= <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a676b5bf0f041728d2413650885c9bd36">tracked_erv_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1ErvInformation.html#a54055d98a4a44a8b89d7e69b1c161f0b">seconds_until_passing</a>) &amp;&amp; (<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a676b5bf0f041728d2413650885c9bd36">tracked_erv_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1ErvInformation.html#a54055d98a4a44a8b89d7e69b1c161f0b">seconds_until_passing</a> &lt; <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a78537e382e029464ea6fa1d1e9053cd5">approaching_threshold</a>)){</div>
<div class="line"><a id="l01552" name="l01552"></a><span class="lineno"> 1552</span>          <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a36f8f9b65fe9f2ebe9bbb09f3b1e2d8e">transition_table_</a>.<a class="code hl_function" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehicleTransitionTable.html#a8e2158634e7011225335a2674e08f305">event</a>(<a class="code hl_enumvalue" href="namespaceapproaching__emergency__vehicle__plugin.html#ae26e1cd128942ddf2ca8eccadb66a6caa1b555c5c3c8561a37b426da3055c0a40">ApproachingEmergencyVehicleEvent::APPROACHING_ERV_IN_PATH</a>);</div>
<div class="line"><a id="l01553" name="l01553"></a><span class="lineno"> 1553</span>        }</div>
<div class="line"><a id="l01554" name="l01554"></a><span class="lineno"> 1554</span>        <span class="keywordflow">else</span> <span class="keywordflow">if</span>((0.0 &lt;= <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a676b5bf0f041728d2413650885c9bd36">tracked_erv_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1ErvInformation.html#a54055d98a4a44a8b89d7e69b1c161f0b">seconds_until_passing</a>) &amp;&amp; (<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a676b5bf0f041728d2413650885c9bd36">tracked_erv_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1ErvInformation.html#a54055d98a4a44a8b89d7e69b1c161f0b">seconds_until_passing</a> &lt; <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a3f55d992021d18a02478cbc07ef0bb25">passing_threshold</a>)){</div>
<div class="line"><a id="l01555" name="l01555"></a><span class="lineno"> 1555</span>          <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a36f8f9b65fe9f2ebe9bbb09f3b1e2d8e">transition_table_</a>.<a class="code hl_function" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehicleTransitionTable.html#a8e2158634e7011225335a2674e08f305">event</a>(<a class="code hl_enumvalue" href="namespaceapproaching__emergency__vehicle__plugin.html#ae26e1cd128942ddf2ca8eccadb66a6caa56a442a3b65d0223941e7bcd776f6100">ApproachingEmergencyVehicleEvent::ERV_PASSING_IN_PATH</a>);</div>
<div class="line"><a id="l01556" name="l01556"></a><span class="lineno"> 1556</span>          </div>
<div class="line"><a id="l01557" name="l01557"></a><span class="lineno"> 1557</span>          <span class="keywordflow">if</span>(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a676b5bf0f041728d2413650885c9bd36">tracked_erv_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1ErvInformation.html#a54055d98a4a44a8b89d7e69b1c161f0b">seconds_until_passing</a> &gt;= <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a4f1b5bd8daf268649c0186920c7ae545">MAINTAIN_SPEED_THRESHOLD</a>){</div>
<div class="line"><a id="l01558" name="l01558"></a><span class="lineno"> 1558</span>            <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#affd5c4e6991e268409a8a021be436347">is_maintaining_non_reduced_speed_</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l01559" name="l01559"></a><span class="lineno"> 1559</span>          }</div>
<div class="line"><a id="l01560" name="l01560"></a><span class="lineno"> 1560</span>          <span class="keywordflow">else</span>{</div>
<div class="line"><a id="l01561" name="l01561"></a><span class="lineno"> 1561</span>            <span class="comment">// ERV is close enough (in the same lane) that if the ego vehicle slows down it could cause a safety hazard; set internal members for ego vehicle to maintain its current speed</span></div>
<div class="line"><a id="l01562" name="l01562"></a><span class="lineno"> 1562</span>            <span class="keywordflow">if</span>(!<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#affd5c4e6991e268409a8a021be436347">is_maintaining_non_reduced_speed_</a>){</div>
<div class="line"><a id="l01563" name="l01563"></a><span class="lineno"> 1563</span>              <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#affd5c4e6991e268409a8a021be436347">is_maintaining_non_reduced_speed_</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l01564" name="l01564"></a><span class="lineno"> 1564</span>              <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a69840d1c02ccdf825a638165e40a1ece">non_reduced_speed_to_maintain_</a> = req-&gt;veh_logitudinal_velocity;</div>
<div class="line"><a id="l01565" name="l01565"></a><span class="lineno"> 1565</span>            }</div>
<div class="line"><a id="l01566" name="l01566"></a><span class="lineno"> 1566</span>          }</div>
<div class="line"><a id="l01567" name="l01567"></a><span class="lineno"> 1567</span> </div>
<div class="line"><a id="l01568" name="l01568"></a><span class="lineno"> 1568</span>          <span class="comment">// Set flag to broadcast EmergencyVehicleResponse warning messages to ERV if they have not already been broadcasted</span></div>
<div class="line"><a id="l01569" name="l01569"></a><span class="lineno"> 1569</span>          <span class="keywordflow">if</span>(!<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a0c9d768f2ccafe7878f63bcf26be2531">has_broadcasted_warning_messages_</a>){</div>
<div class="line"><a id="l01570" name="l01570"></a><span class="lineno"> 1570</span>            <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#ae65a1837d9f53d1d6fd7d240eb866585">should_broadcast_warnings_</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l01571" name="l01571"></a><span class="lineno"> 1571</span>            <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a0c9d768f2ccafe7878f63bcf26be2531">has_broadcasted_warning_messages_</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l01572" name="l01572"></a><span class="lineno"> 1572</span>          }</div>
<div class="line"><a id="l01573" name="l01573"></a><span class="lineno"> 1573</span>        }</div>
<div class="line"><a id="l01574" name="l01574"></a><span class="lineno"> 1574</span>        <span class="keywordflow">else</span>{</div>
<div class="line"><a id="l01575" name="l01575"></a><span class="lineno"> 1575</span>          RCLCPP_WARN_STREAM(rclcpp::get_logger(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6d19969dc5f588661e25aa3575127405">logger_name</a>), <span class="stringliteral">&quot;Unsupported seconds_until_passing of &quot;</span> &lt;&lt; <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a676b5bf0f041728d2413650885c9bd36">tracked_erv_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1ErvInformation.html#a54055d98a4a44a8b89d7e69b1c161f0b">seconds_until_passing</a> &lt;&lt; <span class="stringliteral">&quot;, returning empty maneuver plan&quot;</span>);</div>
<div class="line"><a id="l01576" name="l01576"></a><span class="lineno"> 1576</span>          resp-&gt;new_plan.maneuvers = {};</div>
<div class="line"><a id="l01577" name="l01577"></a><span class="lineno"> 1577</span>          <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01578" name="l01578"></a><span class="lineno"> 1578</span>        }</div>
<div class="line"><a id="l01579" name="l01579"></a><span class="lineno"> 1579</span>      }</div>
<div class="line"><a id="l01580" name="l01580"></a><span class="lineno"> 1580</span>      <span class="keywordflow">else</span>{</div>
<div class="line"><a id="l01581" name="l01581"></a><span class="lineno"> 1581</span>        <span class="comment">// Trigger state machine transition for case in which the ego vehicle is not in the ERV&#39;s path</span></div>
<div class="line"><a id="l01582" name="l01582"></a><span class="lineno"> 1582</span>        RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6d19969dc5f588661e25aa3575127405">logger_name</a>), <span class="stringliteral">&quot;Ego vehicle is not in ERV&#39;s path&quot;</span>);</div>
<div class="line"><a id="l01583" name="l01583"></a><span class="lineno"> 1583</span> </div>
<div class="line"><a id="l01584" name="l01584"></a><span class="lineno"> 1584</span>        <span class="keywordflow">if</span>((<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a676b5bf0f041728d2413650885c9bd36">tracked_erv_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1ErvInformation.html#a54055d98a4a44a8b89d7e69b1c161f0b">seconds_until_passing</a> &gt;= <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a78537e382e029464ea6fa1d1e9053cd5">approaching_threshold</a>)){</div>
<div class="line"><a id="l01585" name="l01585"></a><span class="lineno"> 1585</span>          <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a36f8f9b65fe9f2ebe9bbb09f3b1e2d8e">transition_table_</a>.<a class="code hl_function" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehicleTransitionTable.html#a8e2158634e7011225335a2674e08f305">event</a>(<a class="code hl_enumvalue" href="namespaceapproaching__emergency__vehicle__plugin.html#ae26e1cd128942ddf2ca8eccadb66a6caa3dc495a5c3931df7278a227f93d6b70a">ApproachingEmergencyVehicleEvent::NO_APPROACHING_ERV</a>);</div>
<div class="line"><a id="l01586" name="l01586"></a><span class="lineno"> 1586</span>          <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a529d40caad413492d989ab91eb48fdb6">has_planned_upcoming_lc_</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l01587" name="l01587"></a><span class="lineno"> 1587</span>        }</div>
<div class="line"><a id="l01588" name="l01588"></a><span class="lineno"> 1588</span>        <span class="keywordflow">else</span> <span class="keywordflow">if</span>((0.0 &lt;= <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a676b5bf0f041728d2413650885c9bd36">tracked_erv_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1ErvInformation.html#a54055d98a4a44a8b89d7e69b1c161f0b">seconds_until_passing</a>) &amp;&amp; (<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a676b5bf0f041728d2413650885c9bd36">tracked_erv_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1ErvInformation.html#a54055d98a4a44a8b89d7e69b1c161f0b">seconds_until_passing</a> &lt;= <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">config_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a78537e382e029464ea6fa1d1e9053cd5">approaching_threshold</a>)){</div>
<div class="line"><a id="l01589" name="l01589"></a><span class="lineno"> 1589</span>          <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a36f8f9b65fe9f2ebe9bbb09f3b1e2d8e">transition_table_</a>.<a class="code hl_function" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehicleTransitionTable.html#a8e2158634e7011225335a2674e08f305">event</a>(<a class="code hl_enumvalue" href="namespaceapproaching__emergency__vehicle__plugin.html#ae26e1cd128942ddf2ca8eccadb66a6caadd2ba763284319f7c1bc17f2a0a9df15">ApproachingEmergencyVehicleEvent::APPROACHING_ERV_NOT_IN_PATH</a>);</div>
<div class="line"><a id="l01590" name="l01590"></a><span class="lineno"> 1590</span>        }</div>
<div class="line"><a id="l01591" name="l01591"></a><span class="lineno"> 1591</span>        <span class="keywordflow">else</span>{</div>
<div class="line"><a id="l01592" name="l01592"></a><span class="lineno"> 1592</span>          RCLCPP_WARN_STREAM(rclcpp::get_logger(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6d19969dc5f588661e25aa3575127405">logger_name</a>), <span class="stringliteral">&quot;Unsupported seconds_until_passing of &quot;</span> &lt;&lt; <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a676b5bf0f041728d2413650885c9bd36">tracked_erv_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1ErvInformation.html#a54055d98a4a44a8b89d7e69b1c161f0b">seconds_until_passing</a> &lt;&lt; <span class="stringliteral">&quot;, returning empty maneuver plan&quot;</span>);</div>
<div class="line"><a id="l01593" name="l01593"></a><span class="lineno"> 1593</span>          resp-&gt;new_plan.maneuvers = {};</div>
<div class="line"><a id="l01594" name="l01594"></a><span class="lineno"> 1594</span>          <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01595" name="l01595"></a><span class="lineno"> 1595</span>        }</div>
<div class="line"><a id="l01596" name="l01596"></a><span class="lineno"> 1596</span>      }</div>
<div class="line"><a id="l01597" name="l01597"></a><span class="lineno"> 1597</span>    }</div>
<div class="line"><a id="l01598" name="l01598"></a><span class="lineno"> 1598</span> </div>
<div class="line"><a id="l01599" name="l01599"></a><span class="lineno"> 1599</span>    <span class="comment">// Set initial maneuver plan parameters based on the ego vehicle&#39;s initial state</span></div>
<div class="line"><a id="l01600" name="l01600"></a><span class="lineno"> 1600</span>    <span class="keywordtype">double</span> downtrack_progress = req-&gt;veh_downtrack;</div>
<div class="line"><a id="l01601" name="l01601"></a><span class="lineno"> 1601</span>    <span class="keywordtype">double</span> current_lanelet_ending_downtrack = <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a61b742aab762fff7983b3a1bf1a148b1">wm_</a>-&gt;routeTrackPos(ego_current_lanelet_optional.get().centerline2d().back()).downtrack;</div>
<div class="line"><a id="l01602" name="l01602"></a><span class="lineno"> 1602</span>    <span class="keywordtype">double</span> speed_progress = req-&gt;veh_logitudinal_velocity;</div>
<div class="line"><a id="l01603" name="l01603"></a><span class="lineno"> 1603</span>    <span class="keywordtype">double</span> target_speed = <a class="code hl_function" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#ac057c7b9bb7723c2089604dd3776c8e9">getLaneletSpeedLimit</a>(ego_current_lanelet_optional.get()); </div>
<div class="line"><a id="l01604" name="l01604"></a><span class="lineno"> 1604</span>    rclcpp::Time time_progress = rclcpp::Time(req-&gt;header.stamp);</div>
<div class="line"><a id="l01605" name="l01605"></a><span class="lineno"> 1605</span> </div>
<div class="line"><a id="l01606" name="l01606"></a><span class="lineno"> 1606</span>    <span class="comment">// Generate maneuver plan based on the current state</span></div>
<div class="line"><a id="l01607" name="l01607"></a><span class="lineno"> 1607</span>    <span class="keywordflow">switch</span> (<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a36f8f9b65fe9f2ebe9bbb09f3b1e2d8e">transition_table_</a>.<a class="code hl_function" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehicleTransitionTable.html#a4c74448ef5d30dcda8bbc4fecf054199">getState</a>())</div>
<div class="line"><a id="l01608" name="l01608"></a><span class="lineno"> 1608</span>    {</div>
<div class="line"><a id="l01609" name="l01609"></a><span class="lineno"> 1609</span>      <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="namespaceapproaching__emergency__vehicle__plugin.html#aeb182d0e6c9d53e276e1b9935aff0630a3dc495a5c3931df7278a227f93d6b70a">ApproachingEmergencyVehicleState::NO_APPROACHING_ERV</a>:</div>
<div class="line"><a id="l01610" name="l01610"></a><span class="lineno"> 1610</span>        resp-&gt;new_plan.maneuvers = {};</div>
<div class="line"><a id="l01611" name="l01611"></a><span class="lineno"> 1611</span>        RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6d19969dc5f588661e25aa3575127405">logger_name</a>), <span class="stringliteral">&quot;No approaching ERV. Returning empty maneuver plan&quot;</span>);</div>
<div class="line"><a id="l01612" name="l01612"></a><span class="lineno"> 1612</span>        <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#affd5c4e6991e268409a8a021be436347">is_maintaining_non_reduced_speed_</a> = <span class="keyword">false</span>; <span class="comment">// Reset flag since ego vehicle does not need to maintain a non-reduced speed</span></div>
<div class="line"><a id="l01613" name="l01613"></a><span class="lineno"> 1613</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01614" name="l01614"></a><span class="lineno"> 1614</span> </div>
<div class="line"><a id="l01615" name="l01615"></a><span class="lineno"> 1615</span>      <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="namespaceapproaching__emergency__vehicle__plugin.html#aeb182d0e6c9d53e276e1b9935aff0630a0773e3336b946c578edbc4f3768a93e2">ApproachingEmergencyVehicleState::MOVING_OVER_FOR_APPROACHING_ERV</a>:</div>
<div class="line"><a id="l01616" name="l01616"></a><span class="lineno"> 1616</span>        <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#affd5c4e6991e268409a8a021be436347">is_maintaining_non_reduced_speed_</a> = <span class="keyword">false</span>; <span class="comment">// Reset flag since ego vehicle does not need to maintain a non-reduced speed</span></div>
<div class="line"><a id="l01617" name="l01617"></a><span class="lineno"> 1617</span> </div>
<div class="line"><a id="l01618" name="l01618"></a><span class="lineno"> 1618</span>        <a class="code hl_function" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a211bba5a4b60a28a9ba882262628f653">generateMoveOverManeuverPlan</a>(resp, ego_current_lanelet_optional.get(), downtrack_progress, current_lanelet_ending_downtrack, speed_progress,</div>
<div class="line"><a id="l01619" name="l01619"></a><span class="lineno"> 1619</span>                                        target_speed, time_progress, <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a79f461d7ccc9669dc1b63a1826652861">ego_lane_index_</a>, <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a676b5bf0f041728d2413650885c9bd36">tracked_erv_</a>.<a class="code hl_variable" href="structapproaching__emergency__vehicle__plugin_1_1ErvInformation.html#ac34d23f97859c1239886108d1e8c7828">lane_index</a>);</div>
<div class="line"><a id="l01620" name="l01620"></a><span class="lineno"> 1620</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01621" name="l01621"></a><span class="lineno"> 1621</span> </div>
<div class="line"><a id="l01622" name="l01622"></a><span class="lineno"> 1622</span>      <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="namespaceapproaching__emergency__vehicle__plugin.html#aeb182d0e6c9d53e276e1b9935aff0630abe5a505910aae73e4a99392e4b36e99a">ApproachingEmergencyVehicleState::SLOWING_DOWN_FOR_ERV</a>:</div>
<div class="line"><a id="l01623" name="l01623"></a><span class="lineno"> 1623</span>        <span class="comment">// Generate a maneuver plan consisting of only lane-following maneuvers at a reduced speed since the ERV is actively passing the ego vehicle</span></div>
<div class="line"><a id="l01624" name="l01624"></a><span class="lineno"> 1624</span>        <a class="code hl_function" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a868b40d4e5aa64b34aae8ef5a6ae967a">generateReducedSpeedLaneFollowingeManeuverPlan</a>(resp, ego_current_lanelet_optional.get(), downtrack_progress, current_lanelet_ending_downtrack, speed_progress,</div>
<div class="line"><a id="l01625" name="l01625"></a><span class="lineno"> 1625</span>                                        target_speed, time_progress, <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#affd5c4e6991e268409a8a021be436347">is_maintaining_non_reduced_speed_</a>);</div>
<div class="line"><a id="l01626" name="l01626"></a><span class="lineno"> 1626</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01627" name="l01627"></a><span class="lineno"> 1627</span> </div>
<div class="line"><a id="l01628" name="l01628"></a><span class="lineno"> 1628</span>      <span class="keywordflow">default</span>:</div>
<div class="line"><a id="l01629" name="l01629"></a><span class="lineno"> 1629</span>        <span class="keywordflow">throw</span> std::invalid_argument(<span class="stringliteral">&quot;Transition table in unsupported state&quot;</span>);</div>
<div class="line"><a id="l01630" name="l01630"></a><span class="lineno"> 1630</span>    }</div>
<div class="line"><a id="l01631" name="l01631"></a><span class="lineno"> 1631</span> </div>
<div class="line"><a id="l01632" name="l01632"></a><span class="lineno"> 1632</span>    <a class="code hl_variable" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a9dd99137e46dfb95193ac1df49ef5f83">latest_maneuver_plan_</a> = resp-&gt;new_plan;</div>
<div class="line"><a id="l01633" name="l01633"></a><span class="lineno"> 1633</span>  }</div>
<div class="line"><a id="l01634" name="l01634"></a><span class="lineno"> 1634</span> </div>
<div class="line"><a id="l01635" name="l01635"></a><span class="lineno"><a class="line" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a663bbbbe050b3ba7809a665020836c27"> 1635</a></span>  <span class="keywordtype">bool</span> <a class="code hl_function" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a663bbbbe050b3ba7809a665020836c27">ApproachingEmergencyVehiclePlugin::get_availability</a>() {</div>
<div class="line"><a id="l01636" name="l01636"></a><span class="lineno"> 1636</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l01637" name="l01637"></a><span class="lineno"> 1637</span>  }</div>
<div class="line"><a id="l01638" name="l01638"></a><span class="lineno"> 1638</span> </div>
<div class="line"><a id="l01639" name="l01639"></a><span class="lineno"><a class="line" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#af3ddadb216959847a028b24f5fa0fff0"> 1639</a></span>  std::string <a class="code hl_function" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#af3ddadb216959847a028b24f5fa0fff0">ApproachingEmergencyVehiclePlugin::get_version_id</a>() {</div>
<div class="line"><a id="l01640" name="l01640"></a><span class="lineno"> 1640</span>    <span class="keywordflow">return</span> <span class="stringliteral">&quot;v1.0&quot;</span>;</div>
<div class="line"><a id="l01641" name="l01641"></a><span class="lineno"> 1641</span>  }</div>
<div class="line"><a id="l01642" name="l01642"></a><span class="lineno"> 1642</span> </div>
<div class="line"><a id="l01643" name="l01643"></a><span class="lineno"> 1643</span>} <span class="comment">// approaching_emergency_vehicle_plugin</span></div>
<div class="line"><a id="l01644" name="l01644"></a><span class="lineno"> 1644</span> </div>
<div class="line"><a id="l01645" name="l01645"></a><span class="lineno"> 1645</span><span class="preprocessor">#include &quot;rclcpp_components/register_node_macro.hpp&quot;</span></div>
<div class="line"><a id="l01646" name="l01646"></a><span class="lineno"> 1646</span> </div>
<div class="line"><a id="l01647" name="l01647"></a><span class="lineno"> 1647</span><span class="comment">// Register the component with class_loader</span></div>
<div class="line"><a id="l01648" name="l01648"></a><span class="lineno"> 1648</span>RCLCPP_COMPONENTS_REGISTER_NODE(<a class="code hl_class" href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html">approaching_emergency_vehicle_plugin::ApproachingEmergencyVehiclePlugin</a>)</div>
<div class="ttc" id="aapproaching__emergency__vehicle__plugin__node_8hpp_html"><div class="ttname"><a href="approaching__emergency__vehicle__plugin__node_8hpp.html">approaching_emergency_vehicle_plugin_node.hpp</a></div></div>
<div class="ttc" id="aapproaching__emergency__vehicle__plugin__node_8hpp_html_a066f948508e087006568cb6c9b0674a7"><div class="ttname"><a href="approaching__emergency__vehicle__plugin__node_8hpp.html#a066f948508e087006568cb6c9b0674a7">GET_MANEUVER_PROPERTY</a></div><div class="ttdeci">#define GET_MANEUVER_PROPERTY(mvr, property)</div><div class="ttdoc">Macro definition to enable easier access to fields shared across the maneuver types.</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8hpp_source.html#l00054">approaching_emergency_vehicle_plugin_node.hpp:54</a></div></div>
<div class="ttc" id="aclassapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin_html"><div class="ttname"><a href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html">approaching_emergency_vehicle_plugin::ApproachingEmergencyVehiclePlugin</a></div><div class="ttdoc">Class that implements the Approaching Emergency Vehicle Plugin (ERV) strategic plugin....</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8hpp_source.html#l00110">approaching_emergency_vehicle_plugin_node.hpp:111</a></div></div>
<div class="ttc" id="aclassapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin_html_a094474a9865cfbf427db6712038c1598"><div class="ttname"><a href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a094474a9865cfbf427db6712038c1598">approaching_emergency_vehicle_plugin::ApproachingEmergencyVehiclePlugin::twist_sub_</a></div><div class="ttdeci">carma_ros2_utils::SubPtr&lt; geometry_msgs::msg::TwistStamped &gt; twist_sub_</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8hpp_source.html#l00121">approaching_emergency_vehicle_plugin_node.hpp:121</a></div></div>
<div class="ttc" id="aclassapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin_html_a0c9d768f2ccafe7878f63bcf26be2531"><div class="ttname"><a href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a0c9d768f2ccafe7878f63bcf26be2531">approaching_emergency_vehicle_plugin::ApproachingEmergencyVehiclePlugin::has_broadcasted_warning_messages_</a></div><div class="ttdeci">bool has_broadcasted_warning_messages_</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8hpp_source.html#l00396">approaching_emergency_vehicle_plugin_node.hpp:396</a></div></div>
<div class="ttc" id="aclassapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin_html_a0f62756c7dc36020b71d584066065743"><div class="ttname"><a href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a0f62756c7dc36020b71d584066065743">approaching_emergency_vehicle_plugin::ApproachingEmergencyVehiclePlugin::getRouteIntersectingLanelet</a></div><div class="ttdeci">boost::optional&lt; lanelet::ConstLanelet &gt; getRouteIntersectingLanelet(const lanelet::routing::Route &amp;erv_future_route)</div><div class="ttdoc">Helper function to obtain the earliest lanelet that exists on both an ERV's future route and the ego ...</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8cpp_source.html#l00944">approaching_emergency_vehicle_plugin_node.cpp:944</a></div></div>
<div class="ttc" id="aclassapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin_html_a0f6b68218b4b0b130f8d14e5610b8980"><div class="ttname"><a href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a0f6b68218b4b0b130f8d14e5610b8980">approaching_emergency_vehicle_plugin::ApproachingEmergencyVehiclePlugin::parameter_update_callback</a></div><div class="ttdeci">rcl_interfaces::msg::SetParametersResult parameter_update_callback(const std::vector&lt; rclcpp::Parameter &gt; &amp;parameters)</div><div class="ttdoc">Callback for dynamic parameter updates.</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8cpp_source.html#l00075">approaching_emergency_vehicle_plugin_node.cpp:75</a></div></div>
<div class="ttc" id="aclassapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin_html_a0ff341dde225f7a9c2998ff6ca667380"><div class="ttname"><a href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a0ff341dde225f7a9c2998ff6ca667380">approaching_emergency_vehicle_plugin::ApproachingEmergencyVehiclePlugin::route_sub_</a></div><div class="ttdeci">carma_ros2_utils::SubPtr&lt; carma_planning_msgs::msg::Route &gt; route_sub_</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8hpp_source.html#l00127">approaching_emergency_vehicle_plugin_node.hpp:127</a></div></div>
<div class="ttc" id="aclassapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin_html_a179dc5d96a5f9c0a775cdcd5a11df346"><div class="ttname"><a href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a179dc5d96a5f9c0a775cdcd5a11df346">approaching_emergency_vehicle_plugin::ApproachingEmergencyVehiclePlugin::publishApproachingErvStatus</a></div><div class="ttdeci">void publishApproachingErvStatus()</div><div class="ttdoc">This is a callback function for the approaching_emergency_vehicle_status_timer_. It makes a call to g...</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8cpp_source.html#l00274">approaching_emergency_vehicle_plugin_node.cpp:274</a></div></div>
<div class="ttc" id="aclassapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin_html_a17ee49842e3def04d87e6318ab477fb2"><div class="ttname"><a href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a17ee49842e3def04d87e6318ab477fb2">approaching_emergency_vehicle_plugin::ApproachingEmergencyVehiclePlugin::getManeuverDuration</a></div><div class="ttdeci">rclcpp::Duration getManeuverDuration(const carma_planning_msgs::msg::Maneuver &amp;maneuver, double epsilon) const</div><div class="ttdoc">Helper function to obtain the (seconds) of a provided maneuver.</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8cpp_source.html#l01032">approaching_emergency_vehicle_plugin_node.cpp:1032</a></div></div>
<div class="ttc" id="aclassapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin_html_a1bd11a952f02b0438dc2ccdb2be84fd7"><div class="ttname"><a href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a1bd11a952f02b0438dc2ccdb2be84fd7">approaching_emergency_vehicle_plugin::ApproachingEmergencyVehiclePlugin::incoming_emergency_vehicle_ack_sub_</a></div><div class="ttdeci">carma_ros2_utils::SubPtr&lt; carma_v2x_msgs::msg::EmergencyVehicleAck &gt; incoming_emergency_vehicle_ack_sub_</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8hpp_source.html#l00123">approaching_emergency_vehicle_plugin_node.hpp:123</a></div></div>
<div class="ttc" id="aclassapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin_html_a1d4bc5024634987d7de58ae0ea86e215"><div class="ttname"><a href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a1d4bc5024634987d7de58ae0ea86e215">approaching_emergency_vehicle_plugin::ApproachingEmergencyVehiclePlugin::hazard_light_cmd_pub_</a></div><div class="ttdeci">carma_ros2_utils::PubPtr&lt; std_msgs::msg::Bool &gt; hazard_light_cmd_pub_</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8hpp_source.html#l00134">approaching_emergency_vehicle_plugin_node.hpp:134</a></div></div>
<div class="ttc" id="aclassapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin_html_a205bc91715867790de8d53f07c998a5f"><div class="ttname"><a href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a205bc91715867790de8d53f07c998a5f">approaching_emergency_vehicle_plugin::ApproachingEmergencyVehiclePlugin::on_activate_plugin</a></div><div class="ttdeci">carma_ros2_utils::CallbackReturn on_activate_plugin()</div><div class="ttdoc">This method is used to create a timer and will be called on the activate transition.</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8cpp_source.html#l00189">approaching_emergency_vehicle_plugin_node.cpp:189</a></div></div>
<div class="ttc" id="aclassapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin_html_a211bba5a4b60a28a9ba882262628f653"><div class="ttname"><a href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a211bba5a4b60a28a9ba882262628f653">approaching_emergency_vehicle_plugin::ApproachingEmergencyVehiclePlugin::generateMoveOverManeuverPlan</a></div><div class="ttdeci">void generateMoveOverManeuverPlan(carma_planning_msgs::srv::PlanManeuvers::Response::SharedPtr resp, lanelet::ConstLanelet current_lanelet, double downtrack_progress, double current_lanelet_ending_downtrack, double speed_progress, double target_speed, rclcpp::Time time_progress, int ego_lane_index, int erv_lane_index)</div><div class="ttdoc">Function to generate a maneuver plan when the ego vehicle must change lanes due to being in the MOVIN...</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8cpp_source.html#l01295">approaching_emergency_vehicle_plugin_node.cpp:1295</a></div></div>
<div class="ttc" id="aclassapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin_html_a2195e788f403f7fd401ef4f45fdf5d76"><div class="ttname"><a href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a2195e788f403f7fd401ef4f45fdf5d76">approaching_emergency_vehicle_plugin::ApproachingEmergencyVehiclePlugin::is_guidance_engaged_</a></div><div class="ttdeci">bool is_guidance_engaged_</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8hpp_source.html#l00441">approaching_emergency_vehicle_plugin_node.hpp:441</a></div></div>
<div class="ttc" id="aclassapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin_html_a2aab26ef3fcf308380b14a034b5963b8"><div class="ttname"><a href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a2aab26ef3fcf308380b14a034b5963b8">approaching_emergency_vehicle_plugin::ApproachingEmergencyVehiclePlugin::map_projector_</a></div><div class="ttdeci">boost::optional&lt; std::string &gt; map_projector_</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8hpp_source.html#l00450">approaching_emergency_vehicle_plugin_node.hpp:450</a></div></div>
<div class="ttc" id="aclassapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin_html_a2b2e55868ad43d0a08fccc9e4c188443"><div class="ttname"><a href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a2b2e55868ad43d0a08fccc9e4c188443">approaching_emergency_vehicle_plugin::ApproachingEmergencyVehiclePlugin::generateErvRoute</a></div><div class="ttdeci">lanelet::Optional&lt; lanelet::routing::Route &gt; generateErvRoute(double current_latitude, double current_longitude, std::vector&lt; carma_v2x_msgs::msg::Position3D &gt; erv_destination_points)</div><div class="ttdoc">Helper function to generate an ERV's route based on its current position and its future route destina...</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8cpp_source.html#l00633">approaching_emergency_vehicle_plugin_node.cpp:633</a></div></div>
<div class="ttc" id="aclassapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin_html_a2ca981bae82972205b3877b06054d09d"><div class="ttname"><a href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a2ca981bae82972205b3877b06054d09d">approaching_emergency_vehicle_plugin::ApproachingEmergencyVehiclePlugin::upcoming_lc_params_</a></div><div class="ttdeci">UpcomingLaneChangeParameters upcoming_lc_params_</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8hpp_source.html#l00416">approaching_emergency_vehicle_plugin_node.hpp:416</a></div></div>
<div class="ttc" id="aclassapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin_html_a30c5c0501e991b36887ce37fea83d8ab"><div class="ttname"><a href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a30c5c0501e991b36887ce37fea83d8ab">approaching_emergency_vehicle_plugin::ApproachingEmergencyVehiclePlugin::incoming_bsm_sub_</a></div><div class="ttdeci">carma_ros2_utils::SubPtr&lt; carma_v2x_msgs::msg::BSM &gt; incoming_bsm_sub_</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8hpp_source.html#l00115">approaching_emergency_vehicle_plugin_node.hpp:115</a></div></div>
<div class="ttc" id="aclassapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin_html_a313a23c801916d4e005326e2dcd7d57f"><div class="ttname"><a href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a313a23c801916d4e005326e2dcd7d57f">approaching_emergency_vehicle_plugin::ApproachingEmergencyVehiclePlugin::broadcastWarningToErv</a></div><div class="ttdeci">void broadcastWarningToErv()</div><div class="ttdoc">This is a callback function for the warning_broadcast_timer_, and is called to broadcast an Emergency...</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8cpp_source.html#l00249">approaching_emergency_vehicle_plugin_node.cpp:249</a></div></div>
<div class="ttc" id="aclassapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin_html_a34b6121fd1201177d180f616f635a260"><div class="ttname"><a href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a34b6121fd1201177d180f616f635a260">approaching_emergency_vehicle_plugin::ApproachingEmergencyVehiclePlugin::erv_world_model_</a></div><div class="ttdeci">std::shared_ptr&lt; carma_wm::CARMAWorldModel &gt; erv_world_model_</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8hpp_source.html#l00470">approaching_emergency_vehicle_plugin_node.hpp:470</a></div></div>
<div class="ttc" id="aclassapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin_html_a34d39426c0a919ae1bd003dccb4e7ac0"><div class="ttname"><a href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a34d39426c0a919ae1bd003dccb4e7ac0">approaching_emergency_vehicle_plugin::ApproachingEmergencyVehiclePlugin::composeLaneFollowingManeuverMessage</a></div><div class="ttdeci">carma_planning_msgs::msg::Maneuver composeLaneFollowingManeuverMessage(double start_dist, double end_dist, double start_speed, double target_speed, int lanelet_id, rclcpp::Time &amp;start_time) const</div><div class="ttdoc">Function to compose a lane following maneuver message based on the provided maneuver parameters.</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8cpp_source.html#l01053">approaching_emergency_vehicle_plugin_node.cpp:1053</a></div></div>
<div class="ttc" id="aclassapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin_html_a36f8f9b65fe9f2ebe9bbb09f3b1e2d8e"><div class="ttname"><a href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a36f8f9b65fe9f2ebe9bbb09f3b1e2d8e">approaching_emergency_vehicle_plugin::ApproachingEmergencyVehiclePlugin::transition_table_</a></div><div class="ttdeci">ApproachingEmergencyVehicleTransitionTable transition_table_</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8hpp_source.html#l00367">approaching_emergency_vehicle_plugin_node.hpp:367</a></div></div>
<div class="ttc" id="aclassapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin_html_a3d4f7411cbacc2aa4b5ffc0eac18e72d"><div class="ttname"><a href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a3d4f7411cbacc2aa4b5ffc0eac18e72d">approaching_emergency_vehicle_plugin::ApproachingEmergencyVehiclePlugin::approaching_erv_status_pub_</a></div><div class="ttdeci">carma_ros2_utils::PubPtr&lt; carma_msgs::msg::UIInstructions &gt; approaching_erv_status_pub_</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8hpp_source.html#l00132">approaching_emergency_vehicle_plugin_node.hpp:132</a></div></div>
<div class="ttc" id="aclassapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin_html_a47e5e1d18269f94b5090ba65a6e70f89"><div class="ttname"><a href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a47e5e1d18269f94b5090ba65a6e70f89">approaching_emergency_vehicle_plugin::ApproachingEmergencyVehiclePlugin::epsilon_</a></div><div class="ttdeci">double epsilon_</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8hpp_source.html#l00473">approaching_emergency_vehicle_plugin_node.hpp:473</a></div></div>
<div class="ttc" id="aclassapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin_html_a4a69c80c2408d169a77507645d624343"><div class="ttname"><a href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a4a69c80c2408d169a77507645d624343">approaching_emergency_vehicle_plugin::ApproachingEmergencyVehiclePlugin::checkForErvTimeout</a></div><div class="ttdeci">void checkForErvTimeout()</div><div class="ttdoc">This is a callback function for the erv_timeout_timer_ timer, and is called to determine whether a ti...</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8cpp_source.html#l00235">approaching_emergency_vehicle_plugin_node.cpp:235</a></div></div>
<div class="ttc" id="aclassapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin_html_a4c0612d6eb08db90723028f4c4ca362f"><div class="ttname"><a href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a4c0612d6eb08db90723028f4c4ca362f">approaching_emergency_vehicle_plugin::ApproachingEmergencyVehiclePlugin::getLaneletOnEgoRouteFromMapPosition</a></div><div class="ttdeci">boost::optional&lt; lanelet::ConstLanelet &gt; getLaneletOnEgoRouteFromMapPosition(const double &amp;x_position, const double &amp;y_position)</div><div class="ttdoc">Helper function to convert a map x,y coordinate pair to a lanelet on the ego vehicle's route.</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8cpp_source.html#l01484">approaching_emergency_vehicle_plugin_node.cpp:1484</a></div></div>
<div class="ttc" id="aclassapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin_html_a4f1b5bd8daf268649c0186920c7ae545"><div class="ttname"><a href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a4f1b5bd8daf268649c0186920c7ae545">approaching_emergency_vehicle_plugin::ApproachingEmergencyVehiclePlugin::MAINTAIN_SPEED_THRESHOLD</a></div><div class="ttdeci">const double MAINTAIN_SPEED_THRESHOLD</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8hpp_source.html#l00429">approaching_emergency_vehicle_plugin_node.hpp:429</a></div></div>
<div class="ttc" id="aclassapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin_html_a529d40caad413492d989ab91eb48fdb6"><div class="ttname"><a href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a529d40caad413492d989ab91eb48fdb6">approaching_emergency_vehicle_plugin::ApproachingEmergencyVehiclePlugin::has_planned_upcoming_lc_</a></div><div class="ttdeci">bool has_planned_upcoming_lc_</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8hpp_source.html#l00420">approaching_emergency_vehicle_plugin_node.hpp:420</a></div></div>
<div class="ttc" id="aclassapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin_html_a560e6c05f72babed450ae10727d85af5"><div class="ttname"><a href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a560e6c05f72babed450ae10727d85af5">approaching_emergency_vehicle_plugin::ApproachingEmergencyVehiclePlugin::config_</a></div><div class="ttdeci">Config config_</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8hpp_source.html#l00364">approaching_emergency_vehicle_plugin_node.hpp:364</a></div></div>
<div class="ttc" id="aclassapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin_html_a595311fe524963efff473b1aa6212d68"><div class="ttname"><a href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a595311fe524963efff473b1aa6212d68">approaching_emergency_vehicle_plugin::ApproachingEmergencyVehiclePlugin::georeference_sub_</a></div><div class="ttdeci">carma_ros2_utils::SubPtr&lt; std_msgs::msg::String &gt; georeference_sub_</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8hpp_source.html#l00117">approaching_emergency_vehicle_plugin_node.hpp:117</a></div></div>
<div class="ttc" id="aclassapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin_html_a5f4cb3c7b1c37290745bcba2f8e3c603"><div class="ttname"><a href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a5f4cb3c7b1c37290745bcba2f8e3c603">approaching_emergency_vehicle_plugin::ApproachingEmergencyVehiclePlugin::addStopAndWaitToEndOfPlan</a></div><div class="ttdeci">void addStopAndWaitToEndOfPlan(carma_planning_msgs::srv::PlanManeuvers::Response::SharedPtr resp, double downtrack_progress, double stop_maneuver_beginning_downtrack, double end_of_route_downtrack, double stopping_entry_speed, double stopping_deceleration, double current_lanelet_ending_downtrack, lanelet::ConstLanelet current_lanelet, rclcpp::Time time_progress)</div><div class="ttdoc">Function to add a stop and wait maneuver to the end of the maneuver plan contained in the provided 'r...</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8cpp_source.html#l01150">approaching_emergency_vehicle_plugin_node.cpp:1150</a></div></div>
<div class="ttc" id="aclassapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin_html_a61b742aab762fff7983b3a1bf1a148b1"><div class="ttname"><a href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a61b742aab762fff7983b3a1bf1a148b1">approaching_emergency_vehicle_plugin::ApproachingEmergencyVehiclePlugin::wm_</a></div><div class="ttdeci">carma_wm::WorldModelConstPtr wm_</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8hpp_source.html#l00564">approaching_emergency_vehicle_plugin_node.hpp:564</a></div></div>
<div class="ttc" id="aclassapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin_html_a64b2e3d4c85214a564d689882a2506b3"><div class="ttname"><a href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a64b2e3d4c85214a564d689882a2506b3">approaching_emergency_vehicle_plugin::ApproachingEmergencyVehiclePlugin::ApproachingEmergencyVehiclePlugin</a></div><div class="ttdeci">ApproachingEmergencyVehiclePlugin(const rclcpp::NodeOptions &amp;)</div><div class="ttdoc">ApproachingEmergencyVehiclePlugin constructor.</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8cpp_source.html#l00041">approaching_emergency_vehicle_plugin_node.cpp:41</a></div></div>
<div class="ttc" id="aclassapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin_html_a663bbbbe050b3ba7809a665020836c27"><div class="ttname"><a href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a663bbbbe050b3ba7809a665020836c27">approaching_emergency_vehicle_plugin::ApproachingEmergencyVehiclePlugin::get_availability</a></div><div class="ttdeci">bool get_availability() override</div><div class="ttdoc">Get the availability status of this plugin based on the current operating environment....</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8cpp_source.html#l01635">approaching_emergency_vehicle_plugin_node.cpp:1635</a></div></div>
<div class="ttc" id="aclassapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin_html_a66731fd9e4c54bcf32d9d00b666bf955"><div class="ttname"><a href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a66731fd9e4c54bcf32d9d00b666bf955">approaching_emergency_vehicle_plugin::ApproachingEmergencyVehiclePlugin::on_configure_plugin</a></div><div class="ttdeci">carma_ros2_utils::CallbackReturn on_configure_plugin()</div><div class="ttdoc">This method is used to load parameters and will be called on the configure state transition.</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8cpp_source.html#l00117">approaching_emergency_vehicle_plugin_node.cpp:117</a></div></div>
<div class="ttc" id="aclassapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin_html_a676b5bf0f041728d2413650885c9bd36"><div class="ttname"><a href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a676b5bf0f041728d2413650885c9bd36">approaching_emergency_vehicle_plugin::ApproachingEmergencyVehiclePlugin::tracked_erv_</a></div><div class="ttdeci">ErvInformation tracked_erv_</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8hpp_source.html#l00370">approaching_emergency_vehicle_plugin_node.hpp:370</a></div></div>
<div class="ttc" id="aclassapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin_html_a69840d1c02ccdf825a638165e40a1ece"><div class="ttname"><a href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a69840d1c02ccdf825a638165e40a1ece">approaching_emergency_vehicle_plugin::ApproachingEmergencyVehiclePlugin::non_reduced_speed_to_maintain_</a></div><div class="ttdeci">double non_reduced_speed_to_maintain_</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8hpp_source.html#l00438">approaching_emergency_vehicle_plugin_node.hpp:438</a></div></div>
<div class="ttc" id="aclassapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin_html_a6c454433ce5dedbf0f32bfb38f1404ed"><div class="ttname"><a href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6c454433ce5dedbf0f32bfb38f1404ed">approaching_emergency_vehicle_plugin::ApproachingEmergencyVehiclePlugin::has_tracked_erv_</a></div><div class="ttdeci">bool has_tracked_erv_</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8hpp_source.html#l00375">approaching_emergency_vehicle_plugin_node.hpp:375</a></div></div>
<div class="ttc" id="aclassapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin_html_a6d19969dc5f588661e25aa3575127405"><div class="ttname"><a href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a6d19969dc5f588661e25aa3575127405">approaching_emergency_vehicle_plugin::ApproachingEmergencyVehiclePlugin::logger_name</a></div><div class="ttdeci">std::string logger_name</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8hpp_source.html#l00464">approaching_emergency_vehicle_plugin_node.hpp:464</a></div></div>
<div class="ttc" id="aclassapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin_html_a73cec161f50fc84eda21769703f992c1"><div class="ttname"><a href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a73cec161f50fc84eda21769703f992c1">approaching_emergency_vehicle_plugin::ApproachingEmergencyVehiclePlugin::outgoing_emergency_vehicle_response_pub_</a></div><div class="ttdeci">carma_ros2_utils::PubPtr&lt; carma_v2x_msgs::msg::EmergencyVehicleResponse &gt; outgoing_emergency_vehicle_response_pub_</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8hpp_source.html#l00130">approaching_emergency_vehicle_plugin_node.hpp:130</a></div></div>
<div class="ttc" id="aclassapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin_html_a7476fdeab16d06ec8f63a227c3442509"><div class="ttname"><a href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a7476fdeab16d06ec8f63a227c3442509">approaching_emergency_vehicle_plugin::ApproachingEmergencyVehiclePlugin::routeStateCallback</a></div><div class="ttdeci">void routeStateCallback(carma_planning_msgs::msg::RouteState::UniquePtr msg)</div><div class="ttdoc">Route State subscription callback, with is used to update this plugin's latest_route_state_ object.</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8cpp_source.html#l00985">approaching_emergency_vehicle_plugin_node.cpp:985</a></div></div>
<div class="ttc" id="aclassapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin_html_a76eff02c20d84af747204e3904244be3"><div class="ttname"><a href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a76eff02c20d84af747204e3904244be3">approaching_emergency_vehicle_plugin::ApproachingEmergencyVehiclePlugin::current_speed_</a></div><div class="ttdeci">double current_speed_</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8hpp_source.html#l00456">approaching_emergency_vehicle_plugin_node.hpp:456</a></div></div>
<div class="ttc" id="aclassapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin_html_a79f461d7ccc9669dc1b63a1826652861"><div class="ttname"><a href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a79f461d7ccc9669dc1b63a1826652861">approaching_emergency_vehicle_plugin::ApproachingEmergencyVehiclePlugin::ego_lane_index_</a></div><div class="ttdeci">int ego_lane_index_</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8hpp_source.html#l00378">approaching_emergency_vehicle_plugin_node.hpp:378</a></div></div>
<div class="ttc" id="aclassapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin_html_a7c6d5af8582efd73bf65759b5d94a31b"><div class="ttname"><a href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a7c6d5af8582efd73bf65759b5d94a31b">approaching_emergency_vehicle_plugin::ApproachingEmergencyVehiclePlugin::guidanceStateCallback</a></div><div class="ttdeci">void guidanceStateCallback(const carma_planning_msgs::msg::GuidanceState::UniquePtr msg)</div><div class="ttdoc">Subscription callback to process the latest guidance state and update the is_guidance_engaged_ flag a...</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8cpp_source.html#l00994">approaching_emergency_vehicle_plugin_node.cpp:994</a></div></div>
<div class="ttc" id="aclassapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin_html_a7ef61c32915b20b724e484a9d360bba6"><div class="ttname"><a href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a7ef61c32915b20b724e484a9d360bba6">approaching_emergency_vehicle_plugin::ApproachingEmergencyVehiclePlugin::incomingEmergencyVehicleAckCallback</a></div><div class="ttdeci">void incomingEmergencyVehicleAckCallback(const carma_v2x_msgs::msg::EmergencyVehicleAck::UniquePtr msg)</div><div class="ttdoc">Subscription callback for incoming EmergencyVehicleAck messages. If the message is from the currently...</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8cpp_source.html#l00620">approaching_emergency_vehicle_plugin_node.cpp:620</a></div></div>
<div class="ttc" id="aclassapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin_html_a81a6611597163cc41ba54a8598759091"><div class="ttname"><a href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a81a6611597163cc41ba54a8598759091">approaching_emergency_vehicle_plugin::ApproachingEmergencyVehiclePlugin::composeStopAndWaitManeuverMessage</a></div><div class="ttdeci">carma_planning_msgs::msg::Maneuver composeStopAndWaitManeuverMessage(double start_dist, double end_dist, double start_speed, lanelet::Id starting_lane_id, lanelet::Id ending_lane_id, double stopping_deceleration, rclcpp::Time &amp;start_time) const</div><div class="ttdoc">Function to compose a stop and wait maneuver message based on the provided maneuver parameters.</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8cpp_source.html#l01116">approaching_emergency_vehicle_plugin_node.cpp:1116</a></div></div>
<div class="ttc" id="aclassapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin_html_a856426089b0cbb71bb94001268548652"><div class="ttname"><a href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a856426089b0cbb71bb94001268548652">approaching_emergency_vehicle_plugin::ApproachingEmergencyVehiclePlugin::getSecondsUntilPassing</a></div><div class="ttdeci">boost::optional&lt; double &gt; getSecondsUntilPassing(lanelet::Optional&lt; lanelet::routing::Route &gt; &amp;erv_future_route, const lanelet::BasicPoint2d &amp;erv_position_in_map, const double &amp;erv_current_speed, lanelet::ConstLanelet &amp;intersecting_lanelet)</div><div class="ttdoc">Helper function to calculate the estimated seconds until an ERV will pass the ego vehicle....</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8cpp_source.html#l00883">approaching_emergency_vehicle_plugin_node.cpp:883</a></div></div>
<div class="ttc" id="aclassapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin_html_a85e8e1b36feedaeeccc56f68eb072c4d"><div class="ttname"><a href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a85e8e1b36feedaeeccc56f68eb072c4d">approaching_emergency_vehicle_plugin::ApproachingEmergencyVehiclePlugin::num_warnings_broadcasted_</a></div><div class="ttdeci">int num_warnings_broadcasted_</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8hpp_source.html#l00403">approaching_emergency_vehicle_plugin_node.hpp:403</a></div></div>
<div class="ttc" id="aclassapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin_html_a8686dd7233e4181ec00daf3cfb77c705"><div class="ttname"><a href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a8686dd7233e4181ec00daf3cfb77c705">approaching_emergency_vehicle_plugin::ApproachingEmergencyVehiclePlugin::hazard_light_cmd_</a></div><div class="ttdeci">bool hazard_light_cmd_</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8hpp_source.html#l00423">approaching_emergency_vehicle_plugin_node.hpp:423</a></div></div>
<div class="ttc" id="aclassapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin_html_a868b40d4e5aa64b34aae8ef5a6ae967a"><div class="ttname"><a href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a868b40d4e5aa64b34aae8ef5a6ae967a">approaching_emergency_vehicle_plugin::ApproachingEmergencyVehiclePlugin::generateReducedSpeedLaneFollowingeManeuverPlan</a></div><div class="ttdeci">void generateReducedSpeedLaneFollowingeManeuverPlan(carma_planning_msgs::srv::PlanManeuvers::Response::SharedPtr resp, lanelet::ConstLanelet current_lanelet, double downtrack_progress, double current_lanelet_ending_downtrack, double speed_progress, double target_speed, rclcpp::Time time_progress, bool is_maintaining_non_reduced_speed)</div><div class="ttdoc">Function to generate a maneuver plan when the ego vehicle must remain in its lane due to being in the...</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8cpp_source.html#l01201">approaching_emergency_vehicle_plugin_node.cpp:1201</a></div></div>
<div class="ttc" id="aclassapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin_html_a89890b783f6dd3f5f943b7308afb5ca2"><div class="ttname"><a href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a89890b783f6dd3f5f943b7308afb5ca2">approaching_emergency_vehicle_plugin::ApproachingEmergencyVehiclePlugin::is_same_direction_</a></div><div class="ttdeci">std::unordered_map&lt; std::string, bool &gt; is_same_direction_</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8hpp_source.html#l00444">approaching_emergency_vehicle_plugin_node.hpp:444</a></div></div>
<div class="ttc" id="aclassapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin_html_a92b0b752cbda0de62fd6f5b535aec238"><div class="ttname"><a href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a92b0b752cbda0de62fd6f5b535aec238">approaching_emergency_vehicle_plugin::ApproachingEmergencyVehiclePlugin::publishHazardLightStatus</a></div><div class="ttdeci">void publishHazardLightStatus()</div><div class="ttdoc">This is a callback function for publishing turn ON/OFF (true/false) hazard light command to the ssc d...</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8cpp_source.html#l00218">approaching_emergency_vehicle_plugin_node.cpp:218</a></div></div>
<div class="ttc" id="aclassapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin_html_a957435426e98f4b2b420a5d5c0ddc9c7"><div class="ttname"><a href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a957435426e98f4b2b420a5d5c0ddc9c7">approaching_emergency_vehicle_plugin::ApproachingEmergencyVehiclePlugin::composeLaneChangeManeuverMessage</a></div><div class="ttdeci">carma_planning_msgs::msg::Maneuver composeLaneChangeManeuverMessage(double start_dist, double end_dist, double start_speed, double target_speed, lanelet::Id starting_lane_id, lanelet::Id ending_lane_id, rclcpp::Time &amp;start_time) const</div><div class="ttdoc">Function to compose a lane change maneuver message based on the provided maneuver parameters.</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8cpp_source.html#l01080">approaching_emergency_vehicle_plugin_node.cpp:1080</a></div></div>
<div class="ttc" id="aclassapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin_html_a98318d5a9df6dfd338904e09e3fc273d"><div class="ttname"><a href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a98318d5a9df6dfd338904e09e3fc273d">approaching_emergency_vehicle_plugin::ApproachingEmergencyVehiclePlugin::erv_timeout_timer_</a></div><div class="ttdeci">rclcpp::TimerBase::SharedPtr erv_timeout_timer_</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8hpp_source.html#l00393">approaching_emergency_vehicle_plugin_node.hpp:393</a></div></div>
<div class="ttc" id="aclassapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin_html_a9b9ff2e431bc51b33cf12b95fec17ba8"><div class="ttname"><a href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a9b9ff2e431bc51b33cf12b95fec17ba8">approaching_emergency_vehicle_plugin::ApproachingEmergencyVehiclePlugin::latest_erv_update_times_</a></div><div class="ttdeci">std::unordered_map&lt; std::string, rclcpp::Time &gt; latest_erv_update_times_</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8hpp_source.html#l00447">approaching_emergency_vehicle_plugin_node.hpp:447</a></div></div>
<div class="ttc" id="aclassapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin_html_a9dd99137e46dfb95193ac1df49ef5f83"><div class="ttname"><a href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#a9dd99137e46dfb95193ac1df49ef5f83">approaching_emergency_vehicle_plugin::ApproachingEmergencyVehiclePlugin::latest_maneuver_plan_</a></div><div class="ttdeci">carma_planning_msgs::msg::ManeuverPlan latest_maneuver_plan_</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8hpp_source.html#l00381">approaching_emergency_vehicle_plugin_node.hpp:381</a></div></div>
<div class="ttc" id="aclassapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin_html_aa089a4bd3f2c7e1106439f5e6670c38a"><div class="ttname"><a href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#aa089a4bd3f2c7e1106439f5e6670c38a">approaching_emergency_vehicle_plugin::ApproachingEmergencyVehiclePlugin::getErvPositionInMap</a></div><div class="ttdeci">boost::optional&lt; lanelet::BasicPoint2d &gt; getErvPositionInMap(const double &amp;current_latitude, const double &amp;current_longitude)</div><div class="ttdoc">Helper function to obtain an ERV's position in the map frame from its current latitude and longitude.</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8cpp_source.html#l00371">approaching_emergency_vehicle_plugin_node.cpp:371</a></div></div>
<div class="ttc" id="aclassapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin_html_aa7487cfc92e82c63e0e99c155f384daa"><div class="ttname"><a href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#aa7487cfc92e82c63e0e99c155f384daa">approaching_emergency_vehicle_plugin::ApproachingEmergencyVehiclePlugin::hazard_light_timer_</a></div><div class="ttdeci">rclcpp::TimerBase::SharedPtr hazard_light_timer_</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8hpp_source.html#l00412">approaching_emergency_vehicle_plugin_node.hpp:412</a></div></div>
<div class="ttc" id="aclassapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin_html_aaa56c5f7f80a2f087d52d150d15cf469"><div class="ttname"><a href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#aaa56c5f7f80a2f087d52d150d15cf469">approaching_emergency_vehicle_plugin::ApproachingEmergencyVehiclePlugin::incomingBsmCallback</a></div><div class="ttdeci">void incomingBsmCallback(carma_v2x_msgs::msg::BSM::UniquePtr msg)</div><div class="ttdoc">Incoming BSM subscription callback, which determines whether a BSM should be processed,...</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8cpp_source.html#l00809">approaching_emergency_vehicle_plugin_node.cpp:809</a></div></div>
<div class="ttc" id="aclassapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin_html_aab5aa7ece8a925faed95d97a4c007b23"><div class="ttname"><a href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#aab5aa7ece8a925faed95d97a4c007b23">approaching_emergency_vehicle_plugin::ApproachingEmergencyVehiclePlugin::latest_route_state_</a></div><div class="ttdeci">carma_planning_msgs::msg::RouteState latest_route_state_</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8hpp_source.html#l00453">approaching_emergency_vehicle_plugin_node.hpp:453</a></div></div>
<div class="ttc" id="aclassapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin_html_aad4e194f2513851c1dda17d1bbe0a290"><div class="ttname"><a href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#aad4e194f2513851c1dda17d1bbe0a290">approaching_emergency_vehicle_plugin::ApproachingEmergencyVehiclePlugin::plan_maneuvers_callback</a></div><div class="ttdeci">void plan_maneuvers_callback(std::shared_ptr&lt; rmw_request_id_t &gt;, carma_planning_msgs::srv::PlanManeuvers::Request::SharedPtr req, carma_planning_msgs::srv::PlanManeuvers::Response::SharedPtr resp) override</div><div class="ttdoc">Extending class provided callback which should return a planned trajectory based on the provided traj...</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8cpp_source.html#l01508">approaching_emergency_vehicle_plugin_node.cpp:1508</a></div></div>
<div class="ttc" id="aclassapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin_html_ab39e60f85abebb640a6609b08a4c0c56"><div class="ttname"><a href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#ab39e60f85abebb640a6609b08a4c0c56">approaching_emergency_vehicle_plugin::ApproachingEmergencyVehiclePlugin::route_state_sub_</a></div><div class="ttdeci">carma_ros2_utils::SubPtr&lt; carma_planning_msgs::msg::RouteState &gt; route_state_sub_</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8hpp_source.html#l00119">approaching_emergency_vehicle_plugin_node.hpp:119</a></div></div>
<div class="ttc" id="aclassapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin_html_ac057c7b9bb7723c2089604dd3776c8e9"><div class="ttname"><a href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#ac057c7b9bb7723c2089604dd3776c8e9">approaching_emergency_vehicle_plugin::ApproachingEmergencyVehiclePlugin::getLaneletSpeedLimit</a></div><div class="ttdeci">double getLaneletSpeedLimit(const lanelet::ConstLanelet &amp;lanelet)</div><div class="ttdoc">Helper function to extract the speed limit (m/s) from a provided lanelet.</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8cpp_source.html#l01015">approaching_emergency_vehicle_plugin_node.cpp:1015</a></div></div>
<div class="ttc" id="aclassapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin_html_ac0d01b34e40eac594bb92652acbf7a8e"><div class="ttname"><a href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#ac0d01b34e40eac594bb92652acbf7a8e">approaching_emergency_vehicle_plugin::ApproachingEmergencyVehiclePlugin::filter_points_ahead</a></div><div class="ttdeci">std::vector&lt; lanelet::BasicPoint2d &gt; filter_points_ahead(const lanelet::BasicPoint2d &amp;reference_point, const std::vector&lt; lanelet::BasicPoint2d &gt; &amp;original_points) const</div><div class="ttdoc">Helper function that return points ahead of the given reference point accounting for the list of poin...</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8cpp_source.html#l00737">approaching_emergency_vehicle_plugin_node.cpp:737</a></div></div>
<div class="ttc" id="aclassapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin_html_ac93a5ead1728d2b37a778ce416f80f2b"><div class="ttname"><a href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#ac93a5ead1728d2b37a778ce416f80f2b">approaching_emergency_vehicle_plugin::ApproachingEmergencyVehiclePlugin::getErvInformationFromBsm</a></div><div class="ttdeci">boost::optional&lt; ErvInformation &gt; getErvInformationFromBsm(carma_v2x_msgs::msg::BSM::UniquePtr msg)</div><div class="ttdoc">Through internal logic and calls to separate helper functions, this function processes a received BSM...</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8cpp_source.html#l00401">approaching_emergency_vehicle_plugin_node.cpp:401</a></div></div>
<div class="ttc" id="aclassapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin_html_acc8f2519628142b5c30afab417e28dd7"><div class="ttname"><a href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#acc8f2519628142b5c30afab417e28dd7">approaching_emergency_vehicle_plugin::ApproachingEmergencyVehiclePlugin::strategic_plugin_name_</a></div><div class="ttdeci">std::string strategic_plugin_name_</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8hpp_source.html#l00467">approaching_emergency_vehicle_plugin_node.hpp:467</a></div></div>
<div class="ttc" id="aclassapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin_html_acd5999c8b36406c5768b731e948515a7"><div class="ttname"><a href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#acd5999c8b36406c5768b731e948515a7">approaching_emergency_vehicle_plugin::ApproachingEmergencyVehiclePlugin::routeCallback</a></div><div class="ttdeci">void routeCallback(carma_planning_msgs::msg::Route::UniquePtr msg)</div><div class="ttdoc">Route subscription callback, with is used to update this plugin's future_route_lanelet_ids_ object.</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8cpp_source.html#l01003">approaching_emergency_vehicle_plugin_node.cpp:1003</a></div></div>
<div class="ttc" id="aclassapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin_html_adfbecd63581b2c61f8e7311b9f4ab7bf"><div class="ttname"><a href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#adfbecd63581b2c61f8e7311b9f4ab7bf">approaching_emergency_vehicle_plugin::ApproachingEmergencyVehiclePlugin::twistCallback</a></div><div class="ttdeci">void twistCallback(geometry_msgs::msg::TwistStamped::UniquePtr msg)</div><div class="ttdoc">Subscription callback for the twist subscriber, which will store latest current velocity of the ego v...</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8cpp_source.html#l00990">approaching_emergency_vehicle_plugin_node.cpp:990</a></div></div>
<div class="ttc" id="aclassapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin_html_ae65a1837d9f53d1d6fd7d240eb866585"><div class="ttname"><a href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#ae65a1837d9f53d1d6fd7d240eb866585">approaching_emergency_vehicle_plugin::ApproachingEmergencyVehiclePlugin::should_broadcast_warnings_</a></div><div class="ttdeci">bool should_broadcast_warnings_</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8hpp_source.html#l00400">approaching_emergency_vehicle_plugin_node.hpp:400</a></div></div>
<div class="ttc" id="aclassapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin_html_ae68527687b83a7f7e110227227f4ca86"><div class="ttname"><a href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#ae68527687b83a7f7e110227227f4ca86">approaching_emergency_vehicle_plugin::ApproachingEmergencyVehiclePlugin::guidance_state_sub_</a></div><div class="ttdeci">carma_ros2_utils::SubPtr&lt; carma_planning_msgs::msg::GuidanceState &gt; guidance_state_sub_</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8hpp_source.html#l00125">approaching_emergency_vehicle_plugin_node.hpp:125</a></div></div>
<div class="ttc" id="aclassapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin_html_ae82911dd196e06a718423a36e46599fb"><div class="ttname"><a href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#ae82911dd196e06a718423a36e46599fb">approaching_emergency_vehicle_plugin::ApproachingEmergencyVehiclePlugin::georeferenceCallback</a></div><div class="ttdeci">void georeferenceCallback(const std_msgs::msg::String::UniquePtr msg)</div><div class="ttdoc">Subscription callback for the georeference.</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8cpp_source.html#l00614">approaching_emergency_vehicle_plugin_node.cpp:614</a></div></div>
<div class="ttc" id="aclassapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin_html_aee090b42ea237395e287293d49f63f55"><div class="ttname"><a href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#aee090b42ea237395e287293d49f63f55">approaching_emergency_vehicle_plugin::ApproachingEmergencyVehiclePlugin::approaching_emergency_vehicle_status_timer_</a></div><div class="ttdeci">rclcpp::TimerBase::SharedPtr approaching_emergency_vehicle_status_timer_</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8hpp_source.html#l00409">approaching_emergency_vehicle_plugin_node.hpp:409</a></div></div>
<div class="ttc" id="aclassapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin_html_af3cfbd2bb62c4365b119e8d7630dbc7a"><div class="ttname"><a href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#af3cfbd2bb62c4365b119e8d7630dbc7a">approaching_emergency_vehicle_plugin::ApproachingEmergencyVehiclePlugin::APPROACHING_ERV_STATUS_PARAMS</a></div><div class="ttdeci">const std::string APPROACHING_ERV_STATUS_PARAMS</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8hpp_source.html#l00390">approaching_emergency_vehicle_plugin_node.hpp:390</a></div></div>
<div class="ttc" id="aclassapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin_html_af3ddadb216959847a028b24f5fa0fff0"><div class="ttname"><a href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#af3ddadb216959847a028b24f5fa0fff0">approaching_emergency_vehicle_plugin::ApproachingEmergencyVehiclePlugin::get_version_id</a></div><div class="ttdeci">std::string get_version_id() override</div><div class="ttdoc">Returns the version id of this plugin.</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8cpp_source.html#l01639">approaching_emergency_vehicle_plugin_node.cpp:1639</a></div></div>
<div class="ttc" id="aclassapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin_html_af5fddb700b315c676f4fcd1726dbf689"><div class="ttname"><a href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#af5fddb700b315c676f4fcd1726dbf689">approaching_emergency_vehicle_plugin::ApproachingEmergencyVehiclePlugin::warning_broadcast_timer_</a></div><div class="ttdeci">rclcpp::TimerBase::SharedPtr warning_broadcast_timer_</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8hpp_source.html#l00406">approaching_emergency_vehicle_plugin_node.hpp:406</a></div></div>
<div class="ttc" id="aclassapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin_html_af67c4c7e6f31d34c1b2f0807548a7e1f"><div class="ttname"><a href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#af67c4c7e6f31d34c1b2f0807548a7e1f">approaching_emergency_vehicle_plugin::ApproachingEmergencyVehiclePlugin::generateApproachingErvStatusMessage</a></div><div class="ttdeci">carma_msgs::msg::UIInstructions generateApproachingErvStatusMessage()</div><div class="ttdoc">Function to generate a carma_msgs::msg::UIInstructions message that describes whether there is curren...</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8cpp_source.html#l00280">approaching_emergency_vehicle_plugin_node.cpp:280</a></div></div>
<div class="ttc" id="aclassapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin_html_afbe916ee3589bbffbbd19939fd242a98"><div class="ttname"><a href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#afbe916ee3589bbffbbd19939fd242a98">approaching_emergency_vehicle_plugin::ApproachingEmergencyVehiclePlugin::future_route_lanelet_ids_</a></div><div class="ttdeci">std::vector&lt; int &gt; future_route_lanelet_ids_</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8hpp_source.html#l00461">approaching_emergency_vehicle_plugin_node.hpp:461</a></div></div>
<div class="ttc" id="aclassapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin_html_affd5c4e6991e268409a8a021be436347"><div class="ttname"><a href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehiclePlugin.html#affd5c4e6991e268409a8a021be436347">approaching_emergency_vehicle_plugin::ApproachingEmergencyVehiclePlugin::is_maintaining_non_reduced_speed_</a></div><div class="ttdeci">bool is_maintaining_non_reduced_speed_</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8hpp_source.html#l00433">approaching_emergency_vehicle_plugin_node.hpp:433</a></div></div>
<div class="ttc" id="aclassapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehicleTransitionTable_html_a4c74448ef5d30dcda8bbc4fecf054199"><div class="ttname"><a href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehicleTransitionTable.html#a4c74448ef5d30dcda8bbc4fecf054199">approaching_emergency_vehicle_plugin::ApproachingEmergencyVehicleTransitionTable::getState</a></div><div class="ttdeci">ApproachingEmergencyVehicleState getState() const</div><div class="ttdoc">Returns the current state.</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__transition__table_8cpp_source.html#l00022">approaching_emergency_vehicle_transition_table.cpp:22</a></div></div>
<div class="ttc" id="aclassapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehicleTransitionTable_html_a8e2158634e7011225335a2674e08f305"><div class="ttname"><a href="classapproaching__emergency__vehicle__plugin_1_1ApproachingEmergencyVehicleTransitionTable.html#a8e2158634e7011225335a2674e08f305">approaching_emergency_vehicle_plugin::ApproachingEmergencyVehicleTransitionTable::event</a></div><div class="ttdeci">void event(ApproachingEmergencyVehicleEvent event)</div><div class="ttdoc">Trigger event for the transition table.</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__transition__table_8cpp_source.html#l00027">approaching_emergency_vehicle_transition_table.cpp:27</a></div></div>
<div class="ttc" id="aclasscarma__guidance__plugins_1_1PluginBaseNode_html_a50b54d5c4cc5180eeef0c78c55f70ec3"><div class="ttname"><a href="classcarma__guidance__plugins_1_1PluginBaseNode.html#a50b54d5c4cc5180eeef0c78c55f70ec3">carma_guidance_plugins::PluginBaseNode::get_world_model</a></div><div class="ttdeci">virtual carma_wm::WorldModelConstPtr get_world_model() final</div><div class="ttdoc">Method to return the default world model provided as a convience by this base class If this method or...</div><div class="ttdef"><b>Definition:</b> <a href="plugin__base__node_8cpp_source.html#l00066">plugin_base_node.cpp:66</a></div></div>
<div class="ttc" id="aclasscarma__wm_1_1CARMAWorldModel_html"><div class="ttname"><a href="classcarma__wm_1_1CARMAWorldModel.html">carma_wm::CARMAWorldModel</a></div><div class="ttdoc">Class which implements the WorldModel interface. In addition this class provides write access to the ...</div><div class="ttdef"><b>Definition:</b> <a href="CARMAWorldModel_8hpp_source.html#l00048">CARMAWorldModel.hpp:49</a></div></div>
<div class="ttc" id="anamespaceapproaching__emergency__vehicle__plugin_1_1anonymous__namespace_02approaching__emergenc6b477e4cfd274375085cbaf134e12178_html_a824526918073d730865d3616fded75c4"><div class="ttname"><a href="namespaceapproaching__emergency__vehicle__plugin_1_1anonymous__namespace_02approaching__emergenc6b477e4cfd274375085cbaf134e12178.html#a824526918073d730865d3616fded75c4">approaching_emergency_vehicle_plugin::anonymous_namespace{approaching_emergency_vehicle_plugin_node.cpp}::getManeuverEndSpeed</a></div><div class="ttdeci">double getManeuverEndSpeed(const carma_planning_msgs::msg::Maneuver &amp;mvr)</div><div class="ttdoc">Anonymous function to extract maneuver end speed which cannot be obtained with GET_MANEUVER_PROPERY c...</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8cpp_source.html#l00027">approaching_emergency_vehicle_plugin_node.cpp:27</a></div></div>
<div class="ttc" id="anamespaceapproaching__emergency__vehicle__plugin_html"><div class="ttname"><a href="namespaceapproaching__emergency__vehicle__plugin.html">approaching_emergency_vehicle_plugin</a></div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__config_8hpp_source.html#l00022">approaching_emergency_vehicle_plugin_config.hpp:23</a></div></div>
<div class="ttc" id="anamespaceapproaching__emergency__vehicle__plugin_html_a2dbb3f37c243c291470089b3d68d82e4"><div class="ttname"><a href="namespaceapproaching__emergency__vehicle__plugin.html#a2dbb3f37c243c291470089b3d68d82e4">approaching_emergency_vehicle_plugin::METERS_PER_SEC_TO_MILES_PER_HOUR</a></div><div class="ttdeci">constexpr double METERS_PER_SEC_TO_MILES_PER_HOUR</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8hpp_source.html#l00102">approaching_emergency_vehicle_plugin_node.hpp:102</a></div></div>
<div class="ttc" id="anamespaceapproaching__emergency__vehicle__plugin_html_ae26e1cd128942ddf2ca8eccadb66a6caa1b555c5c3c8561a37b426da3055c0a40"><div class="ttname"><a href="namespaceapproaching__emergency__vehicle__plugin.html#ae26e1cd128942ddf2ca8eccadb66a6caa1b555c5c3c8561a37b426da3055c0a40">approaching_emergency_vehicle_plugin::ApproachingEmergencyVehicleEvent::APPROACHING_ERV_IN_PATH</a></div><div class="ttdeci">@ APPROACHING_ERV_IN_PATH</div></div>
<div class="ttc" id="anamespaceapproaching__emergency__vehicle__plugin_html_ae26e1cd128942ddf2ca8eccadb66a6caa3dc495a5c3931df7278a227f93d6b70a"><div class="ttname"><a href="namespaceapproaching__emergency__vehicle__plugin.html#ae26e1cd128942ddf2ca8eccadb66a6caa3dc495a5c3931df7278a227f93d6b70a">approaching_emergency_vehicle_plugin::ApproachingEmergencyVehicleEvent::NO_APPROACHING_ERV</a></div><div class="ttdeci">@ NO_APPROACHING_ERV</div></div>
<div class="ttc" id="anamespaceapproaching__emergency__vehicle__plugin_html_ae26e1cd128942ddf2ca8eccadb66a6caa56a442a3b65d0223941e7bcd776f6100"><div class="ttname"><a href="namespaceapproaching__emergency__vehicle__plugin.html#ae26e1cd128942ddf2ca8eccadb66a6caa56a442a3b65d0223941e7bcd776f6100">approaching_emergency_vehicle_plugin::ApproachingEmergencyVehicleEvent::ERV_PASSING_IN_PATH</a></div><div class="ttdeci">@ ERV_PASSING_IN_PATH</div></div>
<div class="ttc" id="anamespaceapproaching__emergency__vehicle__plugin_html_ae26e1cd128942ddf2ca8eccadb66a6caa859695dc48d2267825f817444e92d311"><div class="ttname"><a href="namespaceapproaching__emergency__vehicle__plugin.html#ae26e1cd128942ddf2ca8eccadb66a6caa859695dc48d2267825f817444e92d311">approaching_emergency_vehicle_plugin::ApproachingEmergencyVehicleEvent::ERV_PASSED</a></div><div class="ttdeci">@ ERV_PASSED</div></div>
<div class="ttc" id="anamespaceapproaching__emergency__vehicle__plugin_html_ae26e1cd128942ddf2ca8eccadb66a6caa9c81e8ddfa49697b5d0ec5d8eeb79674"><div class="ttname"><a href="namespaceapproaching__emergency__vehicle__plugin.html#ae26e1cd128942ddf2ca8eccadb66a6caa9c81e8ddfa49697b5d0ec5d8eeb79674">approaching_emergency_vehicle_plugin::ApproachingEmergencyVehicleEvent::ERV_UPDATE_TIMEOUT</a></div><div class="ttdeci">@ ERV_UPDATE_TIMEOUT</div></div>
<div class="ttc" id="anamespaceapproaching__emergency__vehicle__plugin_html_ae26e1cd128942ddf2ca8eccadb66a6caadd2ba763284319f7c1bc17f2a0a9df15"><div class="ttname"><a href="namespaceapproaching__emergency__vehicle__plugin.html#ae26e1cd128942ddf2ca8eccadb66a6caadd2ba763284319f7c1bc17f2a0a9df15">approaching_emergency_vehicle_plugin::ApproachingEmergencyVehicleEvent::APPROACHING_ERV_NOT_IN_PATH</a></div><div class="ttdeci">@ APPROACHING_ERV_NOT_IN_PATH</div></div>
<div class="ttc" id="anamespaceapproaching__emergency__vehicle__plugin_html_aeb182d0e6c9d53e276e1b9935aff0630a0773e3336b946c578edbc4f3768a93e2"><div class="ttname"><a href="namespaceapproaching__emergency__vehicle__plugin.html#aeb182d0e6c9d53e276e1b9935aff0630a0773e3336b946c578edbc4f3768a93e2">approaching_emergency_vehicle_plugin::ApproachingEmergencyVehicleState::MOVING_OVER_FOR_APPROACHING_ERV</a></div><div class="ttdeci">@ MOVING_OVER_FOR_APPROACHING_ERV</div></div>
<div class="ttc" id="anamespaceapproaching__emergency__vehicle__plugin_html_aeb182d0e6c9d53e276e1b9935aff0630a3dc495a5c3931df7278a227f93d6b70a"><div class="ttname"><a href="namespaceapproaching__emergency__vehicle__plugin.html#aeb182d0e6c9d53e276e1b9935aff0630a3dc495a5c3931df7278a227f93d6b70a">approaching_emergency_vehicle_plugin::ApproachingEmergencyVehicleState::NO_APPROACHING_ERV</a></div><div class="ttdeci">@ NO_APPROACHING_ERV</div></div>
<div class="ttc" id="anamespaceapproaching__emergency__vehicle__plugin_html_aeb182d0e6c9d53e276e1b9935aff0630abe5a505910aae73e4a99392e4b36e99a"><div class="ttname"><a href="namespaceapproaching__emergency__vehicle__plugin.html#aeb182d0e6c9d53e276e1b9935aff0630abe5a505910aae73e4a99392e4b36e99a">approaching_emergency_vehicle_plugin::ApproachingEmergencyVehicleState::SLOWING_DOWN_FOR_ERV</a></div><div class="ttdeci">@ SLOWING_DOWN_FOR_ERV</div></div>
<div class="ttc" id="anamespacecarma__cooperative__perception_html_a64b708654c8aecb09122d39577df31b5"><div class="ttname"><a href="namespacecarma__cooperative__perception.html#a64b708654c8aecb09122d39577df31b5">carma_cooperative_perception::to_string</a></div><div class="ttdeci">auto to_string(const UtmZone &amp;zone) -&gt; std::string</div><div class="ttdef"><b>Definition:</b> <a href="utm__zone_8cpp_source.html#l00021">utm_zone.cpp:21</a></div></div>
<div class="ttc" id="anamespacecarma__guidance__plugins_html"><div class="ttname"><a href="namespacecarma__guidance__plugins.html">carma_guidance_plugins</a></div><div class="ttdef"><b>Definition:</b> <a href="control__plugin_8hpp_source.html#l00027">control_plugin.hpp:28</a></div></div>
<div class="ttc" id="anamespacecarma__wm_html_ae21cba9eaf353a58738fc2c1773c5ffa"><div class="ttname"><a href="namespacecarma__wm.html#ae21cba9eaf353a58738fc2c1773c5ffa">carma_wm::LaneletRoutePtr</a></div><div class="ttdeci">std::shared_ptr&lt; lanelet::routing::Route &gt; LaneletRoutePtr</div><div class="ttdef"><b>Definition:</b> <a href="WorldModel_8hpp_source.html#l00045">WorldModel.hpp:45</a></div></div>
<div class="ttc" id="anamespacelanelet_html"><div class="ttname"><a href="namespacelanelet.html">lanelet</a></div><div class="ttdef"><b>Definition:</b> <a href="MapConformer_8hpp_source.html#l00038">MapConformer.hpp:39</a></div></div>
<div class="ttc" id="anamespacelightbar__manager_html_aab380495443d8cbd852a707cf8478f49aa1efdd482908b789c53ae09fd2ec72fc"><div class="ttname"><a href="namespacelightbar__manager.html#aab380495443d8cbd852a707cf8478f49aa1efdd482908b789c53ae09fd2ec72fc">lightbar_manager::ENGAGED</a></div><div class="ttdeci">@ ENGAGED</div><div class="ttdef"><b>Definition:</b> <a href="lightbar__manager__sm_8hpp_source.html#l00033">lightbar_manager_sm.hpp:33</a></div></div>
<div class="ttc" id="anamespaceprocess__bag_html_af102a02c97622dd30b0dbf7bafb0d199"><div class="ttname"><a href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">process_bag.i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="process__bag_8py_source.html#l00059">process_bag.py:59</a></div></div>
<div class="ttc" id="anamespaceprocess__traj__logs_html_a05bdb238bfbf3836fb0aa69c5aa1bb48"><div class="ttname"><a href="namespaceprocess__traj__logs.html#a05bdb238bfbf3836fb0aa69c5aa1bb48">process_traj_logs.y</a></div><div class="ttdeci">y</div><div class="ttdef"><b>Definition:</b> <a href="process__traj__logs_8py_source.html#l00129">process_traj_logs.py:129</a></div></div>
<div class="ttc" id="anamespaceprocess__traj__logs_html_ab81a05c3d1d100117b6781d7dedf8a29"><div class="ttname"><a href="namespaceprocess__traj__logs.html#ab81a05c3d1d100117b6781d7dedf8a29">process_traj_logs.point</a></div><div class="ttdeci">point</div><div class="ttdef"><b>Definition:</b> <a href="process__traj__logs_8py_source.html#l00126">process_traj_logs.py:126</a></div></div>
<div class="ttc" id="anamespaceprocess__traj__logs_html_af3ba6144a2d35a4990f1a8d04632a052"><div class="ttname"><a href="namespaceprocess__traj__logs.html#af3ba6144a2d35a4990f1a8d04632a052">process_traj_logs.x</a></div><div class="ttdeci">x</div><div class="ttdef"><b>Definition:</b> <a href="process__traj__logs_8py_source.html#l00128">process_traj_logs.py:128</a></div></div>
<div class="ttc" id="anamespaceroute_html"><div class="ttname"><a href="namespaceroute.html">route</a></div><div class="ttdef"><b>Definition:</b> <a href="route__config_8hpp_source.html#l00022">route_config.hpp:23</a></div></div>
<div class="ttc" id="apointer_8h_html_aeeddce917cf130d62c370b8f216026dd"><div class="ttname"><a href="pointer_8h.html#aeeddce917cf130d62c370b8f216026dd">a</a></div><div class="ttdeci">const GenericPointer&lt; typename T::ValueType &gt; T2 T::AllocatorType &amp; a</div><div class="ttdef"><b>Definition:</b> <a href="pointer_8h_source.html#l01121">pointer.h:1121</a></div></div>
<div class="ttc" id="astructapproaching__emergency__vehicle__plugin_1_1Config_html"><div class="ttname"><a href="structapproaching__emergency__vehicle__plugin_1_1Config.html">approaching_emergency_vehicle_plugin::Config</a></div><div class="ttdoc">Stuct containing the algorithm configuration values for approaching_emergency_vehicle_plugin.</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__config_8hpp_source.html#l00028">approaching_emergency_vehicle_plugin_config.hpp:29</a></div></div>
<div class="ttc" id="astructapproaching__emergency__vehicle__plugin_1_1Config_html_a021c15bd670c461bd74b23f40ce28594"><div class="ttname"><a href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a021c15bd670c461bd74b23f40ce28594">approaching_emergency_vehicle_plugin::Config::timeout_duration</a></div><div class="ttdeci">double timeout_duration</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__config_8hpp_source.html#l00058">approaching_emergency_vehicle_plugin_config.hpp:58</a></div></div>
<div class="ttc" id="astructapproaching__emergency__vehicle__plugin_1_1Config_html_a0bacd4168f75ca1d5c784847ebf52598"><div class="ttname"><a href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a0bacd4168f75ca1d5c784847ebf52598">approaching_emergency_vehicle_plugin::Config::warning_broadcast_frequency</a></div><div class="ttdeci">double warning_broadcast_frequency</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__config_8hpp_source.html#l00075">approaching_emergency_vehicle_plugin_config.hpp:75</a></div></div>
<div class="ttc" id="astructapproaching__emergency__vehicle__plugin_1_1Config_html_a1b30e6e0c5ce1e2eefa70b1af6e941eb"><div class="ttname"><a href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a1b30e6e0c5ce1e2eefa70b1af6e941eb">approaching_emergency_vehicle_plugin::Config::vehicle_acceleration_limit</a></div><div class="ttdeci">double vehicle_acceleration_limit</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__config_8hpp_source.html#l00068">approaching_emergency_vehicle_plugin_config.hpp:68</a></div></div>
<div class="ttc" id="astructapproaching__emergency__vehicle__plugin_1_1Config_html_a2617bd4b6850d11f938dfd39efb0ad1c"><div class="ttname"><a href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a2617bd4b6850d11f938dfd39efb0ad1c">approaching_emergency_vehicle_plugin::Config::min_lane_following_duration_before_lane_change</a></div><div class="ttdeci">double min_lane_following_duration_before_lane_change</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__config_8hpp_source.html#l00039">approaching_emergency_vehicle_plugin_config.hpp:39</a></div></div>
<div class="ttc" id="astructapproaching__emergency__vehicle__plugin_1_1Config_html_a2bad9c38f2c863cb52ce08c89c2ed0f8"><div class="ttname"><a href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a2bad9c38f2c863cb52ce08c89c2ed0f8">approaching_emergency_vehicle_plugin::Config::lane_following_plugin</a></div><div class="ttdeci">std::string lane_following_plugin</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__config_8hpp_source.html#l00083">approaching_emergency_vehicle_plugin_config.hpp:83</a></div></div>
<div class="ttc" id="astructapproaching__emergency__vehicle__plugin_1_1Config_html_a2e6f2566571a01c095800f712e8ee183"><div class="ttname"><a href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a2e6f2566571a01c095800f712e8ee183">approaching_emergency_vehicle_plugin::Config::bsm_processing_frequency</a></div><div class="ttdeci">double bsm_processing_frequency</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__config_8hpp_source.html#l00042">approaching_emergency_vehicle_plugin_config.hpp:42</a></div></div>
<div class="ttc" id="astructapproaching__emergency__vehicle__plugin_1_1Config_html_a357d49d8f1e6e554bf550a1f873c63bc"><div class="ttname"><a href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a357d49d8f1e6e554bf550a1f873c63bc">approaching_emergency_vehicle_plugin::Config::max_warning_broadcasts</a></div><div class="ttdeci">int max_warning_broadcasts</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__config_8hpp_source.html#l00078">approaching_emergency_vehicle_plugin_config.hpp:78</a></div></div>
<div class="ttc" id="astructapproaching__emergency__vehicle__plugin_1_1Config_html_a3f55d992021d18a02478cbc07ef0bb25"><div class="ttname"><a href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a3f55d992021d18a02478cbc07ef0bb25">approaching_emergency_vehicle_plugin::Config::passing_threshold</a></div><div class="ttdeci">double passing_threshold</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__config_8hpp_source.html#l00030">approaching_emergency_vehicle_plugin_config.hpp:30</a></div></div>
<div class="ttc" id="astructapproaching__emergency__vehicle__plugin_1_1Config_html_a64b3bef57508c81e9403778f1415d3be"><div class="ttname"><a href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a64b3bef57508c81e9403778f1415d3be">approaching_emergency_vehicle_plugin::Config::default_speed_limit</a></div><div class="ttdeci">double default_speed_limit</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__config_8hpp_source.html#l00050">approaching_emergency_vehicle_plugin_config.hpp:50</a></div></div>
<div class="ttc" id="astructapproaching__emergency__vehicle__plugin_1_1Config_html_a6dd3156876736b67368486db8f4fcc7f"><div class="ttname"><a href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a6dd3156876736b67368486db8f4fcc7f">approaching_emergency_vehicle_plugin::Config::lane_change_plugin</a></div><div class="ttdeci">std::string lane_change_plugin</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__config_8hpp_source.html#l00085">approaching_emergency_vehicle_plugin_config.hpp:85</a></div></div>
<div class="ttc" id="astructapproaching__emergency__vehicle__plugin_1_1Config_html_a725f395f09130e206956a7deb30f6644"><div class="ttname"><a href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a725f395f09130e206956a7deb30f6644">approaching_emergency_vehicle_plugin::Config::buffer_distance_before_stopping</a></div><div class="ttdeci">double buffer_distance_before_stopping</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__config_8hpp_source.html#l00063">approaching_emergency_vehicle_plugin_config.hpp:63</a></div></div>
<div class="ttc" id="astructapproaching__emergency__vehicle__plugin_1_1Config_html_a7573a5e45947f7d8fa3504161936bd19"><div class="ttname"><a href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a7573a5e45947f7d8fa3504161936bd19">approaching_emergency_vehicle_plugin::Config::finished_passing_threshold</a></div><div class="ttdeci">double finished_passing_threshold</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__config_8hpp_source.html#l00036">approaching_emergency_vehicle_plugin_config.hpp:36</a></div></div>
<div class="ttc" id="astructapproaching__emergency__vehicle__plugin_1_1Config_html_a78537e382e029464ea6fa1d1e9053cd5"><div class="ttname"><a href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a78537e382e029464ea6fa1d1e9053cd5">approaching_emergency_vehicle_plugin::Config::approaching_threshold</a></div><div class="ttdeci">double approaching_threshold</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__config_8hpp_source.html#l00033">approaching_emergency_vehicle_plugin_config.hpp:33</a></div></div>
<div class="ttc" id="astructapproaching__emergency__vehicle__plugin_1_1Config_html_a789e82d1b4c4ebcfe2019fd9808019d8"><div class="ttname"><a href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a789e82d1b4c4ebcfe2019fd9808019d8">approaching_emergency_vehicle_plugin::Config::stopping_accel_limit_multiplier</a></div><div class="ttdeci">double stopping_accel_limit_multiplier</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__config_8hpp_source.html#l00065">approaching_emergency_vehicle_plugin_config.hpp:65</a></div></div>
<div class="ttc" id="astructapproaching__emergency__vehicle__plugin_1_1Config_html_a7d48d943b50100d1c3e2099c36070da9"><div class="ttname"><a href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a7d48d943b50100d1c3e2099c36070da9">approaching_emergency_vehicle_plugin::Config::minimum_reduced_speed_limit</a></div><div class="ttdeci">double minimum_reduced_speed_limit</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__config_8hpp_source.html#l00047">approaching_emergency_vehicle_plugin_config.hpp:47</a></div></div>
<div class="ttc" id="astructapproaching__emergency__vehicle__plugin_1_1Config_html_a82d53d570af61ab41e04d4a27243102e"><div class="ttname"><a href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a82d53d570af61ab41e04d4a27243102e">approaching_emergency_vehicle_plugin::Config::minimal_plan_duration</a></div><div class="ttdeci">double minimal_plan_duration</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__config_8hpp_source.html#l00061">approaching_emergency_vehicle_plugin_config.hpp:61</a></div></div>
<div class="ttc" id="astructapproaching__emergency__vehicle__plugin_1_1Config_html_a859e48c953178140090bbf4d89744f86"><div class="ttname"><a href="structapproaching__emergency__vehicle__plugin_1_1Config.html#a859e48c953178140090bbf4d89744f86">approaching_emergency_vehicle_plugin::Config::stop_and_wait_plugin</a></div><div class="ttdeci">std::string stop_and_wait_plugin</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__config_8hpp_source.html#l00087">approaching_emergency_vehicle_plugin_config.hpp:87</a></div></div>
<div class="ttc" id="astructapproaching__emergency__vehicle__plugin_1_1Config_html_aa70358d5fbdea25512a0e0dd2750a3ea"><div class="ttname"><a href="structapproaching__emergency__vehicle__plugin_1_1Config.html#aa70358d5fbdea25512a0e0dd2750a3ea">approaching_emergency_vehicle_plugin::Config::vehicle_id</a></div><div class="ttdeci">std::string vehicle_id</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__config_8hpp_source.html#l00089">approaching_emergency_vehicle_plugin_config.hpp:89</a></div></div>
<div class="ttc" id="astructapproaching__emergency__vehicle__plugin_1_1Config_html_abf16d22f1b3443854a970a490e2cc97d"><div class="ttname"><a href="structapproaching__emergency__vehicle__plugin_1_1Config.html#abf16d22f1b3443854a970a490e2cc97d">approaching_emergency_vehicle_plugin::Config::approaching_erv_status_publication_frequency</a></div><div class="ttdeci">double approaching_erv_status_publication_frequency</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__config_8hpp_source.html#l00072">approaching_emergency_vehicle_plugin_config.hpp:72</a></div></div>
<div class="ttc" id="astructapproaching__emergency__vehicle__plugin_1_1Config_html_acd12c1b7c7c6546c81679ace095f0c7c"><div class="ttname"><a href="structapproaching__emergency__vehicle__plugin_1_1Config.html#acd12c1b7c7c6546c81679ace095f0c7c">approaching_emergency_vehicle_plugin::Config::speed_limit_reduction_during_passing</a></div><div class="ttdeci">double speed_limit_reduction_during_passing</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__config_8hpp_source.html#l00044">approaching_emergency_vehicle_plugin_config.hpp:44</a></div></div>
<div class="ttc" id="astructapproaching__emergency__vehicle__plugin_1_1Config_html_ad8731d21c88e346dd0d379680afdde72"><div class="ttname"><a href="structapproaching__emergency__vehicle__plugin_1_1Config.html#ad8731d21c88e346dd0d379680afdde72">approaching_emergency_vehicle_plugin::Config::reduced_speed_buffer</a></div><div class="ttdeci">double reduced_speed_buffer</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__config_8hpp_source.html#l00052">approaching_emergency_vehicle_plugin_config.hpp:52</a></div></div>
<div class="ttc" id="astructapproaching__emergency__vehicle__plugin_1_1Config_html_ae1af2f64a5f86e70ea737bb9b0370cdd"><div class="ttname"><a href="structapproaching__emergency__vehicle__plugin_1_1Config.html#ae1af2f64a5f86e70ea737bb9b0370cdd">approaching_emergency_vehicle_plugin::Config::route_end_point_buffer</a></div><div class="ttdeci">double route_end_point_buffer</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__config_8hpp_source.html#l00070">approaching_emergency_vehicle_plugin_config.hpp:70</a></div></div>
<div class="ttc" id="astructapproaching__emergency__vehicle__plugin_1_1Config_html_ae64572ff061924d56fa9998852a2a945"><div class="ttname"><a href="structapproaching__emergency__vehicle__plugin_1_1Config.html#ae64572ff061924d56fa9998852a2a945">approaching_emergency_vehicle_plugin::Config::timeout_check_frequency</a></div><div class="ttdeci">double timeout_check_frequency</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__config_8hpp_source.html#l00055">approaching_emergency_vehicle_plugin_config.hpp:55</a></div></div>
<div class="ttc" id="astructapproaching__emergency__vehicle__plugin_1_1Config_html_afe9dff631c6c75497bbecfe6f6029753"><div class="ttname"><a href="structapproaching__emergency__vehicle__plugin_1_1Config.html#afe9dff631c6c75497bbecfe6f6029753">approaching_emergency_vehicle_plugin::Config::vehicle_length</a></div><div class="ttdeci">double vehicle_length</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__config_8hpp_source.html#l00081">approaching_emergency_vehicle_plugin_config.hpp:81</a></div></div>
<div class="ttc" id="astructapproaching__emergency__vehicle__plugin_1_1ErvInformation_html"><div class="ttname"><a href="structapproaching__emergency__vehicle__plugin_1_1ErvInformation.html">approaching_emergency_vehicle_plugin::ErvInformation</a></div><div class="ttdoc">Convenience struct for storing relevant data for an Emergency Response Vehicle (ERV).</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8hpp_source.html#l00069">approaching_emergency_vehicle_plugin_node.hpp:69</a></div></div>
<div class="ttc" id="astructapproaching__emergency__vehicle__plugin_1_1ErvInformation_html_a2d25462696d7933e72bc33239c42287d"><div class="ttname"><a href="structapproaching__emergency__vehicle__plugin_1_1ErvInformation.html#a2d25462696d7933e72bc33239c42287d">approaching_emergency_vehicle_plugin::ErvInformation::vehicle_id</a></div><div class="ttdeci">std::string vehicle_id</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8hpp_source.html#l00070">approaching_emergency_vehicle_plugin_node.hpp:70</a></div></div>
<div class="ttc" id="astructapproaching__emergency__vehicle__plugin_1_1ErvInformation_html_a530fa1cfa45c494906acb6d55da222e7"><div class="ttname"><a href="structapproaching__emergency__vehicle__plugin_1_1ErvInformation.html#a530fa1cfa45c494906acb6d55da222e7">approaching_emergency_vehicle_plugin::ErvInformation::current_position_in_map</a></div><div class="ttdeci">lanelet::BasicPoint2d current_position_in_map</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8hpp_source.html#l00074">approaching_emergency_vehicle_plugin_node.hpp:74</a></div></div>
<div class="ttc" id="astructapproaching__emergency__vehicle__plugin_1_1ErvInformation_html_a54055d98a4a44a8b89d7e69b1c161f0b"><div class="ttname"><a href="structapproaching__emergency__vehicle__plugin_1_1ErvInformation.html#a54055d98a4a44a8b89d7e69b1c161f0b">approaching_emergency_vehicle_plugin::ErvInformation::seconds_until_passing</a></div><div class="ttdeci">double seconds_until_passing</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8hpp_source.html#l00076">approaching_emergency_vehicle_plugin_node.hpp:76</a></div></div>
<div class="ttc" id="astructapproaching__emergency__vehicle__plugin_1_1ErvInformation_html_a632381dfd37c45c5440d7bbe8ac2b634"><div class="ttname"><a href="structapproaching__emergency__vehicle__plugin_1_1ErvInformation.html#a632381dfd37c45c5440d7bbe8ac2b634">approaching_emergency_vehicle_plugin::ErvInformation::previous_lane_index</a></div><div class="ttdeci">int previous_lane_index</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8hpp_source.html#l00078">approaching_emergency_vehicle_plugin_node.hpp:78</a></div></div>
<div class="ttc" id="astructapproaching__emergency__vehicle__plugin_1_1ErvInformation_html_a6966afb86227f0e5edef2a03b142265a"><div class="ttname"><a href="structapproaching__emergency__vehicle__plugin_1_1ErvInformation.html#a6966afb86227f0e5edef2a03b142265a">approaching_emergency_vehicle_plugin::ErvInformation::latest_update_time</a></div><div class="ttdeci">rclcpp::Time latest_update_time</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8hpp_source.html#l00083">approaching_emergency_vehicle_plugin_node.hpp:83</a></div></div>
<div class="ttc" id="astructapproaching__emergency__vehicle__plugin_1_1ErvInformation_html_a9940a792d030a2d124a2b04fb51fd27f"><div class="ttname"><a href="structapproaching__emergency__vehicle__plugin_1_1ErvInformation.html#a9940a792d030a2d124a2b04fb51fd27f">approaching_emergency_vehicle_plugin::ErvInformation::current_speed</a></div><div class="ttdeci">double current_speed</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8hpp_source.html#l00071">approaching_emergency_vehicle_plugin_node.hpp:71</a></div></div>
<div class="ttc" id="astructapproaching__emergency__vehicle__plugin_1_1ErvInformation_html_abfab4e3dd4ca3fba7e4581488cb7b5e3"><div class="ttname"><a href="structapproaching__emergency__vehicle__plugin_1_1ErvInformation.html#abfab4e3dd4ca3fba7e4581488cb7b5e3">approaching_emergency_vehicle_plugin::ErvInformation::current_latitude</a></div><div class="ttdeci">double current_latitude</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8hpp_source.html#l00072">approaching_emergency_vehicle_plugin_node.hpp:72</a></div></div>
<div class="ttc" id="astructapproaching__emergency__vehicle__plugin_1_1ErvInformation_html_ac34d23f97859c1239886108d1e8c7828"><div class="ttname"><a href="structapproaching__emergency__vehicle__plugin_1_1ErvInformation.html#ac34d23f97859c1239886108d1e8c7828">approaching_emergency_vehicle_plugin::ErvInformation::lane_index</a></div><div class="ttdeci">int lane_index</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8hpp_source.html#l00079">approaching_emergency_vehicle_plugin_node.hpp:79</a></div></div>
<div class="ttc" id="astructapproaching__emergency__vehicle__plugin_1_1ErvInformation_html_ae3384c5e028e78ee1691738c53698e02"><div class="ttname"><a href="structapproaching__emergency__vehicle__plugin_1_1ErvInformation.html#ae3384c5e028e78ee1691738c53698e02">approaching_emergency_vehicle_plugin::ErvInformation::intersecting_lanelet</a></div><div class="ttdeci">lanelet::ConstLanelet intersecting_lanelet</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8hpp_source.html#l00075">approaching_emergency_vehicle_plugin_node.hpp:75</a></div></div>
<div class="ttc" id="astructapproaching__emergency__vehicle__plugin_1_1ErvInformation_html_af0375acd994c05aea49759b8ed9ef544"><div class="ttname"><a href="structapproaching__emergency__vehicle__plugin_1_1ErvInformation.html#af0375acd994c05aea49759b8ed9ef544">approaching_emergency_vehicle_plugin::ErvInformation::current_longitude</a></div><div class="ttdeci">double current_longitude</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8hpp_source.html#l00073">approaching_emergency_vehicle_plugin_node.hpp:73</a></div></div>
<div class="ttc" id="astructapproaching__emergency__vehicle__plugin_1_1UpcomingLaneChangeParameters_html"><div class="ttname"><a href="structapproaching__emergency__vehicle__plugin_1_1UpcomingLaneChangeParameters.html">approaching_emergency_vehicle_plugin::UpcomingLaneChangeParameters</a></div><div class="ttdoc">Convenience struct for storing the parameters of an upcoming lane change to ensure that the same para...</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8hpp_source.html#l00090">approaching_emergency_vehicle_plugin_node.hpp:90</a></div></div>
<div class="ttc" id="astructapproaching__emergency__vehicle__plugin_1_1UpcomingLaneChangeParameters_html_a0276d31105789c8076965c78e6167b8b"><div class="ttname"><a href="structapproaching__emergency__vehicle__plugin_1_1UpcomingLaneChangeParameters.html#a0276d31105789c8076965c78e6167b8b">approaching_emergency_vehicle_plugin::UpcomingLaneChangeParameters::start_speed</a></div><div class="ttdeci">double start_speed</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8hpp_source.html#l00096">approaching_emergency_vehicle_plugin_node.hpp:96</a></div></div>
<div class="ttc" id="astructapproaching__emergency__vehicle__plugin_1_1UpcomingLaneChangeParameters_html_a9bc3e7edf423530bb59fff379f84fe0f"><div class="ttname"><a href="structapproaching__emergency__vehicle__plugin_1_1UpcomingLaneChangeParameters.html#a9bc3e7edf423530bb59fff379f84fe0f">approaching_emergency_vehicle_plugin::UpcomingLaneChangeParameters::end_dist</a></div><div class="ttdeci">double end_dist</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8hpp_source.html#l00095">approaching_emergency_vehicle_plugin_node.hpp:95</a></div></div>
<div class="ttc" id="astructapproaching__emergency__vehicle__plugin_1_1UpcomingLaneChangeParameters_html_aaba665f5ee18db85363601f0c385fd5a"><div class="ttname"><a href="structapproaching__emergency__vehicle__plugin_1_1UpcomingLaneChangeParameters.html#aaba665f5ee18db85363601f0c385fd5a">approaching_emergency_vehicle_plugin::UpcomingLaneChangeParameters::is_right_lane_change</a></div><div class="ttdeci">bool is_right_lane_change</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8hpp_source.html#l00093">approaching_emergency_vehicle_plugin_node.hpp:93</a></div></div>
<div class="ttc" id="astructapproaching__emergency__vehicle__plugin_1_1UpcomingLaneChangeParameters_html_adbad5c78589d71b5eb495730468a710b"><div class="ttname"><a href="structapproaching__emergency__vehicle__plugin_1_1UpcomingLaneChangeParameters.html#adbad5c78589d71b5eb495730468a710b">approaching_emergency_vehicle_plugin::UpcomingLaneChangeParameters::start_dist</a></div><div class="ttdeci">double start_dist</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8hpp_source.html#l00094">approaching_emergency_vehicle_plugin_node.hpp:94</a></div></div>
<div class="ttc" id="astructapproaching__emergency__vehicle__plugin_1_1UpcomingLaneChangeParameters_html_adccbad754ba6efe6c1b6061620bded43"><div class="ttname"><a href="structapproaching__emergency__vehicle__plugin_1_1UpcomingLaneChangeParameters.html#adccbad754ba6efe6c1b6061620bded43">approaching_emergency_vehicle_plugin::UpcomingLaneChangeParameters::starting_lanelet</a></div><div class="ttdeci">lanelet::ConstLanelet starting_lanelet</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8hpp_source.html#l00091">approaching_emergency_vehicle_plugin_node.hpp:91</a></div></div>
<div class="ttc" id="astructapproaching__emergency__vehicle__plugin_1_1UpcomingLaneChangeParameters_html_ae48fc7188493fdd07e58d765a78ffd17"><div class="ttname"><a href="structapproaching__emergency__vehicle__plugin_1_1UpcomingLaneChangeParameters.html#ae48fc7188493fdd07e58d765a78ffd17">approaching_emergency_vehicle_plugin::UpcomingLaneChangeParameters::maneuver_id</a></div><div class="ttdeci">std::string maneuver_id</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8hpp_source.html#l00098">approaching_emergency_vehicle_plugin_node.hpp:98</a></div></div>
<div class="ttc" id="astructapproaching__emergency__vehicle__plugin_1_1UpcomingLaneChangeParameters_html_ae583a07d646008f81d0ad1d4ed1201dd"><div class="ttname"><a href="structapproaching__emergency__vehicle__plugin_1_1UpcomingLaneChangeParameters.html#ae583a07d646008f81d0ad1d4ed1201dd">approaching_emergency_vehicle_plugin::UpcomingLaneChangeParameters::ending_lanelet</a></div><div class="ttdeci">lanelet::ConstLanelet ending_lanelet</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8hpp_source.html#l00092">approaching_emergency_vehicle_plugin_node.hpp:92</a></div></div>
<div class="ttc" id="astructapproaching__emergency__vehicle__plugin_1_1UpcomingLaneChangeParameters_html_afabe50de6bef9dbcf906f85044b6e56f"><div class="ttname"><a href="structapproaching__emergency__vehicle__plugin_1_1UpcomingLaneChangeParameters.html#afabe50de6bef9dbcf906f85044b6e56f">approaching_emergency_vehicle_plugin::UpcomingLaneChangeParameters::end_speed</a></div><div class="ttdeci">double end_speed</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8hpp_source.html#l00097">approaching_emergency_vehicle_plugin_node.hpp:97</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_7026c4de5f5d87920db889333beddb80.html">approaching_emergency_vehicle_plugin</a></li><li class="navelem"><a class="el" href="dir_6f364a2fadbfa39a9c92fb1bf862ec91.html">src</a></li><li class="navelem"><a class="el" href="approaching__emergency__vehicle__plugin__node_8cpp.html">approaching_emergency_vehicle_plugin_node.cpp</a></li>
    <li class="footer">Generated on Wed Feb 14 2024 22:01:07 for Carma-platform by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.4 </li>
  </ul>
</div>
</body>
</html>
