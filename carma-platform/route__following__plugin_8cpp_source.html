<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Carma-platform: route_following_plugin/src/route_following_plugin.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Carma-platform<span id="projectnumber">&#160;v4.2.0</span>
   </div>
   <div id="projectbrief">CARMA Platform is built on robot operating system (ROS) and utilizes open source software (OSS) that enables Cooperative Driving Automation (CDA) features to allow Automated Driving Systems to interact and cooperate with infrastructure and other vehicles through communication.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('route__following__plugin_8cpp_source.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle"><div class="title">route_following_plugin.cpp</div></div>
</div><!--header-->
<div class="contents">
<a href="route__following__plugin_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a id="l00001" name="l00001"></a><span class="lineno">    1</span><span class="comment">/*</span></div>
<div class="line"><a id="l00002" name="l00002"></a><span class="lineno">    2</span><span class="comment"> * Copyright (C) 2022 LEIDOS.</span></div>
<div class="line"><a id="l00003" name="l00003"></a><span class="lineno">    3</span><span class="comment"> *</span></div>
<div class="line"><a id="l00004" name="l00004"></a><span class="lineno">    4</span><span class="comment"> * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); you may not</span></div>
<div class="line"><a id="l00005" name="l00005"></a><span class="lineno">    5</span><span class="comment"> * use this file except in compliance with the License. You may obtain a copy of</span></div>
<div class="line"><a id="l00006" name="l00006"></a><span class="lineno">    6</span><span class="comment"> * the License at</span></div>
<div class="line"><a id="l00007" name="l00007"></a><span class="lineno">    7</span><span class="comment"> *</span></div>
<div class="line"><a id="l00008" name="l00008"></a><span class="lineno">    8</span><span class="comment"> * http://www.apache.org/licenses/LICENSE-2.0</span></div>
<div class="line"><a id="l00009" name="l00009"></a><span class="lineno">    9</span><span class="comment"> *</span></div>
<div class="line"><a id="l00010" name="l00010"></a><span class="lineno">   10</span><span class="comment"> * Unless required by applicable law or agreed to in writing, software</span></div>
<div class="line"><a id="l00011" name="l00011"></a><span class="lineno">   11</span><span class="comment"> * distributed under the License is distributed on an &quot;AS IS&quot; BASIS, WITHOUT</span></div>
<div class="line"><a id="l00012" name="l00012"></a><span class="lineno">   12</span><span class="comment"> * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the</span></div>
<div class="line"><a id="l00013" name="l00013"></a><span class="lineno">   13</span><span class="comment"> * License for the specific language governing permissions and limitations under</span></div>
<div class="line"><a id="l00014" name="l00014"></a><span class="lineno">   14</span><span class="comment"> * the License.</span></div>
<div class="line"><a id="l00015" name="l00015"></a><span class="lineno">   15</span><span class="comment"> */</span></div>
<div class="line"><a id="l00016" name="l00016"></a><span class="lineno">   16</span><span class="preprocessor">#include &lt;rclcpp/rclcpp.hpp&gt;</span></div>
<div class="line"><a id="l00017" name="l00017"></a><span class="lineno">   17</span><span class="preprocessor">#include &lt;rclcpp/parameter_client.hpp&gt;</span></div>
<div class="line"><a id="l00018" name="l00018"></a><span class="lineno">   18</span><span class="preprocessor">#include &lt;string&gt;</span></div>
<div class="line"><a id="l00019" name="l00019"></a><span class="lineno">   19</span><span class="preprocessor">#include &lt;algorithm&gt;</span></div>
<div class="line"><a id="l00020" name="l00020"></a><span class="lineno">   20</span><span class="preprocessor">#include &lt;boost/uuid/uuid_generators.hpp&gt;</span></div>
<div class="line"><a id="l00021" name="l00021"></a><span class="lineno">   21</span><span class="preprocessor">#include &lt;boost/uuid/uuid_io.hpp&gt;</span></div>
<div class="line"><a id="l00022" name="l00022"></a><span class="lineno">   22</span><span class="preprocessor">#include &quot;<a class="code" href="route__following__plugin_8hpp.html">route_following_plugin.hpp</a>&quot;</span></div>
<div class="line"><a id="l00023" name="l00023"></a><span class="lineno">   23</span><span class="preprocessor">#include &lt;lanelet2_core/geometry/Lanelet.h&gt;</span></div>
<div class="line"><a id="l00024" name="l00024"></a><span class="lineno">   24</span><span class="preprocessor">#include &lt;lanelet2_core/geometry/BoundingBox.h&gt;</span></div>
<div class="line"><a id="l00025" name="l00025"></a><span class="lineno">   25</span><span class="preprocessor">#include &lt;lanelet2_extension/traffic_rules/CarmaUSTrafficRules.h&gt;</span></div>
<div class="line"><a id="l00026" name="l00026"></a><span class="lineno">   26</span><span class="preprocessor">#include &lt;chrono&gt;</span></div>
<div class="line"><a id="l00027" name="l00027"></a><span class="lineno">   27</span> </div>
<div class="line"><a id="l00028" name="l00028"></a><span class="lineno">   28</span><span class="keyword">namespace </span><a class="code hl_namespace" href="namespaceroute__following__plugin.html">route_following_plugin</a></div>
<div class="line"><a id="l00029" name="l00029"></a><span class="lineno">   29</span>{</div>
<div class="line"><a id="l00030" name="l00030"></a><span class="lineno">   30</span> <span class="keyword">namespace </span>std_ph = std::placeholders;</div>
<div class="line"><a id="l00031" name="l00031"></a><span class="lineno">   31</span> </div>
<div class="line"><a id="l00032" name="l00032"></a><span class="lineno"><a class="line" href="namespaceroute__following__plugin_1_1anonymous__namespace_02route__following__plugin_8cpp_03.html">   32</a></span><span class="keyword">namespace </span>{</div>
<div class="line"><a id="l00036" name="l00036"></a><span class="lineno"><a class="line" href="namespaceroute__following__plugin_1_1anonymous__namespace_02route__following__plugin_8cpp_03.html#a9b29dd085f9f59d468b1c9320f0b5102">   36</a></span><span class="keywordtype">double</span> <a class="code hl_function" href="namespaceroute__following__plugin_1_1anonymous__namespace_02route__following__plugin_8cpp_03.html#a9b29dd085f9f59d468b1c9320f0b5102">getManeuverEndSpeed</a>(<span class="keyword">const</span> carma_planning_msgs::msg::Maneuver&amp; mvr) { </div>
<div class="line"><a id="l00037" name="l00037"></a><span class="lineno">   37</span>    <span class="keywordflow">switch</span>(mvr.type) {</div>
<div class="line"><a id="l00038" name="l00038"></a><span class="lineno">   38</span>        <span class="keywordflow">case</span> carma_planning_msgs::msg::Maneuver::LANE_FOLLOWING:</div>
<div class="line"><a id="l00039" name="l00039"></a><span class="lineno">   39</span>            <span class="keywordflow">return</span> mvr.lane_following_maneuver.end_speed;</div>
<div class="line"><a id="l00040" name="l00040"></a><span class="lineno">   40</span>        <span class="keywordflow">case</span> carma_planning_msgs::msg::Maneuver::LANE_CHANGE:</div>
<div class="line"><a id="l00041" name="l00041"></a><span class="lineno">   41</span>            <span class="keywordflow">return</span> mvr.lane_change_maneuver.end_speed;</div>
<div class="line"><a id="l00042" name="l00042"></a><span class="lineno">   42</span>        <span class="keywordflow">case</span> carma_planning_msgs::msg::Maneuver::INTERSECTION_TRANSIT_STRAIGHT:</div>
<div class="line"><a id="l00043" name="l00043"></a><span class="lineno">   43</span>            <span class="keywordflow">return</span> mvr.intersection_transit_straight_maneuver.end_speed;</div>
<div class="line"><a id="l00044" name="l00044"></a><span class="lineno">   44</span>        <span class="keywordflow">case</span> carma_planning_msgs::msg::Maneuver::INTERSECTION_TRANSIT_LEFT_TURN:</div>
<div class="line"><a id="l00045" name="l00045"></a><span class="lineno">   45</span>            <span class="keywordflow">return</span> mvr.intersection_transit_left_turn_maneuver.end_speed;</div>
<div class="line"><a id="l00046" name="l00046"></a><span class="lineno">   46</span>        <span class="keywordflow">case</span> carma_planning_msgs::msg::Maneuver::INTERSECTION_TRANSIT_RIGHT_TURN:</div>
<div class="line"><a id="l00047" name="l00047"></a><span class="lineno">   47</span>            <span class="keywordflow">return</span> mvr.intersection_transit_right_turn_maneuver.end_speed;</div>
<div class="line"><a id="l00048" name="l00048"></a><span class="lineno">   48</span>        <span class="keywordflow">case</span> carma_planning_msgs::msg::Maneuver::STOP_AND_WAIT:</div>
<div class="line"><a id="l00049" name="l00049"></a><span class="lineno">   49</span>            <span class="keywordflow">return</span> 0;</div>
<div class="line"><a id="l00050" name="l00050"></a><span class="lineno">   50</span>        <span class="keywordflow">default</span>:</div>
<div class="line"><a id="l00051" name="l00051"></a><span class="lineno">   51</span>            <span class="keywordflow">return</span> 0;</div>
<div class="line"><a id="l00052" name="l00052"></a><span class="lineno">   52</span>    }</div>
<div class="line"><a id="l00053" name="l00053"></a><span class="lineno">   53</span>}</div>
<div class="line"><a id="l00054" name="l00054"></a><span class="lineno">   54</span> </div>
<div class="line"><a id="l00058" name="l00058"></a><span class="lineno"><a class="line" href="namespaceroute__following__plugin_1_1anonymous__namespace_02route__following__plugin_8cpp_03.html#a69b9c9bf1a2410dfb992ec9874073e4e">   58</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="namespaceroute__following__plugin_1_1anonymous__namespace_02route__following__plugin_8cpp_03.html#a69b9c9bf1a2410dfb992ec9874073e4e">setManeuverLaneletIds</a>(carma_planning_msgs::msg::Maneuver&amp; mvr, lanelet::Id start_id, lanelet::Id end_id) {</div>
<div class="line"><a id="l00059" name="l00059"></a><span class="lineno">   59</span> </div>
<div class="line"><a id="l00060" name="l00060"></a><span class="lineno">   60</span>    <span class="keywordflow">switch</span>(mvr.type) {</div>
<div class="line"><a id="l00061" name="l00061"></a><span class="lineno">   61</span>        <span class="keywordflow">case</span> carma_planning_msgs::msg::Maneuver::LANE_CHANGE:</div>
<div class="line"><a id="l00062" name="l00062"></a><span class="lineno">   62</span>            mvr.lane_change_maneuver.starting_lane_id = <a class="code hl_function" href="namespacecarma__cooperative__perception.html#a64b708654c8aecb09122d39577df31b5">std::to_string</a>(start_id);</div>
<div class="line"><a id="l00063" name="l00063"></a><span class="lineno">   63</span>            mvr.lane_change_maneuver.ending_lane_id = <a class="code hl_function" href="namespacecarma__cooperative__perception.html#a64b708654c8aecb09122d39577df31b5">std::to_string</a>(end_id);</div>
<div class="line"><a id="l00064" name="l00064"></a><span class="lineno">   64</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00065" name="l00065"></a><span class="lineno">   65</span>        <span class="keywordflow">case</span> carma_planning_msgs::msg::Maneuver::INTERSECTION_TRANSIT_STRAIGHT:</div>
<div class="line"><a id="l00066" name="l00066"></a><span class="lineno">   66</span>            mvr.intersection_transit_straight_maneuver.starting_lane_id = <a class="code hl_function" href="namespacecarma__cooperative__perception.html#a64b708654c8aecb09122d39577df31b5">std::to_string</a>(start_id);</div>
<div class="line"><a id="l00067" name="l00067"></a><span class="lineno">   67</span>            mvr.intersection_transit_straight_maneuver.ending_lane_id = <a class="code hl_function" href="namespacecarma__cooperative__perception.html#a64b708654c8aecb09122d39577df31b5">std::to_string</a>(end_id);</div>
<div class="line"><a id="l00068" name="l00068"></a><span class="lineno">   68</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00069" name="l00069"></a><span class="lineno">   69</span>        <span class="keywordflow">case</span> carma_planning_msgs::msg::Maneuver::INTERSECTION_TRANSIT_LEFT_TURN:</div>
<div class="line"><a id="l00070" name="l00070"></a><span class="lineno">   70</span>            mvr.intersection_transit_left_turn_maneuver.starting_lane_id = <a class="code hl_function" href="namespacecarma__cooperative__perception.html#a64b708654c8aecb09122d39577df31b5">std::to_string</a>(start_id);</div>
<div class="line"><a id="l00071" name="l00071"></a><span class="lineno">   71</span>            mvr.intersection_transit_left_turn_maneuver.ending_lane_id = <a class="code hl_function" href="namespacecarma__cooperative__perception.html#a64b708654c8aecb09122d39577df31b5">std::to_string</a>(end_id);</div>
<div class="line"><a id="l00072" name="l00072"></a><span class="lineno">   72</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00073" name="l00073"></a><span class="lineno">   73</span>        <span class="keywordflow">case</span> carma_planning_msgs::msg::Maneuver::INTERSECTION_TRANSIT_RIGHT_TURN:</div>
<div class="line"><a id="l00074" name="l00074"></a><span class="lineno">   74</span>            mvr.intersection_transit_right_turn_maneuver.starting_lane_id = <a class="code hl_function" href="namespacecarma__cooperative__perception.html#a64b708654c8aecb09122d39577df31b5">std::to_string</a>(start_id);</div>
<div class="line"><a id="l00075" name="l00075"></a><span class="lineno">   75</span>            mvr.intersection_transit_right_turn_maneuver.ending_lane_id = <a class="code hl_function" href="namespacecarma__cooperative__perception.html#a64b708654c8aecb09122d39577df31b5">std::to_string</a>(end_id);</div>
<div class="line"><a id="l00076" name="l00076"></a><span class="lineno">   76</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00077" name="l00077"></a><span class="lineno">   77</span>        <span class="keywordflow">case</span> carma_planning_msgs::msg::Maneuver::STOP_AND_WAIT:</div>
<div class="line"><a id="l00078" name="l00078"></a><span class="lineno">   78</span>            mvr.stop_and_wait_maneuver.starting_lane_id = <a class="code hl_function" href="namespacecarma__cooperative__perception.html#a64b708654c8aecb09122d39577df31b5">std::to_string</a>(start_id);</div>
<div class="line"><a id="l00079" name="l00079"></a><span class="lineno">   79</span>            mvr.stop_and_wait_maneuver.ending_lane_id = <a class="code hl_function" href="namespacecarma__cooperative__perception.html#a64b708654c8aecb09122d39577df31b5">std::to_string</a>(end_id);</div>
<div class="line"><a id="l00080" name="l00080"></a><span class="lineno">   80</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00081" name="l00081"></a><span class="lineno">   81</span>        <span class="keywordflow">default</span>:</div>
<div class="line"><a id="l00082" name="l00082"></a><span class="lineno">   82</span>            <span class="keywordflow">throw</span> std::invalid_argument(<span class="stringliteral">&quot;Maneuver type does not have start,end lane ids&quot;</span>);</div>
<div class="line"><a id="l00083" name="l00083"></a><span class="lineno">   83</span>    }</div>
<div class="line"><a id="l00084" name="l00084"></a><span class="lineno">   84</span>}</div>
<div class="line"><a id="l00085" name="l00085"></a><span class="lineno">   85</span> </div>
<div class="line"><a id="l00086" name="l00086"></a><span class="lineno">   86</span>}</div>
<div class="line"><a id="l00087" name="l00087"></a><span class="lineno">   87</span> </div>
<div class="line"><a id="l00088" name="l00088"></a><span class="lineno"><a class="line" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#ad2b1509e197aaf188431df53edaec7c6">   88</a></span>  <a class="code hl_function" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#ad2b1509e197aaf188431df53edaec7c6">RouteFollowingPlugin::RouteFollowingPlugin</a>(<span class="keyword">const</span> rclcpp::NodeOptions &amp;options)</div>
<div class="line"><a id="l00089" name="l00089"></a><span class="lineno">   89</span>      : <a class="code hl_namespace" href="namespacecarma__guidance__plugins.html">carma_guidance_plugins</a>::StrategicPlugin(options), tf2_buffer_(get_clock()), config_(<a class="code hl_struct" href="structroute__following__plugin_1_1Config.html">Config</a>())</div>
<div class="line"><a id="l00090" name="l00090"></a><span class="lineno">   90</span>  {</div>
<div class="line"><a id="l00091" name="l00091"></a><span class="lineno">   91</span>    <span class="comment">// Declare parameters</span></div>
<div class="line"><a id="l00092" name="l00092"></a><span class="lineno">   92</span>    <a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#aa82d7af47d6165efae2967559cf6fe76">config_</a>.<a class="code hl_variable" href="structroute__following__plugin_1_1Config.html#a0cbb8bef75d40988a712e401a69fca1d">min_plan_duration_</a> = declare_parameter&lt;double&gt;(<span class="stringliteral">&quot;minimal_plan_duration&quot;</span>, <a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#aa82d7af47d6165efae2967559cf6fe76">config_</a>.<a class="code hl_variable" href="structroute__following__plugin_1_1Config.html#a0cbb8bef75d40988a712e401a69fca1d">min_plan_duration_</a>);</div>
<div class="line"><a id="l00093" name="l00093"></a><span class="lineno">   93</span>    <a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#aa82d7af47d6165efae2967559cf6fe76">config_</a>.<a class="code hl_variable" href="structroute__following__plugin_1_1Config.html#a3bbcbea2b6e0a3efdcc60ff000a30423">lane_change_plugin_</a>= declare_parameter&lt;std::string&gt;(<span class="stringliteral">&quot;lane_change_plugin&quot;</span>, <a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#aa82d7af47d6165efae2967559cf6fe76">config_</a>.<a class="code hl_variable" href="structroute__following__plugin_1_1Config.html#a3bbcbea2b6e0a3efdcc60ff000a30423">lane_change_plugin_</a>);</div>
<div class="line"><a id="l00094" name="l00094"></a><span class="lineno">   94</span>    <a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#aa82d7af47d6165efae2967559cf6fe76">config_</a>.<a class="code hl_variable" href="structroute__following__plugin_1_1Config.html#a61dbf38ff77488710f53d68dfd68c490">stop_and_wait_plugin_</a> = declare_parameter&lt;std::string&gt;(<span class="stringliteral">&quot;stop_and_wait_plugin&quot;</span>, <a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#aa82d7af47d6165efae2967559cf6fe76">config_</a>.<a class="code hl_variable" href="structroute__following__plugin_1_1Config.html#a61dbf38ff77488710f53d68dfd68c490">stop_and_wait_plugin_</a>);</div>
<div class="line"><a id="l00095" name="l00095"></a><span class="lineno">   95</span>    <a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#aa82d7af47d6165efae2967559cf6fe76">config_</a>.<a class="code hl_variable" href="structroute__following__plugin_1_1Config.html#a0fdf01f60fdb0678d9fda3d7d2e38291">lanefollow_planning_tactical_plugin_</a> = declare_parameter&lt;std::string&gt;(<span class="stringliteral">&quot;lane_following_plugin&quot;</span>, <a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#aa82d7af47d6165efae2967559cf6fe76">config_</a>.<a class="code hl_variable" href="structroute__following__plugin_1_1Config.html#a0fdf01f60fdb0678d9fda3d7d2e38291">lanefollow_planning_tactical_plugin_</a>);</div>
<div class="line"><a id="l00096" name="l00096"></a><span class="lineno">   96</span>    <a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#aa82d7af47d6165efae2967559cf6fe76">config_</a>.<a class="code hl_variable" href="structroute__following__plugin_1_1Config.html#a3470bc2fdd2a28b4d080f9fe2713aa4a">route_end_point_buffer_</a> = declare_parameter&lt;double&gt;(<span class="stringliteral">&quot;guidance/route/destination_downtrack_range&quot;</span>, <a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#aa82d7af47d6165efae2967559cf6fe76">config_</a>.<a class="code hl_variable" href="structroute__following__plugin_1_1Config.html#a3470bc2fdd2a28b4d080f9fe2713aa4a">route_end_point_buffer_</a>);</div>
<div class="line"><a id="l00097" name="l00097"></a><span class="lineno">   97</span>    <a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#aa82d7af47d6165efae2967559cf6fe76">config_</a>.<a class="code hl_variable" href="structroute__following__plugin_1_1Config.html#a7a7ba0615ca6ac7d348a8055f576fa8f">accel_limit_</a> = declare_parameter&lt;double&gt;(<span class="stringliteral">&quot;vehicle_acceleration_limit&quot;</span>, <a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#aa82d7af47d6165efae2967559cf6fe76">config_</a>.<a class="code hl_variable" href="structroute__following__plugin_1_1Config.html#a7a7ba0615ca6ac7d348a8055f576fa8f">accel_limit_</a>);</div>
<div class="line"><a id="l00098" name="l00098"></a><span class="lineno">   98</span>    <a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#aa82d7af47d6165efae2967559cf6fe76">config_</a>.<a class="code hl_variable" href="structroute__following__plugin_1_1Config.html#a8d931f2dc9bd78bd001a1cef0a9fe040">lateral_accel_limit_</a> = declare_parameter&lt;double&gt;(<span class="stringliteral">&quot;vehicle_lateral_accel_limit&quot;</span>, <a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#aa82d7af47d6165efae2967559cf6fe76">config_</a>.<a class="code hl_variable" href="structroute__following__plugin_1_1Config.html#a8d931f2dc9bd78bd001a1cef0a9fe040">lateral_accel_limit_</a>);</div>
<div class="line"><a id="l00099" name="l00099"></a><span class="lineno">   99</span>    <a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#aa82d7af47d6165efae2967559cf6fe76">config_</a>.<a class="code hl_variable" href="structroute__following__plugin_1_1Config.html#ad8ce5533d8d609c69f82a11568f16e50">stopping_accel_limit_multiplier_</a> = declare_parameter&lt;double&gt;(<span class="stringliteral">&quot;stopping_accel_limit_multiplier&quot;</span>, <a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#aa82d7af47d6165efae2967559cf6fe76">config_</a>.<a class="code hl_variable" href="structroute__following__plugin_1_1Config.html#ad8ce5533d8d609c69f82a11568f16e50">stopping_accel_limit_multiplier_</a>);</div>
<div class="line"><a id="l00100" name="l00100"></a><span class="lineno">  100</span>    <a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#aa82d7af47d6165efae2967559cf6fe76">config_</a>.<a class="code hl_variable" href="structroute__following__plugin_1_1Config.html#a7ee8465bea603709497a36e9ecd36cec">vehicle_id</a> = declare_parameter&lt;std::string&gt;(<span class="stringliteral">&quot;vehicle_id&quot;</span>, <a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#aa82d7af47d6165efae2967559cf6fe76">config_</a>.<a class="code hl_variable" href="structroute__following__plugin_1_1Config.html#a7ee8465bea603709497a36e9ecd36cec">vehicle_id</a>);</div>
<div class="line"><a id="l00101" name="l00101"></a><span class="lineno">  101</span>    <a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#aa82d7af47d6165efae2967559cf6fe76">config_</a>.<a class="code hl_variable" href="structroute__following__plugin_1_1Config.html#a9cae5fa7d5eb58d2be34b101958a131c">min_maneuver_length_</a> = declare_parameter&lt;double&gt;(<span class="stringliteral">&quot;min_maneuver_length&quot;</span>, <a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#aa82d7af47d6165efae2967559cf6fe76">config_</a>.<a class="code hl_variable" href="structroute__following__plugin_1_1Config.html#a9cae5fa7d5eb58d2be34b101958a131c">min_maneuver_length_</a>);</div>
<div class="line"><a id="l00102" name="l00102"></a><span class="lineno">  102</span>  }</div>
<div class="line"><a id="l00103" name="l00103"></a><span class="lineno">  103</span> </div>
<div class="line"><a id="l00104" name="l00104"></a><span class="lineno"><a class="line" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a06ac08c84b45dca29ec5236604dfe64e">  104</a></span>  carma_ros2_utils::CallbackReturn <a class="code hl_function" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a06ac08c84b45dca29ec5236604dfe64e">RouteFollowingPlugin::on_configure_plugin</a>()</div>
<div class="line"><a id="l00105" name="l00105"></a><span class="lineno">  105</span>  {</div>
<div class="line"><a id="l00106" name="l00106"></a><span class="lineno">  106</span>    <a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#aa82d7af47d6165efae2967559cf6fe76">config_</a> = <a class="code hl_struct" href="structroute__following__plugin_1_1Config.html">Config</a>();</div>
<div class="line"><a id="l00107" name="l00107"></a><span class="lineno">  107</span> </div>
<div class="line"><a id="l00108" name="l00108"></a><span class="lineno">  108</span>    get_parameter&lt;double&gt;(<span class="stringliteral">&quot;minimal_plan_duration&quot;</span>, <a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#aa82d7af47d6165efae2967559cf6fe76">config_</a>.<a class="code hl_variable" href="structroute__following__plugin_1_1Config.html#a0cbb8bef75d40988a712e401a69fca1d">min_plan_duration_</a>);</div>
<div class="line"><a id="l00109" name="l00109"></a><span class="lineno">  109</span>    get_parameter&lt;std::string&gt;(<span class="stringliteral">&quot;lane_change_plugin&quot;</span>, <a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#aa82d7af47d6165efae2967559cf6fe76">config_</a>.<a class="code hl_variable" href="structroute__following__plugin_1_1Config.html#a3bbcbea2b6e0a3efdcc60ff000a30423">lane_change_plugin_</a>);</div>
<div class="line"><a id="l00110" name="l00110"></a><span class="lineno">  110</span>    get_parameter&lt;std::string&gt;(<span class="stringliteral">&quot;stop_and_wait_plugin&quot;</span>, <a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#aa82d7af47d6165efae2967559cf6fe76">config_</a>.<a class="code hl_variable" href="structroute__following__plugin_1_1Config.html#a61dbf38ff77488710f53d68dfd68c490">stop_and_wait_plugin_</a>);</div>
<div class="line"><a id="l00111" name="l00111"></a><span class="lineno">  111</span>    get_parameter&lt;std::string&gt;(<span class="stringliteral">&quot;lane_following_plugin&quot;</span>, <a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#aa82d7af47d6165efae2967559cf6fe76">config_</a>.<a class="code hl_variable" href="structroute__following__plugin_1_1Config.html#a0fdf01f60fdb0678d9fda3d7d2e38291">lanefollow_planning_tactical_plugin_</a>);</div>
<div class="line"><a id="l00112" name="l00112"></a><span class="lineno">  112</span>    get_parameter&lt;double&gt;(<span class="stringliteral">&quot;guidance/route/destination_downtrack_range&quot;</span>, <a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#aa82d7af47d6165efae2967559cf6fe76">config_</a>.<a class="code hl_variable" href="structroute__following__plugin_1_1Config.html#a3470bc2fdd2a28b4d080f9fe2713aa4a">route_end_point_buffer_</a>);</div>
<div class="line"><a id="l00113" name="l00113"></a><span class="lineno">  113</span>    get_parameter&lt;double&gt;(<span class="stringliteral">&quot;vehicle_acceleration_limit&quot;</span>, <a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#aa82d7af47d6165efae2967559cf6fe76">config_</a>.<a class="code hl_variable" href="structroute__following__plugin_1_1Config.html#a7a7ba0615ca6ac7d348a8055f576fa8f">accel_limit_</a>);</div>
<div class="line"><a id="l00114" name="l00114"></a><span class="lineno">  114</span>    get_parameter&lt;double&gt;(<span class="stringliteral">&quot;vehicle_lateral_accel_limit&quot;</span>, <a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#aa82d7af47d6165efae2967559cf6fe76">config_</a>.<a class="code hl_variable" href="structroute__following__plugin_1_1Config.html#a8d931f2dc9bd78bd001a1cef0a9fe040">lateral_accel_limit_</a>);</div>
<div class="line"><a id="l00115" name="l00115"></a><span class="lineno">  115</span>    get_parameter&lt;double&gt;(<span class="stringliteral">&quot;stopping_accel_limit_multiplier&quot;</span>, <a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#aa82d7af47d6165efae2967559cf6fe76">config_</a>.<a class="code hl_variable" href="structroute__following__plugin_1_1Config.html#ad8ce5533d8d609c69f82a11568f16e50">stopping_accel_limit_multiplier_</a>);</div>
<div class="line"><a id="l00116" name="l00116"></a><span class="lineno">  116</span>    get_parameter&lt;double&gt;(<span class="stringliteral">&quot;min_maneuver_length&quot;</span>, <a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#aa82d7af47d6165efae2967559cf6fe76">config_</a>.<a class="code hl_variable" href="structroute__following__plugin_1_1Config.html#a9cae5fa7d5eb58d2be34b101958a131c">min_maneuver_length_</a>);</div>
<div class="line"><a id="l00117" name="l00117"></a><span class="lineno">  117</span>    </div>
<div class="line"><a id="l00118" name="l00118"></a><span class="lineno">  118</span>    RCLCPP_INFO_STREAM(rclcpp::get_logger(<span class="stringliteral">&quot;route_following_plugin&quot;</span>), <span class="stringliteral">&quot;RouteFollowingPlugin Config: &quot;</span> &lt;&lt; <a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#aa82d7af47d6165efae2967559cf6fe76">config_</a>);</div>
<div class="line"><a id="l00119" name="l00119"></a><span class="lineno">  119</span> </div>
<div class="line"><a id="l00120" name="l00120"></a><span class="lineno">  120</span>    <span class="comment">// Setup subscribers</span></div>
<div class="line"><a id="l00121" name="l00121"></a><span class="lineno">  121</span>    <a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#ac34b11de0eb1b225341e6b8cf20c3faf">twist_sub_</a> = create_subscription&lt;geometry_msgs::msg::TwistStamped&gt;(<span class="stringliteral">&quot;current_velocity&quot;</span>, 50,</div>
<div class="line"><a id="l00122" name="l00122"></a><span class="lineno">  122</span>                                                              std::bind(&amp;<a class="code hl_function" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a87d3775c64efb567d517f2be287c78d7">RouteFollowingPlugin::twist_cb</a>,<span class="keyword">this</span>,std_ph::_1));</div>
<div class="line"><a id="l00123" name="l00123"></a><span class="lineno">  123</span>    <a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a958ec1b9ce5480c6e9af6313c913ec85">current_maneuver_plan_sub_</a> = create_subscription&lt;carma_planning_msgs::msg::ManeuverPlan&gt;(<span class="stringliteral">&quot;maneuver_plan&quot;</span>, 50,</div>
<div class="line"><a id="l00124" name="l00124"></a><span class="lineno">  124</span>                                                              std::bind(&amp;<a class="code hl_function" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a86a93ad88943fbf56ac87195706ea25a">RouteFollowingPlugin::current_maneuver_plan_cb</a>,<span class="keyword">this</span>,std_ph::_1));</div>
<div class="line"><a id="l00125" name="l00125"></a><span class="lineno">  125</span>    </div>
<div class="line"><a id="l00126" name="l00126"></a><span class="lineno">  126</span>    <span class="comment">// set world model point form wm listener</span></div>
<div class="line"><a id="l00127" name="l00127"></a><span class="lineno">  127</span>    <a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a97e8eff5885a9de9769304019b6c5a79">wml_</a> = <a class="code hl_function" href="classcarma__guidance__plugins_1_1PluginBaseNode.html#aa1abc8998e6a33bb3e999379d3d87063">get_world_model_listener</a>();</div>
<div class="line"><a id="l00128" name="l00128"></a><span class="lineno">  128</span> </div>
<div class="line"><a id="l00129" name="l00129"></a><span class="lineno">  129</span>    <a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#af6f7bdeb8816c83b212f6329f8e5652d">wm_</a> = <a class="code hl_function" href="classcarma__guidance__plugins_1_1PluginBaseNode.html#a50b54d5c4cc5180eeef0c78c55f70ec3">get_world_model</a>();</div>
<div class="line"><a id="l00130" name="l00130"></a><span class="lineno">  130</span> </div>
<div class="line"><a id="l00131" name="l00131"></a><span class="lineno">  131</span>    <span class="comment">//set a route callback to update route and calculate maneuver</span></div>
<div class="line"><a id="l00132" name="l00132"></a><span class="lineno">  132</span>    <a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a97e8eff5885a9de9769304019b6c5a79">wml_</a>-&gt;setRouteCallback([<span class="keyword">this</span>]() {</div>
<div class="line"><a id="l00133" name="l00133"></a><span class="lineno">  133</span>        RCLCPP_INFO_STREAM(get_logger(),<span class="stringliteral">&quot;Recomputing maneuvers due to a route update&quot;</span>);</div>
<div class="line"><a id="l00134" name="l00134"></a><span class="lineno">  134</span>        this-&gt;<a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a1ca1f0aa227e0d9c2bae6f6f2db9a3ff">latest_maneuver_plan_</a> = <a class="code hl_function" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a5bb267649d296b57b85b6bf3d6868ee6">routeCb</a>(<a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#af6f7bdeb8816c83b212f6329f8e5652d">wm_</a>-&gt;getRoute()-&gt;shortestPath());</div>
<div class="line"><a id="l00135" name="l00135"></a><span class="lineno">  135</span>    });</div>
<div class="line"><a id="l00136" name="l00136"></a><span class="lineno">  136</span> </div>
<div class="line"><a id="l00137" name="l00137"></a><span class="lineno">  137</span>    <a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a97e8eff5885a9de9769304019b6c5a79">wml_</a>-&gt;setMapCallback([<span class="keyword">this</span>]() {</div>
<div class="line"><a id="l00138" name="l00138"></a><span class="lineno">  138</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#af6f7bdeb8816c83b212f6329f8e5652d">wm_</a>-&gt;getRoute()) { <span class="comment">// If this map update occured after a route was provided we need to regenerate maneuvers</span></div>
<div class="line"><a id="l00139" name="l00139"></a><span class="lineno">  139</span>            RCLCPP_INFO_STREAM(get_logger(),<span class="stringliteral">&quot;Recomputing maneuvers due to map update&quot;</span>);</div>
<div class="line"><a id="l00140" name="l00140"></a><span class="lineno">  140</span>            this-&gt;<a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a1ca1f0aa227e0d9c2bae6f6f2db9a3ff">latest_maneuver_plan_</a> = <a class="code hl_function" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a5bb267649d296b57b85b6bf3d6868ee6">routeCb</a>(<a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#af6f7bdeb8816c83b212f6329f8e5652d">wm_</a>-&gt;getRoute()-&gt;shortestPath());</div>
<div class="line"><a id="l00141" name="l00141"></a><span class="lineno">  141</span>        }</div>
<div class="line"><a id="l00142" name="l00142"></a><span class="lineno">  142</span>    });</div>
<div class="line"><a id="l00143" name="l00143"></a><span class="lineno">  143</span> </div>
<div class="line"><a id="l00144" name="l00144"></a><span class="lineno">  144</span>    <a class="code hl_function" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a18bd2ba5768eccc53a7ffab0cd01e251">initializeBumperTransformLookup</a>();</div>
<div class="line"><a id="l00145" name="l00145"></a><span class="lineno">  145</span>    </div>
<div class="line"><a id="l00146" name="l00146"></a><span class="lineno">  146</span>    <span class="comment">// Return success if everthing initialized successfully</span></div>
<div class="line"><a id="l00147" name="l00147"></a><span class="lineno">  147</span>    <span class="keywordflow">return</span> CallbackReturn::SUCCESS;</div>
<div class="line"><a id="l00148" name="l00148"></a><span class="lineno">  148</span>  }</div>
<div class="line"><a id="l00149" name="l00149"></a><span class="lineno">  149</span> </div>
<div class="line"><a id="l00150" name="l00150"></a><span class="lineno"><a class="line" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a95a998d3cc7b56a8c31ea3b11fcd3e8a">  150</a></span>    carma_ros2_utils::CallbackReturn <a class="code hl_function" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a95a998d3cc7b56a8c31ea3b11fcd3e8a">RouteFollowingPlugin::on_activate_plugin</a>()</div>
<div class="line"><a id="l00151" name="l00151"></a><span class="lineno">  151</span>    {</div>
<div class="line"><a id="l00152" name="l00152"></a><span class="lineno">  152</span>        <a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a70c7d9e9948e3804375093159986335e">bumper_pose_timer_</a> = create_timer(get_clock(),</div>
<div class="line"><a id="l00153" name="l00153"></a><span class="lineno">  153</span>            std::chrono::milliseconds(100),</div>
<div class="line"><a id="l00154" name="l00154"></a><span class="lineno">  154</span>            std::bind(&amp;<a class="code hl_function" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a65fc4245c9eb4f377690321e322c532d">RouteFollowingPlugin::bumper_pose_cb</a>, <span class="keyword">this</span>));</div>
<div class="line"><a id="l00155" name="l00155"></a><span class="lineno">  155</span> </div>
<div class="line"><a id="l00156" name="l00156"></a><span class="lineno">  156</span>        <span class="comment">// Return success if everthing initialized successfully</span></div>
<div class="line"><a id="l00157" name="l00157"></a><span class="lineno">  157</span>        <span class="keywordflow">return</span> CallbackReturn::SUCCESS;</div>
<div class="line"><a id="l00158" name="l00158"></a><span class="lineno">  158</span>    }</div>
<div class="line"><a id="l00159" name="l00159"></a><span class="lineno">  159</span>    </div>
<div class="line"><a id="l00160" name="l00160"></a><span class="lineno"><a class="line" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a87d3775c64efb567d517f2be287c78d7">  160</a></span>    <span class="keywordtype">void</span> <a class="code hl_function" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a87d3775c64efb567d517f2be287c78d7">RouteFollowingPlugin::twist_cb</a>(geometry_msgs::msg::TwistStamped::UniquePtr msg)</div>
<div class="line"><a id="l00161" name="l00161"></a><span class="lineno">  161</span>    {</div>
<div class="line"><a id="l00162" name="l00162"></a><span class="lineno">  162</span>        <a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a8196136dd512e85294fdd2bd07e3dc81">current_speed_</a> = msg-&gt;twist.linear.x;</div>
<div class="line"><a id="l00163" name="l00163"></a><span class="lineno">  163</span>    }</div>
<div class="line"><a id="l00164" name="l00164"></a><span class="lineno">  164</span>    </div>
<div class="line"><a id="l00165" name="l00165"></a><span class="lineno"><a class="line" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a86a93ad88943fbf56ac87195706ea25a">  165</a></span>    <span class="keywordtype">void</span> <a class="code hl_function" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a86a93ad88943fbf56ac87195706ea25a">RouteFollowingPlugin::current_maneuver_plan_cb</a>(carma_planning_msgs::msg::ManeuverPlan::UniquePtr msg) {</div>
<div class="line"><a id="l00166" name="l00166"></a><span class="lineno">  166</span>        <a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a63a313f71c81a7c616b2cdf99278c019">current_maneuver_plan_</a> = std::move(msg);</div>
<div class="line"><a id="l00167" name="l00167"></a><span class="lineno">  167</span>    }</div>
<div class="line"><a id="l00168" name="l00168"></a><span class="lineno">  168</span> </div>
<div class="line"><a id="l00169" name="l00169"></a><span class="lineno"><a class="line" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a5bb267649d296b57b85b6bf3d6868ee6">  169</a></span>    std::vector&lt;carma_planning_msgs::msg::Maneuver&gt; <a class="code hl_function" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a5bb267649d296b57b85b6bf3d6868ee6">RouteFollowingPlugin::routeCb</a>(<span class="keyword">const</span> lanelet::routing::LaneletPath &amp;route_shortest_path)</div>
<div class="line"><a id="l00170" name="l00170"></a><span class="lineno">  170</span>    {</div>
<div class="line"><a id="l00171" name="l00171"></a><span class="lineno">  171</span>        </div>
<div class="line"><a id="l00172" name="l00172"></a><span class="lineno">  172</span>        </div>
<div class="line"><a id="l00173" name="l00173"></a><span class="lineno">  173</span>        <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; ll:route_shortest_path)</div>
<div class="line"><a id="l00174" name="l00174"></a><span class="lineno">  174</span>        {</div>
<div class="line"><a id="l00175" name="l00175"></a><span class="lineno">  175</span>            <a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a2bc08e9528ebb74c9ab296479b366cf5">shortest_path_set_</a>.insert(ll.id());</div>
<div class="line"><a id="l00176" name="l00176"></a><span class="lineno">  176</span>        }</div>
<div class="line"><a id="l00177" name="l00177"></a><span class="lineno">  177</span>        std::vector&lt;carma_planning_msgs::msg::Maneuver&gt; maneuvers;</div>
<div class="line"><a id="l00178" name="l00178"></a><span class="lineno">  178</span>        <span class="comment">//This function calculates the maneuver plan every time the route is set</span></div>
<div class="line"><a id="l00179" name="l00179"></a><span class="lineno">  179</span>        RCLCPP_DEBUG_STREAM(get_logger(),<span class="stringliteral">&quot;New route created&quot;</span>);</div>
<div class="line"><a id="l00180" name="l00180"></a><span class="lineno">  180</span> </div>
<div class="line"><a id="l00181" name="l00181"></a><span class="lineno">  181</span>        <span class="comment">//Go through entire route - identify lane changes and fill in the spaces with lane following</span></div>
<div class="line"><a id="l00182" name="l00182"></a><span class="lineno">  182</span>        <span class="keyword">auto</span> nearest_lanelets = lanelet::geometry::findNearest(<a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#af6f7bdeb8816c83b212f6329f8e5652d">wm_</a>-&gt;getMap()-&gt;laneletLayer, <a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a50db56b0b24748b350ff88d067e23676">current_loc_</a>, 10); <span class="comment">//Return 10 nearest lanelets</span></div>
<div class="line"><a id="l00183" name="l00183"></a><span class="lineno">  183</span>        <span class="keywordflow">if</span> (nearest_lanelets.empty())</div>
<div class="line"><a id="l00184" name="l00184"></a><span class="lineno">  184</span>        {</div>
<div class="line"><a id="l00185" name="l00185"></a><span class="lineno">  185</span>            RCLCPP_WARN_STREAM(get_logger(),<span class="stringliteral">&quot;Cannot find any lanelet in map!&quot;</span>);</div>
<div class="line"><a id="l00186" name="l00186"></a><span class="lineno">  186</span> </div>
<div class="line"><a id="l00187" name="l00187"></a><span class="lineno">  187</span>            <span class="keywordflow">return</span> maneuvers;</div>
<div class="line"><a id="l00188" name="l00188"></a><span class="lineno">  188</span>        }</div>
<div class="line"><a id="l00189" name="l00189"></a><span class="lineno">  189</span> </div>
<div class="line"><a id="l00190" name="l00190"></a><span class="lineno">  190</span>        maneuvers.reserve(route_shortest_path.size());</div>
<div class="line"><a id="l00191" name="l00191"></a><span class="lineno">  191</span> </div>
<div class="line"><a id="l00192" name="l00192"></a><span class="lineno">  192</span>        <span class="keywordtype">double</span> route_length = <a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#af6f7bdeb8816c83b212f6329f8e5652d">wm_</a>-&gt;getRouteEndTrackPos().downtrack;</div>
<div class="line"><a id="l00193" name="l00193"></a><span class="lineno">  193</span>        <span class="keywordtype">double</span> start_dist = 0.0;</div>
<div class="line"><a id="l00194" name="l00194"></a><span class="lineno">  194</span>        <span class="keywordtype">double</span> end_dist = 0.0;</div>
<div class="line"><a id="l00195" name="l00195"></a><span class="lineno">  195</span>        <span class="keywordtype">double</span> start_speed = 0.0;</div>
<div class="line"><a id="l00196" name="l00196"></a><span class="lineno">  196</span> </div>
<div class="line"><a id="l00197" name="l00197"></a><span class="lineno">  197</span>        <span class="keywordtype">size_t</span> shortest_path_index;</div>
<div class="line"><a id="l00198" name="l00198"></a><span class="lineno">  198</span>        <span class="comment">//Find lane changes in path - up to the second to last lanelet in path (till lane change is possible)</span></div>
<div class="line"><a id="l00199" name="l00199"></a><span class="lineno">  199</span>        <span class="keywordflow">for</span> (shortest_path_index = 0; shortest_path_index &lt; route_shortest_path.size() - 1; ++shortest_path_index)</div>
<div class="line"><a id="l00200" name="l00200"></a><span class="lineno">  200</span>        {</div>
<div class="line"><a id="l00201" name="l00201"></a><span class="lineno">  201</span>            RCLCPP_DEBUG_STREAM(get_logger(),<span class="stringliteral">&quot;current shortest_path_index:&quot;</span> &lt;&lt; shortest_path_index);</div>
<div class="line"><a id="l00202" name="l00202"></a><span class="lineno">  202</span> </div>
<div class="line"><a id="l00203" name="l00203"></a><span class="lineno">  203</span>            <span class="keyword">auto</span> following_lanelets = <a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#af6f7bdeb8816c83b212f6329f8e5652d">wm_</a>-&gt;getRoute()-&gt;followingRelations(route_shortest_path[shortest_path_index]);</div>
<div class="line"><a id="l00204" name="l00204"></a><span class="lineno">  204</span>            RCLCPP_DEBUG_STREAM(get_logger(),<span class="stringliteral">&quot;following_lanelets.size():&quot;</span> &lt;&lt; following_lanelets.size());</div>
<div class="line"><a id="l00205" name="l00205"></a><span class="lineno">  205</span> </div>
<div class="line"><a id="l00206" name="l00206"></a><span class="lineno">  206</span>            <span class="keywordtype">double</span> target_speed_in_lanelet = <a class="code hl_function" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a8bf5a4eb692d33202958a1f6ed71151c">findSpeedLimit</a>(route_shortest_path[shortest_path_index]);</div>
<div class="line"><a id="l00207" name="l00207"></a><span class="lineno">  207</span> </div>
<div class="line"><a id="l00208" name="l00208"></a><span class="lineno">  208</span>            <span class="comment">//update start distance and start speed from previous maneuver if it exists</span></div>
<div class="line"><a id="l00209" name="l00209"></a><span class="lineno">  209</span>            start_dist = (maneuvers.empty()) ? <a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#af6f7bdeb8816c83b212f6329f8e5652d">wm_</a>-&gt;routeTrackPos(route_shortest_path[shortest_path_index].centerline2d().front()).downtrack : <a class="code hl_define" href="approaching__emergency__vehicle__plugin__node_8hpp.html#a066f948508e087006568cb6c9b0674a7">GET_MANEUVER_PROPERTY</a>(maneuvers.back(), end_dist); <span class="comment">// TODO_REFAC if there is no initial maneuver start distance and start speed should be derived from current state. Current state ought to be provided in planning request</span></div>
<div class="line"><a id="l00210" name="l00210"></a><span class="lineno">  210</span>            start_speed = (maneuvers.empty()) ? 0.0 : <a class="code hl_function" href="namespaceroute__following__plugin_1_1anonymous__namespace_02route__following__plugin_8cpp_03.html#a9b29dd085f9f59d468b1c9320f0b5102">getManeuverEndSpeed</a>(maneuvers.back());</div>
<div class="line"><a id="l00211" name="l00211"></a><span class="lineno">  211</span>            RCLCPP_DEBUG_STREAM(get_logger(),<span class="stringliteral">&quot;start_dist:&quot;</span> &lt;&lt; start_dist &lt;&lt; <span class="stringliteral">&quot;, start_speed:&quot;</span> &lt;&lt; start_speed);</div>
<div class="line"><a id="l00212" name="l00212"></a><span class="lineno">  212</span> </div>
<div class="line"><a id="l00213" name="l00213"></a><span class="lineno">  213</span>            end_dist = <a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#af6f7bdeb8816c83b212f6329f8e5652d">wm_</a>-&gt;routeTrackPos(route_shortest_path[shortest_path_index].centerline2d().back()).downtrack;</div>
<div class="line"><a id="l00214" name="l00214"></a><span class="lineno">  214</span>            RCLCPP_DEBUG_STREAM(get_logger(),<span class="stringliteral">&quot;end_dist:&quot;</span> &lt;&lt; end_dist);</div>
<div class="line"><a id="l00215" name="l00215"></a><span class="lineno">  215</span>            end_dist = std::min(end_dist, route_length);</div>
<div class="line"><a id="l00216" name="l00216"></a><span class="lineno">  216</span>            RCLCPP_DEBUG_STREAM(get_logger(),<span class="stringliteral">&quot;min end_dist:&quot;</span> &lt;&lt; end_dist);</div>
<div class="line"><a id="l00217" name="l00217"></a><span class="lineno">  217</span> </div>
<div class="line"><a id="l00218" name="l00218"></a><span class="lineno">  218</span>            <span class="keywordflow">if</span> (std::fabs(start_dist - end_dist) &lt; 0.1) <span class="comment">//TODO: edge case that was not recreatable. Sometimes start and end dist was same which crashes inlanecruising</span></div>
<div class="line"><a id="l00219" name="l00219"></a><span class="lineno">  219</span>            {</div>
<div class="line"><a id="l00220" name="l00220"></a><span class="lineno">  220</span>                RCLCPP_WARN_STREAM(get_logger(),<span class="stringliteral">&quot;start and end dist are equal! shortest path id&quot;</span> &lt;&lt; shortest_path_index &lt;&lt; <span class="stringliteral">&quot;, lanelet id:&quot;</span> &lt;&lt; route_shortest_path[shortest_path_index].<span class="keywordtype">id</span>() &lt;&lt;</div>
<div class="line"><a id="l00221" name="l00221"></a><span class="lineno">  221</span>                    <span class="stringliteral">&quot;, start and end dist:&quot;</span> &lt;&lt; start_dist);</div>
<div class="line"><a id="l00222" name="l00222"></a><span class="lineno">  222</span>                <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00223" name="l00223"></a><span class="lineno">  223</span>            }</div>
<div class="line"><a id="l00224" name="l00224"></a><span class="lineno">  224</span> </div>
<div class="line"><a id="l00225" name="l00225"></a><span class="lineno">  225</span> </div>
<div class="line"><a id="l00226" name="l00226"></a><span class="lineno">  226</span> </div>
<div class="line"><a id="l00227" name="l00227"></a><span class="lineno">  227</span>            <span class="keywordflow">if</span> (<a class="code hl_function" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a8e0fd7dd9f9a88105188469767d99dee">isLaneChangeNeeded</a>(following_lanelets, route_shortest_path[shortest_path_index + 1].<span class="keywordtype">id</span>()))</div>
<div class="line"><a id="l00228" name="l00228"></a><span class="lineno">  228</span>            {</div>
<div class="line"><a id="l00229" name="l00229"></a><span class="lineno">  229</span>                RCLCPP_DEBUG_STREAM(get_logger(),<span class="stringliteral">&quot;LaneChangeNeeded&quot;</span>);</div>
<div class="line"><a id="l00230" name="l00230"></a><span class="lineno">  230</span>    </div>
<div class="line"><a id="l00231" name="l00231"></a><span class="lineno">  231</span>                <span class="comment">// Determine the Lane Change Status</span></div>
<div class="line"><a id="l00232" name="l00232"></a><span class="lineno">  232</span>                RCLCPP_DEBUG_STREAM(get_logger(),<span class="stringliteral">&quot;Recording lanechange start_dist &lt;&lt;&quot;</span> &lt;&lt; start_dist  &lt;&lt; <span class="stringliteral">&quot;, from llt id:&quot;</span> &lt;&lt; route_shortest_path[shortest_path_index].<span class="keywordtype">id</span>() &lt;&lt; <span class="stringliteral">&quot; to llt id: &quot;</span> &lt;&lt; </div>
<div class="line"><a id="l00233" name="l00233"></a><span class="lineno">  233</span>                    route_shortest_path[shortest_path_index+ 1].<span class="keywordtype">id</span>());</div>
<div class="line"><a id="l00234" name="l00234"></a><span class="lineno">  234</span> </div>
<div class="line"><a id="l00235" name="l00235"></a><span class="lineno">  235</span>                maneuvers.push_back(<a class="code hl_function" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a4a984f6bd1178a6d79886321c8680c7e">composeLaneChangeManeuverMessage</a>(start_dist, end_dist, start_speed, target_speed_in_lanelet, route_shortest_path[shortest_path_index].<span class="keywordtype">id</span>(), route_shortest_path[shortest_path_index + 1].<span class="keywordtype">id</span>()));</div>
<div class="line"><a id="l00236" name="l00236"></a><span class="lineno">  236</span>                ++shortest_path_index; <span class="comment">//Since lane change covers 2 lanelets - skip planning for the next lanelet</span></div>
<div class="line"><a id="l00237" name="l00237"></a><span class="lineno">  237</span> </div>
<div class="line"><a id="l00238" name="l00238"></a><span class="lineno">  238</span>            }</div>
<div class="line"><a id="l00239" name="l00239"></a><span class="lineno">  239</span>            <span class="keywordflow">else</span></div>
<div class="line"><a id="l00240" name="l00240"></a><span class="lineno">  240</span>            {</div>
<div class="line"><a id="l00241" name="l00241"></a><span class="lineno">  241</span>                RCLCPP_DEBUG_STREAM(get_logger(),<span class="stringliteral">&quot;Lanechange NOT Needed &quot;</span>);</div>
<div class="line"><a id="l00242" name="l00242"></a><span class="lineno">  242</span>                maneuvers.push_back(<a class="code hl_function" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a5e9bb087420ee42250c07ce8b1640509">composeLaneFollowingManeuverMessage</a>(start_dist, end_dist, start_speed, target_speed_in_lanelet, { route_shortest_path[shortest_path_index].id() } ));</div>
<div class="line"><a id="l00243" name="l00243"></a><span class="lineno">  243</span>            }</div>
<div class="line"><a id="l00244" name="l00244"></a><span class="lineno">  244</span>        }</div>
<div class="line"><a id="l00245" name="l00245"></a><span class="lineno">  245</span> </div>
<div class="line"><a id="l00246" name="l00246"></a><span class="lineno">  246</span>        <span class="comment">// Add stop and wait maneuver as last maneuver if there is a lanelet unplanned for in path</span></div>
<div class="line"><a id="l00247" name="l00247"></a><span class="lineno">  247</span>        <span class="keywordflow">if</span> (shortest_path_index &lt; route_shortest_path.size())</div>
<div class="line"><a id="l00248" name="l00248"></a><span class="lineno">  248</span>        {</div>
<div class="line"><a id="l00249" name="l00249"></a><span class="lineno">  249</span> </div>
<div class="line"><a id="l00250" name="l00250"></a><span class="lineno">  250</span>            <span class="comment">// Compute target deceleration for stopping</span></div>
<div class="line"><a id="l00251" name="l00251"></a><span class="lineno">  251</span>            <span class="keywordtype">double</span> stopping_accel_limit = <a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#aa82d7af47d6165efae2967559cf6fe76">config_</a>.<a class="code hl_variable" href="structroute__following__plugin_1_1Config.html#a7a7ba0615ca6ac7d348a8055f576fa8f">accel_limit_</a> * <a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#aa82d7af47d6165efae2967559cf6fe76">config_</a>.<a class="code hl_variable" href="structroute__following__plugin_1_1Config.html#ad8ce5533d8d609c69f82a11568f16e50">stopping_accel_limit_multiplier_</a>;</div>
<div class="line"><a id="l00252" name="l00252"></a><span class="lineno">  252</span> </div>
<div class="line"><a id="l00253" name="l00253"></a><span class="lineno">  253</span>            <span class="comment">// Estimate the entry speed for the stopping maneuver</span></div>
<div class="line"><a id="l00254" name="l00254"></a><span class="lineno">  254</span>            <span class="keywordtype">double</span> stopping_entry_speed = maneuvers.empty() ? <a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a8196136dd512e85294fdd2bd07e3dc81">current_speed_</a> : <a class="code hl_function" href="namespaceroute__following__plugin_1_1anonymous__namespace_02route__following__plugin_8cpp_03.html#a9b29dd085f9f59d468b1c9320f0b5102">getManeuverEndSpeed</a>(maneuvers.back());</div>
<div class="line"><a id="l00255" name="l00255"></a><span class="lineno">  255</span> </div>
<div class="line"><a id="l00256" name="l00256"></a><span class="lineno">  256</span>            <span class="comment">// Add stop and wait maneuver based on deceleration target and entry speed</span></div>
<div class="line"><a id="l00257" name="l00257"></a><span class="lineno">  257</span>            maneuvers = <a class="code hl_function" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#aef98e4f85a3a9dd0ac4f8aa2bccc3077">addStopAndWaitAtRouteEnd</a>( maneuvers, route_length, stopping_entry_speed, stopping_accel_limit, <a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#aa82d7af47d6165efae2967559cf6fe76">config_</a>.<a class="code hl_variable" href="structroute__following__plugin_1_1Config.html#a8d931f2dc9bd78bd001a1cef0a9fe040">lateral_accel_limit_</a>, <a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#aa82d7af47d6165efae2967559cf6fe76">config_</a>.<a class="code hl_variable" href="structroute__following__plugin_1_1Config.html#a9cae5fa7d5eb58d2be34b101958a131c">min_maneuver_length_</a> );</div>
<div class="line"><a id="l00258" name="l00258"></a><span class="lineno">  258</span>        </div>
<div class="line"><a id="l00259" name="l00259"></a><span class="lineno">  259</span>        }</div>
<div class="line"><a id="l00261" name="l00261"></a><span class="lineno">  261</span>        RCLCPP_DEBUG_STREAM(get_logger(),<span class="stringliteral">&quot;Maneuver plan along route successfully generated&quot;</span>);</div>
<div class="line"><a id="l00262" name="l00262"></a><span class="lineno">  262</span>        <span class="keywordflow">return</span> maneuvers;</div>
<div class="line"><a id="l00263" name="l00263"></a><span class="lineno">  263</span>    }</div>
<div class="line"><a id="l00264" name="l00264"></a><span class="lineno">  264</span> </div>
<div class="line"><a id="l00265" name="l00265"></a><span class="lineno"><a class="line" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#aef98e4f85a3a9dd0ac4f8aa2bccc3077">  265</a></span>    std::vector&lt;carma_planning_msgs::msg::Maneuver&gt; <a class="code hl_function" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#aef98e4f85a3a9dd0ac4f8aa2bccc3077">RouteFollowingPlugin::addStopAndWaitAtRouteEnd</a> (</div>
<div class="line"><a id="l00266" name="l00266"></a><span class="lineno">  266</span>        <span class="keyword">const</span> std::vector&lt;carma_planning_msgs::msg::Maneuver&gt;&amp; input_maneuvers, </div>
<div class="line"><a id="l00267" name="l00267"></a><span class="lineno">  267</span>        <span class="keywordtype">double</span> route_end_downtrack, <span class="keywordtype">double</span> stopping_entry_speed, <span class="keywordtype">double</span> stopping_logitudinal_accel,</div>
<div class="line"><a id="l00268" name="l00268"></a><span class="lineno">  268</span>        <span class="keywordtype">double</span> lateral_accel_limit, <span class="keywordtype">double</span> min_maneuver_length</div>
<div class="line"><a id="l00269" name="l00269"></a><span class="lineno">  269</span>    )<span class="keyword"> const</span></div>
<div class="line"><a id="l00270" name="l00270"></a><span class="lineno">  270</span><span class="keyword">    </span>{</div>
<div class="line"><a id="l00271" name="l00271"></a><span class="lineno">  271</span>        RCLCPP_INFO_STREAM(get_logger(),<span class="stringliteral">&quot;Attempting to plan Stop and Wait Maneuver&quot;</span>);</div>
<div class="line"><a id="l00280" name="l00280"></a><span class="lineno">  280</span>        std::vector&lt;carma_planning_msgs::msg::Maneuver&gt; maneuvers = input_maneuvers; <span class="comment">// Output maneuvers which will be modified</span></div>
<div class="line"><a id="l00281" name="l00281"></a><span class="lineno">  281</span> </div>
<div class="line"><a id="l00282" name="l00282"></a><span class="lineno">  282</span> </div>
<div class="line"><a id="l00283" name="l00283"></a><span class="lineno">  283</span>        <span class="comment">// Compute stopping distance where v_f = 0</span></div>
<div class="line"><a id="l00284" name="l00284"></a><span class="lineno">  284</span>        <span class="comment">// (v_f^2 - v_i^2) / (2*a) = d </span></div>
<div class="line"><a id="l00285" name="l00285"></a><span class="lineno">  285</span>        <span class="keywordtype">double</span> stopping_distance = 0.5 * (stopping_entry_speed * stopping_entry_speed) / stopping_logitudinal_accel;</div>
<div class="line"><a id="l00286" name="l00286"></a><span class="lineno">  286</span> </div>
<div class="line"><a id="l00287" name="l00287"></a><span class="lineno">  287</span>        <span class="comment">// Compute required starting downtrack for maneuver</span></div>
<div class="line"><a id="l00288" name="l00288"></a><span class="lineno">  288</span>        <span class="keywordtype">double</span> required_start_downtrack = std::max(0.0, route_end_downtrack - stopping_distance);</div>
<div class="line"><a id="l00289" name="l00289"></a><span class="lineno">  289</span> </div>
<div class="line"><a id="l00290" name="l00290"></a><span class="lineno">  290</span>        <span class="comment">// Loop to drop any maneuvers which fully overlap our stopping maneuver while accounting for minimum length maneuver buffers</span></div>
<div class="line"><a id="l00291" name="l00291"></a><span class="lineno">  291</span>        <span class="keywordflow">while</span> ( !maneuvers.empty() &amp;&amp; <a class="code hl_function" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a56de7f7b08cf3762bca595460ac22a30">maneuverWithBufferStartsAfterDowntrack</a>(maneuvers.back(), required_start_downtrack, lateral_accel_limit, <a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#aa82d7af47d6165efae2967559cf6fe76">config_</a>.<a class="code hl_variable" href="structroute__following__plugin_1_1Config.html#a9cae5fa7d5eb58d2be34b101958a131c">min_maneuver_length_</a>) ) { </div>
<div class="line"><a id="l00292" name="l00292"></a><span class="lineno">  292</span>            </div>
<div class="line"><a id="l00293" name="l00293"></a><span class="lineno">  293</span>            RCLCPP_WARN_STREAM(get_logger(),<span class="stringliteral">&quot;Dropping maneuver with id: &quot;</span> &lt;&lt;  <a class="code hl_define" href="approaching__emergency__vehicle__plugin__node_8hpp.html#a066f948508e087006568cb6c9b0674a7">GET_MANEUVER_PROPERTY</a>(maneuvers.back(), parameters.maneuver_id) );</div>
<div class="line"><a id="l00294" name="l00294"></a><span class="lineno">  294</span> </div>
<div class="line"><a id="l00295" name="l00295"></a><span class="lineno">  295</span>            <span class="keywordflow">if</span> (maneuvers.back().type == carma_planning_msgs::msg::Maneuver::LANE_CHANGE) {</div>
<div class="line"><a id="l00296" name="l00296"></a><span class="lineno">  296</span> </div>
<div class="line"><a id="l00297" name="l00297"></a><span class="lineno">  297</span>                <span class="comment">// TODO develop more robust approach for this case per: https://github.com/usdot-fhwa-stol/carma-platform/issues/1350</span></div>
<div class="line"><a id="l00298" name="l00298"></a><span class="lineno">  298</span>                <span class="keywordflow">throw</span> std::invalid_argument(<span class="stringliteral">&quot;Stopping at the end of the route requires replanning a lane change. RouteFollowing cannot yet handle this case&quot;</span>);</div>
<div class="line"><a id="l00299" name="l00299"></a><span class="lineno">  299</span>            }</div>
<div class="line"><a id="l00300" name="l00300"></a><span class="lineno">  300</span> </div>
<div class="line"><a id="l00301" name="l00301"></a><span class="lineno">  301</span>            maneuvers.pop_back(); <span class="comment">// Drop maneuver</span></div>
<div class="line"><a id="l00302" name="l00302"></a><span class="lineno">  302</span> </div>
<div class="line"><a id="l00303" name="l00303"></a><span class="lineno">  303</span>        }</div>
<div class="line"><a id="l00304" name="l00304"></a><span class="lineno">  304</span> </div>
<div class="line"><a id="l00305" name="l00305"></a><span class="lineno">  305</span>        <span class="keywordtype">double</span> last_maneuver_end_downtrack =  required_start_downtrack; <span class="comment">// Set default starting location for stop and wait maneuver </span></div>
<div class="line"><a id="l00306" name="l00306"></a><span class="lineno">  306</span> </div>
<div class="line"><a id="l00307" name="l00307"></a><span class="lineno">  307</span>        <span class="keywordflow">if</span> ( !maneuvers.empty() ) { <span class="comment">// If there are existing maneuvers we need to make sure stop and wait does not overwrite them</span></div>
<div class="line"><a id="l00308" name="l00308"></a><span class="lineno">  308</span>            </div>
<div class="line"><a id="l00309" name="l00309"></a><span class="lineno">  309</span>            last_maneuver_end_downtrack = <a class="code hl_define" href="approaching__emergency__vehicle__plugin__node_8hpp.html#a066f948508e087006568cb6c9b0674a7">GET_MANEUVER_PROPERTY</a>(maneuvers.back(), end_dist);</div>
<div class="line"><a id="l00310" name="l00310"></a><span class="lineno">  310</span>            </div>
<div class="line"><a id="l00311" name="l00311"></a><span class="lineno">  311</span>            <span class="comment">// If our stopping maneuver does not intersect with existing maneuvers</span></div>
<div class="line"><a id="l00312" name="l00312"></a><span class="lineno">  312</span>            <span class="keywordflow">if</span> ( required_start_downtrack &gt;=  last_maneuver_end_downtrack ) {  </div>
<div class="line"><a id="l00313" name="l00313"></a><span class="lineno">  313</span>                </div>
<div class="line"><a id="l00314" name="l00314"></a><span class="lineno">  314</span>                <span class="comment">// If the delta is under minimum_maneuver_length we can just extend the stopping maneuver</span></div>
<div class="line"><a id="l00315" name="l00315"></a><span class="lineno">  315</span>                <span class="comment">// Otherwise add a new lane follow maneuver</span></div>
<div class="line"><a id="l00316" name="l00316"></a><span class="lineno">  316</span>                <span class="keywordflow">if</span> (required_start_downtrack - last_maneuver_end_downtrack &gt; min_maneuver_length) {</div>
<div class="line"><a id="l00317" name="l00317"></a><span class="lineno">  317</span>                 </div>
<div class="line"><a id="l00318" name="l00318"></a><span class="lineno">  318</span>                    <span class="comment">// Identify the lanelets which will be crossed by this lane follow maneuver</span></div>
<div class="line"><a id="l00319" name="l00319"></a><span class="lineno">  319</span>                    std::vector&lt;lanelet::ConstLanelet&gt; crossed_lanelets = <a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#af6f7bdeb8816c83b212f6329f8e5652d">wm_</a>-&gt;getLaneletsBetween(last_maneuver_end_downtrack, required_start_downtrack, <span class="keyword">true</span>, <span class="keyword">false</span>); </div>
<div class="line"><a id="l00320" name="l00320"></a><span class="lineno">  320</span> </div>
<div class="line"><a id="l00321" name="l00321"></a><span class="lineno">  321</span>                    <span class="keywordflow">if</span> (crossed_lanelets.empty()) {</div>
<div class="line"><a id="l00322" name="l00322"></a><span class="lineno">  322</span>                        <span class="keywordflow">throw</span> std::invalid_argument(<span class="stringliteral">&quot;The new lane follow maneuver does not cross any lanelets going from: &quot;</span> + <a class="code hl_function" href="namespacecarma__cooperative__perception.html#a64b708654c8aecb09122d39577df31b5">std::to_string</a>(last_maneuver_end_downtrack) + <span class="stringliteral">&quot; to: &quot;</span> + <a class="code hl_function" href="namespacecarma__cooperative__perception.html#a64b708654c8aecb09122d39577df31b5">std::to_string</a>(required_start_downtrack));</div>
<div class="line"><a id="l00323" name="l00323"></a><span class="lineno">  323</span>                    }</div>
<div class="line"><a id="l00324" name="l00324"></a><span class="lineno">  324</span> </div>
<div class="line"><a id="l00325" name="l00325"></a><span class="lineno">  325</span>                    <span class="comment">// Create the lane follow maneuver</span></div>
<div class="line"><a id="l00326" name="l00326"></a><span class="lineno">  326</span>                    maneuvers.push_back(<a class="code hl_function" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a5e9bb087420ee42250c07ce8b1640509">composeLaneFollowingManeuverMessage</a>(last_maneuver_end_downtrack, required_start_downtrack, stopping_entry_speed, stopping_entry_speed, lanelet::utils::transform(crossed_lanelets, [](<span class="keyword">auto</span> ll) { <span class="keywordflow">return</span> ll.id(); })));</div>
<div class="line"><a id="l00327" name="l00327"></a><span class="lineno">  327</span>                    </div>
<div class="line"><a id="l00328" name="l00328"></a><span class="lineno">  328</span>                    <span class="comment">// Update last maneuver end downtrack so the stop and wait maneuver can be properly formulated</span></div>
<div class="line"><a id="l00329" name="l00329"></a><span class="lineno">  329</span>                    last_maneuver_end_downtrack = required_start_downtrack; </div>
<div class="line"><a id="l00330" name="l00330"></a><span class="lineno">  330</span>                } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00331" name="l00331"></a><span class="lineno">  331</span>                    RCLCPP_DEBUG_STREAM(get_logger(),<span class="stringliteral">&quot;Stop and wait maneuver being extended to nearest maneuver which is closer than the minimum maneuver length&quot;</span>);</div>
<div class="line"><a id="l00332" name="l00332"></a><span class="lineno">  332</span>                }</div>
<div class="line"><a id="l00333" name="l00333"></a><span class="lineno">  333</span> </div>
<div class="line"><a id="l00334" name="l00334"></a><span class="lineno">  334</span>            } <span class="keywordflow">else</span> { <span class="comment">// If our stopping maneuver intersects with existing maneuvers</span></div>
<div class="line"><a id="l00335" name="l00335"></a><span class="lineno">  335</span> </div>
<div class="line"><a id="l00336" name="l00336"></a><span class="lineno">  336</span>                                    </div>
<div class="line"><a id="l00337" name="l00337"></a><span class="lineno">  337</span>                <a class="code hl_define" href="plan__delegator_8hpp.html#a490076edf649de33d777ebd52faf68b6">SET_MANEUVER_PROPERTY</a>(maneuvers.back(), end_dist, required_start_downtrack);</div>
<div class="line"><a id="l00338" name="l00338"></a><span class="lineno">  338</span> </div>
<div class="line"><a id="l00339" name="l00339"></a><span class="lineno">  339</span>                <span class="comment">// Identify the lanelets which will be crossed by this updated maneuver</span></div>
<div class="line"><a id="l00340" name="l00340"></a><span class="lineno">  340</span>                std::vector&lt;lanelet::ConstLanelet&gt; crossed_lanelets = <a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#af6f7bdeb8816c83b212f6329f8e5652d">wm_</a>-&gt;getLaneletsBetween(<a class="code hl_define" href="approaching__emergency__vehicle__plugin__node_8hpp.html#a066f948508e087006568cb6c9b0674a7">GET_MANEUVER_PROPERTY</a>(maneuvers.back(), start_dist), required_start_downtrack, <span class="keyword">true</span>, <span class="keyword">false</span>);</div>
<div class="line"><a id="l00341" name="l00341"></a><span class="lineno">  341</span> </div>
<div class="line"><a id="l00342" name="l00342"></a><span class="lineno">  342</span>                <span class="keywordflow">if</span> (crossed_lanelets.empty()) {</div>
<div class="line"><a id="l00343" name="l00343"></a><span class="lineno">  343</span>                    <span class="keywordflow">throw</span> std::invalid_argument(<span class="stringliteral">&quot;Updated maneuver does not cross any lanelets going from: &quot;</span> + <a class="code hl_function" href="namespacecarma__cooperative__perception.html#a64b708654c8aecb09122d39577df31b5">std::to_string</a>(<a class="code hl_define" href="approaching__emergency__vehicle__plugin__node_8hpp.html#a066f948508e087006568cb6c9b0674a7">GET_MANEUVER_PROPERTY</a>(maneuvers.back(), start_dist)) + <span class="stringliteral">&quot; to: &quot;</span> + <a class="code hl_function" href="namespacecarma__cooperative__perception.html#a64b708654c8aecb09122d39577df31b5">std::to_string</a>(required_start_downtrack));</div>
<div class="line"><a id="l00344" name="l00344"></a><span class="lineno">  344</span>                }</div>
<div class="line"><a id="l00345" name="l00345"></a><span class="lineno">  345</span> </div>
<div class="line"><a id="l00346" name="l00346"></a><span class="lineno">  346</span>                <span class="comment">// Set the impact lane ids for maneuvers</span></div>
<div class="line"><a id="l00347" name="l00347"></a><span class="lineno">  347</span>                <span class="keywordflow">if</span> (maneuvers.back().type == carma_planning_msgs::msg::Maneuver::LANE_FOLLOWING) {</div>
<div class="line"><a id="l00348" name="l00348"></a><span class="lineno">  348</span> </div>
<div class="line"><a id="l00349" name="l00349"></a><span class="lineno">  349</span>                    maneuvers.back().lane_following_maneuver.lane_ids = lanelet::utils::transform(crossed_lanelets, [](<span class="keyword">auto</span> ll) { <span class="keywordflow">return</span> <a class="code hl_function" href="namespacecarma__cooperative__perception.html#a64b708654c8aecb09122d39577df31b5">std::to_string</a>(ll.id()); });</div>
<div class="line"><a id="l00350" name="l00350"></a><span class="lineno">  350</span> </div>
<div class="line"><a id="l00351" name="l00351"></a><span class="lineno">  351</span>                } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00352" name="l00352"></a><span class="lineno">  352</span> </div>
<div class="line"><a id="l00353" name="l00353"></a><span class="lineno">  353</span>                    <a class="code hl_function" href="namespaceroute__following__plugin_1_1anonymous__namespace_02route__following__plugin_8cpp_03.html#a69b9c9bf1a2410dfb992ec9874073e4e">setManeuverLaneletIds</a>(maneuvers.back(), crossed_lanelets.front().id(), crossed_lanelets.back().id());</div>
<div class="line"><a id="l00354" name="l00354"></a><span class="lineno">  354</span> </div>
<div class="line"><a id="l00355" name="l00355"></a><span class="lineno">  355</span>                }</div>
<div class="line"><a id="l00356" name="l00356"></a><span class="lineno">  356</span> </div>
<div class="line"><a id="l00357" name="l00357"></a><span class="lineno">  357</span>                last_maneuver_end_downtrack = required_start_downtrack;</div>
<div class="line"><a id="l00358" name="l00358"></a><span class="lineno">  358</span> </div>
<div class="line"><a id="l00359" name="l00359"></a><span class="lineno">  359</span>            }   </div>
<div class="line"><a id="l00360" name="l00360"></a><span class="lineno">  360</span>        }</div>
<div class="line"><a id="l00361" name="l00361"></a><span class="lineno">  361</span>        </div>
<div class="line"><a id="l00362" name="l00362"></a><span class="lineno">  362</span>        <span class="comment">// Identify the lanelets which will be crossed by this stop and wait maneuver</span></div>
<div class="line"><a id="l00363" name="l00363"></a><span class="lineno">  363</span>        std::vector&lt;lanelet::ConstLanelet&gt; crossed_lanelets = <a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#af6f7bdeb8816c83b212f6329f8e5652d">wm_</a>-&gt;getLaneletsBetween(last_maneuver_end_downtrack, route_end_downtrack, <span class="keyword">true</span>, <span class="keyword">false</span>);</div>
<div class="line"><a id="l00364" name="l00364"></a><span class="lineno">  364</span> </div>
<div class="line"><a id="l00365" name="l00365"></a><span class="lineno">  365</span>        <span class="keywordflow">if</span> (crossed_lanelets.empty()) {</div>
<div class="line"><a id="l00366" name="l00366"></a><span class="lineno">  366</span> </div>
<div class="line"><a id="l00367" name="l00367"></a><span class="lineno">  367</span>            <span class="keywordflow">throw</span> std::invalid_argument(<span class="stringliteral">&quot;Stopping maneuver does not cross any lanelets going from: &quot;</span> + <a class="code hl_function" href="namespacecarma__cooperative__perception.html#a64b708654c8aecb09122d39577df31b5">std::to_string</a>(last_maneuver_end_downtrack) + <span class="stringliteral">&quot; to: &quot;</span> + <a class="code hl_function" href="namespacecarma__cooperative__perception.html#a64b708654c8aecb09122d39577df31b5">std::to_string</a>(route_end_downtrack));</div>
<div class="line"><a id="l00368" name="l00368"></a><span class="lineno">  368</span> </div>
<div class="line"><a id="l00369" name="l00369"></a><span class="lineno">  369</span>        }</div>
<div class="line"><a id="l00370" name="l00370"></a><span class="lineno">  370</span> </div>
<div class="line"><a id="l00371" name="l00371"></a><span class="lineno">  371</span>        lanelet::Id start_lane = crossed_lanelets.front().id();</div>
<div class="line"><a id="l00372" name="l00372"></a><span class="lineno">  372</span>        lanelet::Id end_lane = crossed_lanelets.back().id();</div>
<div class="line"><a id="l00373" name="l00373"></a><span class="lineno">  373</span> </div>
<div class="line"><a id="l00374" name="l00374"></a><span class="lineno">  374</span>        <span class="comment">// Build stop and wait maneuver</span></div>
<div class="line"><a id="l00375" name="l00375"></a><span class="lineno">  375</span>        maneuvers.push_back(<a class="code hl_function" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#addf16b06e2e2053d9a2575b5f76248d7">composeStopAndWaitManeuverMessage</a>(last_maneuver_end_downtrack, route_end_downtrack, stopping_entry_speed, start_lane, end_lane,stopping_logitudinal_accel));</div>
<div class="line"><a id="l00376" name="l00376"></a><span class="lineno">  376</span> </div>
<div class="line"><a id="l00377" name="l00377"></a><span class="lineno">  377</span>        <span class="keywordflow">return</span> maneuvers;</div>
<div class="line"><a id="l00378" name="l00378"></a><span class="lineno">  378</span> </div>
<div class="line"><a id="l00379" name="l00379"></a><span class="lineno">  379</span>    }</div>
<div class="line"><a id="l00380" name="l00380"></a><span class="lineno">  380</span> </div>
<div class="line"><a id="l00381" name="l00381"></a><span class="lineno"><a class="line" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a56de7f7b08cf3762bca595460ac22a30">  381</a></span>    <span class="keywordtype">bool</span> <a class="code hl_function" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a56de7f7b08cf3762bca595460ac22a30">RouteFollowingPlugin::maneuverWithBufferStartsAfterDowntrack</a>(<span class="keyword">const</span> carma_planning_msgs::msg::Maneuver&amp; maneuver, <span class="keywordtype">double</span> downtrack, <span class="keywordtype">double</span> lateral_accel, <span class="keywordtype">double</span> min_maneuver_length)<span class="keyword"> const </span>{</div>
<div class="line"><a id="l00382" name="l00382"></a><span class="lineno">  382</span>       </div>
<div class="line"><a id="l00383" name="l00383"></a><span class="lineno">  383</span>        <span class="keywordflow">if</span> (maneuver.type == carma_planning_msgs::msg::Maneuver::LANE_CHANGE) {</div>
<div class="line"><a id="l00384" name="l00384"></a><span class="lineno">  384</span>                </div>
<div class="line"><a id="l00385" name="l00385"></a><span class="lineno">  385</span>            <span class="comment">// Compute the time it takes to move laterally to the next lane</span></div>
<div class="line"><a id="l00386" name="l00386"></a><span class="lineno">  386</span>            <span class="keywordtype">double</span> lane_change_time = sqrt(0.5 * <a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a1b6534686e8beaf7a11c203e42ed8c7a">MAX_LANE_WIDTH</a> / lateral_accel);</div>
<div class="line"><a id="l00387" name="l00387"></a><span class="lineno">  387</span>            </div>
<div class="line"><a id="l00388" name="l00388"></a><span class="lineno">  388</span>            <span class="comment">// Compute logitudinal distance covered in lane change time</span></div>
<div class="line"><a id="l00389" name="l00389"></a><span class="lineno">  389</span>            <span class="keywordtype">double</span> min_lane_change_distance = std::max(</div>
<div class="line"><a id="l00390" name="l00390"></a><span class="lineno">  390</span>                min_maneuver_length, </div>
<div class="line"><a id="l00391" name="l00391"></a><span class="lineno">  391</span>                lane_change_time * (<a class="code hl_define" href="approaching__emergency__vehicle__plugin__node_8hpp.html#a066f948508e087006568cb6c9b0674a7">GET_MANEUVER_PROPERTY</a>(maneuver, start_speed) + <a class="code hl_function" href="namespaceroute__following__plugin_1_1anonymous__namespace_02route__following__plugin_8cpp_03.html#a9b29dd085f9f59d468b1c9320f0b5102">getManeuverEndSpeed</a>(maneuver)) / 2.0 <span class="comment">// dist = v_avg * t</span></div>
<div class="line"><a id="l00392" name="l00392"></a><span class="lineno">  392</span>            );</div>
<div class="line"><a id="l00393" name="l00393"></a><span class="lineno">  393</span> </div>
<div class="line"><a id="l00394" name="l00394"></a><span class="lineno">  394</span>            <span class="keywordflow">return</span> <a class="code hl_define" href="approaching__emergency__vehicle__plugin__node_8hpp.html#a066f948508e087006568cb6c9b0674a7">GET_MANEUVER_PROPERTY</a>(maneuver, start_dist) + min_lane_change_distance &gt; downtrack;</div>
<div class="line"><a id="l00395" name="l00395"></a><span class="lineno">  395</span> </div>
<div class="line"><a id="l00396" name="l00396"></a><span class="lineno">  396</span>        } <span class="keywordflow">else</span> { </div>
<div class="line"><a id="l00397" name="l00397"></a><span class="lineno">  397</span>            </div>
<div class="line"><a id="l00398" name="l00398"></a><span class="lineno">  398</span>            <span class="keywordflow">return</span> <a class="code hl_define" href="approaching__emergency__vehicle__plugin__node_8hpp.html#a066f948508e087006568cb6c9b0674a7">GET_MANEUVER_PROPERTY</a>(maneuver, start_dist) + min_maneuver_length &gt; downtrack; </div>
<div class="line"><a id="l00399" name="l00399"></a><span class="lineno">  399</span>        </div>
<div class="line"><a id="l00400" name="l00400"></a><span class="lineno">  400</span>        }</div>
<div class="line"><a id="l00401" name="l00401"></a><span class="lineno">  401</span>    }</div>
<div class="line"><a id="l00402" name="l00402"></a><span class="lineno">  402</span> </div>
<div class="line"><a id="l00403" name="l00403"></a><span class="lineno"><a class="line" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#af17e2785054c29b5a8c631b3ea4fa21d">  403</a></span>        <span class="keywordtype">bool</span> <a class="code hl_function" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#af17e2785054c29b5a8c631b3ea4fa21d">RouteFollowingPlugin::get_availability</a>()</div>
<div class="line"><a id="l00404" name="l00404"></a><span class="lineno">  404</span>        {</div>
<div class="line"><a id="l00405" name="l00405"></a><span class="lineno">  405</span>         <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l00406" name="l00406"></a><span class="lineno">  406</span>        }</div>
<div class="line"><a id="l00407" name="l00407"></a><span class="lineno">  407</span>    </div>
<div class="line"><a id="l00408" name="l00408"></a><span class="lineno"><a class="line" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a1080015c697792ecef9886b94fdcb6d4">  408</a></span>        std::string <a class="code hl_function" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a1080015c697792ecef9886b94fdcb6d4">RouteFollowingPlugin::get_version_id</a>()</div>
<div class="line"><a id="l00409" name="l00409"></a><span class="lineno">  409</span>        {</div>
<div class="line"><a id="l00410" name="l00410"></a><span class="lineno">  410</span>                <span class="keywordflow">return</span> <span class="stringliteral">&quot;v1.0&quot;</span>;</div>
<div class="line"><a id="l00411" name="l00411"></a><span class="lineno">  411</span>        }</div>
<div class="line"><a id="l00412" name="l00412"></a><span class="lineno">  412</span> </div>
<div class="line"><a id="l00413" name="l00413"></a><span class="lineno"><a class="line" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a889056a79a669d5de8e1ce1bdb6eba99">  413</a></span>    <span class="keywordtype">void</span>  <a class="code hl_function" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a889056a79a669d5de8e1ce1bdb6eba99">RouteFollowingPlugin::plan_maneuvers_callback</a>(</div>
<div class="line"><a id="l00414" name="l00414"></a><span class="lineno">  414</span>      std::shared_ptr&lt;rmw_request_id_t&gt; srv_header, </div>
<div class="line"><a id="l00415" name="l00415"></a><span class="lineno">  415</span>      carma_planning_msgs::srv::PlanManeuvers::Request::SharedPtr req, </div>
<div class="line"><a id="l00416" name="l00416"></a><span class="lineno">  416</span>      carma_planning_msgs::srv::PlanManeuvers::Response::SharedPtr resp)</div>
<div class="line"><a id="l00417" name="l00417"></a><span class="lineno">  417</span>      {</div>
<div class="line"><a id="l00418" name="l00418"></a><span class="lineno">  418</span> </div>
<div class="line"><a id="l00419" name="l00419"></a><span class="lineno">  419</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a1ca1f0aa227e0d9c2bae6f6f2db9a3ff">latest_maneuver_plan_</a>.empty())</div>
<div class="line"><a id="l00420" name="l00420"></a><span class="lineno">  420</span>        {</div>
<div class="line"><a id="l00421" name="l00421"></a><span class="lineno">  421</span>           RCLCPP_ERROR_STREAM(get_logger(),<span class="stringliteral">&quot;A maneuver plan has not been generated&quot;</span>);</div>
<div class="line"><a id="l00422" name="l00422"></a><span class="lineno">  422</span>            <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00423" name="l00423"></a><span class="lineno">  423</span>        }</div>
<div class="line"><a id="l00424" name="l00424"></a><span class="lineno">  424</span> </div>
<div class="line"><a id="l00425" name="l00425"></a><span class="lineno">  425</span>        <span class="keywordtype">double</span> current_downtrack;</div>
<div class="line"><a id="l00426" name="l00426"></a><span class="lineno">  426</span>        </div>
<div class="line"><a id="l00427" name="l00427"></a><span class="lineno">  427</span>        <span class="keywordflow">if</span> (!req-&gt;prior_plan.maneuvers.empty())</div>
<div class="line"><a id="l00428" name="l00428"></a><span class="lineno">  428</span>        {</div>
<div class="line"><a id="l00429" name="l00429"></a><span class="lineno">  429</span>            current_downtrack = <a class="code hl_define" href="approaching__emergency__vehicle__plugin__node_8hpp.html#a066f948508e087006568cb6c9b0674a7">GET_MANEUVER_PROPERTY</a>(req-&gt;prior_plan.maneuvers.back(), end_dist);</div>
<div class="line"><a id="l00430" name="l00430"></a><span class="lineno">  430</span>            RCLCPP_DEBUG_STREAM(get_logger(),<span class="stringliteral">&quot;Detected a prior plan! Using back maneuver&#39;s end_dist:&quot;</span>&lt;&lt; current_downtrack);            </div>
<div class="line"><a id="l00431" name="l00431"></a><span class="lineno">  431</span>        }</div>
<div class="line"><a id="l00432" name="l00432"></a><span class="lineno">  432</span>        <span class="keywordflow">else</span></div>
<div class="line"><a id="l00433" name="l00433"></a><span class="lineno">  433</span>        {</div>
<div class="line"><a id="l00434" name="l00434"></a><span class="lineno">  434</span>            current_downtrack = req-&gt;veh_downtrack;</div>
<div class="line"><a id="l00435" name="l00435"></a><span class="lineno">  435</span>            RCLCPP_DEBUG_STREAM(get_logger(),<span class="stringliteral">&quot;Detected NO prior plan! Using req.veh_downtrack: &quot;</span>&lt;&lt; current_downtrack);</div>
<div class="line"><a id="l00436" name="l00436"></a><span class="lineno">  436</span>        }</div>
<div class="line"><a id="l00437" name="l00437"></a><span class="lineno">  437</span>        </div>
<div class="line"><a id="l00438" name="l00438"></a><span class="lineno">  438</span>        <span class="comment">//Return the set of maneuvers which intersect with min_plan_duration</span></div>
<div class="line"><a id="l00439" name="l00439"></a><span class="lineno">  439</span>        <span class="keywordtype">size_t</span> <a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a> = 0;</div>
<div class="line"><a id="l00440" name="l00440"></a><span class="lineno">  440</span>        <span class="keywordtype">double</span> planned_time = 0.0;</div>
<div class="line"><a id="l00441" name="l00441"></a><span class="lineno">  441</span> </div>
<div class="line"><a id="l00442" name="l00442"></a><span class="lineno">  442</span>        std::vector&lt;carma_planning_msgs::msg::Maneuver&gt; new_maneuvers;</div>
<div class="line"><a id="l00443" name="l00443"></a><span class="lineno">  443</span> </div>
<div class="line"><a id="l00444" name="l00444"></a><span class="lineno">  444</span>        <span class="keywordflow">while</span> (planned_time &lt; <a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#aa82d7af47d6165efae2967559cf6fe76">config_</a>.<a class="code hl_variable" href="structroute__following__plugin_1_1Config.html#a0cbb8bef75d40988a712e401a69fca1d">min_plan_duration_</a> &amp;&amp; <a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a> &lt; <a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a1ca1f0aa227e0d9c2bae6f6f2db9a3ff">latest_maneuver_plan_</a>.size())</div>
<div class="line"><a id="l00445" name="l00445"></a><span class="lineno">  445</span>        {</div>
<div class="line"><a id="l00446" name="l00446"></a><span class="lineno">  446</span>            RCLCPP_DEBUG_STREAM(get_logger(),<span class="stringliteral">&quot;Checking maneuver id &quot;</span> &lt;&lt; <a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>);</div>
<div class="line"><a id="l00447" name="l00447"></a><span class="lineno">  447</span>            <span class="comment">//Ignore plans for distance already covered</span></div>
<div class="line"><a id="l00448" name="l00448"></a><span class="lineno">  448</span>            <span class="keywordflow">if</span> (<a class="code hl_define" href="approaching__emergency__vehicle__plugin__node_8hpp.html#a066f948508e087006568cb6c9b0674a7">GET_MANEUVER_PROPERTY</a>(<a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a1ca1f0aa227e0d9c2bae6f6f2db9a3ff">latest_maneuver_plan_</a>[<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>], end_dist) &lt;= current_downtrack)</div>
<div class="line"><a id="l00449" name="l00449"></a><span class="lineno">  449</span>            {</div>
<div class="line"><a id="l00450" name="l00450"></a><span class="lineno">  450</span>                RCLCPP_DEBUG_STREAM(get_logger(),<span class="stringliteral">&quot;Skipping maneuver id &quot;</span> &lt;&lt; <a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>);</div>
<div class="line"><a id="l00451" name="l00451"></a><span class="lineno">  451</span> </div>
<div class="line"><a id="l00452" name="l00452"></a><span class="lineno">  452</span>                ++<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>;</div>
<div class="line"><a id="l00453" name="l00453"></a><span class="lineno">  453</span>                <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00454" name="l00454"></a><span class="lineno">  454</span>            }</div>
<div class="line"><a id="l00455" name="l00455"></a><span class="lineno">  455</span>            <span class="keywordflow">if</span>(planned_time == 0.0){</div>
<div class="line"><a id="l00456" name="l00456"></a><span class="lineno">  456</span>                <span class="comment">//update start distance of first maneuver</span></div>
<div class="line"><a id="l00457" name="l00457"></a><span class="lineno">  457</span>                <a class="code hl_function" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a63503ad6eed2f8b25cbe45daf9f3be00">setManeuverStartDist</a>(<a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a1ca1f0aa227e0d9c2bae6f6f2db9a3ff">latest_maneuver_plan_</a>[<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>], current_downtrack);</div>
<div class="line"><a id="l00458" name="l00458"></a><span class="lineno">  458</span>            }</div>
<div class="line"><a id="l00459" name="l00459"></a><span class="lineno">  459</span>            planned_time += <a class="code hl_function" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#aa1a9f6aad9bd61079ced344bb99c8e7d">getManeuverDuration</a>(<a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a1ca1f0aa227e0d9c2bae6f6f2db9a3ff">latest_maneuver_plan_</a>[<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>], <a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a95b6f908b4b49e66bc9c0e68b64a7f2f">epsilon_</a>).seconds();</div>
<div class="line"><a id="l00460" name="l00460"></a><span class="lineno">  460</span> </div>
<div class="line"><a id="l00461" name="l00461"></a><span class="lineno">  461</span>            new_maneuvers.push_back(<a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a1ca1f0aa227e0d9c2bae6f6f2db9a3ff">latest_maneuver_plan_</a>[<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>]);</div>
<div class="line"><a id="l00462" name="l00462"></a><span class="lineno">  462</span>            ++<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>;</div>
<div class="line"><a id="l00463" name="l00463"></a><span class="lineno">  463</span>        }</div>
<div class="line"><a id="l00464" name="l00464"></a><span class="lineno">  464</span> </div>
<div class="line"><a id="l00465" name="l00465"></a><span class="lineno">  465</span>        <span class="keywordflow">if</span> (new_maneuvers.empty())</div>
<div class="line"><a id="l00466" name="l00466"></a><span class="lineno">  466</span>        {</div>
<div class="line"><a id="l00467" name="l00467"></a><span class="lineno">  467</span>            RCLCPP_WARN_STREAM(get_logger(),<span class="stringliteral">&quot;Cannot plan maneuver because no route is found&quot;</span>);</div>
<div class="line"><a id="l00468" name="l00468"></a><span class="lineno">  468</span>            <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00469" name="l00469"></a><span class="lineno">  469</span>        }</div>
<div class="line"><a id="l00470" name="l00470"></a><span class="lineno">  470</span> </div>
<div class="line"><a id="l00471" name="l00471"></a><span class="lineno">  471</span>        <span class="comment">//Update time progress for maneuvers</span></div>
<div class="line"><a id="l00472" name="l00472"></a><span class="lineno">  472</span>        <span class="keywordflow">if</span> (!req-&gt;prior_plan.maneuvers.empty())</div>
<div class="line"><a id="l00473" name="l00473"></a><span class="lineno">  473</span>        {</div>
<div class="line"><a id="l00474" name="l00474"></a><span class="lineno">  474</span>            <a class="code hl_function" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a46bd2d0ea75d12d8e4289c24e48d05f2">updateTimeProgress</a>(new_maneuvers, <a class="code hl_define" href="approaching__emergency__vehicle__plugin__node_8hpp.html#a066f948508e087006568cb6c9b0674a7">GET_MANEUVER_PROPERTY</a>(req-&gt;prior_plan.maneuvers.back(), end_time));</div>
<div class="line"><a id="l00475" name="l00475"></a><span class="lineno">  475</span>           RCLCPP_DEBUG_STREAM(get_logger(),<span class="stringliteral">&quot;Detected a prior plan! Using back maneuver&#39;s end time:&quot;</span>&lt;&lt; <a class="code hl_function" href="namespacecarma__cooperative__perception.html#a64b708654c8aecb09122d39577df31b5">std::to_string</a>(rclcpp::Time(<a class="code hl_define" href="approaching__emergency__vehicle__plugin__node_8hpp.html#a066f948508e087006568cb6c9b0674a7">GET_MANEUVER_PROPERTY</a>(req-&gt;prior_plan.maneuvers.back(), end_time)).seconds()));    </div>
<div class="line"><a id="l00476" name="l00476"></a><span class="lineno">  476</span>           RCLCPP_DEBUG_STREAM(get_logger(),<span class="stringliteral">&quot;Where plan_completion_time was:&quot;</span>&lt;&lt; <a class="code hl_function" href="namespacecarma__cooperative__perception.html#a64b708654c8aecb09122d39577df31b5">std::to_string</a>(rclcpp::Time(req-&gt;prior_plan.planning_completion_time).seconds()));            </div>
<div class="line"><a id="l00477" name="l00477"></a><span class="lineno">  477</span>        }</div>
<div class="line"><a id="l00478" name="l00478"></a><span class="lineno">  478</span>        <span class="keywordflow">else</span></div>
<div class="line"><a id="l00479" name="l00479"></a><span class="lineno">  479</span>        {</div>
<div class="line"><a id="l00480" name="l00480"></a><span class="lineno">  480</span>            <a class="code hl_function" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a46bd2d0ea75d12d8e4289c24e48d05f2">updateTimeProgress</a>(new_maneuvers, rclcpp::Time(req-&gt;header.stamp));</div>
<div class="line"><a id="l00481" name="l00481"></a><span class="lineno">  481</span>           RCLCPP_DEBUG_STREAM(get_logger(),<span class="stringliteral">&quot;Detected NO prior plan! Using this-&gt;now():&quot;</span>&lt;&lt; <a class="code hl_function" href="namespacecarma__cooperative__perception.html#a64b708654c8aecb09122d39577df31b5">std::to_string</a>(this-&gt;now().seconds()));   </div>
<div class="line"><a id="l00482" name="l00482"></a><span class="lineno">  482</span>        }</div>
<div class="line"><a id="l00483" name="l00483"></a><span class="lineno">  483</span> </div>
<div class="line"><a id="l00484" name="l00484"></a><span class="lineno">  484</span>        <span class="comment">//update starting speed of first maneuver</span></div>
<div class="line"><a id="l00485" name="l00485"></a><span class="lineno">  485</span>        <span class="keywordflow">if</span> (!req-&gt;prior_plan.maneuvers.empty())</div>
<div class="line"><a id="l00486" name="l00486"></a><span class="lineno">  486</span>        {</div>
<div class="line"><a id="l00487" name="l00487"></a><span class="lineno">  487</span>            <span class="keywordtype">double</span> start_speed;</div>
<div class="line"><a id="l00488" name="l00488"></a><span class="lineno">  488</span>            <span class="keywordflow">switch</span> (req-&gt;prior_plan.maneuvers.back().type)</div>
<div class="line"><a id="l00489" name="l00489"></a><span class="lineno">  489</span>            {</div>
<div class="line"><a id="l00490" name="l00490"></a><span class="lineno">  490</span>                <span class="keywordflow">case</span> carma_planning_msgs::msg::Maneuver::LANE_FOLLOWING:</div>
<div class="line"><a id="l00491" name="l00491"></a><span class="lineno">  491</span>                    start_speed = req-&gt;prior_plan.maneuvers.back().lane_following_maneuver.end_speed;</div>
<div class="line"><a id="l00492" name="l00492"></a><span class="lineno">  492</span>                    <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00493" name="l00493"></a><span class="lineno">  493</span>                <span class="keywordflow">case</span> carma_planning_msgs::msg::Maneuver::LANE_CHANGE:</div>
<div class="line"><a id="l00494" name="l00494"></a><span class="lineno">  494</span>                    start_speed = req-&gt;prior_plan.maneuvers.back().lane_change_maneuver.end_speed;</div>
<div class="line"><a id="l00495" name="l00495"></a><span class="lineno">  495</span>                    <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00496" name="l00496"></a><span class="lineno">  496</span>                <span class="keywordflow">case</span> carma_planning_msgs::msg::Maneuver::INTERSECTION_TRANSIT_STRAIGHT:</div>
<div class="line"><a id="l00497" name="l00497"></a><span class="lineno">  497</span>                    start_speed = req-&gt;prior_plan.maneuvers.back().intersection_transit_straight_maneuver.end_speed;</div>
<div class="line"><a id="l00498" name="l00498"></a><span class="lineno">  498</span>                    <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00499" name="l00499"></a><span class="lineno">  499</span>                <span class="keywordflow">case</span> carma_planning_msgs::msg::Maneuver::INTERSECTION_TRANSIT_LEFT_TURN:</div>
<div class="line"><a id="l00500" name="l00500"></a><span class="lineno">  500</span>                    start_speed = req-&gt;prior_plan.maneuvers.back().intersection_transit_left_turn_maneuver.end_speed;</div>
<div class="line"><a id="l00501" name="l00501"></a><span class="lineno">  501</span>                    <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00502" name="l00502"></a><span class="lineno">  502</span>                <span class="keywordflow">case</span> carma_planning_msgs::msg::Maneuver::INTERSECTION_TRANSIT_RIGHT_TURN:</div>
<div class="line"><a id="l00503" name="l00503"></a><span class="lineno">  503</span>                    start_speed = req-&gt;prior_plan.maneuvers.back().intersection_transit_right_turn_maneuver.end_speed;</div>
<div class="line"><a id="l00504" name="l00504"></a><span class="lineno">  504</span>                    <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00505" name="l00505"></a><span class="lineno">  505</span>                <span class="keywordflow">default</span>:</div>
<div class="line"><a id="l00506" name="l00506"></a><span class="lineno">  506</span>                    <span class="keywordflow">throw</span> std::invalid_argument(<span class="stringliteral">&quot;Invalid maneuver type, cannot update starting speed for maneuver&quot;</span>);</div>
<div class="line"><a id="l00507" name="l00507"></a><span class="lineno">  507</span>            }</div>
<div class="line"><a id="l00508" name="l00508"></a><span class="lineno">  508</span>            </div>
<div class="line"><a id="l00509" name="l00509"></a><span class="lineno">  509</span>            <a class="code hl_function" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a67318ffc3a4163d6949a14f7ea83351d">updateStartingSpeed</a>(new_maneuvers.front(), start_speed);</div>
<div class="line"><a id="l00510" name="l00510"></a><span class="lineno">  510</span>            RCLCPP_DEBUG_STREAM(get_logger(),<span class="stringliteral">&quot;Detected a prior plan! Using back maneuver&#39;s end speed:&quot;</span>&lt;&lt; start_speed);    </div>
<div class="line"><a id="l00511" name="l00511"></a><span class="lineno">  511</span>        }</div>
<div class="line"><a id="l00512" name="l00512"></a><span class="lineno">  512</span>        <span class="keywordflow">else</span> </div>
<div class="line"><a id="l00513" name="l00513"></a><span class="lineno">  513</span>        {</div>
<div class="line"><a id="l00514" name="l00514"></a><span class="lineno">  514</span>            <a class="code hl_function" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a67318ffc3a4163d6949a14f7ea83351d">updateStartingSpeed</a>(new_maneuvers.front(), req-&gt;veh_logitudinal_velocity);</div>
<div class="line"><a id="l00515" name="l00515"></a><span class="lineno">  515</span>            RCLCPP_DEBUG_STREAM(get_logger(),<span class="stringliteral">&quot;Detected NO prior plan! Using req-&gt;veh_logitudinal_velocity:&quot;</span>&lt;&lt; req-&gt;veh_logitudinal_velocity);    </div>
<div class="line"><a id="l00516" name="l00516"></a><span class="lineno">  516</span>        }</div>
<div class="line"><a id="l00517" name="l00517"></a><span class="lineno">  517</span>        <span class="comment">//update plan</span></div>
<div class="line"><a id="l00518" name="l00518"></a><span class="lineno">  518</span>        resp-&gt;new_plan = req-&gt;prior_plan;</div>
<div class="line"><a id="l00519" name="l00519"></a><span class="lineno">  519</span>        RCLCPP_DEBUG_STREAM(get_logger(),<span class="stringliteral">&quot;Updating maneuvers before returning... Prior plan size:&quot;</span> &lt;&lt; req-&gt;prior_plan.maneuvers.size());</div>
<div class="line"><a id="l00520" name="l00520"></a><span class="lineno">  520</span>        <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; mvr : new_maneuvers)</div>
<div class="line"><a id="l00521" name="l00521"></a><span class="lineno">  521</span>        {</div>
<div class="line"><a id="l00522" name="l00522"></a><span class="lineno">  522</span>            resp-&gt;new_plan.maneuvers.push_back(mvr);</div>
<div class="line"><a id="l00523" name="l00523"></a><span class="lineno">  523</span>        }</div>
<div class="line"><a id="l00524" name="l00524"></a><span class="lineno">  524</span> </div>
<div class="line"><a id="l00525" name="l00525"></a><span class="lineno">  525</span>        RCLCPP_DEBUG_STREAM(get_logger(),<span class="stringliteral">&quot;Returning total of maneuver size: &quot;</span> &lt;&lt; resp-&gt;new_plan.maneuvers.size());</div>
<div class="line"><a id="l00526" name="l00526"></a><span class="lineno">  526</span>        resp-&gt;new_plan.planning_completion_time = this-&gt;now();</div>
<div class="line"><a id="l00527" name="l00527"></a><span class="lineno">  527</span> </div>
<div class="line"><a id="l00528" name="l00528"></a><span class="lineno">  528</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00529" name="l00529"></a><span class="lineno">  529</span>    }</div>
<div class="line"><a id="l00530" name="l00530"></a><span class="lineno">  530</span> </div>
<div class="line"><a id="l00531" name="l00531"></a><span class="lineno"><a class="line" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a65fc4245c9eb4f377690321e322c532d">  531</a></span>    <span class="keywordtype">void</span> <a class="code hl_function" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a65fc4245c9eb4f377690321e322c532d">RouteFollowingPlugin::bumper_pose_cb</a>()</div>
<div class="line"><a id="l00532" name="l00532"></a><span class="lineno">  532</span>    {</div>
<div class="line"><a id="l00533" name="l00533"></a><span class="lineno">  533</span>        RCLCPP_DEBUG_STREAM(get_logger(),<span class="stringliteral">&quot;Entering pose_cb&quot;</span>);</div>
<div class="line"><a id="l00534" name="l00534"></a><span class="lineno">  534</span> </div>
<div class="line"><a id="l00535" name="l00535"></a><span class="lineno">  535</span>        RCLCPP_DEBUG_STREAM(get_logger(),<span class="stringliteral">&quot;Looking up front bumper pose...&quot;</span>);</div>
<div class="line"><a id="l00536" name="l00536"></a><span class="lineno">  536</span>        </div>
<div class="line"><a id="l00537" name="l00537"></a><span class="lineno">  537</span>        <span class="keywordflow">try</span></div>
<div class="line"><a id="l00538" name="l00538"></a><span class="lineno">  538</span>        {</div>
<div class="line"><a id="l00539" name="l00539"></a><span class="lineno">  539</span>            <a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#aee9ed912513ae39c8bf8d5100b4ab86c">tf_</a> = <a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#ae503d51abc6402c90f8c8b38f49451c3">tf2_buffer_</a>.lookupTransform(<span class="stringliteral">&quot;map&quot;</span>, <span class="stringliteral">&quot;vehicle_front&quot;</span>, rclcpp::Time(0), rclcpp::Duration(1, 0)); <span class="comment">//save to local copy of transform 1 sec timeout</span></div>
<div class="line"><a id="l00540" name="l00540"></a><span class="lineno">  540</span>            tf2::fromMsg(<a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#aee9ed912513ae39c8bf8d5100b4ab86c">tf_</a>, <a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a43bf79c574e7475f22b5473003aa1c60">frontbumper_transform_</a>);</div>
<div class="line"><a id="l00541" name="l00541"></a><span class="lineno">  541</span>        }</div>
<div class="line"><a id="l00542" name="l00542"></a><span class="lineno">  542</span>        <span class="keywordflow">catch</span> (<span class="keyword">const</span> tf2::TransformException &amp;ex)</div>
<div class="line"><a id="l00543" name="l00543"></a><span class="lineno">  543</span>        {</div>
<div class="line"><a id="l00544" name="l00544"></a><span class="lineno">  544</span>            RCLCPP_WARN_STREAM(get_logger(),std::string(ex.what()));</div>
<div class="line"><a id="l00545" name="l00545"></a><span class="lineno">  545</span>        }</div>
<div class="line"><a id="l00546" name="l00546"></a><span class="lineno">  546</span> </div>
<div class="line"><a id="l00547" name="l00547"></a><span class="lineno">  547</span>        geometry_msgs::msg::Pose front_bumper_pose;</div>
<div class="line"><a id="l00548" name="l00548"></a><span class="lineno">  548</span>        front_bumper_pose.position.x = <a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a43bf79c574e7475f22b5473003aa1c60">frontbumper_transform_</a>.getOrigin().getX();</div>
<div class="line"><a id="l00549" name="l00549"></a><span class="lineno">  549</span>        front_bumper_pose.position.y = <a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a43bf79c574e7475f22b5473003aa1c60">frontbumper_transform_</a>.getOrigin().getY();</div>
<div class="line"><a id="l00550" name="l00550"></a><span class="lineno">  550</span>        </div>
<div class="line"><a id="l00551" name="l00551"></a><span class="lineno">  551</span>        <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#af6f7bdeb8816c83b212f6329f8e5652d">wm_</a>-&gt;getRoute())</div>
<div class="line"><a id="l00552" name="l00552"></a><span class="lineno">  552</span>            <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00553" name="l00553"></a><span class="lineno">  553</span> </div>
<div class="line"><a id="l00554" name="l00554"></a><span class="lineno">  554</span>        lanelet::BasicPoint2d current_loc(front_bumper_pose.position.x, front_bumper_pose.position.y);</div>
<div class="line"><a id="l00555" name="l00555"></a><span class="lineno">  555</span>        <a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a50db56b0b24748b350ff88d067e23676">current_loc_</a> = current_loc;</div>
<div class="line"><a id="l00556" name="l00556"></a><span class="lineno">  556</span>        <span class="keywordtype">double</span> current_progress = <a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#af6f7bdeb8816c83b212f6329f8e5652d">wm_</a>-&gt;routeTrackPos(current_loc).downtrack;</div>
<div class="line"><a id="l00557" name="l00557"></a><span class="lineno">  557</span>        </div>
<div class="line"><a id="l00558" name="l00558"></a><span class="lineno">  558</span>        RCLCPP_DEBUG_STREAM(get_logger(),<span class="stringliteral">&quot;pose_cb : current_progress&quot;</span> &lt;&lt; current_progress);</div>
<div class="line"><a id="l00559" name="l00559"></a><span class="lineno">  559</span>        </div>
<div class="line"><a id="l00560" name="l00560"></a><span class="lineno">  560</span>        <span class="comment">// Check if we need to return to route shortest path.</span></div>
<div class="line"><a id="l00561" name="l00561"></a><span class="lineno">  561</span>        <span class="comment">// Step 1. Check if another plugin aside from RFP has been in control</span></div>
<div class="line"><a id="l00562" name="l00562"></a><span class="lineno">  562</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a63a313f71c81a7c616b2cdf99278c019">current_maneuver_plan_</a>  != <span class="keyword">nullptr</span> &amp;&amp;</div>
<div class="line"><a id="l00563" name="l00563"></a><span class="lineno">  563</span>            <a class="code hl_define" href="approaching__emergency__vehicle__plugin__node_8hpp.html#a066f948508e087006568cb6c9b0674a7">GET_MANEUVER_PROPERTY</a>(<a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a63a313f71c81a7c616b2cdf99278c019">current_maneuver_plan_</a>-&gt;maneuvers[0], parameters.planning_strategic_plugin) \</div>
<div class="line"><a id="l00564" name="l00564"></a><span class="lineno">  564</span>            != <a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#ac487663f89485ae0f759b768e1e08ace">planning_strategic_plugin_</a>) {</div>
<div class="line"><a id="l00565" name="l00565"></a><span class="lineno">  565</span>            <span class="comment">// If another plugin may have brought us off shortest path, check our current lanelet</span></div>
<div class="line"><a id="l00566" name="l00566"></a><span class="lineno">  566</span>            <span class="keyword">auto</span> llts = <a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#af6f7bdeb8816c83b212f6329f8e5652d">wm_</a>-&gt;getLaneletsFromPoint(current_loc, 10);                                          </div>
<div class="line"><a id="l00567" name="l00567"></a><span class="lineno">  567</span>            <span class="comment">// Remove any candidate lanelets not on the route</span></div>
<div class="line"><a id="l00568" name="l00568"></a><span class="lineno">  568</span>            llts.erase(std::remove_if(llts.begin(), llts.end(),</div>
<div class="line"><a id="l00569" name="l00569"></a><span class="lineno">  569</span>                [&amp;](<span class="keyword">auto</span> <a class="code hl_namespace" href="namespacelanelet.html">lanelet</a>) -&gt; <span class="keywordtype">bool</span> { return !wm_-&gt;getRoute()-&gt;contains(lanelet); }),</div>
<div class="line"><a id="l00570" name="l00570"></a><span class="lineno">  570</span>                llts.end());</div>
<div class="line"><a id="l00571" name="l00571"></a><span class="lineno">  571</span> </div>
<div class="line"><a id="l00572" name="l00572"></a><span class="lineno">  572</span>            <span class="comment">// !!! ASSUMPTION !!!:</span></div>
<div class="line"><a id="l00573" name="l00573"></a><span class="lineno">  573</span>            <span class="comment">// Once non-route lanelets have been removed, it is assumed that our actual current lanelet is the only one that can remain.</span></div>
<div class="line"><a id="l00574" name="l00574"></a><span class="lineno">  574</span>            <span class="comment">// TODO: Verify that this assumption is true in all cases OR implement more robust logic to track current lanelet when there are overlaps</span></div>
<div class="line"><a id="l00575" name="l00575"></a><span class="lineno">  575</span> </div>
<div class="line"><a id="l00576" name="l00576"></a><span class="lineno">  576</span>            <span class="keywordflow">if</span> (llts.size() &gt; 1) {</div>
<div class="line"><a id="l00577" name="l00577"></a><span class="lineno">  577</span>                <span class="comment">// Assumed that:</span></div>
<div class="line"><a id="l00578" name="l00578"></a><span class="lineno">  578</span>                <span class="comment">// 1. Vehicle is in a lanelet on the route.</span></div>
<div class="line"><a id="l00579" name="l00579"></a><span class="lineno">  579</span>                <span class="comment">// 2. The route does not contain overlapping lanelets.</span></div>
<div class="line"><a id="l00580" name="l00580"></a><span class="lineno">  580</span>               RCLCPP_WARN_STREAM(get_logger(),<span class="stringliteral">&quot;ANOMALOUS SIZE DETECTED FOR CURRENT LANELET CANDIDATES! SIZE: &quot;</span> &lt;&lt; llts.size());</div>
<div class="line"><a id="l00581" name="l00581"></a><span class="lineno">  581</span>            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (llts.size() &lt; 1) {</div>
<div class="line"><a id="l00582" name="l00582"></a><span class="lineno">  582</span>                <span class="comment">//  We&#39;ve left the route entirely.</span></div>
<div class="line"><a id="l00583" name="l00583"></a><span class="lineno">  583</span>                RCLCPP_ERROR_STREAM(get_logger(),<span class="stringliteral">&quot;Vehicle has left the route entirely. Unable to compute new shortest path.&quot;</span>);</div>
<div class="line"><a id="l00584" name="l00584"></a><span class="lineno">  584</span>                <span class="keywordflow">throw</span> std::domain_error(<span class="stringliteral">&quot;Vehicle not on route, unable to compute shortest path.&quot;</span>);</div>
<div class="line"><a id="l00585" name="l00585"></a><span class="lineno">  585</span>            }</div>
<div class="line"><a id="l00586" name="l00586"></a><span class="lineno">  586</span> </div>
<div class="line"><a id="l00587" name="l00587"></a><span class="lineno">  587</span>            <span class="keyword">const</span> <span class="keyword">auto</span>&amp; current_lanelet = llts[0];</div>
<div class="line"><a id="l00588" name="l00588"></a><span class="lineno">  588</span>            RCLCPP_DEBUG_STREAM(get_logger(), <span class="stringliteral">&quot;Vehicle is currently in lanelet &quot;</span> &lt;&lt; current_lanelet.id());</div>
<div class="line"><a id="l00589" name="l00589"></a><span class="lineno">  589</span> </div>
<div class="line"><a id="l00590" name="l00590"></a><span class="lineno">  590</span>            <span class="comment">// if the current lanelet is not on the shortest path</span></div>
<div class="line"><a id="l00591" name="l00591"></a><span class="lineno">  591</span>            <span class="keywordflow">if</span> (<a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a2bc08e9528ebb74c9ab296479b366cf5">shortest_path_set_</a>.find(current_lanelet.id()) == <a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a2bc08e9528ebb74c9ab296479b366cf5">shortest_path_set_</a>.end())</div>
<div class="line"><a id="l00592" name="l00592"></a><span class="lineno">  592</span>            {</div>
<div class="line"><a id="l00593" name="l00593"></a><span class="lineno">  593</span>                RCLCPP_DEBUG_STREAM(get_logger(), <span class="stringliteral">&quot;Generating a new shortest path since the vehicle is not on the shortest path&quot;</span>);</div>
<div class="line"><a id="l00594" name="l00594"></a><span class="lineno">  594</span>                <a class="code hl_function" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#abe2ea0ac74599eee61235c5db12d9ed2">returnToShortestPath</a>(current_lanelet);</div>
<div class="line"><a id="l00595" name="l00595"></a><span class="lineno">  595</span>            }</div>
<div class="line"><a id="l00596" name="l00596"></a><span class="lineno">  596</span> </div>
<div class="line"><a id="l00597" name="l00597"></a><span class="lineno">  597</span>            <span class="comment">// Replan if vehicle currently located in a lane change planned by route_following_plugin, since a lane change maneuver can&#39;t begin part way through</span></div>
<div class="line"><a id="l00598" name="l00598"></a><span class="lineno">  598</span>            <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> <a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a> = 0; <a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a> &lt; <a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a1ca1f0aa227e0d9c2bae6f6f2db9a3ff">latest_maneuver_plan_</a>.size(); ++<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>){</div>
<div class="line"><a id="l00599" name="l00599"></a><span class="lineno">  599</span>                <span class="keywordflow">if</span>((<a class="code hl_define" href="approaching__emergency__vehicle__plugin__node_8hpp.html#a066f948508e087006568cb6c9b0674a7">GET_MANEUVER_PROPERTY</a>(<a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a1ca1f0aa227e0d9c2bae6f6f2db9a3ff">latest_maneuver_plan_</a>[<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>], start_dist) &lt;= current_progress) &amp;&amp; (current_progress &lt;= <a class="code hl_define" href="approaching__emergency__vehicle__plugin__node_8hpp.html#a066f948508e087006568cb6c9b0674a7">GET_MANEUVER_PROPERTY</a>(<a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a1ca1f0aa227e0d9c2bae6f6f2db9a3ff">latest_maneuver_plan_</a>[<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>], end_dist))){</div>
<div class="line"><a id="l00600" name="l00600"></a><span class="lineno">  600</span>                    <span class="keywordflow">if</span>(<a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a1ca1f0aa227e0d9c2bae6f6f2db9a3ff">latest_maneuver_plan_</a>[<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>].type == carma_planning_msgs::msg::Maneuver::LANE_CHANGE){</div>
<div class="line"><a id="l00601" name="l00601"></a><span class="lineno">  601</span>                        RCLCPP_DEBUG_STREAM(get_logger(), <span class="stringliteral">&quot;Generating a new shortest path since vehicle is positioned in a lane change but the previous maneuver plan was not generated by route_following_plugin&quot;</span>);</div>
<div class="line"><a id="l00602" name="l00602"></a><span class="lineno">  602</span>                        <a class="code hl_function" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#abe2ea0ac74599eee61235c5db12d9ed2">returnToShortestPath</a>(current_lanelet);</div>
<div class="line"><a id="l00603" name="l00603"></a><span class="lineno">  603</span>                    }</div>
<div class="line"><a id="l00604" name="l00604"></a><span class="lineno">  604</span>                }</div>
<div class="line"><a id="l00605" name="l00605"></a><span class="lineno">  605</span>            }</div>
<div class="line"><a id="l00606" name="l00606"></a><span class="lineno">  606</span>        }</div>
<div class="line"><a id="l00607" name="l00607"></a><span class="lineno">  607</span>    }</div>
<div class="line"><a id="l00608" name="l00608"></a><span class="lineno">  608</span> </div>
<div class="line"><a id="l00609" name="l00609"></a><span class="lineno"><a class="line" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#aa1a9f6aad9bd61079ced344bb99c8e7d">  609</a></span>    rclcpp::Duration <a class="code hl_function" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#aa1a9f6aad9bd61079ced344bb99c8e7d">RouteFollowingPlugin::getManeuverDuration</a>(carma_planning_msgs::msg::Maneuver &amp;maneuver, <span class="keywordtype">double</span> epsilon)<span class="keyword"> const</span></div>
<div class="line"><a id="l00610" name="l00610"></a><span class="lineno">  610</span><span class="keyword">    </span>{</div>
<div class="line"><a id="l00611" name="l00611"></a><span class="lineno">  611</span>        <span class="keywordtype">double</span> maneuver_start_speed = <a class="code hl_define" href="approaching__emergency__vehicle__plugin__node_8hpp.html#a066f948508e087006568cb6c9b0674a7">GET_MANEUVER_PROPERTY</a>(maneuver, start_speed);</div>
<div class="line"><a id="l00612" name="l00612"></a><span class="lineno">  612</span>        <span class="keywordtype">double</span> manever_end_speed = <a class="code hl_function" href="namespaceroute__following__plugin_1_1anonymous__namespace_02route__following__plugin_8cpp_03.html#a9b29dd085f9f59d468b1c9320f0b5102">getManeuverEndSpeed</a>(maneuver);</div>
<div class="line"><a id="l00613" name="l00613"></a><span class="lineno">  613</span>        <span class="keywordtype">double</span> cur_plus_target = maneuver_start_speed + manever_end_speed;</div>
<div class="line"><a id="l00614" name="l00614"></a><span class="lineno">  614</span>        <span class="keywordflow">if</span>(cur_plus_target &lt; epsilon){</div>
<div class="line"><a id="l00615" name="l00615"></a><span class="lineno">  615</span>            <span class="keywordflow">throw</span> std::invalid_argument(<span class="stringliteral">&quot;Maneuver start and ending speed is zero&quot;</span>);</div>
<div class="line"><a id="l00616" name="l00616"></a><span class="lineno">  616</span>        }</div>
<div class="line"><a id="l00617" name="l00617"></a><span class="lineno">  617</span>        rclcpp::Duration duration{0,0};</div>
<div class="line"><a id="l00618" name="l00618"></a><span class="lineno">  618</span>        <span class="keywordtype">double</span> maneuver_start_dist = <a class="code hl_define" href="approaching__emergency__vehicle__plugin__node_8hpp.html#a066f948508e087006568cb6c9b0674a7">GET_MANEUVER_PROPERTY</a>(maneuver, start_dist);</div>
<div class="line"><a id="l00619" name="l00619"></a><span class="lineno">  619</span>        <span class="keywordtype">double</span> maneuver_end_dist = <a class="code hl_define" href="approaching__emergency__vehicle__plugin__node_8hpp.html#a066f948508e087006568cb6c9b0674a7">GET_MANEUVER_PROPERTY</a>(maneuver, end_dist);</div>
<div class="line"><a id="l00620" name="l00620"></a><span class="lineno">  620</span> </div>
<div class="line"><a id="l00621" name="l00621"></a><span class="lineno">  621</span>        RCLCPP_DEBUG_STREAM(get_logger(),<span class="stringliteral">&quot;maneuver_end_dist: &quot;</span> &lt;&lt; maneuver_end_dist &lt;&lt; <span class="stringliteral">&quot;, maneuver_start_dist: &quot;</span> &lt;&lt; maneuver_start_dist &lt;&lt; <span class="stringliteral">&quot;, cur_plus_target: &quot;</span> &lt;&lt; cur_plus_target);</div>
<div class="line"><a id="l00622" name="l00622"></a><span class="lineno">  622</span> </div>
<div class="line"><a id="l00623" name="l00623"></a><span class="lineno">  623</span>        duration = rclcpp::Duration((maneuver_end_dist - maneuver_start_dist) / (0.5 * cur_plus_target) * 1e9);</div>
<div class="line"><a id="l00624" name="l00624"></a><span class="lineno">  624</span> </div>
<div class="line"><a id="l00625" name="l00625"></a><span class="lineno">  625</span>        <span class="keywordflow">return</span> duration;</div>
<div class="line"><a id="l00626" name="l00626"></a><span class="lineno">  626</span>    }</div>
<div class="line"><a id="l00627" name="l00627"></a><span class="lineno">  627</span> </div>
<div class="line"><a id="l00628" name="l00628"></a><span class="lineno"><a class="line" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a46bd2d0ea75d12d8e4289c24e48d05f2">  628</a></span>    <span class="keywordtype">void</span> <a class="code hl_function" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a46bd2d0ea75d12d8e4289c24e48d05f2">RouteFollowingPlugin::updateTimeProgress</a>(std::vector&lt;carma_planning_msgs::msg::Maneuver&gt; &amp;maneuvers, rclcpp::Time start_time)<span class="keyword"> const</span></div>
<div class="line"><a id="l00629" name="l00629"></a><span class="lineno">  629</span><span class="keyword">    </span>{</div>
<div class="line"><a id="l00630" name="l00630"></a><span class="lineno">  630</span>        rclcpp::Time time_progress = start_time;</div>
<div class="line"><a id="l00631" name="l00631"></a><span class="lineno">  631</span>        rclcpp::Time prev_time = time_progress;</div>
<div class="line"><a id="l00632" name="l00632"></a><span class="lineno">  632</span> </div>
<div class="line"><a id="l00633" name="l00633"></a><span class="lineno">  633</span>        <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;maneuver : maneuvers)</div>
<div class="line"><a id="l00634" name="l00634"></a><span class="lineno">  634</span>        {</div>
<div class="line"><a id="l00635" name="l00635"></a><span class="lineno">  635</span>            time_progress += <a class="code hl_function" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#aa1a9f6aad9bd61079ced344bb99c8e7d">getManeuverDuration</a>(maneuver, <a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a95b6f908b4b49e66bc9c0e68b64a7f2f">epsilon_</a>);</div>
<div class="line"><a id="l00636" name="l00636"></a><span class="lineno">  636</span>            <span class="keywordflow">switch</span> (maneuver.type)</div>
<div class="line"><a id="l00637" name="l00637"></a><span class="lineno">  637</span>            {</div>
<div class="line"><a id="l00638" name="l00638"></a><span class="lineno">  638</span>            <span class="keywordflow">case</span> carma_planning_msgs::msg::Maneuver::LANE_FOLLOWING:</div>
<div class="line"><a id="l00639" name="l00639"></a><span class="lineno">  639</span>                maneuver.lane_following_maneuver.start_time = prev_time;</div>
<div class="line"><a id="l00640" name="l00640"></a><span class="lineno">  640</span>                maneuver.lane_following_maneuver.end_time = time_progress;</div>
<div class="line"><a id="l00641" name="l00641"></a><span class="lineno">  641</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00642" name="l00642"></a><span class="lineno">  642</span>            <span class="keywordflow">case</span> carma_planning_msgs::msg::Maneuver::LANE_CHANGE:</div>
<div class="line"><a id="l00643" name="l00643"></a><span class="lineno">  643</span>                maneuver.lane_change_maneuver.start_time = prev_time;</div>
<div class="line"><a id="l00644" name="l00644"></a><span class="lineno">  644</span>                maneuver.lane_change_maneuver.end_time = time_progress;</div>
<div class="line"><a id="l00645" name="l00645"></a><span class="lineno">  645</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00646" name="l00646"></a><span class="lineno">  646</span>            <span class="keywordflow">case</span> carma_planning_msgs::msg::Maneuver::INTERSECTION_TRANSIT_STRAIGHT:</div>
<div class="line"><a id="l00647" name="l00647"></a><span class="lineno">  647</span>                maneuver.intersection_transit_straight_maneuver.start_time = prev_time;</div>
<div class="line"><a id="l00648" name="l00648"></a><span class="lineno">  648</span>                maneuver.intersection_transit_straight_maneuver.end_time = time_progress;</div>
<div class="line"><a id="l00649" name="l00649"></a><span class="lineno">  649</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00650" name="l00650"></a><span class="lineno">  650</span>            <span class="keywordflow">case</span> carma_planning_msgs::msg::Maneuver::INTERSECTION_TRANSIT_LEFT_TURN:</div>
<div class="line"><a id="l00651" name="l00651"></a><span class="lineno">  651</span>                maneuver.intersection_transit_left_turn_maneuver.start_time = prev_time;</div>
<div class="line"><a id="l00652" name="l00652"></a><span class="lineno">  652</span>                maneuver.intersection_transit_left_turn_maneuver.end_time = time_progress;</div>
<div class="line"><a id="l00653" name="l00653"></a><span class="lineno">  653</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00654" name="l00654"></a><span class="lineno">  654</span>            <span class="keywordflow">case</span> carma_planning_msgs::msg::Maneuver::INTERSECTION_TRANSIT_RIGHT_TURN:</div>
<div class="line"><a id="l00655" name="l00655"></a><span class="lineno">  655</span>                maneuver.intersection_transit_right_turn_maneuver.start_time = prev_time;</div>
<div class="line"><a id="l00656" name="l00656"></a><span class="lineno">  656</span>                maneuver.intersection_transit_right_turn_maneuver.end_time = time_progress;</div>
<div class="line"><a id="l00657" name="l00657"></a><span class="lineno">  657</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00658" name="l00658"></a><span class="lineno">  658</span>            <span class="keywordflow">case</span> carma_planning_msgs::msg::Maneuver::STOP_AND_WAIT:</div>
<div class="line"><a id="l00659" name="l00659"></a><span class="lineno">  659</span>                maneuver.stop_and_wait_maneuver.start_time = prev_time;</div>
<div class="line"><a id="l00660" name="l00660"></a><span class="lineno">  660</span>                maneuver.stop_and_wait_maneuver.start_time = time_progress;</div>
<div class="line"><a id="l00661" name="l00661"></a><span class="lineno">  661</span>                maneuver.stop_and_wait_maneuver.end_time = start_time + rclcpp::Duration(86400, 0); <span class="comment">// Set maneuver time period as 24hrs since this is the end of the route</span></div>
<div class="line"><a id="l00662" name="l00662"></a><span class="lineno">  662</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00663" name="l00663"></a><span class="lineno">  663</span>            <span class="keywordflow">default</span>:</div>
<div class="line"><a id="l00664" name="l00664"></a><span class="lineno">  664</span>                <span class="keywordflow">throw</span> std::invalid_argument(<span class="stringliteral">&quot;Invalid maneuver type, cannot update time progress for maneuver&quot;</span>);</div>
<div class="line"><a id="l00665" name="l00665"></a><span class="lineno">  665</span>            }</div>
<div class="line"><a id="l00666" name="l00666"></a><span class="lineno">  666</span>            prev_time = time_progress;</div>
<div class="line"><a id="l00667" name="l00667"></a><span class="lineno">  667</span>        }</div>
<div class="line"><a id="l00668" name="l00668"></a><span class="lineno">  668</span>    }</div>
<div class="line"><a id="l00669" name="l00669"></a><span class="lineno">  669</span> </div>
<div class="line"><a id="l00670" name="l00670"></a><span class="lineno"><a class="line" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a67318ffc3a4163d6949a14f7ea83351d">  670</a></span>    <span class="keywordtype">void</span> <a class="code hl_function" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a67318ffc3a4163d6949a14f7ea83351d">RouteFollowingPlugin::updateStartingSpeed</a>(carma_planning_msgs::msg::Maneuver &amp;maneuver, <span class="keywordtype">double</span> start_speed)<span class="keyword"> const</span></div>
<div class="line"><a id="l00671" name="l00671"></a><span class="lineno">  671</span><span class="keyword">    </span>{</div>
<div class="line"><a id="l00672" name="l00672"></a><span class="lineno">  672</span>        <span class="keywordflow">switch</span> (maneuver.type)</div>
<div class="line"><a id="l00673" name="l00673"></a><span class="lineno">  673</span>        {</div>
<div class="line"><a id="l00674" name="l00674"></a><span class="lineno">  674</span>        <span class="keywordflow">case</span> carma_planning_msgs::msg::Maneuver::LANE_FOLLOWING:</div>
<div class="line"><a id="l00675" name="l00675"></a><span class="lineno">  675</span>            maneuver.lane_following_maneuver.start_speed = start_speed;</div>
<div class="line"><a id="l00676" name="l00676"></a><span class="lineno">  676</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00677" name="l00677"></a><span class="lineno">  677</span>        <span class="keywordflow">case</span> carma_planning_msgs::msg::Maneuver::LANE_CHANGE:</div>
<div class="line"><a id="l00678" name="l00678"></a><span class="lineno">  678</span>            maneuver.lane_change_maneuver.start_speed = start_speed;</div>
<div class="line"><a id="l00679" name="l00679"></a><span class="lineno">  679</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00680" name="l00680"></a><span class="lineno">  680</span>        <span class="keywordflow">case</span> carma_planning_msgs::msg::Maneuver::INTERSECTION_TRANSIT_STRAIGHT:</div>
<div class="line"><a id="l00681" name="l00681"></a><span class="lineno">  681</span>            maneuver.intersection_transit_straight_maneuver.start_speed = start_speed;</div>
<div class="line"><a id="l00682" name="l00682"></a><span class="lineno">  682</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00683" name="l00683"></a><span class="lineno">  683</span>        <span class="keywordflow">case</span> carma_planning_msgs::msg::Maneuver::INTERSECTION_TRANSIT_LEFT_TURN:</div>
<div class="line"><a id="l00684" name="l00684"></a><span class="lineno">  684</span>            maneuver.intersection_transit_left_turn_maneuver.start_speed = start_speed;</div>
<div class="line"><a id="l00685" name="l00685"></a><span class="lineno">  685</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00686" name="l00686"></a><span class="lineno">  686</span>        <span class="keywordflow">case</span> carma_planning_msgs::msg::Maneuver::INTERSECTION_TRANSIT_RIGHT_TURN:</div>
<div class="line"><a id="l00687" name="l00687"></a><span class="lineno">  687</span>            maneuver.intersection_transit_right_turn_maneuver.start_speed = start_speed;</div>
<div class="line"><a id="l00688" name="l00688"></a><span class="lineno">  688</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00689" name="l00689"></a><span class="lineno">  689</span>        <span class="keywordflow">case</span> carma_planning_msgs::msg::Maneuver::STOP_AND_WAIT:</div>
<div class="line"><a id="l00690" name="l00690"></a><span class="lineno">  690</span>            maneuver.stop_and_wait_maneuver.start_speed = start_speed;</div>
<div class="line"><a id="l00691" name="l00691"></a><span class="lineno">  691</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00692" name="l00692"></a><span class="lineno">  692</span>        <span class="keywordflow">default</span>:</div>
<div class="line"><a id="l00693" name="l00693"></a><span class="lineno">  693</span>            <span class="keywordflow">throw</span> std::invalid_argument(<span class="stringliteral">&quot;Invalid maneuver type, cannot update starting speed for maneuver&quot;</span>);</div>
<div class="line"><a id="l00694" name="l00694"></a><span class="lineno">  694</span>        }</div>
<div class="line"><a id="l00695" name="l00695"></a><span class="lineno">  695</span>    }</div>
<div class="line"><a id="l00696" name="l00696"></a><span class="lineno">  696</span> </div>
<div class="line"><a id="l00697" name="l00697"></a><span class="lineno"><a class="line" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a63503ad6eed2f8b25cbe45daf9f3be00">  697</a></span>    <span class="keywordtype">void</span> <a class="code hl_function" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a63503ad6eed2f8b25cbe45daf9f3be00">RouteFollowingPlugin::setManeuverStartDist</a>(carma_planning_msgs::msg::Maneuver &amp;maneuver, <span class="keywordtype">double</span> start_dist)<span class="keyword"> const</span></div>
<div class="line"><a id="l00698" name="l00698"></a><span class="lineno">  698</span><span class="keyword">    </span>{</div>
<div class="line"><a id="l00699" name="l00699"></a><span class="lineno">  699</span>        <span class="keywordflow">switch</span> (maneuver.type)</div>
<div class="line"><a id="l00700" name="l00700"></a><span class="lineno">  700</span>        {</div>
<div class="line"><a id="l00701" name="l00701"></a><span class="lineno">  701</span>        <span class="keywordflow">case</span> carma_planning_msgs::msg::Maneuver::LANE_FOLLOWING:</div>
<div class="line"><a id="l00702" name="l00702"></a><span class="lineno">  702</span>            maneuver.lane_following_maneuver.start_dist = start_dist;</div>
<div class="line"><a id="l00703" name="l00703"></a><span class="lineno">  703</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00704" name="l00704"></a><span class="lineno">  704</span>        <span class="keywordflow">case</span> carma_planning_msgs::msg::Maneuver::LANE_CHANGE:</div>
<div class="line"><a id="l00705" name="l00705"></a><span class="lineno">  705</span>            maneuver.lane_change_maneuver.start_dist = start_dist;</div>
<div class="line"><a id="l00706" name="l00706"></a><span class="lineno">  706</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00707" name="l00707"></a><span class="lineno">  707</span>        <span class="keywordflow">case</span> carma_planning_msgs::msg::Maneuver::INTERSECTION_TRANSIT_STRAIGHT:</div>
<div class="line"><a id="l00708" name="l00708"></a><span class="lineno">  708</span>            maneuver.intersection_transit_straight_maneuver.start_dist = start_dist;</div>
<div class="line"><a id="l00709" name="l00709"></a><span class="lineno">  709</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00710" name="l00710"></a><span class="lineno">  710</span>        <span class="keywordflow">case</span> carma_planning_msgs::msg::Maneuver::INTERSECTION_TRANSIT_LEFT_TURN:</div>
<div class="line"><a id="l00711" name="l00711"></a><span class="lineno">  711</span>            maneuver.intersection_transit_left_turn_maneuver.start_dist = start_dist;</div>
<div class="line"><a id="l00712" name="l00712"></a><span class="lineno">  712</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00713" name="l00713"></a><span class="lineno">  713</span>        <span class="keywordflow">case</span> carma_planning_msgs::msg::Maneuver::INTERSECTION_TRANSIT_RIGHT_TURN:</div>
<div class="line"><a id="l00714" name="l00714"></a><span class="lineno">  714</span>            maneuver.intersection_transit_right_turn_maneuver.start_dist = start_dist;</div>
<div class="line"><a id="l00715" name="l00715"></a><span class="lineno">  715</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00716" name="l00716"></a><span class="lineno">  716</span>        <span class="keywordflow">case</span> carma_planning_msgs::msg::Maneuver::STOP_AND_WAIT:</div>
<div class="line"><a id="l00717" name="l00717"></a><span class="lineno">  717</span>            maneuver.stop_and_wait_maneuver.start_dist = start_dist;</div>
<div class="line"><a id="l00718" name="l00718"></a><span class="lineno">  718</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00719" name="l00719"></a><span class="lineno">  719</span>        <span class="keywordflow">default</span>:</div>
<div class="line"><a id="l00720" name="l00720"></a><span class="lineno">  720</span>            <span class="keywordflow">throw</span> std::invalid_argument(<span class="stringliteral">&quot;Invalid maneuver type&quot;</span>);</div>
<div class="line"><a id="l00721" name="l00721"></a><span class="lineno">  721</span>        }</div>
<div class="line"><a id="l00722" name="l00722"></a><span class="lineno">  722</span>    }</div>
<div class="line"><a id="l00723" name="l00723"></a><span class="lineno">  723</span> </div>
<div class="line"><a id="l00724" name="l00724"></a><span class="lineno"><a class="line" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a5e9bb087420ee42250c07ce8b1640509">  724</a></span>    carma_planning_msgs::msg::Maneuver <a class="code hl_function" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a5e9bb087420ee42250c07ce8b1640509">RouteFollowingPlugin::composeLaneFollowingManeuverMessage</a>(<span class="keywordtype">double</span> start_dist, <span class="keywordtype">double</span> end_dist, <span class="keywordtype">double</span> start_speed, <span class="keywordtype">double</span> target_speed, <span class="keyword">const</span> std::vector&lt;lanelet::Id&gt;&amp; lane_ids)<span class="keyword"> const</span></div>
<div class="line"><a id="l00725" name="l00725"></a><span class="lineno">  725</span><span class="keyword">    </span>{</div>
<div class="line"><a id="l00726" name="l00726"></a><span class="lineno">  726</span>        carma_planning_msgs::msg::Maneuver maneuver_msg;</div>
<div class="line"><a id="l00727" name="l00727"></a><span class="lineno">  727</span>        maneuver_msg.type = carma_planning_msgs::msg::Maneuver::LANE_FOLLOWING;</div>
<div class="line"><a id="l00728" name="l00728"></a><span class="lineno">  728</span>        maneuver_msg.lane_following_maneuver.parameters.negotiation_type = carma_planning_msgs::msg::ManeuverParameters::NO_NEGOTIATION;</div>
<div class="line"><a id="l00729" name="l00729"></a><span class="lineno">  729</span>        maneuver_msg.lane_following_maneuver.parameters.presence_vector = carma_planning_msgs::msg::ManeuverParameters::HAS_TACTICAL_PLUGIN;</div>
<div class="line"><a id="l00730" name="l00730"></a><span class="lineno">  730</span>        maneuver_msg.lane_following_maneuver.parameters.planning_tactical_plugin = <a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a55fa75b8bf940a89acd6ad64f5239185">lanefollow_planning_tactical_plugin_</a>;</div>
<div class="line"><a id="l00731" name="l00731"></a><span class="lineno">  731</span>        maneuver_msg.lane_following_maneuver.parameters.planning_strategic_plugin = <a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#ac487663f89485ae0f759b768e1e08ace">planning_strategic_plugin_</a>;</div>
<div class="line"><a id="l00732" name="l00732"></a><span class="lineno">  732</span>        maneuver_msg.lane_following_maneuver.start_dist = start_dist;</div>
<div class="line"><a id="l00733" name="l00733"></a><span class="lineno">  733</span>        maneuver_msg.lane_following_maneuver.start_speed = start_speed;</div>
<div class="line"><a id="l00734" name="l00734"></a><span class="lineno">  734</span>        maneuver_msg.lane_following_maneuver.end_dist = end_dist;</div>
<div class="line"><a id="l00735" name="l00735"></a><span class="lineno">  735</span>        maneuver_msg.lane_following_maneuver.end_speed = target_speed;</div>
<div class="line"><a id="l00736" name="l00736"></a><span class="lineno">  736</span>        maneuver_msg.lane_following_maneuver.lane_ids = lanelet::utils::transform(lane_ids, [](<span class="keyword">auto</span> <span class="keywordtype">id</span>) { <span class="keywordflow">return</span> <a class="code hl_function" href="namespacecarma__cooperative__perception.html#a64b708654c8aecb09122d39577df31b5">std::to_string</a>(<span class="keywordtype">id</span>); });</div>
<div class="line"><a id="l00737" name="l00737"></a><span class="lineno">  737</span>        <span class="comment">//Start time and end time for maneuver are assigned in updateTimeProgress</span></div>
<div class="line"><a id="l00738" name="l00738"></a><span class="lineno">  738</span> </div>
<div class="line"><a id="l00739" name="l00739"></a><span class="lineno">  739</span>        <span class="comment">// NOTE: The maneuver id is set here because maneuvers are regenerated once per route, so it is acceptable to regenerate them on route updates.</span></div>
<div class="line"><a id="l00740" name="l00740"></a><span class="lineno">  740</span>        <span class="comment">//       If maneuvers were not generated only on route updates we would want to preserve the ids across plans</span></div>
<div class="line"><a id="l00741" name="l00741"></a><span class="lineno">  741</span>        maneuver_msg.lane_following_maneuver.parameters.maneuver_id = <a class="code hl_function" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a4c98600b556259d55d2eb087e20a2a96">getNewManeuverId</a>();</div>
<div class="line"><a id="l00742" name="l00742"></a><span class="lineno">  742</span> </div>
<div class="line"><a id="l00743" name="l00743"></a><span class="lineno">  743</span>        std::stringstream ss;</div>
<div class="line"><a id="l00744" name="l00744"></a><span class="lineno">  744</span>        <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; <span class="keywordtype">id</span> : maneuver_msg.lane_following_maneuver.lane_ids)</div>
<div class="line"><a id="l00745" name="l00745"></a><span class="lineno">  745</span>            ss &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; id;</div>
<div class="line"><a id="l00746" name="l00746"></a><span class="lineno">  746</span> </div>
<div class="line"><a id="l00747" name="l00747"></a><span class="lineno">  747</span>        RCLCPP_DEBUG_STREAM(get_logger(),<span class="stringliteral">&quot;Creating lane follow id: &quot;</span> &lt;&lt; maneuver_msg.lane_following_maneuver.parameters.maneuver_id </div>
<div class="line"><a id="l00748" name="l00748"></a><span class="lineno">  748</span>                        &lt;&lt; <span class="stringliteral">&quot; start dist: &quot;</span> &lt;&lt; start_dist &lt;&lt; <span class="stringliteral">&quot; end dist: &quot;</span> &lt;&lt; end_dist &lt;&lt; <span class="stringliteral">&quot;lane_ids: &quot;</span> &lt;&lt; ss.str());</div>
<div class="line"><a id="l00749" name="l00749"></a><span class="lineno">  749</span>        </div>
<div class="line"><a id="l00750" name="l00750"></a><span class="lineno">  750</span>        <span class="keywordflow">return</span> maneuver_msg;</div>
<div class="line"><a id="l00751" name="l00751"></a><span class="lineno">  751</span>    }</div>
<div class="line"><a id="l00752" name="l00752"></a><span class="lineno">  752</span> </div>
<div class="line"><a id="l00753" name="l00753"></a><span class="lineno"><a class="line" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a4a984f6bd1178a6d79886321c8680c7e">  753</a></span>    carma_planning_msgs::msg::Maneuver <a class="code hl_function" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a4a984f6bd1178a6d79886321c8680c7e">RouteFollowingPlugin::composeLaneChangeManeuverMessage</a>(<span class="keywordtype">double</span> start_dist, <span class="keywordtype">double</span> end_dist, <span class="keywordtype">double</span> start_speed, <span class="keywordtype">double</span> target_speed, lanelet::Id starting_lane_id, lanelet::Id ending_lane_id)<span class="keyword"> const</span></div>
<div class="line"><a id="l00754" name="l00754"></a><span class="lineno">  754</span><span class="keyword">    </span>{</div>
<div class="line"><a id="l00755" name="l00755"></a><span class="lineno">  755</span>        carma_planning_msgs::msg::Maneuver maneuver_msg;</div>
<div class="line"><a id="l00756" name="l00756"></a><span class="lineno">  756</span>        maneuver_msg.type = carma_planning_msgs::msg::Maneuver::LANE_CHANGE;</div>
<div class="line"><a id="l00757" name="l00757"></a><span class="lineno">  757</span>        maneuver_msg.lane_change_maneuver.parameters.negotiation_type = carma_planning_msgs::msg::ManeuverParameters::NO_NEGOTIATION;</div>
<div class="line"><a id="l00758" name="l00758"></a><span class="lineno">  758</span>        maneuver_msg.lane_change_maneuver.parameters.presence_vector = carma_planning_msgs::msg::ManeuverParameters::HAS_TACTICAL_PLUGIN;</div>
<div class="line"><a id="l00759" name="l00759"></a><span class="lineno">  759</span>        maneuver_msg.lane_change_maneuver.parameters.planning_tactical_plugin = <a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a24867047366de79ec7023d8b0f84b690">lane_change_plugin_</a>;</div>
<div class="line"><a id="l00760" name="l00760"></a><span class="lineno">  760</span>        maneuver_msg.lane_change_maneuver.parameters.planning_strategic_plugin = <a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#ac487663f89485ae0f759b768e1e08ace">planning_strategic_plugin_</a>;</div>
<div class="line"><a id="l00761" name="l00761"></a><span class="lineno">  761</span>        maneuver_msg.lane_change_maneuver.start_dist = start_dist;</div>
<div class="line"><a id="l00762" name="l00762"></a><span class="lineno">  762</span>        maneuver_msg.lane_change_maneuver.start_speed = start_speed;</div>
<div class="line"><a id="l00763" name="l00763"></a><span class="lineno">  763</span>        maneuver_msg.lane_change_maneuver.end_dist = end_dist;</div>
<div class="line"><a id="l00764" name="l00764"></a><span class="lineno">  764</span>        maneuver_msg.lane_change_maneuver.end_speed = target_speed;</div>
<div class="line"><a id="l00765" name="l00765"></a><span class="lineno">  765</span>        maneuver_msg.lane_change_maneuver.starting_lane_id = <a class="code hl_function" href="namespacecarma__cooperative__perception.html#a64b708654c8aecb09122d39577df31b5">std::to_string</a>(starting_lane_id);</div>
<div class="line"><a id="l00766" name="l00766"></a><span class="lineno">  766</span>        maneuver_msg.lane_change_maneuver.ending_lane_id = <a class="code hl_function" href="namespacecarma__cooperative__perception.html#a64b708654c8aecb09122d39577df31b5">std::to_string</a>(ending_lane_id);</div>
<div class="line"><a id="l00767" name="l00767"></a><span class="lineno">  767</span>        <span class="comment">//Start time and end time for maneuver are assigned in updateTimeProgress</span></div>
<div class="line"><a id="l00768" name="l00768"></a><span class="lineno">  768</span> </div>
<div class="line"><a id="l00769" name="l00769"></a><span class="lineno">  769</span>        <span class="comment">// NOTE: The maneuver id is set here because maneuvers are regenerated once per route, so it is acceptable to regenerate them on route updates.</span></div>
<div class="line"><a id="l00770" name="l00770"></a><span class="lineno">  770</span>        <span class="comment">//       If maneuvers were not generated only on route updates we would want to preserve the ids across plans</span></div>
<div class="line"><a id="l00771" name="l00771"></a><span class="lineno">  771</span>        maneuver_msg.lane_change_maneuver.parameters.maneuver_id = <a class="code hl_function" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a4c98600b556259d55d2eb087e20a2a96">getNewManeuverId</a>();</div>
<div class="line"><a id="l00772" name="l00772"></a><span class="lineno">  772</span> </div>
<div class="line"><a id="l00773" name="l00773"></a><span class="lineno">  773</span>        RCLCPP_DEBUG_STREAM(get_logger(),<span class="stringliteral">&quot;Creating lane change id: &quot;</span>  &lt;&lt; maneuver_msg.lane_change_maneuver.parameters.maneuver_id &lt;&lt; <span class="stringliteral">&quot;start dist: &quot;</span> &lt;&lt; start_dist &lt;&lt; <span class="stringliteral">&quot; end dist: &quot;</span> &lt;&lt; end_dist &lt;&lt; <span class="stringliteral">&quot; Starting llt: &quot;</span> &lt;&lt; starting_lane_id &lt;&lt; <span class="stringliteral">&quot; Ending llt: &quot;</span> &lt;&lt; ending_lane_id);</div>
<div class="line"><a id="l00774" name="l00774"></a><span class="lineno">  774</span> </div>
<div class="line"><a id="l00775" name="l00775"></a><span class="lineno">  775</span>        <span class="keywordflow">return</span> maneuver_msg;</div>
<div class="line"><a id="l00776" name="l00776"></a><span class="lineno">  776</span>    }</div>
<div class="line"><a id="l00777" name="l00777"></a><span class="lineno">  777</span> </div>
<div class="line"><a id="l00778" name="l00778"></a><span class="lineno"><a class="line" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a4c98600b556259d55d2eb087e20a2a96">  778</a></span>    std::string <a class="code hl_function" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a4c98600b556259d55d2eb087e20a2a96">RouteFollowingPlugin::getNewManeuverId</a>()<span class="keyword"> const </span>{</div>
<div class="line"><a id="l00779" name="l00779"></a><span class="lineno">  779</span>        <span class="keyword">static</span> <span class="keyword">auto</span> gen = boost::uuids::random_generator(); <span class="comment">// Initialize uuid generator</span></div>
<div class="line"><a id="l00780" name="l00780"></a><span class="lineno">  780</span>        </div>
<div class="line"><a id="l00781" name="l00781"></a><span class="lineno">  781</span>        <span class="keywordflow">return</span> boost::lexical_cast&lt;std::string&gt;(gen()); <span class="comment">// generate uuid and convert to string</span></div>
<div class="line"><a id="l00782" name="l00782"></a><span class="lineno">  782</span>    }</div>
<div class="line"><a id="l00783" name="l00783"></a><span class="lineno">  783</span> </div>
<div class="line"><a id="l00784" name="l00784"></a><span class="lineno"><a class="line" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#addf16b06e2e2053d9a2575b5f76248d7">  784</a></span>    carma_planning_msgs::msg::Maneuver <a class="code hl_function" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#addf16b06e2e2053d9a2575b5f76248d7">RouteFollowingPlugin::composeStopAndWaitManeuverMessage</a>(<span class="keywordtype">double</span> start_dist, <span class="keywordtype">double</span> end_dist, <span class="keywordtype">double</span> start_speed, lanelet::Id starting_lane_id, lanelet::Id ending_lane_id, <span class="keywordtype">double</span> stopping_accel)<span class="keyword"> const</span></div>
<div class="line"><a id="l00785" name="l00785"></a><span class="lineno">  785</span><span class="keyword">    </span>{</div>
<div class="line"><a id="l00786" name="l00786"></a><span class="lineno">  786</span>        carma_planning_msgs::msg::Maneuver maneuver_msg;</div>
<div class="line"><a id="l00787" name="l00787"></a><span class="lineno">  787</span>        maneuver_msg.type = carma_planning_msgs::msg::Maneuver::STOP_AND_WAIT;</div>
<div class="line"><a id="l00788" name="l00788"></a><span class="lineno">  788</span>        maneuver_msg.stop_and_wait_maneuver.parameters.negotiation_type = carma_planning_msgs::msg::ManeuverParameters::NO_NEGOTIATION;</div>
<div class="line"><a id="l00789" name="l00789"></a><span class="lineno">  789</span>        maneuver_msg.stop_and_wait_maneuver.parameters.presence_vector = carma_planning_msgs::msg::ManeuverParameters::HAS_TACTICAL_PLUGIN</div>
<div class="line"><a id="l00790" name="l00790"></a><span class="lineno">  790</span>                                                                        | carma_planning_msgs::msg::ManeuverParameters::HAS_FLOAT_META_DATA;</div>
<div class="line"><a id="l00791" name="l00791"></a><span class="lineno">  791</span>        maneuver_msg.stop_and_wait_maneuver.parameters.planning_tactical_plugin = <a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a3da7b28ead4c0385b40cc70731ea68c5">stop_and_wait_plugin_</a>;</div>
<div class="line"><a id="l00792" name="l00792"></a><span class="lineno">  792</span>        maneuver_msg.stop_and_wait_maneuver.parameters.planning_strategic_plugin = <a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#ac487663f89485ae0f759b768e1e08ace">planning_strategic_plugin_</a>;</div>
<div class="line"><a id="l00793" name="l00793"></a><span class="lineno">  793</span>        maneuver_msg.stop_and_wait_maneuver.start_dist = start_dist;</div>
<div class="line"><a id="l00794" name="l00794"></a><span class="lineno">  794</span>        maneuver_msg.stop_and_wait_maneuver.start_speed = start_speed;</div>
<div class="line"><a id="l00795" name="l00795"></a><span class="lineno">  795</span>        maneuver_msg.stop_and_wait_maneuver.end_dist = end_dist;</div>
<div class="line"><a id="l00796" name="l00796"></a><span class="lineno">  796</span>        maneuver_msg.stop_and_wait_maneuver.starting_lane_id = <a class="code hl_function" href="namespacecarma__cooperative__perception.html#a64b708654c8aecb09122d39577df31b5">std::to_string</a>(starting_lane_id);</div>
<div class="line"><a id="l00797" name="l00797"></a><span class="lineno">  797</span>        maneuver_msg.stop_and_wait_maneuver.ending_lane_id = <a class="code hl_function" href="namespacecarma__cooperative__perception.html#a64b708654c8aecb09122d39577df31b5">std::to_string</a>(ending_lane_id);</div>
<div class="line"><a id="l00798" name="l00798"></a><span class="lineno">  798</span>        <span class="comment">//Start time and end time for maneuver are assigned in updateTimeProgress</span></div>
<div class="line"><a id="l00799" name="l00799"></a><span class="lineno">  799</span> </div>
<div class="line"><a id="l00800" name="l00800"></a><span class="lineno">  800</span>        <span class="comment">// Set the meta-data for the StopAndWait Maneuver to define the buffer in the route end point stopping location</span></div>
<div class="line"><a id="l00801" name="l00801"></a><span class="lineno">  801</span>        maneuver_msg.stop_and_wait_maneuver.parameters.float_valued_meta_data.push_back(<a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#aa82d7af47d6165efae2967559cf6fe76">config_</a>.<a class="code hl_variable" href="structroute__following__plugin_1_1Config.html#a3470bc2fdd2a28b4d080f9fe2713aa4a">route_end_point_buffer_</a>);</div>
<div class="line"><a id="l00802" name="l00802"></a><span class="lineno">  802</span>        maneuver_msg.stop_and_wait_maneuver.parameters.float_valued_meta_data.push_back(stopping_accel);</div>
<div class="line"><a id="l00803" name="l00803"></a><span class="lineno">  803</span>        </div>
<div class="line"><a id="l00804" name="l00804"></a><span class="lineno">  804</span>        <span class="comment">// NOTE: The maneuver id is set here because maneuvers are regenerated once per route, so it is acceptable to regenerate them on route updates.</span></div>
<div class="line"><a id="l00805" name="l00805"></a><span class="lineno">  805</span>        <span class="comment">//       If maneuvers were not generated only on route updates we would want to preserve the ids across plans</span></div>
<div class="line"><a id="l00806" name="l00806"></a><span class="lineno">  806</span>        maneuver_msg.stop_and_wait_maneuver.parameters.maneuver_id = <a class="code hl_function" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a4c98600b556259d55d2eb087e20a2a96">getNewManeuverId</a>();</div>
<div class="line"><a id="l00807" name="l00807"></a><span class="lineno">  807</span> </div>
<div class="line"><a id="l00808" name="l00808"></a><span class="lineno">  808</span>        RCLCPP_DEBUG_STREAM(get_logger(),<span class="stringliteral">&quot;Creating stop and wait maneuver id:&quot;</span> &lt;&lt; maneuver_msg.stop_and_wait_maneuver.parameters.maneuver_id &lt;&lt; <span class="stringliteral">&quot;start dist: &quot;</span> &lt;&lt; start_dist &lt;&lt; <span class="stringliteral">&quot; end dist: &quot;</span> &lt;&lt; end_dist &lt;&lt; <span class="stringliteral">&quot; start_speed: &quot;</span> &lt;&lt; start_speed &lt;&lt; <span class="stringliteral">&quot; Starting llt: &quot;</span> &lt;&lt; starting_lane_id &lt;&lt; <span class="stringliteral">&quot; Ending llt: &quot;</span> &lt;&lt; ending_lane_id);</div>
<div class="line"><a id="l00809" name="l00809"></a><span class="lineno">  809</span> </div>
<div class="line"><a id="l00810" name="l00810"></a><span class="lineno">  810</span>        <span class="keywordflow">return</span> maneuver_msg;</div>
<div class="line"><a id="l00811" name="l00811"></a><span class="lineno">  811</span>    }</div>
<div class="line"><a id="l00812" name="l00812"></a><span class="lineno">  812</span> </div>
<div class="line"><a id="l00813" name="l00813"></a><span class="lineno"><a class="line" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a8e0fd7dd9f9a88105188469767d99dee">  813</a></span>    <span class="keywordtype">bool</span> <a class="code hl_function" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a8e0fd7dd9f9a88105188469767d99dee">RouteFollowingPlugin::isLaneChangeNeeded</a>(lanelet::routing::LaneletRelations relations, lanelet::Id target_id)<span class="keyword"> const</span></div>
<div class="line"><a id="l00814" name="l00814"></a><span class="lineno">  814</span><span class="keyword">    </span>{</div>
<div class="line"><a id="l00815" name="l00815"></a><span class="lineno">  815</span>        <span class="comment">//This method is constrained to the lanelet being checked against being accessible. A non-accessible target lanelet would result in unspecified behavior</span></div>
<div class="line"><a id="l00816" name="l00816"></a><span class="lineno">  816</span>        <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;relation : relations)</div>
<div class="line"><a id="l00817" name="l00817"></a><span class="lineno">  817</span>        {</div>
<div class="line"><a id="l00818" name="l00818"></a><span class="lineno">  818</span>            <span class="keywordflow">if</span> (relation.lanelet.id() == target_id &amp;&amp; relation.relationType == lanelet::routing::RelationType::Successor)</div>
<div class="line"><a id="l00819" name="l00819"></a><span class="lineno">  819</span>            {</div>
<div class="line"><a id="l00820" name="l00820"></a><span class="lineno">  820</span>                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00821" name="l00821"></a><span class="lineno">  821</span>            }</div>
<div class="line"><a id="l00822" name="l00822"></a><span class="lineno">  822</span>        }</div>
<div class="line"><a id="l00823" name="l00823"></a><span class="lineno">  823</span>        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l00824" name="l00824"></a><span class="lineno">  824</span>    }</div>
<div class="line"><a id="l00825" name="l00825"></a><span class="lineno">  825</span> </div>
<div class="line"><a id="l00826" name="l00826"></a><span class="lineno"><a class="line" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a8bf5a4eb692d33202958a1f6ed71151c">  826</a></span>    <span class="keywordtype">double</span> <a class="code hl_function" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a8bf5a4eb692d33202958a1f6ed71151c">RouteFollowingPlugin::findSpeedLimit</a>(<span class="keyword">const</span> lanelet::ConstLanelet &amp;llt)</div>
<div class="line"><a id="l00827" name="l00827"></a><span class="lineno">  827</span>    {</div>
<div class="line"><a id="l00828" name="l00828"></a><span class="lineno">  828</span>        lanelet::Optional&lt;carma_wm::TrafficRulesConstPtr&gt; traffic_rules = <a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#af6f7bdeb8816c83b212f6329f8e5652d">wm_</a>-&gt;getTrafficRules();</div>
<div class="line"><a id="l00829" name="l00829"></a><span class="lineno">  829</span>        <span class="keywordflow">if</span> (traffic_rules)</div>
<div class="line"><a id="l00830" name="l00830"></a><span class="lineno">  830</span>        {</div>
<div class="line"><a id="l00831" name="l00831"></a><span class="lineno">  831</span>            <span class="keywordflow">return</span> (*traffic_rules)-&gt;speedLimit(llt).speedLimit.value();</div>
<div class="line"><a id="l00832" name="l00832"></a><span class="lineno">  832</span>        }</div>
<div class="line"><a id="l00833" name="l00833"></a><span class="lineno">  833</span>        <span class="keywordflow">else</span></div>
<div class="line"><a id="l00834" name="l00834"></a><span class="lineno">  834</span>        {</div>
<div class="line"><a id="l00835" name="l00835"></a><span class="lineno">  835</span>            <span class="keywordflow">throw</span> std::invalid_argument(<span class="stringliteral">&quot;Valid traffic rules object could not be built&quot;</span>);</div>
<div class="line"><a id="l00836" name="l00836"></a><span class="lineno">  836</span>        }</div>
<div class="line"><a id="l00837" name="l00837"></a><span class="lineno">  837</span>    }</div>
<div class="line"><a id="l00838" name="l00838"></a><span class="lineno">  838</span> </div>
<div class="line"><a id="l00839" name="l00839"></a><span class="lineno"><a class="line" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a18bd2ba5768eccc53a7ffab0cd01e251">  839</a></span>    <span class="keywordtype">void</span> <a class="code hl_function" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a18bd2ba5768eccc53a7ffab0cd01e251">RouteFollowingPlugin::initializeBumperTransformLookup</a>() </div>
<div class="line"><a id="l00840" name="l00840"></a><span class="lineno">  840</span>    {</div>
<div class="line"><a id="l00841" name="l00841"></a><span class="lineno">  841</span>        <a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a3d587e4f1aef34d0d97e74b655d7f0de">tf2_listener_</a>.reset(<span class="keyword">new</span> tf2_ros::TransformListener(<a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#ae503d51abc6402c90f8c8b38f49451c3">tf2_buffer_</a>));</div>
<div class="line"><a id="l00842" name="l00842"></a><span class="lineno">  842</span>        <a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#ae503d51abc6402c90f8c8b38f49451c3">tf2_buffer_</a>.setUsingDedicatedThread(<span class="keyword">true</span>);</div>
<div class="line"><a id="l00843" name="l00843"></a><span class="lineno">  843</span>    }</div>
<div class="line"><a id="l00844" name="l00844"></a><span class="lineno">  844</span> </div>
<div class="line"><a id="l00845" name="l00845"></a><span class="lineno"><a class="line" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#abe2ea0ac74599eee61235c5db12d9ed2">  845</a></span>    <span class="keywordtype">void</span> <a class="code hl_function" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#abe2ea0ac74599eee61235c5db12d9ed2">RouteFollowingPlugin::returnToShortestPath</a>(<span class="keyword">const</span> lanelet::ConstLanelet &amp;current_lanelet)</div>
<div class="line"><a id="l00846" name="l00846"></a><span class="lineno">  846</span>    {</div>
<div class="line"><a id="l00847" name="l00847"></a><span class="lineno">  847</span>        <span class="keyword">auto</span> original_shortestpath = <a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#af6f7bdeb8816c83b212f6329f8e5652d">wm_</a>-&gt;getRoute()-&gt;shortestPath();</div>
<div class="line"><a id="l00848" name="l00848"></a><span class="lineno">  848</span>        RCLCPP_DEBUG_STREAM(get_logger(),<span class="stringliteral">&quot;The vehicle has left the shortest path&quot;</span>);</div>
<div class="line"><a id="l00849" name="l00849"></a><span class="lineno">  849</span>        <span class="keyword">auto</span> routing_graph = <a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#af6f7bdeb8816c83b212f6329f8e5652d">wm_</a>-&gt;getMapRoutingGraph();</div>
<div class="line"><a id="l00850" name="l00850"></a><span class="lineno">  850</span>        </div>
<div class="line"><a id="l00851" name="l00851"></a><span class="lineno">  851</span>        <span class="comment">// Obtain the lanelet following the current lanelet in this same lane, this lanelet must exist since the new shortest path cannot begin with a lane change</span></div>
<div class="line"><a id="l00852" name="l00852"></a><span class="lineno">  852</span>        <span class="keyword">auto</span> current_lane_following_lanelets = routing_graph-&gt;following(current_lanelet);</div>
<div class="line"><a id="l00853" name="l00853"></a><span class="lineno">  853</span>        lanelet::ConstLanelet current_lane_following_lanelet;</div>
<div class="line"><a id="l00854" name="l00854"></a><span class="lineno">  854</span>        <span class="keywordflow">if</span>(!current_lane_following_lanelets.empty()){</div>
<div class="line"><a id="l00855" name="l00855"></a><span class="lineno">  855</span>            current_lane_following_lanelet = current_lane_following_lanelets[0];</div>
<div class="line"><a id="l00856" name="l00856"></a><span class="lineno">  856</span>        }</div>
<div class="line"><a id="l00857" name="l00857"></a><span class="lineno">  857</span>        <span class="keywordflow">else</span>{</div>
<div class="line"><a id="l00858" name="l00858"></a><span class="lineno">  858</span>            <span class="keywordflow">throw</span> std::invalid_argument(<span class="stringliteral">&quot;The current lanelet does not have a following lanelet. Vehicle cannot return to shortest path!&quot;</span>);</div>
<div class="line"><a id="l00859" name="l00859"></a><span class="lineno">  859</span>        }</div>
<div class="line"><a id="l00860" name="l00860"></a><span class="lineno">  860</span> </div>
<div class="line"><a id="l00861" name="l00861"></a><span class="lineno">  861</span>        <span class="comment">// In order to return to the shortest path, the closest future lanelet on the shortest path needs to be found.</span></div>
<div class="line"><a id="l00862" name="l00862"></a><span class="lineno">  862</span>        <span class="comment">// That is the adjacent lanelet of the following lanelet of the current lanelet.</span></div>
<div class="line"><a id="l00863" name="l00863"></a><span class="lineno">  863</span>        <span class="keyword">auto</span> adjacent_lanelets = routing_graph-&gt;besides(current_lane_following_lanelet);</div>
<div class="line"><a id="l00864" name="l00864"></a><span class="lineno">  864</span>        <span class="keywordflow">if</span> (!adjacent_lanelets.empty())</div>
<div class="line"><a id="l00865" name="l00865"></a><span class="lineno">  865</span>        {</div>
<div class="line"><a id="l00866" name="l00866"></a><span class="lineno">  866</span>            <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; adjacent:adjacent_lanelets)</div>
<div class="line"><a id="l00867" name="l00867"></a><span class="lineno">  867</span>            {</div>
<div class="line"><a id="l00868" name="l00868"></a><span class="lineno">  868</span>                <span class="keywordflow">if</span> (<a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a2bc08e9528ebb74c9ab296479b366cf5">shortest_path_set_</a>.find(adjacent.id())!=<a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a2bc08e9528ebb74c9ab296479b366cf5">shortest_path_set_</a>.end())</div>
<div class="line"><a id="l00869" name="l00869"></a><span class="lineno">  869</span>                {</div>
<div class="line"><a id="l00870" name="l00870"></a><span class="lineno">  870</span>                    <span class="keyword">auto</span> following_lanelets = routing_graph-&gt;following(adjacent);</div>
<div class="line"><a id="l00871" name="l00871"></a><span class="lineno">  871</span>                    <span class="keyword">const</span> <span class="keyword">auto</span>&amp; target_following_lanelet = following_lanelets[0];</div>
<div class="line"><a id="l00872" name="l00872"></a><span class="lineno">  872</span>                    RCLCPP_DEBUG_STREAM(get_logger(),<span class="stringliteral">&quot;The target_following_lanelet id is: &quot;</span> &lt;&lt; target_following_lanelet.id());</div>
<div class="line"><a id="l00873" name="l00873"></a><span class="lineno">  873</span>                    lanelet::ConstLanelets interm;</div>
<div class="line"><a id="l00874" name="l00874"></a><span class="lineno">  874</span>                    interm.push_back(<span class="keyword">static_cast&lt;</span>lanelet::ConstLanelet<span class="keyword">&gt;</span>(current_lane_following_lanelet));</div>
<div class="line"><a id="l00875" name="l00875"></a><span class="lineno">  875</span>                    interm.push_back(<span class="keyword">static_cast&lt;</span>lanelet::ConstLanelet<span class="keyword">&gt;</span>(target_following_lanelet));</div>
<div class="line"><a id="l00876" name="l00876"></a><span class="lineno">  876</span>                    <span class="comment">// a new shortest path, via the the lanelets in &#39;interm&#39; is calculated and used an alternative shortest path</span></div>
<div class="line"><a id="l00877" name="l00877"></a><span class="lineno">  877</span>                    <span class="keyword">auto</span> new_shortestpath = routing_graph-&gt;shortestPathVia(current_lanelet, interm, original_shortestpath.back());</div>
<div class="line"><a id="l00878" name="l00878"></a><span class="lineno">  878</span>                    RCLCPP_DEBUG_STREAM(get_logger(),<span class="stringliteral">&quot;a new shortestpath is generated to return to original shortestpath&quot;</span>);</div>
<div class="line"><a id="l00879" name="l00879"></a><span class="lineno">  879</span>                    <span class="comment">// routeCb is called to update latest_maneuver_plan_</span></div>
<div class="line"><a id="l00880" name="l00880"></a><span class="lineno">  880</span>                    <span class="keywordflow">if</span> (new_shortestpath) this-&gt;<a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a1ca1f0aa227e0d9c2bae6f6f2db9a3ff">latest_maneuver_plan_</a> = <a class="code hl_function" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a5bb267649d296b57b85b6bf3d6868ee6">routeCb</a>(new_shortestpath.get());</div>
<div class="line"><a id="l00881" name="l00881"></a><span class="lineno">  881</span>                    <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00882" name="l00882"></a><span class="lineno">  882</span>                }</div>
<div class="line"><a id="l00883" name="l00883"></a><span class="lineno">  883</span>                <span class="keywordflow">else</span></div>
<div class="line"><a id="l00884" name="l00884"></a><span class="lineno">  884</span>                {</div>
<div class="line"><a id="l00885" name="l00885"></a><span class="lineno">  885</span>                    <span class="comment">// a new shortest path, via the current_lanelet is calculated and used an alternative shortest path</span></div>
<div class="line"><a id="l00886" name="l00886"></a><span class="lineno">  886</span>                    lanelet::ConstLanelets new_interm;</div>
<div class="line"><a id="l00887" name="l00887"></a><span class="lineno">  887</span>                    new_interm.push_back(<span class="keyword">static_cast&lt;</span>lanelet::ConstLanelet<span class="keyword">&gt;</span>(current_lane_following_lanelet));</div>
<div class="line"><a id="l00888" name="l00888"></a><span class="lineno">  888</span>                    <span class="keyword">auto</span> new_shortestpath = routing_graph-&gt;shortestPathVia(current_lanelet, new_interm, original_shortestpath.back());</div>
<div class="line"><a id="l00889" name="l00889"></a><span class="lineno">  889</span>                    RCLCPP_DEBUG_STREAM(get_logger(),<span class="stringliteral">&quot;Cannot return to the original shortestpath from adjacent lanes, so a new shortestpath is generated&quot;</span>);</div>
<div class="line"><a id="l00890" name="l00890"></a><span class="lineno">  890</span>                    <span class="comment">// routeCb is called to update latest_maneuver_plan_</span></div>
<div class="line"><a id="l00891" name="l00891"></a><span class="lineno">  891</span>                    <span class="keywordflow">if</span> (new_shortestpath) this-&gt;<a class="code hl_variable" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a1ca1f0aa227e0d9c2bae6f6f2db9a3ff">latest_maneuver_plan_</a> = <a class="code hl_function" href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a5bb267649d296b57b85b6bf3d6868ee6">routeCb</a>(new_shortestpath.get());</div>
<div class="line"><a id="l00892" name="l00892"></a><span class="lineno">  892</span>                }</div>
<div class="line"><a id="l00893" name="l00893"></a><span class="lineno">  893</span>            }</div>
<div class="line"><a id="l00894" name="l00894"></a><span class="lineno">  894</span>            </div>
<div class="line"><a id="l00895" name="l00895"></a><span class="lineno">  895</span>        }</div>
<div class="line"><a id="l00896" name="l00896"></a><span class="lineno">  896</span>        <span class="keywordflow">else</span></div>
<div class="line"><a id="l00897" name="l00897"></a><span class="lineno">  897</span>        {</div>
<div class="line"><a id="l00898" name="l00898"></a><span class="lineno">  898</span>           RCLCPP_WARN_STREAM(get_logger(),<span class="stringliteral">&quot;Alternative shortest path cannot be generated&quot;</span>);</div>
<div class="line"><a id="l00899" name="l00899"></a><span class="lineno">  899</span>        }</div>
<div class="line"><a id="l00900" name="l00900"></a><span class="lineno">  900</span> </div>
<div class="line"><a id="l00901" name="l00901"></a><span class="lineno">  901</span>    }</div>
<div class="line"><a id="l00902" name="l00902"></a><span class="lineno">  902</span>              </div>
<div class="line"><a id="l00903" name="l00903"></a><span class="lineno">  903</span>}</div>
<div class="line"><a id="l00904" name="l00904"></a><span class="lineno">  904</span> </div>
<div class="line"><a id="l00905" name="l00905"></a><span class="lineno">  905</span><span class="preprocessor">#include &quot;rclcpp_components/register_node_macro.hpp&quot;</span></div>
<div class="line"><a id="l00906" name="l00906"></a><span class="lineno">  906</span> </div>
<div class="line"><a id="l00907" name="l00907"></a><span class="lineno">  907</span><span class="comment">// Register the component with class_loader</span></div>
<div class="line"><a id="l00908" name="l00908"></a><span class="lineno">  908</span>RCLCPP_COMPONENTS_REGISTER_NODE(<a class="code hl_class" href="classroute__following__plugin_1_1RouteFollowingPlugin.html">route_following_plugin::RouteFollowingPlugin</a>)</div>
<div class="ttc" id="aapproaching__emergency__vehicle__plugin__node_8hpp_html_a066f948508e087006568cb6c9b0674a7"><div class="ttname"><a href="approaching__emergency__vehicle__plugin__node_8hpp.html#a066f948508e087006568cb6c9b0674a7">GET_MANEUVER_PROPERTY</a></div><div class="ttdeci">#define GET_MANEUVER_PROPERTY(mvr, property)</div><div class="ttdoc">Macro definition to enable easier access to fields shared across the maneuver types.</div><div class="ttdef"><b>Definition:</b> <a href="approaching__emergency__vehicle__plugin__node_8hpp_source.html#l00054">approaching_emergency_vehicle_plugin_node.hpp:54</a></div></div>
<div class="ttc" id="aclasscarma__guidance__plugins_1_1PluginBaseNode_html_a50b54d5c4cc5180eeef0c78c55f70ec3"><div class="ttname"><a href="classcarma__guidance__plugins_1_1PluginBaseNode.html#a50b54d5c4cc5180eeef0c78c55f70ec3">carma_guidance_plugins::PluginBaseNode::get_world_model</a></div><div class="ttdeci">virtual carma_wm::WorldModelConstPtr get_world_model() final</div><div class="ttdoc">Method to return the default world model provided as a convience by this base class If this method or...</div><div class="ttdef"><b>Definition:</b> <a href="plugin__base__node_8cpp_source.html#l00066">plugin_base_node.cpp:66</a></div></div>
<div class="ttc" id="aclasscarma__guidance__plugins_1_1PluginBaseNode_html_aa1abc8998e6a33bb3e999379d3d87063"><div class="ttname"><a href="classcarma__guidance__plugins_1_1PluginBaseNode.html#aa1abc8998e6a33bb3e999379d3d87063">carma_guidance_plugins::PluginBaseNode::get_world_model_listener</a></div><div class="ttdeci">virtual std::shared_ptr&lt; carma_wm::WMListener &gt; get_world_model_listener() final</div><div class="ttdoc">Method to return the default world model listener provided as a convience by this base class If this ...</div><div class="ttdef"><b>Definition:</b> <a href="plugin__base__node_8cpp_source.html#l00060">plugin_base_node.cpp:60</a></div></div>
<div class="ttc" id="aclassroute__following__plugin_1_1RouteFollowingPlugin_html"><div class="ttname"><a href="classroute__following__plugin_1_1RouteFollowingPlugin.html">route_following_plugin::RouteFollowingPlugin</a></div><div class="ttdef"><b>Definition:</b> <a href="route__following__plugin_8hpp_source.html#l00062">route_following_plugin.hpp:63</a></div></div>
<div class="ttc" id="aclassroute__following__plugin_1_1RouteFollowingPlugin_html_a06ac08c84b45dca29ec5236604dfe64e"><div class="ttname"><a href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a06ac08c84b45dca29ec5236604dfe64e">route_following_plugin::RouteFollowingPlugin::on_configure_plugin</a></div><div class="ttdeci">carma_ros2_utils::CallbackReturn on_configure_plugin()</div><div class="ttdoc">Method which is triggered when this plugin is moved from the UNCONFIGURED to INACTIVE states....</div><div class="ttdef"><b>Definition:</b> <a href="route__following__plugin_8cpp_source.html#l00104">route_following_plugin.cpp:104</a></div></div>
<div class="ttc" id="aclassroute__following__plugin_1_1RouteFollowingPlugin_html_a1080015c697792ecef9886b94fdcb6d4"><div class="ttname"><a href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a1080015c697792ecef9886b94fdcb6d4">route_following_plugin::RouteFollowingPlugin::get_version_id</a></div><div class="ttdeci">std::string get_version_id()</div><div class="ttdoc">Returns the version id of this plugin.</div><div class="ttdef"><b>Definition:</b> <a href="route__following__plugin_8cpp_source.html#l00408">route_following_plugin.cpp:408</a></div></div>
<div class="ttc" id="aclassroute__following__plugin_1_1RouteFollowingPlugin_html_a18bd2ba5768eccc53a7ffab0cd01e251"><div class="ttname"><a href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a18bd2ba5768eccc53a7ffab0cd01e251">route_following_plugin::RouteFollowingPlugin::initializeBumperTransformLookup</a></div><div class="ttdeci">void initializeBumperTransformLookup()</div><div class="ttdoc">Initialize transform lookup from front bumper to map.</div><div class="ttdef"><b>Definition:</b> <a href="route__following__plugin_8cpp_source.html#l00839">route_following_plugin.cpp:839</a></div></div>
<div class="ttc" id="aclassroute__following__plugin_1_1RouteFollowingPlugin_html_a1b6534686e8beaf7a11c203e42ed8c7a"><div class="ttname"><a href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a1b6534686e8beaf7a11c203e42ed8c7a">route_following_plugin::RouteFollowingPlugin::MAX_LANE_WIDTH</a></div><div class="ttdeci">static constexpr double MAX_LANE_WIDTH</div><div class="ttdef"><b>Definition:</b> <a href="route__following__plugin_8hpp_source.html#l00235">route_following_plugin.hpp:235</a></div></div>
<div class="ttc" id="aclassroute__following__plugin_1_1RouteFollowingPlugin_html_a1ca1f0aa227e0d9c2bae6f6f2db9a3ff"><div class="ttname"><a href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a1ca1f0aa227e0d9c2bae6f6f2db9a3ff">route_following_plugin::RouteFollowingPlugin::latest_maneuver_plan_</a></div><div class="ttdeci">std::vector&lt; carma_planning_msgs::msg::Maneuver &gt; latest_maneuver_plan_</div><div class="ttdef"><b>Definition:</b> <a href="route__following__plugin_8hpp_source.html#l00254">route_following_plugin.hpp:254</a></div></div>
<div class="ttc" id="aclassroute__following__plugin_1_1RouteFollowingPlugin_html_a24867047366de79ec7023d8b0f84b690"><div class="ttname"><a href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a24867047366de79ec7023d8b0f84b690">route_following_plugin::RouteFollowingPlugin::lane_change_plugin_</a></div><div class="ttdeci">std::string lane_change_plugin_</div><div class="ttdef"><b>Definition:</b> <a href="route__following__plugin_8hpp_source.html#l00257">route_following_plugin.hpp:257</a></div></div>
<div class="ttc" id="aclassroute__following__plugin_1_1RouteFollowingPlugin_html_a2bc08e9528ebb74c9ab296479b366cf5"><div class="ttname"><a href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a2bc08e9528ebb74c9ab296479b366cf5">route_following_plugin::RouteFollowingPlugin::shortest_path_set_</a></div><div class="ttdeci">std::unordered_set&lt; lanelet::Id &gt; shortest_path_set_</div><div class="ttdef"><b>Definition:</b> <a href="route__following__plugin_8hpp_source.html#l00233">route_following_plugin.hpp:233</a></div></div>
<div class="ttc" id="aclassroute__following__plugin_1_1RouteFollowingPlugin_html_a3d587e4f1aef34d0d97e74b655d7f0de"><div class="ttname"><a href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a3d587e4f1aef34d0d97e74b655d7f0de">route_following_plugin::RouteFollowingPlugin::tf2_listener_</a></div><div class="ttdeci">std::unique_ptr&lt; tf2_ros::TransformListener &gt; tf2_listener_</div><div class="ttdef"><b>Definition:</b> <a href="route__following__plugin_8hpp_source.html#l00305">route_following_plugin.hpp:305</a></div></div>
<div class="ttc" id="aclassroute__following__plugin_1_1RouteFollowingPlugin_html_a3da7b28ead4c0385b40cc70731ea68c5"><div class="ttname"><a href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a3da7b28ead4c0385b40cc70731ea68c5">route_following_plugin::RouteFollowingPlugin::stop_and_wait_plugin_</a></div><div class="ttdeci">std::string stop_and_wait_plugin_</div><div class="ttdef"><b>Definition:</b> <a href="route__following__plugin_8hpp_source.html#l00258">route_following_plugin.hpp:258</a></div></div>
<div class="ttc" id="aclassroute__following__plugin_1_1RouteFollowingPlugin_html_a43bf79c574e7475f22b5473003aa1c60"><div class="ttname"><a href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a43bf79c574e7475f22b5473003aa1c60">route_following_plugin::RouteFollowingPlugin::frontbumper_transform_</a></div><div class="ttdeci">tf2::Stamped&lt; tf2::Transform &gt; frontbumper_transform_</div><div class="ttdef"><b>Definition:</b> <a href="route__following__plugin_8hpp_source.html#l00301">route_following_plugin.hpp:301</a></div></div>
<div class="ttc" id="aclassroute__following__plugin_1_1RouteFollowingPlugin_html_a46bd2d0ea75d12d8e4289c24e48d05f2"><div class="ttname"><a href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a46bd2d0ea75d12d8e4289c24e48d05f2">route_following_plugin::RouteFollowingPlugin::updateTimeProgress</a></div><div class="ttdeci">void updateTimeProgress(std::vector&lt; carma_planning_msgs::msg::Maneuver &gt; &amp;maneuvers, rclcpp::Time start_time) const</div><div class="ttdoc">Given an array of maneuvers update the starting time for each.</div><div class="ttdef"><b>Definition:</b> <a href="route__following__plugin_8cpp_source.html#l00628">route_following_plugin.cpp:628</a></div></div>
<div class="ttc" id="aclassroute__following__plugin_1_1RouteFollowingPlugin_html_a4a984f6bd1178a6d79886321c8680c7e"><div class="ttname"><a href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a4a984f6bd1178a6d79886321c8680c7e">route_following_plugin::RouteFollowingPlugin::composeLaneChangeManeuverMessage</a></div><div class="ttdeci">carma_planning_msgs::msg::Maneuver composeLaneChangeManeuverMessage(double start_dist, double end_dist, double start_speed, double target_speed, lanelet::Id starting_lane_id, lanelet::Id ending_lane_id) const</div><div class="ttdoc">Compose a lane change maneuver message based on input params NOTE: The start and stop time are not se...</div><div class="ttdef"><b>Definition:</b> <a href="route__following__plugin_8cpp_source.html#l00753">route_following_plugin.cpp:753</a></div></div>
<div class="ttc" id="aclassroute__following__plugin_1_1RouteFollowingPlugin_html_a4c98600b556259d55d2eb087e20a2a96"><div class="ttname"><a href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a4c98600b556259d55d2eb087e20a2a96">route_following_plugin::RouteFollowingPlugin::getNewManeuverId</a></div><div class="ttdeci">std::string getNewManeuverId() const</div><div class="ttdoc">This method returns a new UUID as a string for assignment to a Maneuver message.</div><div class="ttdef"><b>Definition:</b> <a href="route__following__plugin_8cpp_source.html#l00778">route_following_plugin.cpp:778</a></div></div>
<div class="ttc" id="aclassroute__following__plugin_1_1RouteFollowingPlugin_html_a50db56b0b24748b350ff88d067e23676"><div class="ttname"><a href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a50db56b0b24748b350ff88d067e23676">route_following_plugin::RouteFollowingPlugin::current_loc_</a></div><div class="ttdeci">lanelet::BasicPoint2d current_loc_</div><div class="ttdef"><b>Definition:</b> <a href="route__following__plugin_8hpp_source.html#l00248">route_following_plugin.hpp:248</a></div></div>
<div class="ttc" id="aclassroute__following__plugin_1_1RouteFollowingPlugin_html_a55fa75b8bf940a89acd6ad64f5239185"><div class="ttname"><a href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a55fa75b8bf940a89acd6ad64f5239185">route_following_plugin::RouteFollowingPlugin::lanefollow_planning_tactical_plugin_</a></div><div class="ttdeci">std::string lanefollow_planning_tactical_plugin_</div><div class="ttdef"><b>Definition:</b> <a href="route__following__plugin_8hpp_source.html#l00261">route_following_plugin.hpp:261</a></div></div>
<div class="ttc" id="aclassroute__following__plugin_1_1RouteFollowingPlugin_html_a56de7f7b08cf3762bca595460ac22a30"><div class="ttname"><a href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a56de7f7b08cf3762bca595460ac22a30">route_following_plugin::RouteFollowingPlugin::maneuverWithBufferStartsAfterDowntrack</a></div><div class="ttdeci">bool maneuverWithBufferStartsAfterDowntrack(const carma_planning_msgs::msg::Maneuver &amp;maneuver, double downtrack, double lateral_accel, double min_maneuver_length) const</div><div class="ttdoc">Identifies if a maneuver starts after the provided downtrack with compensation for a dynamic buffer s...</div><div class="ttdef"><b>Definition:</b> <a href="route__following__plugin_8cpp_source.html#l00381">route_following_plugin.cpp:381</a></div></div>
<div class="ttc" id="aclassroute__following__plugin_1_1RouteFollowingPlugin_html_a5bb267649d296b57b85b6bf3d6868ee6"><div class="ttname"><a href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a5bb267649d296b57b85b6bf3d6868ee6">route_following_plugin::RouteFollowingPlugin::routeCb</a></div><div class="ttdeci">std::vector&lt; carma_planning_msgs::msg::Maneuver &gt; routeCb(const lanelet::routing::LaneletPath &amp;route_shortest_path)</div><div class="ttdoc">Calculate maneuver plan for remaining route. This callback is triggered when a new route has been rec...</div><div class="ttdef"><b>Definition:</b> <a href="route__following__plugin_8cpp_source.html#l00169">route_following_plugin.cpp:169</a></div></div>
<div class="ttc" id="aclassroute__following__plugin_1_1RouteFollowingPlugin_html_a5e9bb087420ee42250c07ce8b1640509"><div class="ttname"><a href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a5e9bb087420ee42250c07ce8b1640509">route_following_plugin::RouteFollowingPlugin::composeLaneFollowingManeuverMessage</a></div><div class="ttdeci">carma_planning_msgs::msg::Maneuver composeLaneFollowingManeuverMessage(double start_dist, double end_dist, double start_speed, double target_speed, const std::vector&lt; lanelet::Id &gt; &amp;lane_ids) const</div><div class="ttdoc">Compose a lane keeping maneuver message based on input params.</div><div class="ttdef"><b>Definition:</b> <a href="route__following__plugin_8cpp_source.html#l00724">route_following_plugin.cpp:724</a></div></div>
<div class="ttc" id="aclassroute__following__plugin_1_1RouteFollowingPlugin_html_a63503ad6eed2f8b25cbe45daf9f3be00"><div class="ttname"><a href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a63503ad6eed2f8b25cbe45daf9f3be00">route_following_plugin::RouteFollowingPlugin::setManeuverStartDist</a></div><div class="ttdeci">void setManeuverStartDist(carma_planning_msgs::msg::Maneuver &amp;maneuver, double start_dist) const</div><div class="ttdoc">Set the start distance of a maneuver based on the progress along the route.</div><div class="ttdef"><b>Definition:</b> <a href="route__following__plugin_8cpp_source.html#l00697">route_following_plugin.cpp:697</a></div></div>
<div class="ttc" id="aclassroute__following__plugin_1_1RouteFollowingPlugin_html_a63a313f71c81a7c616b2cdf99278c019"><div class="ttname"><a href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a63a313f71c81a7c616b2cdf99278c019">route_following_plugin::RouteFollowingPlugin::current_maneuver_plan_</a></div><div class="ttdeci">carma_planning_msgs::msg::ManeuverPlan::UniquePtr current_maneuver_plan_</div><div class="ttdef"><b>Definition:</b> <a href="route__following__plugin_8hpp_source.html#l00251">route_following_plugin.hpp:251</a></div></div>
<div class="ttc" id="aclassroute__following__plugin_1_1RouteFollowingPlugin_html_a65fc4245c9eb4f377690321e322c532d"><div class="ttname"><a href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a65fc4245c9eb4f377690321e322c532d">route_following_plugin::RouteFollowingPlugin::bumper_pose_cb</a></div><div class="ttdeci">void bumper_pose_cb()</div><div class="ttdoc">Callback for the front bumper pose transform.</div><div class="ttdef"><b>Definition:</b> <a href="route__following__plugin_8cpp_source.html#l00531">route_following_plugin.cpp:531</a></div></div>
<div class="ttc" id="aclassroute__following__plugin_1_1RouteFollowingPlugin_html_a67318ffc3a4163d6949a14f7ea83351d"><div class="ttname"><a href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a67318ffc3a4163d6949a14f7ea83351d">route_following_plugin::RouteFollowingPlugin::updateStartingSpeed</a></div><div class="ttdeci">void updateStartingSpeed(carma_planning_msgs::msg::Maneuver &amp;maneuver, double start_speed) const</div><div class="ttdoc">Given an maneuver update the starting speed.</div><div class="ttdef"><b>Definition:</b> <a href="route__following__plugin_8cpp_source.html#l00670">route_following_plugin.cpp:670</a></div></div>
<div class="ttc" id="aclassroute__following__plugin_1_1RouteFollowingPlugin_html_a70c7d9e9948e3804375093159986335e"><div class="ttname"><a href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a70c7d9e9948e3804375093159986335e">route_following_plugin::RouteFollowingPlugin::bumper_pose_timer_</a></div><div class="ttdeci">rclcpp::TimerBase::SharedPtr bumper_pose_timer_</div><div class="ttdef"><b>Definition:</b> <a href="route__following__plugin_8hpp_source.html#l00264">route_following_plugin.hpp:264</a></div></div>
<div class="ttc" id="aclassroute__following__plugin_1_1RouteFollowingPlugin_html_a8196136dd512e85294fdd2bd07e3dc81"><div class="ttname"><a href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a8196136dd512e85294fdd2bd07e3dc81">route_following_plugin::RouteFollowingPlugin::current_speed_</a></div><div class="ttdeci">double current_speed_</div><div class="ttdef"><b>Definition:</b> <a href="route__following__plugin_8hpp_source.html#l00241">route_following_plugin.hpp:241</a></div></div>
<div class="ttc" id="aclassroute__following__plugin_1_1RouteFollowingPlugin_html_a86a93ad88943fbf56ac87195706ea25a"><div class="ttname"><a href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a86a93ad88943fbf56ac87195706ea25a">route_following_plugin::RouteFollowingPlugin::current_maneuver_plan_cb</a></div><div class="ttdeci">void current_maneuver_plan_cb(carma_planning_msgs::msg::ManeuverPlan::UniquePtr msg)</div><div class="ttdoc">Callback for the ManeuverPlan subscriber, will store the current maneuver plan received locally....</div><div class="ttdef"><b>Definition:</b> <a href="route__following__plugin_8cpp_source.html#l00165">route_following_plugin.cpp:165</a></div></div>
<div class="ttc" id="aclassroute__following__plugin_1_1RouteFollowingPlugin_html_a87d3775c64efb567d517f2be287c78d7"><div class="ttname"><a href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a87d3775c64efb567d517f2be287c78d7">route_following_plugin::RouteFollowingPlugin::twist_cb</a></div><div class="ttdeci">void twist_cb(geometry_msgs::msg::TwistStamped::UniquePtr msg)</div><div class="ttdoc">Callback for the twist subscriber, which will store latest twist locally.</div><div class="ttdef"><b>Definition:</b> <a href="route__following__plugin_8cpp_source.html#l00160">route_following_plugin.cpp:160</a></div></div>
<div class="ttc" id="aclassroute__following__plugin_1_1RouteFollowingPlugin_html_a889056a79a669d5de8e1ce1bdb6eba99"><div class="ttname"><a href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a889056a79a669d5de8e1ce1bdb6eba99">route_following_plugin::RouteFollowingPlugin::plan_maneuvers_callback</a></div><div class="ttdeci">void plan_maneuvers_callback(std::shared_ptr&lt; rmw_request_id_t &gt; srv_header, carma_planning_msgs::srv::PlanManeuvers::Request::SharedPtr req, carma_planning_msgs::srv::PlanManeuvers::Response::SharedPtr resp)</div><div class="ttdoc">Service callback for arbitrator maneuver planning.</div><div class="ttdef"><b>Definition:</b> <a href="route__following__plugin_8cpp_source.html#l00413">route_following_plugin.cpp:413</a></div></div>
<div class="ttc" id="aclassroute__following__plugin_1_1RouteFollowingPlugin_html_a8bf5a4eb692d33202958a1f6ed71151c"><div class="ttname"><a href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a8bf5a4eb692d33202958a1f6ed71151c">route_following_plugin::RouteFollowingPlugin::findSpeedLimit</a></div><div class="ttdeci">double findSpeedLimit(const lanelet::ConstLanelet &amp;llt)</div><div class="ttdoc">Given a Lanelet, find it's associated Speed Limit.</div><div class="ttdef"><b>Definition:</b> <a href="route__following__plugin_8cpp_source.html#l00826">route_following_plugin.cpp:826</a></div></div>
<div class="ttc" id="aclassroute__following__plugin_1_1RouteFollowingPlugin_html_a8e0fd7dd9f9a88105188469767d99dee"><div class="ttname"><a href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a8e0fd7dd9f9a88105188469767d99dee">route_following_plugin::RouteFollowingPlugin::isLaneChangeNeeded</a></div><div class="ttdeci">bool isLaneChangeNeeded(lanelet::routing::LaneletRelations relations, lanelet::Id target_id) const</div><div class="ttdoc">Given a LaneletRelations and ID of the next lanelet in the shortest path.</div><div class="ttdef"><b>Definition:</b> <a href="route__following__plugin_8cpp_source.html#l00813">route_following_plugin.cpp:813</a></div></div>
<div class="ttc" id="aclassroute__following__plugin_1_1RouteFollowingPlugin_html_a958ec1b9ce5480c6e9af6313c913ec85"><div class="ttname"><a href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a958ec1b9ce5480c6e9af6313c913ec85">route_following_plugin::RouteFollowingPlugin::current_maneuver_plan_sub_</a></div><div class="ttdeci">carma_ros2_utils::SubPtr&lt; carma_planning_msgs::msg::ManeuverPlan &gt; current_maneuver_plan_sub_</div><div class="ttdef"><b>Definition:</b> <a href="route__following__plugin_8hpp_source.html#l00230">route_following_plugin.hpp:230</a></div></div>
<div class="ttc" id="aclassroute__following__plugin_1_1RouteFollowingPlugin_html_a95a998d3cc7b56a8c31ea3b11fcd3e8a"><div class="ttname"><a href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a95a998d3cc7b56a8c31ea3b11fcd3e8a">route_following_plugin::RouteFollowingPlugin::on_activate_plugin</a></div><div class="ttdeci">carma_ros2_utils::CallbackReturn on_activate_plugin()</div><div class="ttdoc">Method which is triggered when this plugin is moved from the INACTIVE to ACTIVE states....</div><div class="ttdef"><b>Definition:</b> <a href="route__following__plugin_8cpp_source.html#l00150">route_following_plugin.cpp:150</a></div></div>
<div class="ttc" id="aclassroute__following__plugin_1_1RouteFollowingPlugin_html_a95b6f908b4b49e66bc9c0e68b64a7f2f"><div class="ttname"><a href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a95b6f908b4b49e66bc9c0e68b64a7f2f">route_following_plugin::RouteFollowingPlugin::epsilon_</a></div><div class="ttdeci">double epsilon_</div><div class="ttdef"><b>Definition:</b> <a href="route__following__plugin_8hpp_source.html#l00244">route_following_plugin.hpp:244</a></div></div>
<div class="ttc" id="aclassroute__following__plugin_1_1RouteFollowingPlugin_html_a97e8eff5885a9de9769304019b6c5a79"><div class="ttname"><a href="classroute__following__plugin_1_1RouteFollowingPlugin.html#a97e8eff5885a9de9769304019b6c5a79">route_following_plugin::RouteFollowingPlugin::wml_</a></div><div class="ttdeci">std::shared_ptr&lt; carma_wm::WMListener &gt; wml_</div><div class="ttdef"><b>Definition:</b> <a href="route__following__plugin_8hpp_source.html#l00076">route_following_plugin.hpp:76</a></div></div>
<div class="ttc" id="aclassroute__following__plugin_1_1RouteFollowingPlugin_html_aa1a9f6aad9bd61079ced344bb99c8e7d"><div class="ttname"><a href="classroute__following__plugin_1_1RouteFollowingPlugin.html#aa1a9f6aad9bd61079ced344bb99c8e7d">route_following_plugin::RouteFollowingPlugin::getManeuverDuration</a></div><div class="ttdeci">rclcpp::Duration getManeuverDuration(carma_planning_msgs::msg::Maneuver &amp;maneuver, double epsilon) const</div><div class="ttdoc">returns duration as ros::Duration required to complete maneuver given its start dist,...</div><div class="ttdef"><b>Definition:</b> <a href="route__following__plugin_8cpp_source.html#l00609">route_following_plugin.cpp:609</a></div></div>
<div class="ttc" id="aclassroute__following__plugin_1_1RouteFollowingPlugin_html_aa82d7af47d6165efae2967559cf6fe76"><div class="ttname"><a href="classroute__following__plugin_1_1RouteFollowingPlugin.html#aa82d7af47d6165efae2967559cf6fe76">route_following_plugin::RouteFollowingPlugin::config_</a></div><div class="ttdeci">Config config_</div><div class="ttdef"><b>Definition:</b> <a href="route__following__plugin_8hpp_source.html#l00238">route_following_plugin.hpp:238</a></div></div>
<div class="ttc" id="aclassroute__following__plugin_1_1RouteFollowingPlugin_html_abe2ea0ac74599eee61235c5db12d9ed2"><div class="ttname"><a href="classroute__following__plugin_1_1RouteFollowingPlugin.html#abe2ea0ac74599eee61235c5db12d9ed2">route_following_plugin::RouteFollowingPlugin::returnToShortestPath</a></div><div class="ttdeci">void returnToShortestPath(const lanelet::ConstLanelet &amp;current_lanelet)</div><div class="ttdoc">This method re-routes the vehicle back to the shortest path, if the vehicle has left the shortest pat...</div><div class="ttdef"><b>Definition:</b> <a href="route__following__plugin_8cpp_source.html#l00845">route_following_plugin.cpp:845</a></div></div>
<div class="ttc" id="aclassroute__following__plugin_1_1RouteFollowingPlugin_html_ac34b11de0eb1b225341e6b8cf20c3faf"><div class="ttname"><a href="classroute__following__plugin_1_1RouteFollowingPlugin.html#ac34b11de0eb1b225341e6b8cf20c3faf">route_following_plugin::RouteFollowingPlugin::twist_sub_</a></div><div class="ttdeci">carma_ros2_utils::SubPtr&lt; geometry_msgs::msg::TwistStamped &gt; twist_sub_</div><div class="ttdef"><b>Definition:</b> <a href="route__following__plugin_8hpp_source.html#l00229">route_following_plugin.hpp:229</a></div></div>
<div class="ttc" id="aclassroute__following__plugin_1_1RouteFollowingPlugin_html_ac487663f89485ae0f759b768e1e08ace"><div class="ttname"><a href="classroute__following__plugin_1_1RouteFollowingPlugin.html#ac487663f89485ae0f759b768e1e08ace">route_following_plugin::RouteFollowingPlugin::planning_strategic_plugin_</a></div><div class="ttdeci">std::string planning_strategic_plugin_</div><div class="ttdef"><b>Definition:</b> <a href="route__following__plugin_8hpp_source.html#l00260">route_following_plugin.hpp:260</a></div></div>
<div class="ttc" id="aclassroute__following__plugin_1_1RouteFollowingPlugin_html_ad2b1509e197aaf188431df53edaec7c6"><div class="ttname"><a href="classroute__following__plugin_1_1RouteFollowingPlugin.html#ad2b1509e197aaf188431df53edaec7c6">route_following_plugin::RouteFollowingPlugin::RouteFollowingPlugin</a></div><div class="ttdeci">RouteFollowingPlugin(const rclcpp::NodeOptions &amp;)</div><div class="ttdoc">Default constructor for RouteFollowingPlugin class.</div><div class="ttdef"><b>Definition:</b> <a href="route__following__plugin_8cpp_source.html#l00088">route_following_plugin.cpp:88</a></div></div>
<div class="ttc" id="aclassroute__following__plugin_1_1RouteFollowingPlugin_html_addf16b06e2e2053d9a2575b5f76248d7"><div class="ttname"><a href="classroute__following__plugin_1_1RouteFollowingPlugin.html#addf16b06e2e2053d9a2575b5f76248d7">route_following_plugin::RouteFollowingPlugin::composeStopAndWaitManeuverMessage</a></div><div class="ttdeci">carma_planning_msgs::msg::Maneuver composeStopAndWaitManeuverMessage(double start_dist, double end_dist, double start_speed, lanelet::Id starting_lane_id, lanelet::Id ending_lane_id, double stopping_accel) const</div><div class="ttdoc">Compose a stop and wait maneuver message based on input params. NOTE: The start and stop time are not...</div><div class="ttdef"><b>Definition:</b> <a href="route__following__plugin_8cpp_source.html#l00784">route_following_plugin.cpp:784</a></div></div>
<div class="ttc" id="aclassroute__following__plugin_1_1RouteFollowingPlugin_html_ae503d51abc6402c90f8c8b38f49451c3"><div class="ttname"><a href="classroute__following__plugin_1_1RouteFollowingPlugin.html#ae503d51abc6402c90f8c8b38f49451c3">route_following_plugin::RouteFollowingPlugin::tf2_buffer_</a></div><div class="ttdeci">tf2_ros::Buffer tf2_buffer_</div><div class="ttdef"><b>Definition:</b> <a href="route__following__plugin_8hpp_source.html#l00304">route_following_plugin.hpp:304</a></div></div>
<div class="ttc" id="aclassroute__following__plugin_1_1RouteFollowingPlugin_html_aee9ed912513ae39c8bf8d5100b4ab86c"><div class="ttname"><a href="classroute__following__plugin_1_1RouteFollowingPlugin.html#aee9ed912513ae39c8bf8d5100b4ab86c">route_following_plugin::RouteFollowingPlugin::tf_</a></div><div class="ttdeci">geometry_msgs::msg::TransformStamped tf_</div><div class="ttdef"><b>Definition:</b> <a href="route__following__plugin_8hpp_source.html#l00298">route_following_plugin.hpp:298</a></div></div>
<div class="ttc" id="aclassroute__following__plugin_1_1RouteFollowingPlugin_html_aef98e4f85a3a9dd0ac4f8aa2bccc3077"><div class="ttname"><a href="classroute__following__plugin_1_1RouteFollowingPlugin.html#aef98e4f85a3a9dd0ac4f8aa2bccc3077">route_following_plugin::RouteFollowingPlugin::addStopAndWaitAtRouteEnd</a></div><div class="ttdeci">std::vector&lt; carma_planning_msgs::msg::Maneuver &gt; addStopAndWaitAtRouteEnd(const std::vector&lt; carma_planning_msgs::msg::Maneuver &gt; &amp;input_maneuvers, double route_end_downtrack, double stopping_entry_speed, double stopping_logitudinal_accel, double lateral_accel_limit, double min_maneuver_length) const</div><div class="ttdoc">Adds a StopAndWait maneuver to the end of a maneuver set stopping at the provided downtrack value NOT...</div><div class="ttdef"><b>Definition:</b> <a href="route__following__plugin_8cpp_source.html#l00265">route_following_plugin.cpp:265</a></div></div>
<div class="ttc" id="aclassroute__following__plugin_1_1RouteFollowingPlugin_html_af17e2785054c29b5a8c631b3ea4fa21d"><div class="ttname"><a href="classroute__following__plugin_1_1RouteFollowingPlugin.html#af17e2785054c29b5a8c631b3ea4fa21d">route_following_plugin::RouteFollowingPlugin::get_availability</a></div><div class="ttdeci">bool get_availability()</div><div class="ttdoc">Get the availability status of this plugin based on the current operating environment....</div><div class="ttdef"><b>Definition:</b> <a href="route__following__plugin_8cpp_source.html#l00403">route_following_plugin.cpp:403</a></div></div>
<div class="ttc" id="aclassroute__following__plugin_1_1RouteFollowingPlugin_html_af6f7bdeb8816c83b212f6329f8e5652d"><div class="ttname"><a href="classroute__following__plugin_1_1RouteFollowingPlugin.html#af6f7bdeb8816c83b212f6329f8e5652d">route_following_plugin::RouteFollowingPlugin::wm_</a></div><div class="ttdeci">carma_wm::WorldModelConstPtr wm_</div><div class="ttdef"><b>Definition:</b> <a href="route__following__plugin_8hpp_source.html#l00077">route_following_plugin.hpp:77</a></div></div>
<div class="ttc" id="anamespacecarma__cooperative__perception_html_a64b708654c8aecb09122d39577df31b5"><div class="ttname"><a href="namespacecarma__cooperative__perception.html#a64b708654c8aecb09122d39577df31b5">carma_cooperative_perception::to_string</a></div><div class="ttdeci">auto to_string(const UtmZone &amp;zone) -&gt; std::string</div><div class="ttdef"><b>Definition:</b> <a href="utm__zone_8cpp_source.html#l00021">utm_zone.cpp:21</a></div></div>
<div class="ttc" id="anamespacecarma__guidance__plugins_html"><div class="ttname"><a href="namespacecarma__guidance__plugins.html">carma_guidance_plugins</a></div><div class="ttdef"><b>Definition:</b> <a href="control__plugin_8hpp_source.html#l00027">control_plugin.hpp:28</a></div></div>
<div class="ttc" id="anamespacelanelet_html"><div class="ttname"><a href="namespacelanelet.html">lanelet</a></div><div class="ttdef"><b>Definition:</b> <a href="MapConformer_8hpp_source.html#l00038">MapConformer.hpp:39</a></div></div>
<div class="ttc" id="anamespaceprocess__bag_html_af102a02c97622dd30b0dbf7bafb0d199"><div class="ttname"><a href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">process_bag.i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="process__bag_8py_source.html#l00059">process_bag.py:59</a></div></div>
<div class="ttc" id="anamespaceroute__following__plugin_1_1anonymous__namespace_02route__following__plugin_8cpp_03_html_a69b9c9bf1a2410dfb992ec9874073e4e"><div class="ttname"><a href="namespaceroute__following__plugin_1_1anonymous__namespace_02route__following__plugin_8cpp_03.html#a69b9c9bf1a2410dfb992ec9874073e4e">route_following_plugin::anonymous_namespace{route_following_plugin.cpp}::setManeuverLaneletIds</a></div><div class="ttdeci">void setManeuverLaneletIds(carma_planning_msgs::msg::Maneuver &amp;mvr, lanelet::Id start_id, lanelet::Id end_id)</div><div class="ttdoc">Anonymous function to set the lanelet ids for all maneuver types except lane following.</div><div class="ttdef"><b>Definition:</b> <a href="route__following__plugin_8cpp_source.html#l00058">route_following_plugin.cpp:58</a></div></div>
<div class="ttc" id="anamespaceroute__following__plugin_1_1anonymous__namespace_02route__following__plugin_8cpp_03_html_a9b29dd085f9f59d468b1c9320f0b5102"><div class="ttname"><a href="namespaceroute__following__plugin_1_1anonymous__namespace_02route__following__plugin_8cpp_03.html#a9b29dd085f9f59d468b1c9320f0b5102">route_following_plugin::anonymous_namespace{route_following_plugin.cpp}::getManeuverEndSpeed</a></div><div class="ttdeci">double getManeuverEndSpeed(const carma_planning_msgs::msg::Maneuver &amp;mvr)</div><div class="ttdoc">Anonymous function to extract maneuver end speed which can not be optained with GET_MANEUVER_PROPERY ...</div><div class="ttdef"><b>Definition:</b> <a href="route__following__plugin_8cpp_source.html#l00036">route_following_plugin.cpp:36</a></div></div>
<div class="ttc" id="anamespaceroute__following__plugin_html"><div class="ttname"><a href="namespaceroute__following__plugin.html">route_following_plugin</a></div><div class="ttdef"><b>Definition:</b> <a href="route__following__plugin_8hpp_source.html#l00060">route_following_plugin.hpp:61</a></div></div>
<div class="ttc" id="aplan__delegator_8hpp_html_a490076edf649de33d777ebd52faf68b6"><div class="ttname"><a href="plan__delegator_8hpp.html#a490076edf649de33d777ebd52faf68b6">SET_MANEUVER_PROPERTY</a></div><div class="ttdeci">#define SET_MANEUVER_PROPERTY(mvr, property, value)</div><div class="ttdef"><b>Definition:</b> <a href="plan__delegator_8hpp_source.html#l00055">plan_delegator.hpp:55</a></div></div>
<div class="ttc" id="aroute__following__plugin_8hpp_html"><div class="ttname"><a href="route__following__plugin_8hpp.html">route_following_plugin.hpp</a></div></div>
<div class="ttc" id="astructroute__following__plugin_1_1Config_html"><div class="ttname"><a href="structroute__following__plugin_1_1Config.html">route_following_plugin::Config</a></div><div class="ttdoc">Struct containing config values values for route_following_plugin.</div><div class="ttdef"><b>Definition:</b> <a href="route__following__plugin__config_8hpp_source.html#l00026">route_following_plugin_config.hpp:27</a></div></div>
<div class="ttc" id="astructroute__following__plugin_1_1Config_html_a0cbb8bef75d40988a712e401a69fca1d"><div class="ttname"><a href="structroute__following__plugin_1_1Config.html#a0cbb8bef75d40988a712e401a69fca1d">route_following_plugin::Config::min_plan_duration_</a></div><div class="ttdeci">double min_plan_duration_</div><div class="ttdef"><b>Definition:</b> <a href="route__following__plugin__config_8hpp_source.html#l00029">route_following_plugin_config.hpp:29</a></div></div>
<div class="ttc" id="astructroute__following__plugin_1_1Config_html_a0fdf01f60fdb0678d9fda3d7d2e38291"><div class="ttname"><a href="structroute__following__plugin_1_1Config.html#a0fdf01f60fdb0678d9fda3d7d2e38291">route_following_plugin::Config::lanefollow_planning_tactical_plugin_</a></div><div class="ttdeci">std::string lanefollow_planning_tactical_plugin_</div><div class="ttdef"><b>Definition:</b> <a href="route__following__plugin__config_8hpp_source.html#l00034">route_following_plugin_config.hpp:34</a></div></div>
<div class="ttc" id="astructroute__following__plugin_1_1Config_html_a3470bc2fdd2a28b4d080f9fe2713aa4a"><div class="ttname"><a href="structroute__following__plugin_1_1Config.html#a3470bc2fdd2a28b4d080f9fe2713aa4a">route_following_plugin::Config::route_end_point_buffer_</a></div><div class="ttdeci">double route_end_point_buffer_</div><div class="ttdef"><b>Definition:</b> <a href="route__following__plugin__config_8hpp_source.html#l00035">route_following_plugin_config.hpp:35</a></div></div>
<div class="ttc" id="astructroute__following__plugin_1_1Config_html_a3bbcbea2b6e0a3efdcc60ff000a30423"><div class="ttname"><a href="structroute__following__plugin_1_1Config.html#a3bbcbea2b6e0a3efdcc60ff000a30423">route_following_plugin::Config::lane_change_plugin_</a></div><div class="ttdeci">std::string lane_change_plugin_</div><div class="ttdef"><b>Definition:</b> <a href="route__following__plugin__config_8hpp_source.html#l00031">route_following_plugin_config.hpp:31</a></div></div>
<div class="ttc" id="astructroute__following__plugin_1_1Config_html_a61dbf38ff77488710f53d68dfd68c490"><div class="ttname"><a href="structroute__following__plugin_1_1Config.html#a61dbf38ff77488710f53d68dfd68c490">route_following_plugin::Config::stop_and_wait_plugin_</a></div><div class="ttdeci">std::string stop_and_wait_plugin_</div><div class="ttdef"><b>Definition:</b> <a href="route__following__plugin__config_8hpp_source.html#l00032">route_following_plugin_config.hpp:32</a></div></div>
<div class="ttc" id="astructroute__following__plugin_1_1Config_html_a7a7ba0615ca6ac7d348a8055f576fa8f"><div class="ttname"><a href="structroute__following__plugin_1_1Config.html#a7a7ba0615ca6ac7d348a8055f576fa8f">route_following_plugin::Config::accel_limit_</a></div><div class="ttdeci">double accel_limit_</div><div class="ttdef"><b>Definition:</b> <a href="route__following__plugin__config_8hpp_source.html#l00036">route_following_plugin_config.hpp:36</a></div></div>
<div class="ttc" id="astructroute__following__plugin_1_1Config_html_a7ee8465bea603709497a36e9ecd36cec"><div class="ttname"><a href="structroute__following__plugin_1_1Config.html#a7ee8465bea603709497a36e9ecd36cec">route_following_plugin::Config::vehicle_id</a></div><div class="ttdeci">std::string vehicle_id</div><div class="ttdef"><b>Definition:</b> <a href="route__following__plugin__config_8hpp_source.html#l00033">route_following_plugin_config.hpp:33</a></div></div>
<div class="ttc" id="astructroute__following__plugin_1_1Config_html_a8d931f2dc9bd78bd001a1cef0a9fe040"><div class="ttname"><a href="structroute__following__plugin_1_1Config.html#a8d931f2dc9bd78bd001a1cef0a9fe040">route_following_plugin::Config::lateral_accel_limit_</a></div><div class="ttdeci">double lateral_accel_limit_</div><div class="ttdef"><b>Definition:</b> <a href="route__following__plugin__config_8hpp_source.html#l00037">route_following_plugin_config.hpp:37</a></div></div>
<div class="ttc" id="astructroute__following__plugin_1_1Config_html_a9cae5fa7d5eb58d2be34b101958a131c"><div class="ttname"><a href="structroute__following__plugin_1_1Config.html#a9cae5fa7d5eb58d2be34b101958a131c">route_following_plugin::Config::min_maneuver_length_</a></div><div class="ttdeci">double min_maneuver_length_</div><div class="ttdef"><b>Definition:</b> <a href="route__following__plugin__config_8hpp_source.html#l00039">route_following_plugin_config.hpp:39</a></div></div>
<div class="ttc" id="astructroute__following__plugin_1_1Config_html_ad8ce5533d8d609c69f82a11568f16e50"><div class="ttname"><a href="structroute__following__plugin_1_1Config.html#ad8ce5533d8d609c69f82a11568f16e50">route_following_plugin::Config::stopping_accel_limit_multiplier_</a></div><div class="ttdeci">double stopping_accel_limit_multiplier_</div><div class="ttdef"><b>Definition:</b> <a href="route__following__plugin__config_8hpp_source.html#l00038">route_following_plugin_config.hpp:38</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_95cd68ac93928c44fbd424a91e6daa3d.html">route_following_plugin</a></li><li class="navelem"><a class="el" href="dir_dd2d59332e53a25f1939e11a63659846.html">src</a></li><li class="navelem"><a class="el" href="route__following__plugin_8cpp.html">route_following_plugin.cpp</a></li>
    <li class="footer">Generated on Fri May 10 2024 15:46:54 for Carma-platform by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.4 </li>
  </ul>
</div>
</body>
</html>
