<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Carma-platform: carma_wm/src/WMListenerWorker.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Carma-platform<span id="projectnumber">&#160;v4.2.0</span>
   </div>
   <div id="projectbrief">CARMA Platform is built on robot operating system (ROS) and utilizes open source software (OSS) that enables Cooperative Driving Automation (CDA) features to allow Automated Driving Systems to interact and cooperate with infrastructure and other vehicles through communication.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('WMListenerWorker_8cpp_source.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle"><div class="title">WMListenerWorker.cpp</div></div>
</div><!--header-->
<div class="contents">
<a href="WMListenerWorker_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a id="l00001" name="l00001"></a><span class="lineno">    1</span><span class="comment">/*</span></div>
<div class="line"><a id="l00002" name="l00002"></a><span class="lineno">    2</span><span class="comment"> * Copyright (C) 2022 LEIDOS.</span></div>
<div class="line"><a id="l00003" name="l00003"></a><span class="lineno">    3</span><span class="comment"> *</span></div>
<div class="line"><a id="l00004" name="l00004"></a><span class="lineno">    4</span><span class="comment"> * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); you may not</span></div>
<div class="line"><a id="l00005" name="l00005"></a><span class="lineno">    5</span><span class="comment"> * use this file except in compliance with the License. You may obtain a copy of</span></div>
<div class="line"><a id="l00006" name="l00006"></a><span class="lineno">    6</span><span class="comment"> * the License at</span></div>
<div class="line"><a id="l00007" name="l00007"></a><span class="lineno">    7</span><span class="comment"> *</span></div>
<div class="line"><a id="l00008" name="l00008"></a><span class="lineno">    8</span><span class="comment"> * http://www.apache.org/licenses/LICENSE-2.0</span></div>
<div class="line"><a id="l00009" name="l00009"></a><span class="lineno">    9</span><span class="comment"> *</span></div>
<div class="line"><a id="l00010" name="l00010"></a><span class="lineno">   10</span><span class="comment"> * Unless required by applicable law or agreed to in writing, software</span></div>
<div class="line"><a id="l00011" name="l00011"></a><span class="lineno">   11</span><span class="comment"> * distributed under the License is distributed on an &quot;AS IS&quot; BASIS, WITHOUT</span></div>
<div class="line"><a id="l00012" name="l00012"></a><span class="lineno">   12</span><span class="comment"> * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the</span></div>
<div class="line"><a id="l00013" name="l00013"></a><span class="lineno">   13</span><span class="comment"> * License for the specific language governing permissions and limitations under</span></div>
<div class="line"><a id="l00014" name="l00014"></a><span class="lineno">   14</span><span class="comment"> * the License.</span></div>
<div class="line"><a id="l00015" name="l00015"></a><span class="lineno">   15</span><span class="comment"> */</span></div>
<div class="line"><a id="l00016" name="l00016"></a><span class="lineno">   16</span> </div>
<div class="line"><a id="l00017" name="l00017"></a><span class="lineno">   17</span><span class="preprocessor">#include &lt;autoware_lanelet2_ros2_interface/utility/message_conversion.hpp&gt;</span></div>
<div class="line"><a id="l00018" name="l00018"></a><span class="lineno">   18</span><span class="preprocessor">#include &lt;lanelet2_extension/regulatory_elements/DirectionOfTravel.h&gt;</span></div>
<div class="line"><a id="l00019" name="l00019"></a><span class="lineno">   19</span><span class="preprocessor">#include &lt;lanelet2_extension/regulatory_elements/StopRule.h&gt;</span></div>
<div class="line"><a id="l00020" name="l00020"></a><span class="lineno">   20</span><span class="preprocessor">#include &lt;lanelet2_extension/regulatory_elements/CarmaTrafficSignal.h&gt;</span></div>
<div class="line"><a id="l00021" name="l00021"></a><span class="lineno">   21</span><span class="preprocessor">#include &lt;lanelet2_extension/regulatory_elements/SignalizedIntersection.h&gt;</span></div>
<div class="line"><a id="l00022" name="l00022"></a><span class="lineno">   22</span><span class="preprocessor">#include &lt;lanelet2_routing/internal/Graph.h&gt;</span></div>
<div class="line"><a id="l00023" name="l00023"></a><span class="lineno">   23</span><span class="preprocessor">#include &quot;<a class="code" href="WMListenerWorker_8hpp.html">WMListenerWorker.hpp</a>&quot;</span></div>
<div class="line"><a id="l00024" name="l00024"></a><span class="lineno">   24</span> </div>
<div class="line"><a id="l00025" name="l00025"></a><span class="lineno">   25</span><span class="keyword">namespace </span><a class="code hl_namespace" href="namespacecarma__wm.html">carma_wm</a></div>
<div class="line"><a id="l00026" name="l00026"></a><span class="lineno">   26</span>{</div>
<div class="line"><a id="l00027" name="l00027"></a><span class="lineno">   27</span> </div>
<div class="line"><a id="l00028" name="l00028"></a><span class="lineno"><a class="line" href="namespacecarma__wm.html#ac09d7a77e6f8f955651e7afa16136bf1">   28</a></span><span class="keyword">enum class</span> <a class="code hl_enumeration" href="namespacecarma__wm.html#ac09d7a77e6f8f955651e7afa16136bf1">GeofenceType</a>{ <a class="code hl_enumvalue" href="namespacecarma__wm.html#ac09d7a77e6f8f955651e7afa16136bf1accc0377a8afbf50e7094f5c23a8af223">INVALID</a>, <a class="code hl_enumvalue" href="namespacecarma__wm.html#ac09d7a77e6f8f955651e7afa16136bf1a56a6787427d0254f508836bebdea7700">DIGITAL_SPEED_LIMIT</a>, <a class="code hl_enumvalue" href="namespacecarma__wm.html#ac09d7a77e6f8f955651e7afa16136bf1a0acb40e631b1fdde545715ce5080ce82">PASSING_CONTROL_LINE</a>, <a class="code hl_enumvalue" href="namespacecarma__wm.html#ac09d7a77e6f8f955651e7afa16136bf1a3342d8a1648c3c7b49348bdebb6a67d8">REGION_ACCESS_RULE</a>, <a class="code hl_enumvalue" href="namespacecarma__wm.html#ac09d7a77e6f8f955651e7afa16136bf1a72fb3f0a086a3e9014953c51396b9f63">DIGITAL_MINIMUM_GAP</a>,</div>
<div class="line"><a id="l00029" name="l00029"></a><span class="lineno">   29</span>                          <a class="code hl_enumvalue" href="namespacecarma__wm.html#ac09d7a77e6f8f955651e7afa16136bf1a165080307b64c43de1a0939d3bf047ae">DIRECTION_OF_TRAVEL</a>, <a class="code hl_enumvalue" href="namespacecarma__wm.html#ac09d7a77e6f8f955651e7afa16136bf1a3ef9e3ed7808c7c32a48e954fad71c04">STOP_RULE</a>, <a class="code hl_enumvalue" href="namespacecarma__wm.html#ac09d7a77e6f8f955651e7afa16136bf1a269b80a3c3f0b44a73071e21d4ab36c2">CARMA_TRAFFIC_LIGHT</a>, <a class="code hl_enumvalue" href="namespacecarma__wm.html#ac09d7a77e6f8f955651e7afa16136bf1a5183fcbc60f37b81f9ca22d76af71867">SIGNALIZED_INTERSECTION</a><span class="comment">/* ... others */</span> };</div>
<div class="line"><a id="l00030" name="l00030"></a><span class="lineno">   30</span><span class="comment">// helper function that return geofence type as an enum, which makes it cleaner by allowing switch statement</span></div>
<div class="line"><a id="l00031" name="l00031"></a><span class="lineno"><a class="line" href="namespacecarma__wm.html#a4c3b7aaa05aea0c95189c98c5d902cf8">   31</a></span><a class="code hl_enumeration" href="namespacecarma__wm.html#ac09d7a77e6f8f955651e7afa16136bf1">GeofenceType</a> <a class="code hl_function" href="namespacecarma__wm.html#a4c3b7aaa05aea0c95189c98c5d902cf8">resolveGeofenceType</a>(<span class="keyword">const</span> std::string&amp; rule_name)</div>
<div class="line"><a id="l00032" name="l00032"></a><span class="lineno">   32</span>{</div>
<div class="line"><a id="l00033" name="l00033"></a><span class="lineno">   33</span>  <span class="keywordflow">if</span> (rule_name.compare(lanelet::PassingControlLine::RuleName) == 0) <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="namespacecarma__wm.html#ac09d7a77e6f8f955651e7afa16136bf1a0acb40e631b1fdde545715ce5080ce82">GeofenceType::PASSING_CONTROL_LINE</a>;</div>
<div class="line"><a id="l00034" name="l00034"></a><span class="lineno">   34</span>  <span class="keywordflow">if</span> (rule_name.compare(lanelet::DigitalSpeedLimit::RuleName) == 0) <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="namespacecarma__wm.html#ac09d7a77e6f8f955651e7afa16136bf1a56a6787427d0254f508836bebdea7700">GeofenceType::DIGITAL_SPEED_LIMIT</a>;</div>
<div class="line"><a id="l00035" name="l00035"></a><span class="lineno">   35</span>  <span class="keywordflow">if</span> (rule_name.compare(lanelet::RegionAccessRule::RuleName) == 0) <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="namespacecarma__wm.html#ac09d7a77e6f8f955651e7afa16136bf1a3342d8a1648c3c7b49348bdebb6a67d8">GeofenceType::REGION_ACCESS_RULE</a>;</div>
<div class="line"><a id="l00036" name="l00036"></a><span class="lineno">   36</span>  <span class="keywordflow">if</span> (rule_name.compare(lanelet::DigitalMinimumGap::RuleName) == 0) <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="namespacecarma__wm.html#ac09d7a77e6f8f955651e7afa16136bf1a72fb3f0a086a3e9014953c51396b9f63">GeofenceType::DIGITAL_MINIMUM_GAP</a>;</div>
<div class="line"><a id="l00037" name="l00037"></a><span class="lineno">   37</span>  <span class="keywordflow">if</span> (rule_name.compare(lanelet::DirectionOfTravel::RuleName) == 0) <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="namespacecarma__wm.html#ac09d7a77e6f8f955651e7afa16136bf1a165080307b64c43de1a0939d3bf047ae">GeofenceType::DIRECTION_OF_TRAVEL</a>;</div>
<div class="line"><a id="l00038" name="l00038"></a><span class="lineno">   38</span>  <span class="keywordflow">if</span> (rule_name.compare(lanelet::StopRule::RuleName) == 0) <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="namespacecarma__wm.html#ac09d7a77e6f8f955651e7afa16136bf1a3ef9e3ed7808c7c32a48e954fad71c04">GeofenceType::STOP_RULE</a>;</div>
<div class="line"><a id="l00039" name="l00039"></a><span class="lineno">   39</span>  <span class="keywordflow">if</span> (rule_name.compare(lanelet::CarmaTrafficSignal::RuleName) == 0) <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="namespacecarma__wm.html#ac09d7a77e6f8f955651e7afa16136bf1a269b80a3c3f0b44a73071e21d4ab36c2">GeofenceType::CARMA_TRAFFIC_LIGHT</a>;</div>
<div class="line"><a id="l00040" name="l00040"></a><span class="lineno">   40</span>  <span class="keywordflow">if</span> (rule_name.compare(lanelet::SignalizedIntersection::RuleName) == 0) <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="namespacecarma__wm.html#ac09d7a77e6f8f955651e7afa16136bf1a5183fcbc60f37b81f9ca22d76af71867">GeofenceType::SIGNALIZED_INTERSECTION</a>;</div>
<div class="line"><a id="l00041" name="l00041"></a><span class="lineno">   41</span> </div>
<div class="line"><a id="l00042" name="l00042"></a><span class="lineno">   42</span>  <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="namespacecarma__wm.html#ac09d7a77e6f8f955651e7afa16136bf1accc0377a8afbf50e7094f5c23a8af223">GeofenceType::INVALID</a>;</div>
<div class="line"><a id="l00043" name="l00043"></a><span class="lineno">   43</span>}</div>
<div class="line"><a id="l00044" name="l00044"></a><span class="lineno">   44</span> </div>
<div class="line"><a id="l00045" name="l00045"></a><span class="lineno"><a class="line" href="classcarma__wm_1_1WMListenerWorker.html#ae5b964291859114c54b1f726d8cdeda2">   45</a></span><a class="code hl_function" href="classcarma__wm_1_1WMListenerWorker.html#ae5b964291859114c54b1f726d8cdeda2">WMListenerWorker::WMListenerWorker</a>()</div>
<div class="line"><a id="l00046" name="l00046"></a><span class="lineno">   46</span>{</div>
<div class="line"><a id="l00047" name="l00047"></a><span class="lineno">   47</span>  <a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#a4ea1ac169b8ba4a72dd72b4e8723257e">world_model_</a>.reset(<span class="keyword">new</span> <a class="code hl_class" href="classcarma__wm_1_1CARMAWorldModel.html">CARMAWorldModel</a>);</div>
<div class="line"><a id="l00048" name="l00048"></a><span class="lineno">   48</span>}</div>
<div class="line"><a id="l00049" name="l00049"></a><span class="lineno">   49</span> </div>
<div class="line"><a id="l00050" name="l00050"></a><span class="lineno"><a class="line" href="classcarma__wm_1_1WMListenerWorker.html#ad46406f4874729f47b079b52f4ebb213">   50</a></span><a class="code hl_typedef" href="namespacecarma__wm.html#a3ac653959e0b6198cae274d68b343228">WorldModelConstPtr</a> <a class="code hl_function" href="classcarma__wm_1_1WMListenerWorker.html#ad46406f4874729f47b079b52f4ebb213">WMListenerWorker::getWorldModel</a>()<span class="keyword"> const</span></div>
<div class="line"><a id="l00051" name="l00051"></a><span class="lineno">   51</span><span class="keyword"></span>{</div>
<div class="line"><a id="l00052" name="l00052"></a><span class="lineno">   52</span>  <span class="keywordflow">return</span> std::static_pointer_cast&lt;const WorldModel&gt;(<a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#a4ea1ac169b8ba4a72dd72b4e8723257e">world_model_</a>);  <span class="comment">// Cast pointer to const variant</span></div>
<div class="line"><a id="l00053" name="l00053"></a><span class="lineno">   53</span>}</div>
<div class="line"><a id="l00054" name="l00054"></a><span class="lineno">   54</span> </div>
<div class="line"><a id="l00055" name="l00055"></a><span class="lineno">   55</span> </div>
<div class="line"><a id="l00056" name="l00056"></a><span class="lineno"><a class="line" href="classcarma__wm_1_1WMListenerWorker.html#a8e15579129fdb4096b4a1540d007b07e">   56</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classcarma__wm_1_1WMListenerWorker.html#a8e15579129fdb4096b4a1540d007b07e">WMListenerWorker::mapCallback</a>(<span class="keyword">const</span> autoware_lanelet2_msgs::msg::MapBin::SharedPtr map_msg)</div>
<div class="line"><a id="l00057" name="l00057"></a><span class="lineno">   57</span>{</div>
<div class="line"><a id="l00058" name="l00058"></a><span class="lineno">   58</span>  <a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#aae0b14b4566a06ba1c99e46e79de0fba">current_map_version_</a> = map_msg-&gt;map_version;</div>
<div class="line"><a id="l00059" name="l00059"></a><span class="lineno">   59</span> </div>
<div class="line"><a id="l00060" name="l00060"></a><span class="lineno">   60</span>  lanelet::LaneletMapPtr new_map(<span class="keyword">new</span> lanelet::LaneletMap);</div>
<div class="line"><a id="l00061" name="l00061"></a><span class="lineno">   61</span> </div>
<div class="line"><a id="l00062" name="l00062"></a><span class="lineno">   62</span>  <a class="code hl_function" href="namespacecarma__wm.html#a3c6c82d3e0fcfc7dd50176a453598911">lanelet::utils::conversion::fromBinMsg</a>(*map_msg, new_map);</div>
<div class="line"><a id="l00063" name="l00063"></a><span class="lineno">   63</span> </div>
<div class="line"><a id="l00064" name="l00064"></a><span class="lineno">   64</span>  <a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#a4ea1ac169b8ba4a72dd72b4e8723257e">world_model_</a>-&gt;setMap(new_map, <a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#aae0b14b4566a06ba1c99e46e79de0fba">current_map_version_</a>);</div>
<div class="line"><a id="l00065" name="l00065"></a><span class="lineno">   65</span> </div>
<div class="line"><a id="l00066" name="l00066"></a><span class="lineno">   66</span>  <span class="comment">// After setting map evaluate the current update queue to apply any updates that arrived before the map</span></div>
<div class="line"><a id="l00067" name="l00067"></a><span class="lineno">   67</span>  <span class="keywordtype">bool</span> more_updates_to_apply = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00068" name="l00068"></a><span class="lineno">   68</span>  <span class="keywordflow">while</span>(!<a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#ae5106bd418dff1ee316864d929c02c93">map_update_queue_</a>.empty() &amp;&amp; more_updates_to_apply) {</div>
<div class="line"><a id="l00069" name="l00069"></a><span class="lineno">   69</span> </div>
<div class="line"><a id="l00070" name="l00070"></a><span class="lineno">   70</span>    <span class="keyword">auto</span> update = <a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#ae5106bd418dff1ee316864d929c02c93">map_update_queue_</a>.front(); <span class="comment">// Get first update</span></div>
<div class="line"><a id="l00071" name="l00071"></a><span class="lineno">   71</span>    <a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#ae5106bd418dff1ee316864d929c02c93">map_update_queue_</a>.pop(); <span class="comment">// Remove update from queue</span></div>
<div class="line"><a id="l00072" name="l00072"></a><span class="lineno">   72</span> </div>
<div class="line"><a id="l00073" name="l00073"></a><span class="lineno">   73</span>    <span class="keywordflow">if</span> (update-&gt;map_version &lt; <a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#aae0b14b4566a06ba1c99e46e79de0fba">current_map_version_</a>) { <span class="comment">// Drop any so far unapplied updates for the previous map</span></div>
<div class="line"><a id="l00074" name="l00074"></a><span class="lineno">   74</span>      RCLCPP_WARN_STREAM(rclcpp::get_logger(<span class="stringliteral">&quot;carma_wm::WMListenerWorker&quot;</span>), <span class="stringliteral">&quot;There were unapplied updates in carma_wm when a new map was received.&quot;</span>);</div>
<div class="line"><a id="l00075" name="l00075"></a><span class="lineno">   75</span>      <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00076" name="l00076"></a><span class="lineno">   76</span>    }</div>
<div class="line"><a id="l00077" name="l00077"></a><span class="lineno">   77</span>    <span class="keywordflow">if</span> (update-&gt;map_version == <a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#aae0b14b4566a06ba1c99e46e79de0fba">current_map_version_</a>) { <span class="comment">// Current update goes with current map</span></div>
<div class="line"><a id="l00078" name="l00078"></a><span class="lineno">   78</span>      <a class="code hl_function" href="classcarma__wm_1_1WMListenerWorker.html#a44154428b921244d04d4678ed61c81d8">mapUpdateCallback</a>(update); <span class="comment">// Apply the update</span></div>
<div class="line"><a id="l00079" name="l00079"></a><span class="lineno">   79</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00080" name="l00080"></a><span class="lineno">   80</span>      RCLCPP_INFO_STREAM(rclcpp::get_logger(<span class="stringliteral">&quot;carma_wm::WMListenerWorker&quot;</span>), <span class="stringliteral">&quot;Done applying updates for new map. However, more updates are waiting for a future map.&quot;</span>);</div>
<div class="line"><a id="l00081" name="l00081"></a><span class="lineno">   81</span>      more_updates_to_apply = <span class="keyword">false</span>; <span class="comment">// If there is more updates queued that are not for this map version assume they are for a future map version</span></div>
<div class="line"><a id="l00082" name="l00082"></a><span class="lineno">   82</span>    }</div>
<div class="line"><a id="l00083" name="l00083"></a><span class="lineno">   83</span> </div>
<div class="line"><a id="l00084" name="l00084"></a><span class="lineno">   84</span>  }</div>
<div class="line"><a id="l00085" name="l00085"></a><span class="lineno">   85</span> </div>
<div class="line"><a id="l00086" name="l00086"></a><span class="lineno">   86</span>  <span class="comment">// Call user defined map callback</span></div>
<div class="line"><a id="l00087" name="l00087"></a><span class="lineno">   87</span>  <span class="keywordflow">if</span> (<a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#a3c2e638e8fdc934482ba9076a5ca7bb5">map_callback_</a>)</div>
<div class="line"><a id="l00088" name="l00088"></a><span class="lineno">   88</span>  {</div>
<div class="line"><a id="l00089" name="l00089"></a><span class="lineno">   89</span>    <a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#a3c2e638e8fdc934482ba9076a5ca7bb5">map_callback_</a>();</div>
<div class="line"><a id="l00090" name="l00090"></a><span class="lineno">   90</span>  }</div>
<div class="line"><a id="l00091" name="l00091"></a><span class="lineno">   91</span> </div>
<div class="line"><a id="l00092" name="l00092"></a><span class="lineno">   92</span>  <span class="keywordflow">if</span> (<a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#a295aefa7073627e0c645ab19ec123a73">delayed_route_msg_</a>) {</div>
<div class="line"><a id="l00093" name="l00093"></a><span class="lineno">   93</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#a295aefa7073627e0c645ab19ec123a73">delayed_route_msg_</a>.get().map_version == <a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#aae0b14b4566a06ba1c99e46e79de0fba">current_map_version_</a>) { <span class="comment">// If there is a delayed route message to apply then do so</span></div>
<div class="line"><a id="l00094" name="l00094"></a><span class="lineno">   94</span>      <a class="code hl_function" href="classcarma__wm_1_1WMListenerWorker.html#a64f55af7e8146c0119b7f603a27629e4">routeCallback</a>(std::make_unique&lt;carma_planning_msgs::msg::Route&gt;(<a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#a295aefa7073627e0c645ab19ec123a73">delayed_route_msg_</a>.get()));</div>
<div class="line"><a id="l00095" name="l00095"></a><span class="lineno">   95</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#a295aefa7073627e0c645ab19ec123a73">delayed_route_msg_</a>.get().map_version &lt; <a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#aae0b14b4566a06ba1c99e46e79de0fba">current_map_version_</a>) {</div>
<div class="line"><a id="l00096" name="l00096"></a><span class="lineno">   96</span>      RCLCPP_WARN_STREAM(rclcpp::get_logger(<span class="stringliteral">&quot;carma_wm::WMListenerWorker&quot;</span>), <span class="stringliteral">&quot;Dropping delayed route message which was never applied as updated map was not recieved&quot;</span>);</div>
<div class="line"><a id="l00097" name="l00097"></a><span class="lineno">   97</span>      <a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#a295aefa7073627e0c645ab19ec123a73">delayed_route_msg_</a> = boost::none;</div>
<div class="line"><a id="l00098" name="l00098"></a><span class="lineno">   98</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00099" name="l00099"></a><span class="lineno">   99</span>      RCLCPP_INFO_STREAM(rclcpp::get_logger(<span class="stringliteral">&quot;carma_wm::WMListenerWorker&quot;</span>), <span class="stringliteral">&quot;There is a delayed route message still waiting to be applied in carma_wm&quot;</span>);</div>
<div class="line"><a id="l00100" name="l00100"></a><span class="lineno">  100</span>    }</div>
<div class="line"><a id="l00101" name="l00101"></a><span class="lineno">  101</span>  }</div>
<div class="line"><a id="l00102" name="l00102"></a><span class="lineno">  102</span>}</div>
<div class="line"><a id="l00103" name="l00103"></a><span class="lineno">  103</span> </div>
<div class="line"><a id="l00104" name="l00104"></a><span class="lineno"><a class="line" href="classcarma__wm_1_1WMListenerWorker.html#a7a740a64aa1b677acf1d16373c43a65c">  104</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classcarma__wm_1_1WMListenerWorker.html#a7a740a64aa1b677acf1d16373c43a65c">WMListenerWorker::incomingSpatCallback</a>(<span class="keyword">const</span> carma_v2x_msgs::msg::SPAT::SharedPtr spat_msg)</div>
<div class="line"><a id="l00105" name="l00105"></a><span class="lineno">  105</span>{</div>
<div class="line"><a id="l00106" name="l00106"></a><span class="lineno">  106</span>  <a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#a4ea1ac169b8ba4a72dd72b4e8723257e">world_model_</a>-&gt;processSpatFromMsg(*spat_msg, <a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#acab7ad4d3841c78cf96da2deec5c751b">use_sim_time_</a>, <a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#a7c30c45e3da523c1ef5a0b279c164b4d">is_spat_wall_time_</a>);</div>
<div class="line"><a id="l00107" name="l00107"></a><span class="lineno">  107</span>}</div>
<div class="line"><a id="l00108" name="l00108"></a><span class="lineno">  108</span> </div>
<div class="line"><a id="l00109" name="l00109"></a><span class="lineno"><a class="line" href="classcarma__wm_1_1WMListenerWorker.html#a75d47a05771e1d53c0c8f516e290d4a2">  109</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classcarma__wm_1_1WMListenerWorker.html#a75d47a05771e1d53c0c8f516e290d4a2">WMListenerWorker::checkIfReRoutingNeeded</a>()<span class="keyword"> const</span></div>
<div class="line"><a id="l00110" name="l00110"></a><span class="lineno">  110</span><span class="keyword"></span>{</div>
<div class="line"><a id="l00111" name="l00111"></a><span class="lineno">  111</span>  <span class="keywordflow">return</span> <a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#a310d6ebc20c42f055541025291337b57">rerouting_flag_</a>;</div>
<div class="line"><a id="l00112" name="l00112"></a><span class="lineno">  112</span>}</div>
<div class="line"><a id="l00113" name="l00113"></a><span class="lineno">  113</span> </div>
<div class="line"><a id="l00114" name="l00114"></a><span class="lineno"><a class="line" href="classcarma__wm_1_1WMListenerWorker.html#a4c2fcc147efbee76b18ad285f0555d2c">  114</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classcarma__wm_1_1WMListenerWorker.html#a4c2fcc147efbee76b18ad285f0555d2c">WMListenerWorker::enableUpdatesWithoutRoute</a>()</div>
<div class="line"><a id="l00115" name="l00115"></a><span class="lineno">  115</span>{</div>
<div class="line"><a id="l00116" name="l00116"></a><span class="lineno">  116</span>  <a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#a39cbf05af713a84fb396c36da3551df5">route_node_flag_</a>=<span class="keyword">true</span>;</div>
<div class="line"><a id="l00117" name="l00117"></a><span class="lineno">  117</span>}</div>
<div class="line"><a id="l00118" name="l00118"></a><span class="lineno">  118</span> </div>
<div class="line"><a id="l00119" name="l00119"></a><span class="lineno">  119</span><span class="comment">// helper function to log SignalizedIntersectionManager content</span></div>
<div class="line"><a id="l00120" name="l00120"></a><span class="lineno"><a class="line" href="namespacecarma__wm.html#aae8a9e16b161a8edf05ca9df4307a5ec">  120</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="namespacecarma__wm.html#aae8a9e16b161a8edf05ca9df4307a5ec">logSignalizedIntersectionManager</a>(<span class="keyword">const</span> <a class="code hl_class" href="classcarma__wm_1_1SignalizedIntersectionManager.html">carma_wm::SignalizedIntersectionManager</a>&amp; sim)</div>
<div class="line"><a id="l00121" name="l00121"></a><span class="lineno">  121</span>{</div>
<div class="line"><a id="l00122" name="l00122"></a><span class="lineno">  122</span>  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span> &amp;[intersection_id, regulatory_element_id] : sim.<a class="code hl_variable" href="classcarma__wm_1_1SignalizedIntersectionManager.html#a561c5f21f1c07c80e13bdc3c29fa70fe">intersection_id_to_regem_id_</a>)</div>
<div class="line"><a id="l00123" name="l00123"></a><span class="lineno">  123</span>  {</div>
<div class="line"><a id="l00124" name="l00124"></a><span class="lineno">  124</span>    RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<span class="stringliteral">&quot;carma_wm::WMListenerWorker&quot;</span>),</div>
<div class="line"><a id="l00125" name="l00125"></a><span class="lineno">  125</span>      <span class="stringliteral">&quot;inter id: &quot;</span> &lt;&lt; intersection_id &lt;&lt; <span class="stringliteral">&quot;, regem id: &quot;</span> &lt;&lt; regulatory_element_id);</div>
<div class="line"><a id="l00126" name="l00126"></a><span class="lineno">  126</span>  }</div>
<div class="line"><a id="l00127" name="l00127"></a><span class="lineno">  127</span>  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span> &amp;[signal_id, entry_llt_ids] : sim.<a class="code hl_variable" href="classcarma__wm_1_1SignalizedIntersectionManager.html#a2902416a4c3948773e7692a1e5586502">signal_group_to_entry_lanelet_ids_</a>)</div>
<div class="line"><a id="l00128" name="l00128"></a><span class="lineno">  128</span>  {</div>
<div class="line"><a id="l00129" name="l00129"></a><span class="lineno">  129</span>    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp; entry_llt_id : entry_llt_ids)</div>
<div class="line"><a id="l00130" name="l00130"></a><span class="lineno">  130</span>    {</div>
<div class="line"><a id="l00131" name="l00131"></a><span class="lineno">  131</span>      RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<span class="stringliteral">&quot;carma_wm::WMListenerWorker&quot;</span>), <span class="stringliteral">&quot;signal id: &quot;</span> &lt;&lt; (<span class="keywordtype">int</span>)signal_id &lt;&lt; <span class="stringliteral">&quot;, entry llt id: &quot;</span> &lt;&lt; entry_llt_id);</div>
<div class="line"><a id="l00132" name="l00132"></a><span class="lineno">  132</span>    }</div>
<div class="line"><a id="l00133" name="l00133"></a><span class="lineno">  133</span>  }</div>
<div class="line"><a id="l00134" name="l00134"></a><span class="lineno">  134</span>  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span> &amp;[signal_id, exit_llt_ids] : sim.<a class="code hl_variable" href="classcarma__wm_1_1SignalizedIntersectionManager.html#aad402f936d28448d19df5d6b6a718f52">signal_group_to_exit_lanelet_ids_</a>)</div>
<div class="line"><a id="l00135" name="l00135"></a><span class="lineno">  135</span>  {</div>
<div class="line"><a id="l00136" name="l00136"></a><span class="lineno">  136</span>    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp; exit_llt_id : exit_llt_ids)</div>
<div class="line"><a id="l00137" name="l00137"></a><span class="lineno">  137</span>    {</div>
<div class="line"><a id="l00138" name="l00138"></a><span class="lineno">  138</span>      RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<span class="stringliteral">&quot;carma_wm::WMListenerWorker&quot;</span>), <span class="stringliteral">&quot;signal id: &quot;</span> &lt;&lt; (<span class="keywordtype">int</span>)signal_id &lt;&lt; <span class="stringliteral">&quot;, exit llt id: &quot;</span> &lt;&lt; exit_llt_id);</div>
<div class="line"><a id="l00139" name="l00139"></a><span class="lineno">  139</span>    }</div>
<div class="line"><a id="l00140" name="l00140"></a><span class="lineno">  140</span>  }</div>
<div class="line"><a id="l00141" name="l00141"></a><span class="lineno">  141</span>  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span> &amp;[signal_id, regem_id] : sim.<a class="code hl_variable" href="classcarma__wm_1_1SignalizedIntersectionManager.html#ac6d373cd4a78ed384153d43836031b03">signal_group_to_traffic_light_id_</a>)</div>
<div class="line"><a id="l00142" name="l00142"></a><span class="lineno">  142</span>  {</div>
<div class="line"><a id="l00143" name="l00143"></a><span class="lineno">  143</span>    RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<span class="stringliteral">&quot;carma_wm::WMListenerWorker&quot;</span>), <span class="stringliteral">&quot;signal id: &quot;</span> &lt;&lt; (<span class="keywordtype">int</span>)signal_id &lt;&lt; <span class="stringliteral">&quot;, regem id: &quot;</span> &lt;&lt; regem_id);</div>
<div class="line"><a id="l00144" name="l00144"></a><span class="lineno">  144</span>  }</div>
<div class="line"><a id="l00145" name="l00145"></a><span class="lineno">  145</span>}</div>
<div class="line"><a id="l00146" name="l00146"></a><span class="lineno">  146</span> </div>
<div class="line"><a id="l00147" name="l00147"></a><span class="lineno"><a class="line" href="classcarma__wm_1_1WMListenerWorker.html#a44154428b921244d04d4678ed61c81d8">  147</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classcarma__wm_1_1WMListenerWorker.html#a44154428b921244d04d4678ed61c81d8">WMListenerWorker::mapUpdateCallback</a>(autoware_lanelet2_msgs::msg::MapBin::SharedPtr geofence_msg)</div>
<div class="line"><a id="l00148" name="l00148"></a><span class="lineno">  148</span>{</div>
<div class="line"><a id="l00149" name="l00149"></a><span class="lineno">  149</span>  RCLCPP_INFO_STREAM(rclcpp::get_logger(<span class="stringliteral">&quot;carma_wm::WMListenerWorker&quot;</span>), <span class="stringliteral">&quot;Map Update Being Evaluated. SeqNum: &quot;</span> &lt;&lt; geofence_msg-&gt;seq_id);</div>
<div class="line"><a id="l00150" name="l00150"></a><span class="lineno">  150</span>  <span class="keywordflow">if</span> (<a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#a310d6ebc20c42f055541025291337b57">rerouting_flag_</a>) <span class="comment">// no update should be applied if rerouting</span></div>
<div class="line"><a id="l00151" name="l00151"></a><span class="lineno">  151</span>  {</div>
<div class="line"><a id="l00152" name="l00152"></a><span class="lineno">  152</span>    RCLCPP_INFO_STREAM(rclcpp::get_logger(<span class="stringliteral">&quot;carma_wm::WMListenerWorker&quot;</span>), <span class="stringliteral">&quot;Currently new route is being processed. Queueing this update. Received seq: &quot;</span> &lt;&lt; geofence_msg-&gt;seq_id &lt;&lt; <span class="stringliteral">&quot; prev seq: &quot;</span> &lt;&lt; <a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#ae838d10e2677708b7b86c13fbb62d452">most_recent_update_msg_seq_</a>);</div>
<div class="line"><a id="l00153" name="l00153"></a><span class="lineno">  153</span>    <a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#ae5106bd418dff1ee316864d929c02c93">map_update_queue_</a>.emplace(geofence_msg);</div>
<div class="line"><a id="l00154" name="l00154"></a><span class="lineno">  154</span>    <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00155" name="l00155"></a><span class="lineno">  155</span>  }</div>
<div class="line"><a id="l00156" name="l00156"></a><span class="lineno">  156</span>  <span class="keywordflow">if</span> (geofence_msg-&gt;seq_id &lt;= <a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#ae838d10e2677708b7b86c13fbb62d452">most_recent_update_msg_seq_</a>) {</div>
<div class="line"><a id="l00157" name="l00157"></a><span class="lineno">  157</span>    RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<span class="stringliteral">&quot;carma_wm::WMListenerWorker&quot;</span>), <span class="stringliteral">&quot;Dropping map update which has already been processed. Received seq: &quot;</span> &lt;&lt; geofence_msg-&gt;seq_id &lt;&lt; <span class="stringliteral">&quot; prev seq: &quot;</span> &lt;&lt; <a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#ae838d10e2677708b7b86c13fbb62d452">most_recent_update_msg_seq_</a>);</div>
<div class="line"><a id="l00158" name="l00158"></a><span class="lineno">  158</span>    <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00159" name="l00159"></a><span class="lineno">  159</span>  } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!<a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#a4ea1ac169b8ba4a72dd72b4e8723257e">world_model_</a>-&gt;getMap() || current_map_version_ &lt; geofence_msg-&gt;map_version) { <span class="comment">// If our current map version is older than the version target by this update</span></div>
<div class="line"><a id="l00160" name="l00160"></a><span class="lineno">  160</span>    RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<span class="stringliteral">&quot;carma_wm::WMListenerWorker&quot;</span>), <span class="stringliteral">&quot;Update received for newer map version than available. Queueing update until map is available.&quot;</span>);</div>
<div class="line"><a id="l00161" name="l00161"></a><span class="lineno">  161</span>    <a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#ae5106bd418dff1ee316864d929c02c93">map_update_queue_</a>.emplace(geofence_msg);</div>
<div class="line"><a id="l00162" name="l00162"></a><span class="lineno">  162</span>    <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00163" name="l00163"></a><span class="lineno">  163</span>  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#aae0b14b4566a06ba1c99e46e79de0fba">current_map_version_</a> &gt; geofence_msg-&gt;map_version) { <span class="comment">// If this update is for an older map</span></div>
<div class="line"><a id="l00164" name="l00164"></a><span class="lineno">  164</span>    RCLCPP_WARN_STREAM(rclcpp::get_logger(<span class="stringliteral">&quot;carma_wm::WMListenerWorker&quot;</span>), <span class="stringliteral">&quot;Dropping old map update as newer map is already available.&quot;</span>);</div>
<div class="line"><a id="l00165" name="l00165"></a><span class="lineno">  165</span>    <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00166" name="l00166"></a><span class="lineno">  166</span>  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#ae838d10e2677708b7b86c13fbb62d452">most_recent_update_msg_seq_</a> + 1 &lt; geofence_msg-&gt;seq_id) {</div>
<div class="line"><a id="l00167" name="l00167"></a><span class="lineno">  167</span>    RCLCPP_INFO_STREAM(rclcpp::get_logger(<span class="stringliteral">&quot;carma_wm::WMListenerWorker&quot;</span>), <span class="stringliteral">&quot;Queuing map update as we are waiting on an earlier update to be applied. most_recent_update_msg_seq_: &quot;</span> &lt;&lt; <a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#ae838d10e2677708b7b86c13fbb62d452">most_recent_update_msg_seq_</a> &lt;&lt; <span class="stringliteral">&quot;geofence_msg-&gt;seq_id: &quot;</span> &lt;&lt; geofence_msg-&gt;seq_id);</div>
<div class="line"><a id="l00168" name="l00168"></a><span class="lineno">  168</span>    <a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#ae5106bd418dff1ee316864d929c02c93">map_update_queue_</a>.emplace(geofence_msg);</div>
<div class="line"><a id="l00169" name="l00169"></a><span class="lineno">  169</span>    <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00170" name="l00170"></a><span class="lineno">  170</span>  }</div>
<div class="line"><a id="l00171" name="l00171"></a><span class="lineno">  171</span> </div>
<div class="line"><a id="l00172" name="l00172"></a><span class="lineno">  172</span> </div>
<div class="line"><a id="l00173" name="l00173"></a><span class="lineno">  173</span>  <span class="keywordflow">if</span>(geofence_msg-&gt;invalidates_route==<span class="keyword">true</span> &amp;&amp; <a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#a4ea1ac169b8ba4a72dd72b4e8723257e">world_model_</a>-&gt;getRoute())</div>
<div class="line"><a id="l00174" name="l00174"></a><span class="lineno">  174</span>  {</div>
<div class="line"><a id="l00175" name="l00175"></a><span class="lineno">  175</span>    <a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#a310d6ebc20c42f055541025291337b57">rerouting_flag_</a>=<span class="keyword">true</span>;</div>
<div class="line"><a id="l00176" name="l00176"></a><span class="lineno">  176</span>    <a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#acae1ff63ff0f396de4e3f1bb9ab492bb">recompute_route_flag_</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00177" name="l00177"></a><span class="lineno">  177</span> </div>
<div class="line"><a id="l00178" name="l00178"></a><span class="lineno">  178</span>    RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<span class="stringliteral">&quot;carma_wm::WMListenerWorker&quot;</span>), <span class="stringliteral">&quot;Received notice that route has been invalidated in mapUpdateCallback&quot;</span>);</div>
<div class="line"><a id="l00179" name="l00179"></a><span class="lineno">  179</span> </div>
<div class="line"><a id="l00180" name="l00180"></a><span class="lineno">  180</span>    <span class="keywordflow">if</span>(<a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#a39cbf05af713a84fb396c36da3551df5">route_node_flag_</a>!=<span class="keyword">true</span>)</div>
<div class="line"><a id="l00181" name="l00181"></a><span class="lineno">  181</span>    {</div>
<div class="line"><a id="l00182" name="l00182"></a><span class="lineno">  182</span>     RCLCPP_INFO_STREAM(rclcpp::get_logger(<span class="stringliteral">&quot;carma_wm::WMListenerWorker&quot;</span>), <span class="stringliteral">&quot;Route is not yet available. Therefore queueing the update&quot;</span>);</div>
<div class="line"><a id="l00183" name="l00183"></a><span class="lineno">  183</span>     <a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#ae5106bd418dff1ee316864d929c02c93">map_update_queue_</a>.emplace(geofence_msg);</div>
<div class="line"><a id="l00184" name="l00184"></a><span class="lineno">  184</span>     <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00185" name="l00185"></a><span class="lineno">  185</span>    }</div>
<div class="line"><a id="l00186" name="l00186"></a><span class="lineno">  186</span>  }</div>
<div class="line"><a id="l00187" name="l00187"></a><span class="lineno">  187</span> </div>
<div class="line"><a id="l00188" name="l00188"></a><span class="lineno">  188</span>  <a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#ae838d10e2677708b7b86c13fbb62d452">most_recent_update_msg_seq_</a> = geofence_msg-&gt;seq_id; <span class="comment">// Update current sequence count</span></div>
<div class="line"><a id="l00189" name="l00189"></a><span class="lineno">  189</span> </div>
<div class="line"><a id="l00190" name="l00190"></a><span class="lineno">  190</span>  <span class="keyword">auto</span> gf_ptr = std::shared_ptr&lt;carma_wm::TrafficControl&gt;(<span class="keyword">new</span> <a class="code hl_class" href="classcarma__wm_1_1TrafficControl.html">carma_wm::TrafficControl</a>);</div>
<div class="line"><a id="l00191" name="l00191"></a><span class="lineno">  191</span> </div>
<div class="line"><a id="l00192" name="l00192"></a><span class="lineno">  192</span>  <span class="comment">// convert ros msg to geofence object</span></div>
<div class="line"><a id="l00193" name="l00193"></a><span class="lineno">  193</span>  <a class="code hl_function" href="namespacecarma__wm.html#a3c6c82d3e0fcfc7dd50176a453598911">carma_wm::fromBinMsg</a>(*geofence_msg, gf_ptr, <a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#a4ea1ac169b8ba4a72dd72b4e8723257e">world_model_</a>-&gt;getMutableMap());</div>
<div class="line"><a id="l00194" name="l00194"></a><span class="lineno">  194</span> </div>
<div class="line"><a id="l00195" name="l00195"></a><span class="lineno">  195</span>  RCLCPP_INFO_STREAM(rclcpp::get_logger(<span class="stringliteral">&quot;carma_wm::WMListenerWorker&quot;</span>), <span class="stringliteral">&quot;Processing Map Update with Geofence Id:&quot;</span> &lt;&lt; gf_ptr-&gt;id_);</div>
<div class="line"><a id="l00196" name="l00196"></a><span class="lineno">  196</span> </div>
<div class="line"><a id="l00197" name="l00197"></a><span class="lineno">  197</span>  RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<span class="stringliteral">&quot;carma_wm::WMListenerWorker&quot;</span>), <span class="stringliteral">&quot;Geofence id&quot;</span> &lt;&lt; gf_ptr-&gt;id_ &lt;&lt; <span class="stringliteral">&quot; requests addition of lanelets size: &quot;</span> &lt;&lt; gf_ptr-&gt;lanelet_additions_.size());</div>
<div class="line"><a id="l00198" name="l00198"></a><span class="lineno">  198</span>  <span class="keywordflow">for</span> (<span class="keyword">auto</span> llt : gf_ptr-&gt;lanelet_additions_)</div>
<div class="line"><a id="l00199" name="l00199"></a><span class="lineno">  199</span>  {</div>
<div class="line"><a id="l00200" name="l00200"></a><span class="lineno">  200</span>    <span class="comment">// world model here should blindly accept the map update received</span></div>
<div class="line"><a id="l00201" name="l00201"></a><span class="lineno">  201</span>    RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<span class="stringliteral">&quot;carma_wm::WMListenerWorker&quot;</span>), <span class="stringliteral">&quot;Adding new lanelet with id: &quot;</span> &lt;&lt; llt.id());</div>
<div class="line"><a id="l00202" name="l00202"></a><span class="lineno">  202</span>    <span class="keyword">auto</span> left = llt.leftBound3d(); <span class="comment">//new lanelet coming in</span></div>
<div class="line"><a id="l00203" name="l00203"></a><span class="lineno">  203</span> </div>
<div class="line"><a id="l00204" name="l00204"></a><span class="lineno">  204</span>    <span class="comment">// updating incoming points&#39; memory addresses with local ones of same ids</span></div>
<div class="line"><a id="l00205" name="l00205"></a><span class="lineno">  205</span>    <span class="comment">// so that lanelet library can recognize they are same objects</span></div>
<div class="line"><a id="l00206" name="l00206"></a><span class="lineno">  206</span>    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a> = 0; <a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a> &lt; left.size(); <a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a> ++)</div>
<div class="line"><a id="l00207" name="l00207"></a><span class="lineno">  207</span>    {</div>
<div class="line"><a id="l00208" name="l00208"></a><span class="lineno">  208</span>      <span class="keywordflow">if</span> (<a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#a4ea1ac169b8ba4a72dd72b4e8723257e">world_model_</a>-&gt;getMutableMap()-&gt;pointLayer.exists(left[<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>].id())) <span class="comment">//rewrite the memory address of new pts with that of local</span></div>
<div class="line"><a id="l00209" name="l00209"></a><span class="lineno">  209</span>      {</div>
<div class="line"><a id="l00210" name="l00210"></a><span class="lineno">  210</span>        llt.leftBound3d()[<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>] = <a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#a4ea1ac169b8ba4a72dd72b4e8723257e">world_model_</a>-&gt;getMutableMap()-&gt;pointLayer.get(left[<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>].<span class="keywordtype">id</span>());</div>
<div class="line"><a id="l00211" name="l00211"></a><span class="lineno">  211</span>      }</div>
<div class="line"><a id="l00212" name="l00212"></a><span class="lineno">  212</span>    }</div>
<div class="line"><a id="l00213" name="l00213"></a><span class="lineno">  213</span>    <span class="keyword">auto</span> right = llt.rightBound3d(); <span class="comment">//new lanelet coming in</span></div>
<div class="line"><a id="l00214" name="l00214"></a><span class="lineno">  214</span>    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a> = 0; <a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a> &lt; right.size(); <a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a> ++)</div>
<div class="line"><a id="l00215" name="l00215"></a><span class="lineno">  215</span>    {</div>
<div class="line"><a id="l00216" name="l00216"></a><span class="lineno">  216</span>      <span class="keywordflow">if</span> (<a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#a4ea1ac169b8ba4a72dd72b4e8723257e">world_model_</a>-&gt;getMutableMap()-&gt;pointLayer.exists(right[<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>].id())) <span class="comment">//rewrite the memory address of new pts with that of local</span></div>
<div class="line"><a id="l00217" name="l00217"></a><span class="lineno">  217</span>      {</div>
<div class="line"><a id="l00218" name="l00218"></a><span class="lineno">  218</span>        llt.rightBound3d()[<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>] = <a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#a4ea1ac169b8ba4a72dd72b4e8723257e">world_model_</a>-&gt;getMutableMap()-&gt;pointLayer.get(right[<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>].<span class="keywordtype">id</span>());</div>
<div class="line"><a id="l00219" name="l00219"></a><span class="lineno">  219</span>      }</div>
<div class="line"><a id="l00220" name="l00220"></a><span class="lineno">  220</span>    }</div>
<div class="line"><a id="l00221" name="l00221"></a><span class="lineno">  221</span> </div>
<div class="line"><a id="l00222" name="l00222"></a><span class="lineno">  222</span>    <a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#a4ea1ac169b8ba4a72dd72b4e8723257e">world_model_</a>-&gt;getMutableMap()-&gt;add(llt);</div>
<div class="line"><a id="l00223" name="l00223"></a><span class="lineno">  223</span>  }</div>
<div class="line"><a id="l00224" name="l00224"></a><span class="lineno">  224</span> </div>
<div class="line"><a id="l00225" name="l00225"></a><span class="lineno">  225</span>  RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<span class="stringliteral">&quot;carma_wm::WMListenerWorker&quot;</span>), <span class="stringliteral">&quot;Geofence id&quot;</span> &lt;&lt; gf_ptr-&gt;id_ &lt;&lt; <span class="stringliteral">&quot; sends record of traffic_lights_id size: &quot;</span> &lt;&lt; gf_ptr-&gt;traffic_light_id_lookup_.size());</div>
<div class="line"><a id="l00226" name="l00226"></a><span class="lineno">  226</span>  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span> &amp;[traffic_light_id, lanelet_id] : gf_ptr-&gt;traffic_light_id_lookup_)</div>
<div class="line"><a id="l00227" name="l00227"></a><span class="lineno">  227</span>  {</div>
<div class="line"><a id="l00228" name="l00228"></a><span class="lineno">  228</span>    RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<span class="stringliteral">&quot;carma_wm::WMListenerWorker&quot;</span>), <span class="stringliteral">&quot;Adding new pair for traffic light ids: &quot;</span> &lt;&lt; traffic_light_id &lt;&lt; <span class="stringliteral">&quot;, and lanelet::Id: &quot;</span> &lt;&lt; lanelet_id);</div>
<div class="line"><a id="l00229" name="l00229"></a><span class="lineno">  229</span>    <a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#a4ea1ac169b8ba4a72dd72b4e8723257e">world_model_</a>-&gt;setTrafficLightIds(traffic_light_id, lanelet_id);</div>
<div class="line"><a id="l00230" name="l00230"></a><span class="lineno">  230</span>  }</div>
<div class="line"><a id="l00231" name="l00231"></a><span class="lineno">  231</span> </div>
<div class="line"><a id="l00232" name="l00232"></a><span class="lineno">  232</span>  RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<span class="stringliteral">&quot;carma_wm::WMListenerWorker&quot;</span>), <span class="stringliteral">&quot;Geofence id&quot;</span> &lt;&lt; gf_ptr-&gt;id_ &lt;&lt; <span class="stringliteral">&quot; sends record of intersections size: &quot;</span> &lt;&lt; gf_ptr-&gt;sim_.intersection_id_to_regem_id_.size());</div>
<div class="line"><a id="l00233" name="l00233"></a><span class="lineno">  233</span>  <span class="keywordflow">if</span> (gf_ptr-&gt;sim_.intersection_id_to_regem_id_.size() &gt; 0)</div>
<div class="line"><a id="l00234" name="l00234"></a><span class="lineno">  234</span>  {</div>
<div class="line"><a id="l00235" name="l00235"></a><span class="lineno">  235</span>    <a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#a4ea1ac169b8ba4a72dd72b4e8723257e">world_model_</a>-&gt;sim_ = gf_ptr-&gt;sim_;</div>
<div class="line"><a id="l00236" name="l00236"></a><span class="lineno">  236</span>    <a class="code hl_function" href="namespacecarma__wm.html#aae8a9e16b161a8edf05ca9df4307a5ec">logSignalizedIntersectionManager</a>(<a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#a4ea1ac169b8ba4a72dd72b4e8723257e">world_model_</a>-&gt;sim_);</div>
<div class="line"><a id="l00237" name="l00237"></a><span class="lineno">  237</span>  }</div>
<div class="line"><a id="l00238" name="l00238"></a><span class="lineno">  238</span> </div>
<div class="line"><a id="l00239" name="l00239"></a><span class="lineno">  239</span>  RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<span class="stringliteral">&quot;carma_wm::WMListenerWorker&quot;</span>), <span class="stringliteral">&quot;Geofence id&quot;</span> &lt;&lt; gf_ptr-&gt;id_ &lt;&lt; <span class="stringliteral">&quot; requests removal of size: &quot;</span> &lt;&lt; gf_ptr-&gt;remove_list_.size());</div>
<div class="line"><a id="l00240" name="l00240"></a><span class="lineno">  240</span>  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span> &amp;[lanelet_id, lanelet_to_remove] : gf_ptr-&gt;remove_list_)</div>
<div class="line"><a id="l00241" name="l00241"></a><span class="lineno">  241</span>  {</div>
<div class="line"><a id="l00242" name="l00242"></a><span class="lineno">  242</span>    <span class="keyword">auto</span> parent_llt = <a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#a4ea1ac169b8ba4a72dd72b4e8723257e">world_model_</a>-&gt;getMutableMap()-&gt;laneletLayer.get(lanelet_id);</div>
<div class="line"><a id="l00243" name="l00243"></a><span class="lineno">  243</span>    <span class="comment">// we can only check by id, if the element is there</span></div>
<div class="line"><a id="l00244" name="l00244"></a><span class="lineno">  244</span>    <span class="comment">// this is only for speed optimization, as world model here should blindly accept the map update received</span></div>
<div class="line"><a id="l00245" name="l00245"></a><span class="lineno">  245</span>    <span class="keyword">auto</span> regems_copy_to_check = parent_llt.regulatoryElements(); <span class="comment">// save local copy as the regem can be deleted during iteration</span></div>
<div class="line"><a id="l00246" name="l00246"></a><span class="lineno">  246</span>    RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<span class="stringliteral">&quot;carma_wm::WMListenerWorker&quot;</span>), <span class="stringliteral">&quot;Regems found in lanelet: &quot;</span> &lt;&lt; regems_copy_to_check.size());</div>
<div class="line"><a id="l00247" name="l00247"></a><span class="lineno">  247</span>    <span class="keywordflow">for</span> (<span class="keyword">auto</span> regem: regems_copy_to_check)</div>
<div class="line"><a id="l00248" name="l00248"></a><span class="lineno">  248</span>    {</div>
<div class="line"><a id="l00249" name="l00249"></a><span class="lineno">  249</span>      <span class="comment">// we can&#39;t use the deserialized element as its data address conflicts the one in this node</span></div>
<div class="line"><a id="l00250" name="l00250"></a><span class="lineno">  250</span>      <span class="keywordflow">if</span> (lanelet_to_remove-&gt;id() == regem-&gt;id()) <a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#a4ea1ac169b8ba4a72dd72b4e8723257e">world_model_</a>-&gt;getMutableMap()-&gt;remove(parent_llt, regem);</div>
<div class="line"><a id="l00251" name="l00251"></a><span class="lineno">  251</span>    }</div>
<div class="line"><a id="l00252" name="l00252"></a><span class="lineno">  252</span>    RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<span class="stringliteral">&quot;carma_wm::WMListenerWorker&quot;</span>), <span class="stringliteral">&quot;Regems left in lanelet after removal: &quot;</span> &lt;&lt; parent_llt.regulatoryElements().size());</div>
<div class="line"><a id="l00253" name="l00253"></a><span class="lineno">  253</span> </div>
<div class="line"><a id="l00254" name="l00254"></a><span class="lineno">  254</span>  }</div>
<div class="line"><a id="l00255" name="l00255"></a><span class="lineno">  255</span> </div>
<div class="line"><a id="l00256" name="l00256"></a><span class="lineno">  256</span>  RCLCPP_INFO_STREAM(rclcpp::get_logger(<span class="stringliteral">&quot;carma_wm::WMListenerWorker&quot;</span>), <span class="stringliteral">&quot;Geofence id&quot;</span> &lt;&lt; gf_ptr-&gt;id_ &lt;&lt; <span class="stringliteral">&quot; requests update of size: &quot;</span> &lt;&lt; gf_ptr-&gt;update_list_.size());</div>
<div class="line"><a id="l00257" name="l00257"></a><span class="lineno">  257</span> </div>
<div class="line"><a id="l00258" name="l00258"></a><span class="lineno">  258</span>  <span class="comment">// we should extract general regem to specific type of regem the geofence specifies</span></div>
<div class="line"><a id="l00259" name="l00259"></a><span class="lineno">  259</span>  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span> &amp;[lanelet_id, lanelet_to_update]: gf_ptr-&gt;update_list_)</div>
<div class="line"><a id="l00260" name="l00260"></a><span class="lineno">  260</span>  {</div>
<div class="line"><a id="l00261" name="l00261"></a><span class="lineno">  261</span> </div>
<div class="line"><a id="l00262" name="l00262"></a><span class="lineno">  262</span>    <span class="keyword">auto</span> parent_llt = <a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#a4ea1ac169b8ba4a72dd72b4e8723257e">world_model_</a>-&gt;getMutableMap()-&gt;laneletLayer.get(lanelet_id);</div>
<div class="line"><a id="l00263" name="l00263"></a><span class="lineno">  263</span> </div>
<div class="line"><a id="l00264" name="l00264"></a><span class="lineno">  264</span>    <span class="keyword">auto</span> regemptr_it = <a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#a4ea1ac169b8ba4a72dd72b4e8723257e">world_model_</a>-&gt;getMutableMap()-&gt;regulatoryElementLayer.find(lanelet_to_update-&gt;id());</div>
<div class="line"><a id="l00265" name="l00265"></a><span class="lineno">  265</span> </div>
<div class="line"><a id="l00266" name="l00266"></a><span class="lineno">  266</span>    <span class="comment">// if this regem is already in the map.</span></div>
<div class="line"><a id="l00267" name="l00267"></a><span class="lineno">  267</span>    <span class="comment">// This section is expected to be called to add back regulations which were previously removed by expired geofences.</span></div>
<div class="line"><a id="l00268" name="l00268"></a><span class="lineno">  268</span>    <span class="keywordflow">if</span> (regemptr_it != <a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#a4ea1ac169b8ba4a72dd72b4e8723257e">world_model_</a>-&gt;getMutableMap()-&gt;regulatoryElementLayer.end())</div>
<div class="line"><a id="l00269" name="l00269"></a><span class="lineno">  269</span>    {</div>
<div class="line"><a id="l00270" name="l00270"></a><span class="lineno">  270</span> </div>
<div class="line"><a id="l00271" name="l00271"></a><span class="lineno">  271</span>      RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<span class="stringliteral">&quot;carma_wm::WMListenerWorker&quot;</span>), <span class="stringliteral">&quot;Reapplying previously existing element for lanelet id:&quot;</span> &lt;&lt; parent_llt.id() &lt;&lt; <span class="stringliteral">&quot;, and regem id: &quot;</span> &lt;&lt; regemptr_it-&gt;get()-&gt;id());</div>
<div class="line"><a id="l00272" name="l00272"></a><span class="lineno">  272</span>      <span class="comment">// again we should use the element with correct data address to be consistent</span></div>
<div class="line"><a id="l00273" name="l00273"></a><span class="lineno">  273</span>      <a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#a4ea1ac169b8ba4a72dd72b4e8723257e">world_model_</a>-&gt;getMutableMap()-&gt;update(parent_llt, *regemptr_it);</div>
<div class="line"><a id="l00274" name="l00274"></a><span class="lineno">  274</span>    }</div>
<div class="line"><a id="l00275" name="l00275"></a><span class="lineno">  275</span>    <span class="keywordflow">else</span> <span class="comment">// Updates are treated as new regulations after the old value was removed. In both cases we enter this block.</span></div>
<div class="line"><a id="l00276" name="l00276"></a><span class="lineno">  276</span>    {</div>
<div class="line"><a id="l00277" name="l00277"></a><span class="lineno">  277</span>      RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<span class="stringliteral">&quot;carma_wm::WMListenerWorker&quot;</span>), <span class="stringliteral">&quot;New regulatory element at lanelet: &quot;</span> &lt;&lt; parent_llt.id() &lt;&lt; <span class="stringliteral">&quot;, and id: &quot;</span> &lt;&lt; lanelet_to_update-&gt;id());</div>
<div class="line"><a id="l00278" name="l00278"></a><span class="lineno">  278</span>      <a class="code hl_function" href="classcarma__wm_1_1WMListenerWorker.html#a5cffb02708d8e8421ad56c4e7dd21b81">newRegemUpdateHelper</a>(parent_llt, lanelet_to_update.get());</div>
<div class="line"><a id="l00279" name="l00279"></a><span class="lineno">  279</span>    }</div>
<div class="line"><a id="l00280" name="l00280"></a><span class="lineno">  280</span>  }</div>
<div class="line"><a id="l00281" name="l00281"></a><span class="lineno">  281</span> </div>
<div class="line"><a id="l00282" name="l00282"></a><span class="lineno">  282</span>  <span class="comment">// set the Map to trigger a new route graph construction if rerouting was required by the updates and a new graph was not provided</span></div>
<div class="line"><a id="l00283" name="l00283"></a><span class="lineno">  283</span>  <a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#a4ea1ac169b8ba4a72dd72b4e8723257e">world_model_</a>-&gt;setMap(<a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#a4ea1ac169b8ba4a72dd72b4e8723257e">world_model_</a>-&gt;getMutableMap(), <a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#aae0b14b4566a06ba1c99e46e79de0fba">current_map_version_</a>, <a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#acae1ff63ff0f396de4e3f1bb9ab492bb">recompute_route_flag_</a> &amp;&amp; !geofence_msg-&gt;has_routing_graph );</div>
<div class="line"><a id="l00284" name="l00284"></a><span class="lineno">  284</span> </div>
<div class="line"><a id="l00285" name="l00285"></a><span class="lineno">  285</span>  <span class="comment">// If a new graph was provided then set that graph</span></div>
<div class="line"><a id="l00286" name="l00286"></a><span class="lineno">  286</span>  <span class="comment">// recompute_route_flag_ not checked here to support the case of the first map or map version changing</span></div>
<div class="line"><a id="l00287" name="l00287"></a><span class="lineno">  287</span>  <span class="keywordflow">if</span> (geofence_msg-&gt;has_routing_graph) {</div>
<div class="line"><a id="l00288" name="l00288"></a><span class="lineno">  288</span> </div>
<div class="line"><a id="l00289" name="l00289"></a><span class="lineno">  289</span>    <a class="code hl_typedef" href="namespacecarma__wm.html#a23411d3d299da623ec379efbc1a5b14a">LaneletRoutingGraphPtr</a> graph = <a class="code hl_function" href="classcarma__wm_1_1WMListenerWorker.html#a614654b7b374ed1d24537e347d49389f">routingGraphFromMsg</a>(geofence_msg-&gt;routing_graph, <a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#a4ea1ac169b8ba4a72dd72b4e8723257e">world_model_</a>-&gt;getMutableMap());</div>
<div class="line"><a id="l00290" name="l00290"></a><span class="lineno">  290</span> </div>
<div class="line"><a id="l00291" name="l00291"></a><span class="lineno">  291</span>    <span class="keywordflow">if</span> (!graph) {</div>
<div class="line"><a id="l00292" name="l00292"></a><span class="lineno">  292</span>      <span class="keywordflow">throw</span> std::invalid_argument(<span class="stringliteral">&quot;Map updated provided routing graph which could not be applied to the current map.&quot;</span>);</div>
<div class="line"><a id="l00293" name="l00293"></a><span class="lineno">  293</span>    }</div>
<div class="line"><a id="l00294" name="l00294"></a><span class="lineno">  294</span> </div>
<div class="line"><a id="l00295" name="l00295"></a><span class="lineno">  295</span>    <a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#a4ea1ac169b8ba4a72dd72b4e8723257e">world_model_</a>-&gt;setRoutingGraph(graph);</div>
<div class="line"><a id="l00296" name="l00296"></a><span class="lineno">  296</span> </div>
<div class="line"><a id="l00297" name="l00297"></a><span class="lineno">  297</span>  }</div>
<div class="line"><a id="l00298" name="l00298"></a><span class="lineno">  298</span> </div>
<div class="line"><a id="l00299" name="l00299"></a><span class="lineno">  299</span>  <span class="comment">// no need to reroute again unless received invalidated msg again</span></div>
<div class="line"><a id="l00300" name="l00300"></a><span class="lineno">  300</span>  <span class="keywordflow">if</span> (<a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#acae1ff63ff0f396de4e3f1bb9ab492bb">recompute_route_flag_</a>)</div>
<div class="line"><a id="l00301" name="l00301"></a><span class="lineno">  301</span>    <a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#acae1ff63ff0f396de4e3f1bb9ab492bb">recompute_route_flag_</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00302" name="l00302"></a><span class="lineno">  302</span> </div>
<div class="line"><a id="l00303" name="l00303"></a><span class="lineno">  303</span> </div>
<div class="line"><a id="l00304" name="l00304"></a><span class="lineno">  304</span>  RCLCPP_INFO_STREAM(rclcpp::get_logger(<span class="stringliteral">&quot;carma_wm::WMListenerWorker&quot;</span>), <span class="stringliteral">&quot;Finished Applying the Map Update with Geofence Id:&quot;</span> &lt;&lt; gf_ptr-&gt;id_);</div>
<div class="line"><a id="l00305" name="l00305"></a><span class="lineno">  305</span> </div>
<div class="line"><a id="l00306" name="l00306"></a><span class="lineno">  306</span>  <span class="comment">// Call user defined map callback</span></div>
<div class="line"><a id="l00307" name="l00307"></a><span class="lineno">  307</span>  <span class="keywordflow">if</span> (<a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#a3c2e638e8fdc934482ba9076a5ca7bb5">map_callback_</a>)</div>
<div class="line"><a id="l00308" name="l00308"></a><span class="lineno">  308</span>  {</div>
<div class="line"><a id="l00309" name="l00309"></a><span class="lineno">  309</span>    RCLCPP_INFO_STREAM(rclcpp::get_logger(<span class="stringliteral">&quot;carma_wm::WMListenerWorker&quot;</span>), <span class="stringliteral">&quot;Calling user defined map update callback&quot;</span>);</div>
<div class="line"><a id="l00310" name="l00310"></a><span class="lineno">  310</span>    <a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#a3c2e638e8fdc934482ba9076a5ca7bb5">map_callback_</a>();</div>
<div class="line"><a id="l00311" name="l00311"></a><span class="lineno">  311</span>  }</div>
<div class="line"><a id="l00312" name="l00312"></a><span class="lineno">  312</span>}</div>
<div class="line"><a id="l00313" name="l00313"></a><span class="lineno">  313</span> </div>
<div class="line"><a id="l00314" name="l00314"></a><span class="lineno">  314</span> </div>
<div class="line"><a id="l00322" name="l00322"></a><span class="lineno"><a class="line" href="classcarma__wm_1_1WMListenerWorker.html#a5cffb02708d8e8421ad56c4e7dd21b81">  322</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classcarma__wm_1_1WMListenerWorker.html#a5cffb02708d8e8421ad56c4e7dd21b81">WMListenerWorker::newRegemUpdateHelper</a>(lanelet::Lanelet parent_llt, lanelet::RegulatoryElement* regem)<span class="keyword"> const</span></div>
<div class="line"><a id="l00323" name="l00323"></a><span class="lineno">  323</span><span class="keyword"></span>{</div>
<div class="line"><a id="l00324" name="l00324"></a><span class="lineno">  324</span>  <span class="keyword">auto</span> factory_regem = lanelet::RegulatoryElementFactory::create(regem-&gt;attribute(lanelet::AttributeName::Subtype).value(),</div>
<div class="line"><a id="l00325" name="l00325"></a><span class="lineno">  325</span>                                                            std::const_pointer_cast&lt;lanelet::RegulatoryElementData&gt;(regem-&gt;constData()));</div>
<div class="line"><a id="l00326" name="l00326"></a><span class="lineno">  326</span> </div>
<div class="line"><a id="l00327" name="l00327"></a><span class="lineno">  327</span>  <span class="comment">// we should extract general regem to specific type of regem the geofence specifies</span></div>
<div class="line"><a id="l00328" name="l00328"></a><span class="lineno">  328</span>  <span class="keywordflow">switch</span>(<a class="code hl_function" href="namespacecarma__wm.html#a4c3b7aaa05aea0c95189c98c5d902cf8">resolveGeofenceType</a>(regem-&gt;attribute(lanelet::AttributeName::Subtype).value()))</div>
<div class="line"><a id="l00329" name="l00329"></a><span class="lineno">  329</span>  {</div>
<div class="line"><a id="l00330" name="l00330"></a><span class="lineno">  330</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="namespacecarma__wm.html#ac09d7a77e6f8f955651e7afa16136bf1a0acb40e631b1fdde545715ce5080ce82">GeofenceType::PASSING_CONTROL_LINE</a>:</div>
<div class="line"><a id="l00331" name="l00331"></a><span class="lineno">  331</span>    {</div>
<div class="line"><a id="l00332" name="l00332"></a><span class="lineno">  332</span>      lanelet::PassingControlLinePtr control_line = std::dynamic_pointer_cast&lt;lanelet::PassingControlLine&gt;(factory_regem);</div>
<div class="line"><a id="l00333" name="l00333"></a><span class="lineno">  333</span>      <span class="keywordflow">if</span> (control_line)</div>
<div class="line"><a id="l00334" name="l00334"></a><span class="lineno">  334</span>      {</div>
<div class="line"><a id="l00335" name="l00335"></a><span class="lineno">  335</span>        <a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#a4ea1ac169b8ba4a72dd72b4e8723257e">world_model_</a>-&gt;getMutableMap()-&gt;update(parent_llt, control_line);</div>
<div class="line"><a id="l00336" name="l00336"></a><span class="lineno">  336</span>      }</div>
<div class="line"><a id="l00337" name="l00337"></a><span class="lineno">  337</span>      <span class="keywordflow">else</span></div>
<div class="line"><a id="l00338" name="l00338"></a><span class="lineno">  338</span>      {</div>
<div class="line"><a id="l00339" name="l00339"></a><span class="lineno">  339</span>        std::invalid_argument(<span class="stringliteral">&quot;Dynamic Pointer cast failed on getting valid control line&quot;</span>);</div>
<div class="line"><a id="l00340" name="l00340"></a><span class="lineno">  340</span>      }</div>
<div class="line"><a id="l00341" name="l00341"></a><span class="lineno">  341</span> </div>
<div class="line"><a id="l00342" name="l00342"></a><span class="lineno">  342</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00343" name="l00343"></a><span class="lineno">  343</span>    }</div>
<div class="line"><a id="l00344" name="l00344"></a><span class="lineno">  344</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="namespacecarma__wm.html#ac09d7a77e6f8f955651e7afa16136bf1a56a6787427d0254f508836bebdea7700">GeofenceType::DIGITAL_SPEED_LIMIT</a>:</div>
<div class="line"><a id="l00345" name="l00345"></a><span class="lineno">  345</span>    {</div>
<div class="line"><a id="l00346" name="l00346"></a><span class="lineno">  346</span>      lanelet::DigitalSpeedLimitPtr speed = std::dynamic_pointer_cast&lt;lanelet::DigitalSpeedLimit&gt;(factory_regem);</div>
<div class="line"><a id="l00347" name="l00347"></a><span class="lineno">  347</span>      <span class="keywordflow">if</span> (speed)</div>
<div class="line"><a id="l00348" name="l00348"></a><span class="lineno">  348</span>      {</div>
<div class="line"><a id="l00349" name="l00349"></a><span class="lineno">  349</span>        <a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#a4ea1ac169b8ba4a72dd72b4e8723257e">world_model_</a>-&gt;getMutableMap()-&gt;update(parent_llt, speed);</div>
<div class="line"><a id="l00350" name="l00350"></a><span class="lineno">  350</span>      }</div>
<div class="line"><a id="l00351" name="l00351"></a><span class="lineno">  351</span>      <span class="keywordflow">else</span></div>
<div class="line"><a id="l00352" name="l00352"></a><span class="lineno">  352</span>      {</div>
<div class="line"><a id="l00353" name="l00353"></a><span class="lineno">  353</span>        std::invalid_argument(<span class="stringliteral">&quot;Dynamic Pointer cast failed on getting valid speed limit&quot;</span>);</div>
<div class="line"><a id="l00354" name="l00354"></a><span class="lineno">  354</span>      }</div>
<div class="line"><a id="l00355" name="l00355"></a><span class="lineno">  355</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00356" name="l00356"></a><span class="lineno">  356</span>    }</div>
<div class="line"><a id="l00357" name="l00357"></a><span class="lineno">  357</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="namespacecarma__wm.html#ac09d7a77e6f8f955651e7afa16136bf1a3342d8a1648c3c7b49348bdebb6a67d8">GeofenceType::REGION_ACCESS_RULE</a>:</div>
<div class="line"><a id="l00358" name="l00358"></a><span class="lineno">  358</span>    {</div>
<div class="line"><a id="l00359" name="l00359"></a><span class="lineno">  359</span> </div>
<div class="line"><a id="l00360" name="l00360"></a><span class="lineno">  360</span>      lanelet::RegionAccessRulePtr rar = std::dynamic_pointer_cast&lt;lanelet::RegionAccessRule&gt;(factory_regem);</div>
<div class="line"><a id="l00361" name="l00361"></a><span class="lineno">  361</span>      <span class="keywordflow">if</span> (rar)</div>
<div class="line"><a id="l00362" name="l00362"></a><span class="lineno">  362</span>      {</div>
<div class="line"><a id="l00363" name="l00363"></a><span class="lineno">  363</span>        <a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#a4ea1ac169b8ba4a72dd72b4e8723257e">world_model_</a>-&gt;getMutableMap()-&gt;update(parent_llt, rar);</div>
<div class="line"><a id="l00364" name="l00364"></a><span class="lineno">  364</span>      }</div>
<div class="line"><a id="l00365" name="l00365"></a><span class="lineno">  365</span>      <span class="keywordflow">else</span></div>
<div class="line"><a id="l00366" name="l00366"></a><span class="lineno">  366</span>      {</div>
<div class="line"><a id="l00367" name="l00367"></a><span class="lineno">  367</span>        std::invalid_argument(<span class="stringliteral">&quot;Dynamic Pointer cast failed on getting valid region access rule&quot;</span>);</div>
<div class="line"><a id="l00368" name="l00368"></a><span class="lineno">  368</span>      }</div>
<div class="line"><a id="l00369" name="l00369"></a><span class="lineno">  369</span> </div>
<div class="line"><a id="l00370" name="l00370"></a><span class="lineno">  370</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00371" name="l00371"></a><span class="lineno">  371</span>    }</div>
<div class="line"><a id="l00372" name="l00372"></a><span class="lineno">  372</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="namespacecarma__wm.html#ac09d7a77e6f8f955651e7afa16136bf1a72fb3f0a086a3e9014953c51396b9f63">GeofenceType::DIGITAL_MINIMUM_GAP</a>:</div>
<div class="line"><a id="l00373" name="l00373"></a><span class="lineno">  373</span>    {</div>
<div class="line"><a id="l00374" name="l00374"></a><span class="lineno">  374</span> </div>
<div class="line"><a id="l00375" name="l00375"></a><span class="lineno">  375</span>      lanelet::DigitalMinimumGapPtr min_gap = std::dynamic_pointer_cast&lt;lanelet::DigitalMinimumGap&gt;(factory_regem);</div>
<div class="line"><a id="l00376" name="l00376"></a><span class="lineno">  376</span>      <span class="keywordflow">if</span> (min_gap)</div>
<div class="line"><a id="l00377" name="l00377"></a><span class="lineno">  377</span>      {</div>
<div class="line"><a id="l00378" name="l00378"></a><span class="lineno">  378</span>        <a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#a4ea1ac169b8ba4a72dd72b4e8723257e">world_model_</a>-&gt;getMutableMap()-&gt;update(parent_llt, min_gap);</div>
<div class="line"><a id="l00379" name="l00379"></a><span class="lineno">  379</span>      }</div>
<div class="line"><a id="l00380" name="l00380"></a><span class="lineno">  380</span>      <span class="keywordflow">else</span></div>
<div class="line"><a id="l00381" name="l00381"></a><span class="lineno">  381</span>      {</div>
<div class="line"><a id="l00382" name="l00382"></a><span class="lineno">  382</span>        std::invalid_argument(<span class="stringliteral">&quot;Dynamic Pointer cast failed on getting valid minimum gap rule&quot;</span>);</div>
<div class="line"><a id="l00383" name="l00383"></a><span class="lineno">  383</span>      }</div>
<div class="line"><a id="l00384" name="l00384"></a><span class="lineno">  384</span> </div>
<div class="line"><a id="l00385" name="l00385"></a><span class="lineno">  385</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00386" name="l00386"></a><span class="lineno">  386</span>    }</div>
<div class="line"><a id="l00387" name="l00387"></a><span class="lineno">  387</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="namespacecarma__wm.html#ac09d7a77e6f8f955651e7afa16136bf1a165080307b64c43de1a0939d3bf047ae">GeofenceType::DIRECTION_OF_TRAVEL</a>:</div>
<div class="line"><a id="l00388" name="l00388"></a><span class="lineno">  388</span>    {</div>
<div class="line"><a id="l00389" name="l00389"></a><span class="lineno">  389</span> </div>
<div class="line"><a id="l00390" name="l00390"></a><span class="lineno">  390</span>      lanelet::DirectionOfTravelPtr dot = std::dynamic_pointer_cast&lt;lanelet::DirectionOfTravel&gt;(factory_regem);</div>
<div class="line"><a id="l00391" name="l00391"></a><span class="lineno">  391</span>      <span class="keywordflow">if</span> (dot)</div>
<div class="line"><a id="l00392" name="l00392"></a><span class="lineno">  392</span>      {</div>
<div class="line"><a id="l00393" name="l00393"></a><span class="lineno">  393</span>        <a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#a4ea1ac169b8ba4a72dd72b4e8723257e">world_model_</a>-&gt;getMutableMap()-&gt;update(parent_llt, dot);</div>
<div class="line"><a id="l00394" name="l00394"></a><span class="lineno">  394</span>      }</div>
<div class="line"><a id="l00395" name="l00395"></a><span class="lineno">  395</span>      <span class="keywordflow">else</span></div>
<div class="line"><a id="l00396" name="l00396"></a><span class="lineno">  396</span>      {</div>
<div class="line"><a id="l00397" name="l00397"></a><span class="lineno">  397</span>        std::invalid_argument(<span class="stringliteral">&quot;Dynamic Pointer cast failed on getting valid direction of travel&quot;</span>);</div>
<div class="line"><a id="l00398" name="l00398"></a><span class="lineno">  398</span>      }</div>
<div class="line"><a id="l00399" name="l00399"></a><span class="lineno">  399</span> </div>
<div class="line"><a id="l00400" name="l00400"></a><span class="lineno">  400</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00401" name="l00401"></a><span class="lineno">  401</span>    }</div>
<div class="line"><a id="l00402" name="l00402"></a><span class="lineno">  402</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="namespacecarma__wm.html#ac09d7a77e6f8f955651e7afa16136bf1a3ef9e3ed7808c7c32a48e954fad71c04">GeofenceType::STOP_RULE</a>:</div>
<div class="line"><a id="l00403" name="l00403"></a><span class="lineno">  403</span>    {</div>
<div class="line"><a id="l00404" name="l00404"></a><span class="lineno">  404</span> </div>
<div class="line"><a id="l00405" name="l00405"></a><span class="lineno">  405</span>      lanelet::StopRulePtr sr = std::dynamic_pointer_cast&lt;lanelet::StopRule&gt;(factory_regem);</div>
<div class="line"><a id="l00406" name="l00406"></a><span class="lineno">  406</span>      <span class="keywordflow">if</span> (sr)</div>
<div class="line"><a id="l00407" name="l00407"></a><span class="lineno">  407</span>      {</div>
<div class="line"><a id="l00408" name="l00408"></a><span class="lineno">  408</span>        <a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#a4ea1ac169b8ba4a72dd72b4e8723257e">world_model_</a>-&gt;getMutableMap()-&gt;update(parent_llt, sr);</div>
<div class="line"><a id="l00409" name="l00409"></a><span class="lineno">  409</span>      }</div>
<div class="line"><a id="l00410" name="l00410"></a><span class="lineno">  410</span>      <span class="keywordflow">else</span></div>
<div class="line"><a id="l00411" name="l00411"></a><span class="lineno">  411</span>      {</div>
<div class="line"><a id="l00412" name="l00412"></a><span class="lineno">  412</span>        std::invalid_argument(<span class="stringliteral">&quot;Dynamic Pointer cast failed on getting valid stop rule&quot;</span>);</div>
<div class="line"><a id="l00413" name="l00413"></a><span class="lineno">  413</span>      }</div>
<div class="line"><a id="l00414" name="l00414"></a><span class="lineno">  414</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00415" name="l00415"></a><span class="lineno">  415</span>    }</div>
<div class="line"><a id="l00416" name="l00416"></a><span class="lineno">  416</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="namespacecarma__wm.html#ac09d7a77e6f8f955651e7afa16136bf1a269b80a3c3f0b44a73071e21d4ab36c2">GeofenceType::CARMA_TRAFFIC_LIGHT</a>:</div>
<div class="line"><a id="l00417" name="l00417"></a><span class="lineno">  417</span>    {</div>
<div class="line"><a id="l00418" name="l00418"></a><span class="lineno">  418</span>      lanelet::CarmaTrafficSignalPtr ctl = std::dynamic_pointer_cast&lt;lanelet::CarmaTrafficSignal&gt;(factory_regem);</div>
<div class="line"><a id="l00419" name="l00419"></a><span class="lineno">  419</span>      <span class="keywordflow">if</span> (ctl)</div>
<div class="line"><a id="l00420" name="l00420"></a><span class="lineno">  420</span>      {</div>
<div class="line"><a id="l00421" name="l00421"></a><span class="lineno">  421</span>        <a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#a4ea1ac169b8ba4a72dd72b4e8723257e">world_model_</a>-&gt;getMutableMap()-&gt;update(parent_llt, ctl);</div>
<div class="line"><a id="l00422" name="l00422"></a><span class="lineno">  422</span>      }</div>
<div class="line"><a id="l00423" name="l00423"></a><span class="lineno">  423</span>      <span class="keywordflow">else</span></div>
<div class="line"><a id="l00424" name="l00424"></a><span class="lineno">  424</span>      {</div>
<div class="line"><a id="l00425" name="l00425"></a><span class="lineno">  425</span>        std::invalid_argument(<span class="stringliteral">&quot;Dynamic Pointer cast failed on getting valid carma traffic signal&quot;</span>);</div>
<div class="line"><a id="l00426" name="l00426"></a><span class="lineno">  426</span>      }</div>
<div class="line"><a id="l00427" name="l00427"></a><span class="lineno">  427</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00428" name="l00428"></a><span class="lineno">  428</span>    }</div>
<div class="line"><a id="l00429" name="l00429"></a><span class="lineno">  429</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="namespacecarma__wm.html#ac09d7a77e6f8f955651e7afa16136bf1a5183fcbc60f37b81f9ca22d76af71867">GeofenceType::SIGNALIZED_INTERSECTION</a>:</div>
<div class="line"><a id="l00430" name="l00430"></a><span class="lineno">  430</span>    {</div>
<div class="line"><a id="l00431" name="l00431"></a><span class="lineno">  431</span>      lanelet::SignalizedIntersectionPtr si = std::dynamic_pointer_cast&lt;lanelet::SignalizedIntersection&gt;(factory_regem);</div>
<div class="line"><a id="l00432" name="l00432"></a><span class="lineno">  432</span>      <span class="keywordflow">if</span> (si)</div>
<div class="line"><a id="l00433" name="l00433"></a><span class="lineno">  433</span>      {</div>
<div class="line"><a id="l00434" name="l00434"></a><span class="lineno">  434</span>        <a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#a4ea1ac169b8ba4a72dd72b4e8723257e">world_model_</a>-&gt;getMutableMap()-&gt;update(parent_llt, si);</div>
<div class="line"><a id="l00435" name="l00435"></a><span class="lineno">  435</span>      }</div>
<div class="line"><a id="l00436" name="l00436"></a><span class="lineno">  436</span>      <span class="keywordflow">else</span></div>
<div class="line"><a id="l00437" name="l00437"></a><span class="lineno">  437</span>      {</div>
<div class="line"><a id="l00438" name="l00438"></a><span class="lineno">  438</span>        std::invalid_argument(<span class="stringliteral">&quot;Dynamic Pointer cast failed on getting valid signalized intersection&quot;</span>);</div>
<div class="line"><a id="l00439" name="l00439"></a><span class="lineno">  439</span>      }</div>
<div class="line"><a id="l00440" name="l00440"></a><span class="lineno">  440</span> </div>
<div class="line"><a id="l00441" name="l00441"></a><span class="lineno">  441</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00442" name="l00442"></a><span class="lineno">  442</span>    }</div>
<div class="line"><a id="l00443" name="l00443"></a><span class="lineno">  443</span>    <span class="keywordflow">default</span>:</div>
<div class="line"><a id="l00444" name="l00444"></a><span class="lineno">  444</span>      RCLCPP_WARN_STREAM(rclcpp::get_logger(<span class="stringliteral">&quot;carma_wm::WMListenerWorker&quot;</span>), <span class="stringliteral">&quot;World Model instance received an unsupported geofence type in its map update callback!&quot;</span>);</div>
<div class="line"><a id="l00445" name="l00445"></a><span class="lineno">  445</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00446" name="l00446"></a><span class="lineno">  446</span>  }</div>
<div class="line"><a id="l00447" name="l00447"></a><span class="lineno">  447</span>}</div>
<div class="line"><a id="l00448" name="l00448"></a><span class="lineno">  448</span> </div>
<div class="line"><a id="l00449" name="l00449"></a><span class="lineno"><a class="line" href="classcarma__wm_1_1WMListenerWorker.html#a614654b7b374ed1d24537e347d49389f">  449</a></span><a class="code hl_typedef" href="namespacecarma__wm.html#a23411d3d299da623ec379efbc1a5b14a">LaneletRoutingGraphPtr</a> <a class="code hl_function" href="classcarma__wm_1_1WMListenerWorker.html#a614654b7b374ed1d24537e347d49389f">WMListenerWorker::routingGraphFromMsg</a>(<span class="keyword">const</span> autoware_lanelet2_msgs::msg::RoutingGraph&amp; msg, lanelet::LaneletMapPtr map)<span class="keyword"> const </span>{</div>
<div class="line"><a id="l00450" name="l00450"></a><span class="lineno">  450</span> </div>
<div class="line"><a id="l00451" name="l00451"></a><span class="lineno">  451</span>  <span class="keywordflow">if</span> (msg.participant_type.compare(<a class="code hl_function" href="classcarma__wm_1_1WMListenerWorker.html#ac0c115081f19ec29b215e6edeb110d4c">getVehicleParticipationType</a>()) != 0) {</div>
<div class="line"><a id="l00452" name="l00452"></a><span class="lineno">  452</span> </div>
<div class="line"><a id="l00453" name="l00453"></a><span class="lineno">  453</span>    RCLCPP_ERROR_STREAM(rclcpp::get_logger(<span class="stringliteral">&quot;carma_wm::WMListenerWorker&quot;</span>),<span class="stringliteral">&quot;Received routing graph does not have matching vehicle type for world model. WM Type: &quot;</span></div>
<div class="line"><a id="l00454" name="l00454"></a><span class="lineno">  454</span>      &lt;&lt; <a class="code hl_function" href="classcarma__wm_1_1WMListenerWorker.html#ac0c115081f19ec29b215e6edeb110d4c">getVehicleParticipationType</a>()</div>
<div class="line"><a id="l00455" name="l00455"></a><span class="lineno">  455</span>      &lt;&lt; <span class="stringliteral">&quot; graph type: &quot;</span> &lt;&lt; msg.participant_type</div>
<div class="line"><a id="l00456" name="l00456"></a><span class="lineno">  456</span>    );</div>
<div class="line"><a id="l00457" name="l00457"></a><span class="lineno">  457</span> </div>
<div class="line"><a id="l00458" name="l00458"></a><span class="lineno">  458</span>    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00459" name="l00459"></a><span class="lineno">  459</span>  }</div>
<div class="line"><a id="l00460" name="l00460"></a><span class="lineno">  460</span> </div>
<div class="line"><a id="l00461" name="l00461"></a><span class="lineno">  461</span>  <span class="comment">// Get the lists of passable lanelets and areas</span></div>
<div class="line"><a id="l00462" name="l00462"></a><span class="lineno">  462</span>  <span class="comment">// Both these lists must be populated in the same order as the message to support later logic</span></div>
<div class="line"><a id="l00463" name="l00463"></a><span class="lineno">  463</span>  lanelet::ConstLanelets passable_lanelets;</div>
<div class="line"><a id="l00464" name="l00464"></a><span class="lineno">  464</span>  lanelet::ConstAreas passable_areas;</div>
<div class="line"><a id="l00465" name="l00465"></a><span class="lineno">  465</span> </div>
<div class="line"><a id="l00466" name="l00466"></a><span class="lineno">  466</span>  passable_lanelets.reserve(msg.lanelet_vertices.size());</div>
<div class="line"><a id="l00467" name="l00467"></a><span class="lineno">  467</span>  passable_areas.reserve(msg.area_vertices.size());</div>
<div class="line"><a id="l00468" name="l00468"></a><span class="lineno">  468</span> </div>
<div class="line"><a id="l00469" name="l00469"></a><span class="lineno">  469</span>  <span class="keywordflow">try</span> {</div>
<div class="line"><a id="l00470" name="l00470"></a><span class="lineno">  470</span> </div>
<div class="line"><a id="l00471" name="l00471"></a><span class="lineno">  471</span>    <span class="comment">// All the passable lanelets and areas should be included as a vertext so just iterate over each and store</span></div>
<div class="line"><a id="l00472" name="l00472"></a><span class="lineno">  472</span>    <span class="keywordflow">for</span> (<span class="keyword">auto</span> vertex : msg.lanelet_vertices) {</div>
<div class="line"><a id="l00473" name="l00473"></a><span class="lineno">  473</span>      passable_lanelets.emplace_back(map-&gt;laneletLayer.get(vertex.lanelet_or_area));</div>
<div class="line"><a id="l00474" name="l00474"></a><span class="lineno">  474</span>    }</div>
<div class="line"><a id="l00475" name="l00475"></a><span class="lineno">  475</span> </div>
<div class="line"><a id="l00476" name="l00476"></a><span class="lineno">  476</span>    <span class="keywordflow">for</span> (<span class="keyword">auto</span> vertex : msg.area_vertices) {</div>
<div class="line"><a id="l00477" name="l00477"></a><span class="lineno">  477</span>      passable_areas.emplace_back(map-&gt;areaLayer.get(vertex.lanelet_or_area));</div>
<div class="line"><a id="l00478" name="l00478"></a><span class="lineno">  478</span>    }</div>
<div class="line"><a id="l00479" name="l00479"></a><span class="lineno">  479</span> </div>
<div class="line"><a id="l00480" name="l00480"></a><span class="lineno">  480</span>  } <span class="keywordflow">catch</span>(<span class="keyword">const</span> lanelet::NoSuchPrimitiveError&amp; e) {</div>
<div class="line"><a id="l00481" name="l00481"></a><span class="lineno">  481</span> </div>
<div class="line"><a id="l00482" name="l00482"></a><span class="lineno">  482</span>    RCLCPP_ERROR_STREAM(rclcpp::get_logger(<span class="stringliteral">&quot;carma_wm::WMListenerWorker&quot;</span>), <span class="stringliteral">&quot;Received routing graph specifies lanelets which do not match the current map version. Actual exception: &quot;</span> &lt;&lt; e.what());</div>
<div class="line"><a id="l00483" name="l00483"></a><span class="lineno">  483</span> </div>
<div class="line"><a id="l00484" name="l00484"></a><span class="lineno">  484</span>    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00485" name="l00485"></a><span class="lineno">  485</span>  }</div>
<div class="line"><a id="l00486" name="l00486"></a><span class="lineno">  486</span> </div>
<div class="line"><a id="l00487" name="l00487"></a><span class="lineno">  487</span> </div>
<div class="line"><a id="l00488" name="l00488"></a><span class="lineno">  488</span>  <span class="comment">// Build the submap</span></div>
<div class="line"><a id="l00489" name="l00489"></a><span class="lineno">  489</span>  <span class="comment">// This operation does increase in time as the number of lanelets and areas increase</span></div>
<div class="line"><a id="l00490" name="l00490"></a><span class="lineno">  490</span>  <span class="comment">// however testing shows it to less than 1% of the total routing graph build time so this is a reasonable operation to keep</span></div>
<div class="line"><a id="l00491" name="l00491"></a><span class="lineno">  491</span>  <span class="keyword">auto</span> passable_map = lanelet::utils::createConstSubmap(passable_lanelets, passable_areas);</div>
<div class="line"><a id="l00492" name="l00492"></a><span class="lineno">  492</span> </div>
<div class="line"><a id="l00493" name="l00493"></a><span class="lineno">  493</span>  <span class="comment">// This is the actual graph object which is used to initialize a RoutingGraph</span></div>
<div class="line"><a id="l00494" name="l00494"></a><span class="lineno">  494</span>  <span class="keyword">auto</span> graph = std::make_unique&lt;lanelet::routing::internal::RoutingGraphGraph&gt;(msg.num_unique_routing_cost_ids);</div>
<div class="line"><a id="l00495" name="l00495"></a><span class="lineno">  495</span> </div>
<div class="line"><a id="l00496" name="l00496"></a><span class="lineno">  496</span>  <span class="comment">// Vertex must be added first then the edge can be added</span></div>
<div class="line"><a id="l00497" name="l00497"></a><span class="lineno">  497</span>  <span class="keywordflow">for</span> (<span class="keyword">auto</span> ll : passable_lanelets) {</div>
<div class="line"><a id="l00498" name="l00498"></a><span class="lineno">  498</span>    graph-&gt;addVertex(lanelet::routing::internal::VertexInfo{ll});</div>
<div class="line"><a id="l00499" name="l00499"></a><span class="lineno">  499</span>  }</div>
<div class="line"><a id="l00500" name="l00500"></a><span class="lineno">  500</span> </div>
<div class="line"><a id="l00501" name="l00501"></a><span class="lineno">  501</span>  <span class="keywordflow">for</span> (<span class="keyword">auto</span> area : passable_areas) {</div>
<div class="line"><a id="l00502" name="l00502"></a><span class="lineno">  502</span>    graph-&gt;addVertex(lanelet::routing::internal::VertexInfo{area});</div>
<div class="line"><a id="l00503" name="l00503"></a><span class="lineno">  503</span>  }</div>
<div class="line"><a id="l00504" name="l00504"></a><span class="lineno">  504</span> </div>
<div class="line"><a id="l00505" name="l00505"></a><span class="lineno">  505</span>  <span class="comment">// Now we can add edges</span></div>
<div class="line"><a id="l00506" name="l00506"></a><span class="lineno">  506</span>  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a> = 0; <a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a> &lt; msg.lanelet_vertices.size(); ++<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>) {</div>
<div class="line"><a id="l00507" name="l00507"></a><span class="lineno">  507</span> </div>
<div class="line"><a id="l00508" name="l00508"></a><span class="lineno">  508</span>    <span class="keyword">auto</span> vertex = msg.lanelet_vertices[<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>];</div>
<div class="line"><a id="l00509" name="l00509"></a><span class="lineno">  509</span>    <span class="keyword">auto</span> <a class="code hl_namespace" href="namespacelanelet.html">lanelet</a> = passable_lanelets[<a class="code hl_variable" href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">i</a>]; <span class="comment">// passable_lanelets should be in the same order based on how its constructed</span></div>
<div class="line"><a id="l00510" name="l00510"></a><span class="lineno">  510</span> </div>
<div class="line"><a id="l00511" name="l00511"></a><span class="lineno">  511</span>    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> j = 0; j &lt; vertex.lanelet_or_area_ids.size(); ++j) {</div>
<div class="line"><a id="l00512" name="l00512"></a><span class="lineno">  512</span> </div>
<div class="line"><a id="l00513" name="l00513"></a><span class="lineno">  513</span>      lanelet::routing::RelationType relation;</div>
<div class="line"><a id="l00514" name="l00514"></a><span class="lineno">  514</span> </div>
<div class="line"><a id="l00515" name="l00515"></a><span class="lineno">  515</span>      <span class="comment">// Get relation</span></div>
<div class="line"><a id="l00516" name="l00516"></a><span class="lineno">  516</span>      <span class="keywordflow">switch</span> (vertex.edge_relations[j])</div>
<div class="line"><a id="l00517" name="l00517"></a><span class="lineno">  517</span>      {</div>
<div class="line"><a id="l00518" name="l00518"></a><span class="lineno">  518</span>        <span class="keywordflow">case</span> autoware_lanelet2_msgs::msg::RoutingGraphVertexAndEdges::RELATION_SUCCESSOR:</div>
<div class="line"><a id="l00519" name="l00519"></a><span class="lineno">  519</span>          relation = lanelet::routing::RelationType::Successor; <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00520" name="l00520"></a><span class="lineno">  520</span> </div>
<div class="line"><a id="l00521" name="l00521"></a><span class="lineno">  521</span>        <span class="keywordflow">case</span> autoware_lanelet2_msgs::msg::RoutingGraphVertexAndEdges::RELATION_LEFT:</div>
<div class="line"><a id="l00522" name="l00522"></a><span class="lineno">  522</span>          relation = <a class="code hl_enumvalue" href="namespacesci__strategic__plugin.html#a566a001705be58d1fa9b8b13ba6e3677a0614364ce8a300e7a392919c4753d8a8">lanelet::routing::RelationType::Left</a>; <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00523" name="l00523"></a><span class="lineno">  523</span> </div>
<div class="line"><a id="l00524" name="l00524"></a><span class="lineno">  524</span>        <span class="keywordflow">case</span> autoware_lanelet2_msgs::msg::RoutingGraphVertexAndEdges::RELATION_RIGHT:</div>
<div class="line"><a id="l00525" name="l00525"></a><span class="lineno">  525</span>          relation = <a class="code hl_enumvalue" href="namespacesci__strategic__plugin.html#a566a001705be58d1fa9b8b13ba6e3677ae56f9187e18e7976a4565df987d0962e">lanelet::routing::RelationType::Right</a>; <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00526" name="l00526"></a><span class="lineno">  526</span> </div>
<div class="line"><a id="l00527" name="l00527"></a><span class="lineno">  527</span>        <span class="keywordflow">case</span> autoware_lanelet2_msgs::msg::RoutingGraphVertexAndEdges::RELATION_ADJACENT_LEFT:</div>
<div class="line"><a id="l00528" name="l00528"></a><span class="lineno">  528</span>          relation = lanelet::routing::RelationType::AdjacentLeft; <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00529" name="l00529"></a><span class="lineno">  529</span> </div>
<div class="line"><a id="l00530" name="l00530"></a><span class="lineno">  530</span>        <span class="keywordflow">case</span> autoware_lanelet2_msgs::msg::RoutingGraphVertexAndEdges::RELATION_ADJACENT_RIGHT:</div>
<div class="line"><a id="l00531" name="l00531"></a><span class="lineno">  531</span>          relation = lanelet::routing::RelationType::AdjacentRight; <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00532" name="l00532"></a><span class="lineno">  532</span> </div>
<div class="line"><a id="l00533" name="l00533"></a><span class="lineno">  533</span>        <span class="keywordflow">case</span> autoware_lanelet2_msgs::msg::RoutingGraphVertexAndEdges::RELATION_CONFLICTING:</div>
<div class="line"><a id="l00534" name="l00534"></a><span class="lineno">  534</span>          relation = lanelet::routing::RelationType::Conflicting; <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00535" name="l00535"></a><span class="lineno">  535</span> </div>
<div class="line"><a id="l00536" name="l00536"></a><span class="lineno">  536</span>        <span class="keywordflow">case</span> autoware_lanelet2_msgs::msg::RoutingGraphVertexAndEdges::RELATION_AREA:</div>
<div class="line"><a id="l00537" name="l00537"></a><span class="lineno">  537</span>          relation = lanelet::routing::RelationType::Area; <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00538" name="l00538"></a><span class="lineno">  538</span> </div>
<div class="line"><a id="l00539" name="l00539"></a><span class="lineno">  539</span>        <span class="keywordflow">default</span>: <span class="comment">// Treat default as RELATION_NONE</span></div>
<div class="line"><a id="l00540" name="l00540"></a><span class="lineno">  540</span>          relation = lanelet::routing::RelationType::None; <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00541" name="l00541"></a><span class="lineno">  541</span>      }</div>
<div class="line"><a id="l00542" name="l00542"></a><span class="lineno">  542</span> </div>
<div class="line"><a id="l00543" name="l00543"></a><span class="lineno">  543</span>      <span class="keywordflow">try</span> {</div>
<div class="line"><a id="l00544" name="l00544"></a><span class="lineno">  544</span> </div>
<div class="line"><a id="l00545" name="l00545"></a><span class="lineno">  545</span>        <span class="comment">// Create edge</span></div>
<div class="line"><a id="l00546" name="l00546"></a><span class="lineno">  546</span>        graph-&gt;addEdge(</div>
<div class="line"><a id="l00547" name="l00547"></a><span class="lineno">  547</span>          <a class="code hl_namespace" href="namespacelanelet.html">lanelet</a>,</div>
<div class="line"><a id="l00548" name="l00548"></a><span class="lineno">  548</span>          map-&gt;laneletLayer.get(vertex.lanelet_or_area_ids[j]),</div>
<div class="line"><a id="l00549" name="l00549"></a><span class="lineno">  549</span>          lanelet::routing::internal::EdgeInfo{vertex.edge_routing_costs[j], vertex.edge_routing_cost_source_ids[j], relation}</div>
<div class="line"><a id="l00550" name="l00550"></a><span class="lineno">  550</span>        );</div>
<div class="line"><a id="l00551" name="l00551"></a><span class="lineno">  551</span> </div>
<div class="line"><a id="l00552" name="l00552"></a><span class="lineno">  552</span>      }  <span class="keywordflow">catch</span>(<span class="keyword">const</span> lanelet::NoSuchPrimitiveError&amp; e) {</div>
<div class="line"><a id="l00553" name="l00553"></a><span class="lineno">  553</span> </div>
<div class="line"><a id="l00554" name="l00554"></a><span class="lineno">  554</span>        RCLCPP_ERROR_STREAM(rclcpp::get_logger(<span class="stringliteral">&quot;carma_wm::WMListenerWorker&quot;</span>),<span class="stringliteral">&quot;Received routing graph specifies lanelets which do not match the current map version. Not found lanelet or area: &quot;</span></div>
<div class="line"><a id="l00555" name="l00555"></a><span class="lineno">  555</span>          &lt;&lt; vertex.lanelet_or_area_ids[j] &lt;&lt; <span class="stringliteral">&quot; Actual exception: &quot;</span> &lt;&lt; e.what());</div>
<div class="line"><a id="l00556" name="l00556"></a><span class="lineno">  556</span> </div>
<div class="line"><a id="l00557" name="l00557"></a><span class="lineno">  557</span>        <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00558" name="l00558"></a><span class="lineno">  558</span>      }</div>
<div class="line"><a id="l00559" name="l00559"></a><span class="lineno">  559</span> </div>
<div class="line"><a id="l00560" name="l00560"></a><span class="lineno">  560</span>    }</div>
<div class="line"><a id="l00561" name="l00561"></a><span class="lineno">  561</span>  }</div>
<div class="line"><a id="l00562" name="l00562"></a><span class="lineno">  562</span> </div>
<div class="line"><a id="l00563" name="l00563"></a><span class="lineno">  563</span>  <span class="comment">// Build and return the final initialized routing graph</span></div>
<div class="line"><a id="l00564" name="l00564"></a><span class="lineno">  564</span>  <span class="keywordflow">return</span> std::make_shared&lt;lanelet::routing::RoutingGraph&gt;(std::move(graph), std::move(passable_map));</div>
<div class="line"><a id="l00565" name="l00565"></a><span class="lineno">  565</span> </div>
<div class="line"><a id="l00566" name="l00566"></a><span class="lineno">  566</span>}</div>
<div class="line"><a id="l00567" name="l00567"></a><span class="lineno">  567</span> </div>
<div class="line"><a id="l00568" name="l00568"></a><span class="lineno"><a class="line" href="classcarma__wm_1_1WMListenerWorker.html#ac0c115081f19ec29b215e6edeb110d4c">  568</a></span>std::string <a class="code hl_function" href="classcarma__wm_1_1WMListenerWorker.html#ac0c115081f19ec29b215e6edeb110d4c">WMListenerWorker::getVehicleParticipationType</a>()<span class="keyword"> const</span></div>
<div class="line"><a id="l00569" name="l00569"></a><span class="lineno">  569</span><span class="keyword"></span>{</div>
<div class="line"><a id="l00570" name="l00570"></a><span class="lineno">  570</span>  <span class="keywordflow">return</span> <a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#a4ea1ac169b8ba4a72dd72b4e8723257e">world_model_</a>-&gt;getVehicleParticipationType();</div>
<div class="line"><a id="l00571" name="l00571"></a><span class="lineno">  571</span>}</div>
<div class="line"><a id="l00572" name="l00572"></a><span class="lineno">  572</span> </div>
<div class="line"><a id="l00573" name="l00573"></a><span class="lineno"><a class="line" href="classcarma__wm_1_1WMListenerWorker.html#a837ecb3086f6f25bd2768ce2bb5d2a81">  573</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classcarma__wm_1_1WMListenerWorker.html#a837ecb3086f6f25bd2768ce2bb5d2a81">WMListenerWorker::roadwayObjectListCallback</a>(<span class="keyword">const</span> carma_perception_msgs::msg::RoadwayObstacleList::SharedPtr msg)</div>
<div class="line"><a id="l00574" name="l00574"></a><span class="lineno">  574</span>{</div>
<div class="line"><a id="l00575" name="l00575"></a><span class="lineno">  575</span>  <span class="comment">// this topic publishes only the objects that are on the road</span></div>
<div class="line"><a id="l00576" name="l00576"></a><span class="lineno">  576</span>  <a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#a4ea1ac169b8ba4a72dd72b4e8723257e">world_model_</a>-&gt;setRoadwayObjects(msg-&gt;roadway_obstacles);</div>
<div class="line"><a id="l00577" name="l00577"></a><span class="lineno">  577</span>}</div>
<div class="line"><a id="l00578" name="l00578"></a><span class="lineno">  578</span> </div>
<div class="line"><a id="l00579" name="l00579"></a><span class="lineno"><a class="line" href="classcarma__wm_1_1WMListenerWorker.html#ada3e493ebddb3bcb7596c2af2a3a14d6">  579</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classcarma__wm_1_1WMListenerWorker.html#ada3e493ebddb3bcb7596c2af2a3a14d6">WMListenerWorker::ros1ClockCallback</a>(<span class="keyword">const</span> rosgraph_msgs::msg::Clock::SharedPtr clock_msg)</div>
<div class="line"><a id="l00580" name="l00580"></a><span class="lineno">  580</span>{</div>
<div class="line"><a id="l00581" name="l00581"></a><span class="lineno">  581</span>  <a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#a4ea1ac169b8ba4a72dd72b4e8723257e">world_model_</a>-&gt;setRos1Clock(rclcpp::Time(clock_msg-&gt;clock));</div>
<div class="line"><a id="l00582" name="l00582"></a><span class="lineno">  582</span>}</div>
<div class="line"><a id="l00583" name="l00583"></a><span class="lineno">  583</span> </div>
<div class="line"><a id="l00584" name="l00584"></a><span class="lineno"><a class="line" href="classcarma__wm_1_1WMListenerWorker.html#a9ce452d5bee1efa560ad66713c306a66">  584</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classcarma__wm_1_1WMListenerWorker.html#a9ce452d5bee1efa560ad66713c306a66">WMListenerWorker::simClockCallback</a>(<span class="keyword">const</span> rosgraph_msgs::msg::Clock::SharedPtr clock_msg)</div>
<div class="line"><a id="l00585" name="l00585"></a><span class="lineno">  585</span>{</div>
<div class="line"><a id="l00586" name="l00586"></a><span class="lineno">  586</span>  <a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#a4ea1ac169b8ba4a72dd72b4e8723257e">world_model_</a>-&gt;setSimulationClock(rclcpp::Time(clock_msg-&gt;clock));</div>
<div class="line"><a id="l00587" name="l00587"></a><span class="lineno">  587</span>}</div>
<div class="line"><a id="l00588" name="l00588"></a><span class="lineno">  588</span> </div>
<div class="line"><a id="l00589" name="l00589"></a><span class="lineno"><a class="line" href="classcarma__wm_1_1WMListenerWorker.html#a64f55af7e8146c0119b7f603a27629e4">  589</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classcarma__wm_1_1WMListenerWorker.html#a64f55af7e8146c0119b7f603a27629e4">WMListenerWorker::routeCallback</a>(<span class="keyword">const</span> carma_planning_msgs::msg::Route::SharedPtr route_msg)</div>
<div class="line"><a id="l00590" name="l00590"></a><span class="lineno">  590</span>{</div>
<div class="line"><a id="l00591" name="l00591"></a><span class="lineno">  591</span>  <span class="keywordflow">if</span> (route_msg-&gt;map_version &lt; <a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#aae0b14b4566a06ba1c99e46e79de0fba">current_map_version_</a>) {</div>
<div class="line"><a id="l00592" name="l00592"></a><span class="lineno">  592</span>    RCLCPP_WARN_STREAM(rclcpp::get_logger(<span class="stringliteral">&quot;carma_wm::WMListenerWorker&quot;</span>), <span class="stringliteral">&quot;Route message rejected as it is for an older map&quot;</span>);</div>
<div class="line"><a id="l00593" name="l00593"></a><span class="lineno">  593</span>    <a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#a310d6ebc20c42f055541025291337b57">rerouting_flag_</a> = <span class="keyword">false</span>; <span class="comment">// Clear any blockers on map updates as the route we were waiting for is no longer valid</span></div>
<div class="line"><a id="l00594" name="l00594"></a><span class="lineno">  594</span>    <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00595" name="l00595"></a><span class="lineno">  595</span>  }</div>
<div class="line"><a id="l00596" name="l00596"></a><span class="lineno">  596</span> </div>
<div class="line"><a id="l00597" name="l00597"></a><span class="lineno">  597</span>  <span class="keywordflow">if</span> (route_msg-&gt;map_version &gt; <a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#aae0b14b4566a06ba1c99e46e79de0fba">current_map_version_</a>) {</div>
<div class="line"><a id="l00598" name="l00598"></a><span class="lineno">  598</span>    RCLCPP_WARN_STREAM(rclcpp::get_logger(<span class="stringliteral">&quot;carma_wm::WMListenerWorker&quot;</span>), <span class="stringliteral">&quot;Route message received for future map. Delaying application until map is recieved&quot;</span>);</div>
<div class="line"><a id="l00599" name="l00599"></a><span class="lineno">  599</span>    <a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#a295aefa7073627e0c645ab19ec123a73">delayed_route_msg_</a> = *route_msg;</div>
<div class="line"><a id="l00600" name="l00600"></a><span class="lineno">  600</span>    <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00601" name="l00601"></a><span class="lineno">  601</span>  }</div>
<div class="line"><a id="l00602" name="l00602"></a><span class="lineno">  602</span> </div>
<div class="line"><a id="l00603" name="l00603"></a><span class="lineno">  603</span>  <span class="keywordtype">bool</span> route_invalidated_by_queued_map_update = <span class="keyword">false</span>; <span class="comment">// Flag to indicate whether this new route has been invalidated due to one of the applied queued map updates</span></div>
<div class="line"><a id="l00604" name="l00604"></a><span class="lineno">  604</span>  <span class="keywordflow">if</span>(<a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#a310d6ebc20c42f055541025291337b57">rerouting_flag_</a>==<span class="keyword">true</span> &amp;&amp; route_msg-&gt;is_rerouted )</div>
<div class="line"><a id="l00605" name="l00605"></a><span class="lineno">  605</span> </div>
<div class="line"><a id="l00606" name="l00606"></a><span class="lineno">  606</span>  {</div>
<div class="line"><a id="l00607" name="l00607"></a><span class="lineno">  607</span> </div>
<div class="line"><a id="l00608" name="l00608"></a><span class="lineno">  608</span>    <a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#a310d6ebc20c42f055541025291337b57">rerouting_flag_</a> = <span class="keyword">false</span>; <span class="comment">// Reset flag since the route node has finished re-routing</span></div>
<div class="line"><a id="l00609" name="l00609"></a><span class="lineno">  609</span> </div>
<div class="line"><a id="l00610" name="l00610"></a><span class="lineno">  610</span>    <span class="comment">// After setting map evaluate the current update queue to apply any updates that arrived before the map</span></div>
<div class="line"><a id="l00611" name="l00611"></a><span class="lineno">  611</span>    <span class="keywordtype">bool</span> more_updates_to_apply = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00612" name="l00612"></a><span class="lineno">  612</span>    <span class="keywordflow">while</span>(!<a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#ae5106bd418dff1ee316864d929c02c93">map_update_queue_</a>.empty() &amp;&amp; more_updates_to_apply) {</div>
<div class="line"><a id="l00613" name="l00613"></a><span class="lineno">  613</span> </div>
<div class="line"><a id="l00614" name="l00614"></a><span class="lineno">  614</span>      <span class="keyword">auto</span> update = <a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#ae5106bd418dff1ee316864d929c02c93">map_update_queue_</a>.front(); <span class="comment">// Get first update</span></div>
<div class="line"><a id="l00615" name="l00615"></a><span class="lineno">  615</span>      <a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#ae5106bd418dff1ee316864d929c02c93">map_update_queue_</a>.pop(); <span class="comment">// Remove update from queue</span></div>
<div class="line"><a id="l00616" name="l00616"></a><span class="lineno">  616</span> </div>
<div class="line"><a id="l00617" name="l00617"></a><span class="lineno">  617</span>      <span class="keywordflow">if</span> (update-&gt;map_version &lt; <a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#aae0b14b4566a06ba1c99e46e79de0fba">current_map_version_</a>) { <span class="comment">// Drop any so far unapplied updates for the current map</span></div>
<div class="line"><a id="l00618" name="l00618"></a><span class="lineno">  618</span>        RCLCPP_WARN_STREAM(rclcpp::get_logger(<span class="stringliteral">&quot;carma_wm::WMListenerWorker&quot;</span>), <span class="stringliteral">&quot;Apply from reroute: There were unapplied updates in carma_wm when a new map was recieved.&quot;</span>);</div>
<div class="line"><a id="l00619" name="l00619"></a><span class="lineno">  619</span>        <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00620" name="l00620"></a><span class="lineno">  620</span>      }</div>
<div class="line"><a id="l00621" name="l00621"></a><span class="lineno">  621</span>      <span class="keywordflow">if</span> (update-&gt;map_version == <a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#aae0b14b4566a06ba1c99e46e79de0fba">current_map_version_</a>) { <span class="comment">// Current update goes with current map which is also the map used by this route</span></div>
<div class="line"><a id="l00622" name="l00622"></a><span class="lineno">  622</span>        RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<span class="stringliteral">&quot;carma_wm::WMListenerWorker&quot;</span>), <span class="stringliteral">&quot;Applying queued update after route was recieved. &quot;</span>);</div>
<div class="line"><a id="l00623" name="l00623"></a><span class="lineno">  623</span> </div>
<div class="line"><a id="l00624" name="l00624"></a><span class="lineno">  624</span>        <span class="keywordflow">if</span> (update-&gt;invalidates_route == <span class="keyword">true</span>) {</div>
<div class="line"><a id="l00625" name="l00625"></a><span class="lineno">  625</span>          RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<span class="stringliteral">&quot;carma_wm::WMListenerWorker&quot;</span>), <span class="stringliteral">&quot;Applied queued map update has invalidated the route.&quot;</span>);</div>
<div class="line"><a id="l00626" name="l00626"></a><span class="lineno">  626</span>          route_invalidated_by_queued_map_update = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00627" name="l00627"></a><span class="lineno">  627</span>        }</div>
<div class="line"><a id="l00628" name="l00628"></a><span class="lineno">  628</span> </div>
<div class="line"><a id="l00629" name="l00629"></a><span class="lineno">  629</span>        update-&gt;invalidates_route=<span class="keyword">false</span>; <span class="comment">// Do not trigger recomputation of routing graph in mapUpdateCallback; recomputation of routing graph will occur outside of this loop</span></div>
<div class="line"><a id="l00630" name="l00630"></a><span class="lineno">  630</span> </div>
<div class="line"><a id="l00631" name="l00631"></a><span class="lineno">  631</span>        <a class="code hl_function" href="classcarma__wm_1_1WMListenerWorker.html#a44154428b921244d04d4678ed61c81d8">mapUpdateCallback</a>(update); <span class="comment">// Apply the update</span></div>
<div class="line"><a id="l00632" name="l00632"></a><span class="lineno">  632</span>      } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00633" name="l00633"></a><span class="lineno">  633</span>        RCLCPP_INFO_STREAM(rclcpp::get_logger(<span class="stringliteral">&quot;carma_wm::WMListenerWorker&quot;</span>), <span class="stringliteral">&quot;Apply from reroute: Done applying updates for new map. However, more updates are waiting for a future map.&quot;</span>);</div>
<div class="line"><a id="l00634" name="l00634"></a><span class="lineno">  634</span>        more_updates_to_apply = <span class="keyword">false</span>; <span class="comment">// If there is more updates queued that are not for this map version assume they are for a future map version</span></div>
<div class="line"><a id="l00635" name="l00635"></a><span class="lineno">  635</span>      }</div>
<div class="line"><a id="l00636" name="l00636"></a><span class="lineno">  636</span> </div>
<div class="line"><a id="l00637" name="l00637"></a><span class="lineno">  637</span>    }</div>
<div class="line"><a id="l00638" name="l00638"></a><span class="lineno">  638</span> </div>
<div class="line"><a id="l00639" name="l00639"></a><span class="lineno">  639</span>  }</div>
<div class="line"><a id="l00640" name="l00640"></a><span class="lineno">  640</span> </div>
<div class="line"><a id="l00641" name="l00641"></a><span class="lineno">  641</span>  <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#a4ea1ac169b8ba4a72dd72b4e8723257e">world_model_</a>-&gt;getMap()) { <span class="comment">// This check is a bit redundant but still useful from a debugging perspective as the alternative is a segfault</span></div>
<div class="line"><a id="l00642" name="l00642"></a><span class="lineno">  642</span>    RCLCPP_ERROR_STREAM(rclcpp::get_logger(<span class="stringliteral">&quot;carma_wm::WMListenerWorker&quot;</span>), <span class="stringliteral">&quot;WMListener received a route before a map was available. Dropping route message.&quot;</span>);</div>
<div class="line"><a id="l00643" name="l00643"></a><span class="lineno">  643</span>    <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00644" name="l00644"></a><span class="lineno">  644</span>  }</div>
<div class="line"><a id="l00645" name="l00645"></a><span class="lineno">  645</span> </div>
<div class="line"><a id="l00646" name="l00646"></a><span class="lineno">  646</span>  <span class="comment">// If one of the applied queued map updates invalidated the route, then the routing graph must be updated again for the route node</span></div>
<div class="line"><a id="l00647" name="l00647"></a><span class="lineno">  647</span>  <span class="keywordflow">if</span> (route_invalidated_by_queued_map_update &amp;&amp; <a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#a39cbf05af713a84fb396c36da3551df5">route_node_flag_</a>){</div>
<div class="line"><a id="l00648" name="l00648"></a><span class="lineno">  648</span>    RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<span class="stringliteral">&quot;carma_wm::WMListenerWorker&quot;</span>),<span class="stringliteral">&quot;At least one applied queued map update has invalidated the route. Routing graph will be recomputed.&quot;</span>);</div>
<div class="line"><a id="l00649" name="l00649"></a><span class="lineno">  649</span>    <a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#a4ea1ac169b8ba4a72dd72b4e8723257e">world_model_</a>-&gt;setMap(<a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#a4ea1ac169b8ba4a72dd72b4e8723257e">world_model_</a>-&gt;getMutableMap(), <a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#aae0b14b4566a06ba1c99e46e79de0fba">current_map_version_</a>, route_invalidated_by_queued_map_update);</div>
<div class="line"><a id="l00650" name="l00650"></a><span class="lineno">  650</span>    RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<span class="stringliteral">&quot;carma_wm::WMListenerWorker&quot;</span>),<span class="stringliteral">&quot;Finished recomputing the routing graph for the applied queued map update(s)&quot;</span>);</div>
<div class="line"><a id="l00651" name="l00651"></a><span class="lineno">  651</span> </div>
<div class="line"><a id="l00652" name="l00652"></a><span class="lineno">  652</span>    <a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#a310d6ebc20c42f055541025291337b57">rerouting_flag_</a> = <span class="keyword">true</span>; <span class="comment">// Set flag to trigger a route update by the route node due to the updated routing graph</span></div>
<div class="line"><a id="l00653" name="l00653"></a><span class="lineno">  653</span> </div>
<div class="line"><a id="l00654" name="l00654"></a><span class="lineno">  654</span>    <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00655" name="l00655"></a><span class="lineno">  655</span>  }</div>
<div class="line"><a id="l00656" name="l00656"></a><span class="lineno">  656</span>  <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00657" name="l00657"></a><span class="lineno">  657</span>    <a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#a310d6ebc20c42f055541025291337b57">rerouting_flag_</a> = <span class="keyword">false</span>; <span class="comment">// Reset flag since no applied queued map updates invalidated the route for the route node</span></div>
<div class="line"><a id="l00658" name="l00658"></a><span class="lineno">  658</span> </div>
<div class="line"><a id="l00659" name="l00659"></a><span class="lineno">  659</span>    <span class="keyword">auto</span> path = lanelet::ConstLanelets();</div>
<div class="line"><a id="l00660" name="l00660"></a><span class="lineno">  660</span>    <span class="keywordflow">for</span>(<span class="keyword">auto</span> <span class="keywordtype">id</span> : route_msg-&gt;shortest_path_lanelet_ids)</div>
<div class="line"><a id="l00661" name="l00661"></a><span class="lineno">  661</span>    {</div>
<div class="line"><a id="l00662" name="l00662"></a><span class="lineno">  662</span>      <span class="keyword">auto</span> ll = <a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#a4ea1ac169b8ba4a72dd72b4e8723257e">world_model_</a>-&gt;getMap()-&gt;laneletLayer.get(<span class="keywordtype">id</span>);</div>
<div class="line"><a id="l00663" name="l00663"></a><span class="lineno">  663</span>      path.push_back(ll);</div>
<div class="line"><a id="l00664" name="l00664"></a><span class="lineno">  664</span>    }</div>
<div class="line"><a id="l00665" name="l00665"></a><span class="lineno">  665</span> </div>
<div class="line"><a id="l00666" name="l00666"></a><span class="lineno">  666</span>    <span class="keyword">auto</span> route_opt = path.size() == 1 ? <a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#a4ea1ac169b8ba4a72dd72b4e8723257e">world_model_</a>-&gt;getMapRoutingGraph()-&gt;getRoute(path.front(), path.back())</div>
<div class="line"><a id="l00667" name="l00667"></a><span class="lineno">  667</span>                                : <a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#a4ea1ac169b8ba4a72dd72b4e8723257e">world_model_</a>-&gt;getMapRoutingGraph()-&gt;getRouteVia(path.front(), lanelet::ConstLanelets(path.begin() + 1, path.end() - 1), path.back());</div>
<div class="line"><a id="l00668" name="l00668"></a><span class="lineno">  668</span>    <span class="keywordflow">if</span>(route_opt.is_initialized()) {</div>
<div class="line"><a id="l00669" name="l00669"></a><span class="lineno">  669</span>      RCLCPP_DEBUG_STREAM(rclcpp::get_logger(<span class="stringliteral">&quot;carma_wm::WMListenerWorker&quot;</span>), <span class="stringliteral">&quot;Setting route in world model&quot;</span>);</div>
<div class="line"><a id="l00670" name="l00670"></a><span class="lineno">  670</span>      <span class="keyword">auto</span> ptr = std::make_shared&lt;lanelet::routing::Route&gt;(std::move(route_opt.get()));</div>
<div class="line"><a id="l00671" name="l00671"></a><span class="lineno">  671</span>      <a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#a4ea1ac169b8ba4a72dd72b4e8723257e">world_model_</a>-&gt;setRoute(ptr);</div>
<div class="line"><a id="l00672" name="l00672"></a><span class="lineno">  672</span>    }</div>
<div class="line"><a id="l00673" name="l00673"></a><span class="lineno">  673</span> </div>
<div class="line"><a id="l00674" name="l00674"></a><span class="lineno">  674</span>    <a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#a4ea1ac169b8ba4a72dd72b4e8723257e">world_model_</a>-&gt;setRouteEndPoint({route_msg-&gt;end_point.x,route_msg-&gt;end_point.y,route_msg-&gt;end_point.z});</div>
<div class="line"><a id="l00675" name="l00675"></a><span class="lineno">  675</span>    <a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#a4ea1ac169b8ba4a72dd72b4e8723257e">world_model_</a>-&gt;setRouteName(route_msg-&gt;route_name);</div>
<div class="line"><a id="l00676" name="l00676"></a><span class="lineno">  676</span> </div>
<div class="line"><a id="l00677" name="l00677"></a><span class="lineno">  677</span>    <span class="comment">// Call route_callback_</span></div>
<div class="line"><a id="l00678" name="l00678"></a><span class="lineno">  678</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#a8a81ac013a5e920b47e6c12d338446cc">route_callback_</a>)</div>
<div class="line"><a id="l00679" name="l00679"></a><span class="lineno">  679</span>    {</div>
<div class="line"><a id="l00680" name="l00680"></a><span class="lineno">  680</span>      <a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#a8a81ac013a5e920b47e6c12d338446cc">route_callback_</a>();</div>
<div class="line"><a id="l00681" name="l00681"></a><span class="lineno">  681</span>    }</div>
<div class="line"><a id="l00682" name="l00682"></a><span class="lineno">  682</span> </div>
<div class="line"><a id="l00683" name="l00683"></a><span class="lineno">  683</span>    <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00684" name="l00684"></a><span class="lineno">  684</span>  }</div>
<div class="line"><a id="l00685" name="l00685"></a><span class="lineno">  685</span>}</div>
<div class="line"><a id="l00686" name="l00686"></a><span class="lineno">  686</span> </div>
<div class="line"><a id="l00687" name="l00687"></a><span class="lineno"><a class="line" href="classcarma__wm_1_1WMListenerWorker.html#a6e8ee5810146dbad79df2a2424e8b2d7">  687</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classcarma__wm_1_1WMListenerWorker.html#a6e8ee5810146dbad79df2a2424e8b2d7">WMListenerWorker::setMapCallback</a>(std::function&lt;<span class="keywordtype">void</span>()&gt; <a class="code hl_function" href="helper_8cpp.html#ac0f7f7ec5375e47d4c681359431356b9">callback</a>)</div>
<div class="line"><a id="l00688" name="l00688"></a><span class="lineno">  688</span>{</div>
<div class="line"><a id="l00689" name="l00689"></a><span class="lineno">  689</span>  <a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#a3c2e638e8fdc934482ba9076a5ca7bb5">map_callback_</a> = <a class="code hl_function" href="helper_8cpp.html#ac0f7f7ec5375e47d4c681359431356b9">callback</a>;</div>
<div class="line"><a id="l00690" name="l00690"></a><span class="lineno">  690</span>}</div>
<div class="line"><a id="l00691" name="l00691"></a><span class="lineno">  691</span> </div>
<div class="line"><a id="l00692" name="l00692"></a><span class="lineno"><a class="line" href="classcarma__wm_1_1WMListenerWorker.html#a531f3557b64b85c4cd3a068ba7094a2d">  692</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classcarma__wm_1_1WMListenerWorker.html#a531f3557b64b85c4cd3a068ba7094a2d">WMListenerWorker::setRouteCallback</a>(std::function&lt;<span class="keywordtype">void</span>()&gt; <a class="code hl_function" href="helper_8cpp.html#ac0f7f7ec5375e47d4c681359431356b9">callback</a>)</div>
<div class="line"><a id="l00693" name="l00693"></a><span class="lineno">  693</span>{</div>
<div class="line"><a id="l00694" name="l00694"></a><span class="lineno">  694</span>  <a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#a8a81ac013a5e920b47e6c12d338446cc">route_callback_</a> = <a class="code hl_function" href="helper_8cpp.html#ac0f7f7ec5375e47d4c681359431356b9">callback</a>;</div>
<div class="line"><a id="l00695" name="l00695"></a><span class="lineno">  695</span>}</div>
<div class="line"><a id="l00696" name="l00696"></a><span class="lineno">  696</span> </div>
<div class="line"><a id="l00697" name="l00697"></a><span class="lineno"><a class="line" href="classcarma__wm_1_1WMListenerWorker.html#a32f22fd00a2f0fff3690d5f0b4ff2eb5">  697</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classcarma__wm_1_1WMListenerWorker.html#a32f22fd00a2f0fff3690d5f0b4ff2eb5">WMListenerWorker::setConfigSpeedLimit</a>(<span class="keywordtype">double</span> config_lim)</div>
<div class="line"><a id="l00698" name="l00698"></a><span class="lineno">  698</span>{</div>
<div class="line"><a id="l00699" name="l00699"></a><span class="lineno">  699</span>  <a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#a84466a412323d469f5a53bbd9fbcaf6d">config_speed_limit_</a> = config_lim;</div>
<div class="line"><a id="l00700" name="l00700"></a><span class="lineno">  700</span>  <span class="comment">//Function to load config_limit into CarmaWorldModel</span></div>
<div class="line"><a id="l00701" name="l00701"></a><span class="lineno">  701</span>   <a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#a4ea1ac169b8ba4a72dd72b4e8723257e">world_model_</a>-&gt;setConfigSpeedLimit(<a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#a84466a412323d469f5a53bbd9fbcaf6d">config_speed_limit_</a>);</div>
<div class="line"><a id="l00702" name="l00702"></a><span class="lineno">  702</span>}</div>
<div class="line"><a id="l00703" name="l00703"></a><span class="lineno">  703</span> </div>
<div class="line"><a id="l00704" name="l00704"></a><span class="lineno"><a class="line" href="classcarma__wm_1_1WMListenerWorker.html#aba49ce4302c5629cc030363e0f0d810d">  704</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classcarma__wm_1_1WMListenerWorker.html#aba49ce4302c5629cc030363e0f0d810d">WMListenerWorker::isUsingSimTime</a>(<span class="keywordtype">bool</span> use_sim_time)</div>
<div class="line"><a id="l00705" name="l00705"></a><span class="lineno">  705</span>{</div>
<div class="line"><a id="l00706" name="l00706"></a><span class="lineno">  706</span>  <a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#acab7ad4d3841c78cf96da2deec5c751b">use_sim_time_</a> = use_sim_time;</div>
<div class="line"><a id="l00707" name="l00707"></a><span class="lineno">  707</span>}</div>
<div class="line"><a id="l00708" name="l00708"></a><span class="lineno"><a class="line" href="classcarma__wm_1_1WMListenerWorker.html#a3e4cb967434a9e31251d3575087731bf">  708</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classcarma__wm_1_1WMListenerWorker.html#a3e4cb967434a9e31251d3575087731bf">WMListenerWorker::isSpatWallTime</a>(<span class="keywordtype">bool</span> is_spat_wall_time)</div>
<div class="line"><a id="l00709" name="l00709"></a><span class="lineno">  709</span>{</div>
<div class="line"><a id="l00710" name="l00710"></a><span class="lineno">  710</span>  <a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#a7c30c45e3da523c1ef5a0b279c164b4d">is_spat_wall_time_</a> = is_spat_wall_time;</div>
<div class="line"><a id="l00711" name="l00711"></a><span class="lineno">  711</span>}</div>
<div class="line"><a id="l00712" name="l00712"></a><span class="lineno">  712</span> </div>
<div class="line"><a id="l00713" name="l00713"></a><span class="lineno"><a class="line" href="classcarma__wm_1_1WMListenerWorker.html#a4a2d5eac51fade96787fe5056c357afa">  713</a></span><span class="keywordtype">double</span> <a class="code hl_function" href="classcarma__wm_1_1WMListenerWorker.html#a4a2d5eac51fade96787fe5056c357afa">WMListenerWorker::getConfigSpeedLimit</a>()<span class="keyword"> const</span></div>
<div class="line"><a id="l00714" name="l00714"></a><span class="lineno">  714</span><span class="keyword"></span>{</div>
<div class="line"><a id="l00715" name="l00715"></a><span class="lineno">  715</span>  <span class="keywordflow">return</span> <a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#a84466a412323d469f5a53bbd9fbcaf6d">config_speed_limit_</a>;</div>
<div class="line"><a id="l00716" name="l00716"></a><span class="lineno">  716</span>}</div>
<div class="line"><a id="l00717" name="l00717"></a><span class="lineno">  717</span> </div>
<div class="line"><a id="l00718" name="l00718"></a><span class="lineno"><a class="line" href="classcarma__wm_1_1WMListenerWorker.html#ae84a214a0c12c4ccc3bce45c17a97bf9">  718</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classcarma__wm_1_1WMListenerWorker.html#ae84a214a0c12c4ccc3bce45c17a97bf9">WMListenerWorker::setVehicleParticipationType</a>(std::string participant)</div>
<div class="line"><a id="l00719" name="l00719"></a><span class="lineno">  719</span>{</div>
<div class="line"><a id="l00720" name="l00720"></a><span class="lineno">  720</span>  <span class="comment">//Function to load participation type into CarmaWorldModel</span></div>
<div class="line"><a id="l00721" name="l00721"></a><span class="lineno">  721</span>  <a class="code hl_variable" href="classcarma__wm_1_1WMListenerWorker.html#a4ea1ac169b8ba4a72dd72b4e8723257e">world_model_</a>-&gt;setVehicleParticipationType(participant);</div>
<div class="line"><a id="l00722" name="l00722"></a><span class="lineno">  722</span>}</div>
<div class="line"><a id="l00723" name="l00723"></a><span class="lineno">  723</span> </div>
<div class="line"><a id="l00724" name="l00724"></a><span class="lineno">  724</span> </div>
<div class="line"><a id="l00725" name="l00725"></a><span class="lineno">  725</span>}  <span class="comment">// namespace carma_wm</span></div>
<div class="ttc" id="aWMListenerWorker_8hpp_html"><div class="ttname"><a href="WMListenerWorker_8hpp.html">WMListenerWorker.hpp</a></div></div>
<div class="ttc" id="aclasscarma__wm_1_1CARMAWorldModel_html"><div class="ttname"><a href="classcarma__wm_1_1CARMAWorldModel.html">carma_wm::CARMAWorldModel</a></div><div class="ttdoc">Class which implements the WorldModel interface. In addition this class provides write access to the ...</div><div class="ttdef"><b>Definition:</b> <a href="CARMAWorldModel_8hpp_source.html#l00048">CARMAWorldModel.hpp:49</a></div></div>
<div class="ttc" id="aclasscarma__wm_1_1SignalizedIntersectionManager_html"><div class="ttname"><a href="classcarma__wm_1_1SignalizedIntersectionManager.html">carma_wm::SignalizedIntersectionManager</a></div><div class="ttdoc">This class manages and keeps track of all signalized intersections in the map. All of the SPAT and MA...</div><div class="ttdef"><b>Definition:</b> <a href="SignalizedIntersectionManager_8hpp_source.html#l00052">SignalizedIntersectionManager.hpp:53</a></div></div>
<div class="ttc" id="aclasscarma__wm_1_1SignalizedIntersectionManager_html_a2902416a4c3948773e7692a1e5586502"><div class="ttname"><a href="classcarma__wm_1_1SignalizedIntersectionManager.html#a2902416a4c3948773e7692a1e5586502">carma_wm::SignalizedIntersectionManager::signal_group_to_entry_lanelet_ids_</a></div><div class="ttdeci">std::unordered_map&lt; uint8_t, std::unordered_set&lt; lanelet::Id &gt; &gt; signal_group_to_entry_lanelet_ids_</div><div class="ttdef"><b>Definition:</b> <a href="SignalizedIntersectionManager_8hpp_source.html#l00160">SignalizedIntersectionManager.hpp:160</a></div></div>
<div class="ttc" id="aclasscarma__wm_1_1SignalizedIntersectionManager_html_a561c5f21f1c07c80e13bdc3c29fa70fe"><div class="ttname"><a href="classcarma__wm_1_1SignalizedIntersectionManager.html#a561c5f21f1c07c80e13bdc3c29fa70fe">carma_wm::SignalizedIntersectionManager::intersection_id_to_regem_id_</a></div><div class="ttdeci">std::unordered_map&lt; uint16_t, lanelet::Id &gt; intersection_id_to_regem_id_</div><div class="ttdef"><b>Definition:</b> <a href="SignalizedIntersectionManager_8hpp_source.html#l00151">SignalizedIntersectionManager.hpp:151</a></div></div>
<div class="ttc" id="aclasscarma__wm_1_1SignalizedIntersectionManager_html_aad402f936d28448d19df5d6b6a718f52"><div class="ttname"><a href="classcarma__wm_1_1SignalizedIntersectionManager.html#aad402f936d28448d19df5d6b6a718f52">carma_wm::SignalizedIntersectionManager::signal_group_to_exit_lanelet_ids_</a></div><div class="ttdeci">std::unordered_map&lt; uint8_t, std::unordered_set&lt; lanelet::Id &gt; &gt; signal_group_to_exit_lanelet_ids_</div><div class="ttdef"><b>Definition:</b> <a href="SignalizedIntersectionManager_8hpp_source.html#l00157">SignalizedIntersectionManager.hpp:157</a></div></div>
<div class="ttc" id="aclasscarma__wm_1_1SignalizedIntersectionManager_html_ac6d373cd4a78ed384153d43836031b03"><div class="ttname"><a href="classcarma__wm_1_1SignalizedIntersectionManager.html#ac6d373cd4a78ed384153d43836031b03">carma_wm::SignalizedIntersectionManager::signal_group_to_traffic_light_id_</a></div><div class="ttdeci">std::unordered_map&lt; uint8_t, lanelet::Id &gt; signal_group_to_traffic_light_id_</div><div class="ttdef"><b>Definition:</b> <a href="SignalizedIntersectionManager_8hpp_source.html#l00154">SignalizedIntersectionManager.hpp:154</a></div></div>
<div class="ttc" id="aclasscarma__wm_1_1TrafficControl_html"><div class="ttname"><a href="classcarma__wm_1_1TrafficControl.html">carma_wm::TrafficControl</a></div><div class="ttdef"><b>Definition:</b> <a href="TrafficControl_8hpp_source.html#l00049">TrafficControl.hpp:50</a></div></div>
<div class="ttc" id="aclasscarma__wm_1_1WMListenerWorker_html_a295aefa7073627e0c645ab19ec123a73"><div class="ttname"><a href="classcarma__wm_1_1WMListenerWorker.html#a295aefa7073627e0c645ab19ec123a73">carma_wm::WMListenerWorker::delayed_route_msg_</a></div><div class="ttdeci">boost::optional&lt; carma_planning_msgs::msg::Route &gt; delayed_route_msg_</div><div class="ttdef"><b>Definition:</b> <a href="WMListenerWorker_8hpp_source.html#l00170">WMListenerWorker.hpp:170</a></div></div>
<div class="ttc" id="aclasscarma__wm_1_1WMListenerWorker_html_a310d6ebc20c42f055541025291337b57"><div class="ttname"><a href="classcarma__wm_1_1WMListenerWorker.html#a310d6ebc20c42f055541025291337b57">carma_wm::WMListenerWorker::rerouting_flag_</a></div><div class="ttdeci">bool rerouting_flag_</div><div class="ttdef"><b>Definition:</b> <a href="WMListenerWorker_8hpp_source.html#l00173">WMListenerWorker.hpp:173</a></div></div>
<div class="ttc" id="aclasscarma__wm_1_1WMListenerWorker_html_a32f22fd00a2f0fff3690d5f0b4ff2eb5"><div class="ttname"><a href="classcarma__wm_1_1WMListenerWorker.html#a32f22fd00a2f0fff3690d5f0b4ff2eb5">carma_wm::WMListenerWorker::setConfigSpeedLimit</a></div><div class="ttdeci">void setConfigSpeedLimit(double config_lim)</div><div class="ttdoc">Allows user to set a callback to be triggered when a map update is received.</div><div class="ttdef"><b>Definition:</b> <a href="WMListenerWorker_8cpp_source.html#l00697">WMListenerWorker.cpp:697</a></div></div>
<div class="ttc" id="aclasscarma__wm_1_1WMListenerWorker_html_a39cbf05af713a84fb396c36da3551df5"><div class="ttname"><a href="classcarma__wm_1_1WMListenerWorker.html#a39cbf05af713a84fb396c36da3551df5">carma_wm::WMListenerWorker::route_node_flag_</a></div><div class="ttdeci">bool route_node_flag_</div><div class="ttdef"><b>Definition:</b> <a href="WMListenerWorker_8hpp_source.html#l00174">WMListenerWorker.hpp:174</a></div></div>
<div class="ttc" id="aclasscarma__wm_1_1WMListenerWorker_html_a3c2e638e8fdc934482ba9076a5ca7bb5"><div class="ttname"><a href="classcarma__wm_1_1WMListenerWorker.html#a3c2e638e8fdc934482ba9076a5ca7bb5">carma_wm::WMListenerWorker::map_callback_</a></div><div class="ttdeci">std::function&lt; void()&gt; map_callback_</div><div class="ttdef"><b>Definition:</b> <a href="WMListenerWorker_8hpp_source.html#l00163">WMListenerWorker.hpp:163</a></div></div>
<div class="ttc" id="aclasscarma__wm_1_1WMListenerWorker_html_a3e4cb967434a9e31251d3575087731bf"><div class="ttname"><a href="classcarma__wm_1_1WMListenerWorker.html#a3e4cb967434a9e31251d3575087731bf">carma_wm::WMListenerWorker::isSpatWallTime</a></div><div class="ttdeci">void isSpatWallTime(bool is_spat_wall_time)</div><div class="ttdoc">set true if incoming spat is based on wall clock</div><div class="ttdef"><b>Definition:</b> <a href="WMListenerWorker_8cpp_source.html#l00708">WMListenerWorker.cpp:708</a></div></div>
<div class="ttc" id="aclasscarma__wm_1_1WMListenerWorker_html_a44154428b921244d04d4678ed61c81d8"><div class="ttname"><a href="classcarma__wm_1_1WMListenerWorker.html#a44154428b921244d04d4678ed61c81d8">carma_wm::WMListenerWorker::mapUpdateCallback</a></div><div class="ttdeci">void mapUpdateCallback(autoware_lanelet2_msgs::msg::MapBin::SharedPtr geofence_msg)</div><div class="ttdoc">Callback for new map update messages (geofence). Updates the underlying map.</div><div class="ttdef"><b>Definition:</b> <a href="WMListenerWorker_8cpp_source.html#l00147">WMListenerWorker.cpp:147</a></div></div>
<div class="ttc" id="aclasscarma__wm_1_1WMListenerWorker_html_a4a2d5eac51fade96787fe5056c357afa"><div class="ttname"><a href="classcarma__wm_1_1WMListenerWorker.html#a4a2d5eac51fade96787fe5056c357afa">carma_wm::WMListenerWorker::getConfigSpeedLimit</a></div><div class="ttdeci">double getConfigSpeedLimit() const</div><div class="ttdoc">Returns the current configured speed limit value.</div><div class="ttdef"><b>Definition:</b> <a href="WMListenerWorker_8cpp_source.html#l00713">WMListenerWorker.cpp:713</a></div></div>
<div class="ttc" id="aclasscarma__wm_1_1WMListenerWorker_html_a4c2fcc147efbee76b18ad285f0555d2c"><div class="ttname"><a href="classcarma__wm_1_1WMListenerWorker.html#a4c2fcc147efbee76b18ad285f0555d2c">carma_wm::WMListenerWorker::enableUpdatesWithoutRoute</a></div><div class="ttdeci">void enableUpdatesWithoutRoute()</div><div class="ttdoc">Enable updates without route and set route_node_flag_ as true.</div><div class="ttdef"><b>Definition:</b> <a href="WMListenerWorker_8cpp_source.html#l00114">WMListenerWorker.cpp:114</a></div></div>
<div class="ttc" id="aclasscarma__wm_1_1WMListenerWorker_html_a4ea1ac169b8ba4a72dd72b4e8723257e"><div class="ttname"><a href="classcarma__wm_1_1WMListenerWorker.html#a4ea1ac169b8ba4a72dd72b4e8723257e">carma_wm::WMListenerWorker::world_model_</a></div><div class="ttdeci">std::shared_ptr&lt; CARMAWorldModel &gt; world_model_</div><div class="ttdef"><b>Definition:</b> <a href="WMListenerWorker_8hpp_source.html#l00160">WMListenerWorker.hpp:160</a></div></div>
<div class="ttc" id="aclasscarma__wm_1_1WMListenerWorker_html_a531f3557b64b85c4cd3a068ba7094a2d"><div class="ttname"><a href="classcarma__wm_1_1WMListenerWorker.html#a531f3557b64b85c4cd3a068ba7094a2d">carma_wm::WMListenerWorker::setRouteCallback</a></div><div class="ttdeci">void setRouteCallback(std::function&lt; void()&gt; callback)</div><div class="ttdoc">Allows user to set a callback to be triggered when a route update is received.</div><div class="ttdef"><b>Definition:</b> <a href="WMListenerWorker_8cpp_source.html#l00692">WMListenerWorker.cpp:692</a></div></div>
<div class="ttc" id="aclasscarma__wm_1_1WMListenerWorker_html_a5cffb02708d8e8421ad56c4e7dd21b81"><div class="ttname"><a href="classcarma__wm_1_1WMListenerWorker.html#a5cffb02708d8e8421ad56c4e7dd21b81">carma_wm::WMListenerWorker::newRegemUpdateHelper</a></div><div class="ttdeci">void newRegemUpdateHelper(lanelet::Lanelet parent_llt, lanelet::RegulatoryElement *regem) const</div><div class="ttdoc">This is a helper function updates the parent_llt with specified regem. This function is needed as we ...</div><div class="ttdef"><b>Definition:</b> <a href="WMListenerWorker_8cpp_source.html#l00322">WMListenerWorker.cpp:322</a></div></div>
<div class="ttc" id="aclasscarma__wm_1_1WMListenerWorker_html_a614654b7b374ed1d24537e347d49389f"><div class="ttname"><a href="classcarma__wm_1_1WMListenerWorker.html#a614654b7b374ed1d24537e347d49389f">carma_wm::WMListenerWorker::routingGraphFromMsg</a></div><div class="ttdeci">LaneletRoutingGraphPtr routingGraphFromMsg(const autoware_lanelet2_msgs::msg::RoutingGraph &amp;msg, lanelet::LaneletMapPtr map) const</div><div class="ttdoc">Helper function to convert a routing graph message into a actual RoutingGraph object.</div><div class="ttdef"><b>Definition:</b> <a href="WMListenerWorker_8cpp_source.html#l00449">WMListenerWorker.cpp:449</a></div></div>
<div class="ttc" id="aclasscarma__wm_1_1WMListenerWorker_html_a64f55af7e8146c0119b7f603a27629e4"><div class="ttname"><a href="classcarma__wm_1_1WMListenerWorker.html#a64f55af7e8146c0119b7f603a27629e4">carma_wm::WMListenerWorker::routeCallback</a></div><div class="ttdeci">void routeCallback(const carma_planning_msgs::msg::Route::SharedPtr route_msg)</div><div class="ttdoc">Callback for route message.</div><div class="ttdef"><b>Definition:</b> <a href="WMListenerWorker_8cpp_source.html#l00589">WMListenerWorker.cpp:589</a></div></div>
<div class="ttc" id="aclasscarma__wm_1_1WMListenerWorker_html_a6e8ee5810146dbad79df2a2424e8b2d7"><div class="ttname"><a href="classcarma__wm_1_1WMListenerWorker.html#a6e8ee5810146dbad79df2a2424e8b2d7">carma_wm::WMListenerWorker::setMapCallback</a></div><div class="ttdeci">void setMapCallback(std::function&lt; void()&gt; callback)</div><div class="ttdoc">Allows user to set a callback to be triggered when a map update is received.</div><div class="ttdef"><b>Definition:</b> <a href="WMListenerWorker_8cpp_source.html#l00687">WMListenerWorker.cpp:687</a></div></div>
<div class="ttc" id="aclasscarma__wm_1_1WMListenerWorker_html_a75d47a05771e1d53c0c8f516e290d4a2"><div class="ttname"><a href="classcarma__wm_1_1WMListenerWorker.html#a75d47a05771e1d53c0c8f516e290d4a2">carma_wm::WMListenerWorker::checkIfReRoutingNeeded</a></div><div class="ttdeci">bool checkIfReRoutingNeeded() const</div><div class="ttdoc">Check if re-routing is needed and returns re-routing flag.</div><div class="ttdef"><b>Definition:</b> <a href="WMListenerWorker_8cpp_source.html#l00109">WMListenerWorker.cpp:109</a></div></div>
<div class="ttc" id="aclasscarma__wm_1_1WMListenerWorker_html_a7a740a64aa1b677acf1d16373c43a65c"><div class="ttname"><a href="classcarma__wm_1_1WMListenerWorker.html#a7a740a64aa1b677acf1d16373c43a65c">carma_wm::WMListenerWorker::incomingSpatCallback</a></div><div class="ttdeci">void incomingSpatCallback(const carma_v2x_msgs::msg::SPAT::SharedPtr spat_msg)</div><div class="ttdoc">incoming spat message</div><div class="ttdef"><b>Definition:</b> <a href="WMListenerWorker_8cpp_source.html#l00104">WMListenerWorker.cpp:104</a></div></div>
<div class="ttc" id="aclasscarma__wm_1_1WMListenerWorker_html_a7c30c45e3da523c1ef5a0b279c164b4d"><div class="ttname"><a href="classcarma__wm_1_1WMListenerWorker.html#a7c30c45e3da523c1ef5a0b279c164b4d">carma_wm::WMListenerWorker::is_spat_wall_time_</a></div><div class="ttdeci">bool is_spat_wall_time_</div><div class="ttdef"><b>Definition:</b> <a href="WMListenerWorker_8hpp_source.html#l00162">WMListenerWorker.hpp:162</a></div></div>
<div class="ttc" id="aclasscarma__wm_1_1WMListenerWorker_html_a837ecb3086f6f25bd2768ce2bb5d2a81"><div class="ttname"><a href="classcarma__wm_1_1WMListenerWorker.html#a837ecb3086f6f25bd2768ce2bb5d2a81">carma_wm::WMListenerWorker::roadwayObjectListCallback</a></div><div class="ttdeci">void roadwayObjectListCallback(const carma_perception_msgs::msg::RoadwayObstacleList::SharedPtr msg)</div><div class="ttdoc">Callback for roadway objects msg.</div><div class="ttdef"><b>Definition:</b> <a href="WMListenerWorker_8cpp_source.html#l00573">WMListenerWorker.cpp:573</a></div></div>
<div class="ttc" id="aclasscarma__wm_1_1WMListenerWorker_html_a84466a412323d469f5a53bbd9fbcaf6d"><div class="ttname"><a href="classcarma__wm_1_1WMListenerWorker.html#a84466a412323d469f5a53bbd9fbcaf6d">carma_wm::WMListenerWorker::config_speed_limit_</a></div><div class="ttdeci">double config_speed_limit_</div><div class="ttdef"><b>Definition:</b> <a href="WMListenerWorker_8hpp_source.html#l00166">WMListenerWorker.hpp:166</a></div></div>
<div class="ttc" id="aclasscarma__wm_1_1WMListenerWorker_html_a8a81ac013a5e920b47e6c12d338446cc"><div class="ttname"><a href="classcarma__wm_1_1WMListenerWorker.html#a8a81ac013a5e920b47e6c12d338446cc">carma_wm::WMListenerWorker::route_callback_</a></div><div class="ttdeci">std::function&lt; void()&gt; route_callback_</div><div class="ttdef"><b>Definition:</b> <a href="WMListenerWorker_8hpp_source.html#l00164">WMListenerWorker.hpp:164</a></div></div>
<div class="ttc" id="aclasscarma__wm_1_1WMListenerWorker_html_a8e15579129fdb4096b4a1540d007b07e"><div class="ttname"><a href="classcarma__wm_1_1WMListenerWorker.html#a8e15579129fdb4096b4a1540d007b07e">carma_wm::WMListenerWorker::mapCallback</a></div><div class="ttdeci">void mapCallback(const autoware_lanelet2_msgs::msg::MapBin::SharedPtr map_msg)</div><div class="ttdoc">Callback for new map messages. Updates the underlying map.</div><div class="ttdef"><b>Definition:</b> <a href="WMListenerWorker_8cpp_source.html#l00056">WMListenerWorker.cpp:56</a></div></div>
<div class="ttc" id="aclasscarma__wm_1_1WMListenerWorker_html_a9ce452d5bee1efa560ad66713c306a66"><div class="ttname"><a href="classcarma__wm_1_1WMListenerWorker.html#a9ce452d5bee1efa560ad66713c306a66">carma_wm::WMListenerWorker::simClockCallback</a></div><div class="ttdeci">void simClockCallback(const rosgraph_msgs::msg::Clock::SharedPtr clock_msg)</div><div class="ttdoc">Callback for Simulation clock message (used in Simulation runs)</div><div class="ttdef"><b>Definition:</b> <a href="WMListenerWorker_8cpp_source.html#l00584">WMListenerWorker.cpp:584</a></div></div>
<div class="ttc" id="aclasscarma__wm_1_1WMListenerWorker_html_aae0b14b4566a06ba1c99e46e79de0fba"><div class="ttname"><a href="classcarma__wm_1_1WMListenerWorker.html#aae0b14b4566a06ba1c99e46e79de0fba">carma_wm::WMListenerWorker::current_map_version_</a></div><div class="ttdeci">size_t current_map_version_</div><div class="ttdef"><b>Definition:</b> <a href="WMListenerWorker_8hpp_source.html#l00168">WMListenerWorker.hpp:168</a></div></div>
<div class="ttc" id="aclasscarma__wm_1_1WMListenerWorker_html_aba49ce4302c5629cc030363e0f0d810d"><div class="ttname"><a href="classcarma__wm_1_1WMListenerWorker.html#aba49ce4302c5629cc030363e0f0d810d">carma_wm::WMListenerWorker::isUsingSimTime</a></div><div class="ttdeci">void isUsingSimTime(bool use_sim_time)</div><div class="ttdoc">set true if simulation_mode is on</div><div class="ttdef"><b>Definition:</b> <a href="WMListenerWorker_8cpp_source.html#l00704">WMListenerWorker.cpp:704</a></div></div>
<div class="ttc" id="aclasscarma__wm_1_1WMListenerWorker_html_ac0c115081f19ec29b215e6edeb110d4c"><div class="ttname"><a href="classcarma__wm_1_1WMListenerWorker.html#ac0c115081f19ec29b215e6edeb110d4c">carma_wm::WMListenerWorker::getVehicleParticipationType</a></div><div class="ttdeci">std::string getVehicleParticipationType() const</div><div class="ttdoc">Returns the Vehicle Participation Type value.</div><div class="ttdef"><b>Definition:</b> <a href="WMListenerWorker_8cpp_source.html#l00568">WMListenerWorker.cpp:568</a></div></div>
<div class="ttc" id="aclasscarma__wm_1_1WMListenerWorker_html_acab7ad4d3841c78cf96da2deec5c751b"><div class="ttname"><a href="classcarma__wm_1_1WMListenerWorker.html#acab7ad4d3841c78cf96da2deec5c751b">carma_wm::WMListenerWorker::use_sim_time_</a></div><div class="ttdeci">bool use_sim_time_</div><div class="ttdef"><b>Definition:</b> <a href="WMListenerWorker_8hpp_source.html#l00161">WMListenerWorker.hpp:161</a></div></div>
<div class="ttc" id="aclasscarma__wm_1_1WMListenerWorker_html_acae1ff63ff0f396de4e3f1bb9ab492bb"><div class="ttname"><a href="classcarma__wm_1_1WMListenerWorker.html#acae1ff63ff0f396de4e3f1bb9ab492bb">carma_wm::WMListenerWorker::recompute_route_flag_</a></div><div class="ttdeci">bool recompute_route_flag_</div><div class="ttdef"><b>Definition:</b> <a href="WMListenerWorker_8hpp_source.html#l00172">WMListenerWorker.hpp:172</a></div></div>
<div class="ttc" id="aclasscarma__wm_1_1WMListenerWorker_html_ad46406f4874729f47b079b52f4ebb213"><div class="ttname"><a href="classcarma__wm_1_1WMListenerWorker.html#ad46406f4874729f47b079b52f4ebb213">carma_wm::WMListenerWorker::getWorldModel</a></div><div class="ttdeci">WorldModelConstPtr getWorldModel() const</div><div class="ttdoc">Constructor.</div><div class="ttdef"><b>Definition:</b> <a href="WMListenerWorker_8cpp_source.html#l00050">WMListenerWorker.cpp:50</a></div></div>
<div class="ttc" id="aclasscarma__wm_1_1WMListenerWorker_html_ada3e493ebddb3bcb7596c2af2a3a14d6"><div class="ttname"><a href="classcarma__wm_1_1WMListenerWorker.html#ada3e493ebddb3bcb7596c2af2a3a14d6">carma_wm::WMListenerWorker::ros1ClockCallback</a></div><div class="ttdeci">void ros1ClockCallback(const rosgraph_msgs::msg::Clock::SharedPtr clock_msg)</div><div class="ttdoc">Callback for ROS1 clock message (used in Simulation runs)</div><div class="ttdef"><b>Definition:</b> <a href="WMListenerWorker_8cpp_source.html#l00579">WMListenerWorker.cpp:579</a></div></div>
<div class="ttc" id="aclasscarma__wm_1_1WMListenerWorker_html_ae5106bd418dff1ee316864d929c02c93"><div class="ttname"><a href="classcarma__wm_1_1WMListenerWorker.html#ae5106bd418dff1ee316864d929c02c93">carma_wm::WMListenerWorker::map_update_queue_</a></div><div class="ttdeci">std::queue&lt; autoware_lanelet2_msgs::msg::MapBin::SharedPtr &gt; map_update_queue_</div><div class="ttdef"><b>Definition:</b> <a href="WMListenerWorker_8hpp_source.html#l00169">WMListenerWorker.hpp:169</a></div></div>
<div class="ttc" id="aclasscarma__wm_1_1WMListenerWorker_html_ae5b964291859114c54b1f726d8cdeda2"><div class="ttname"><a href="classcarma__wm_1_1WMListenerWorker.html#ae5b964291859114c54b1f726d8cdeda2">carma_wm::WMListenerWorker::WMListenerWorker</a></div><div class="ttdeci">WMListenerWorker()</div><div class="ttdoc">Constructor.</div><div class="ttdef"><b>Definition:</b> <a href="WMListenerWorker_8cpp_source.html#l00045">WMListenerWorker.cpp:45</a></div></div>
<div class="ttc" id="aclasscarma__wm_1_1WMListenerWorker_html_ae838d10e2677708b7b86c13fbb62d452"><div class="ttname"><a href="classcarma__wm_1_1WMListenerWorker.html#ae838d10e2677708b7b86c13fbb62d452">carma_wm::WMListenerWorker::most_recent_update_msg_seq_</a></div><div class="ttdeci">long most_recent_update_msg_seq_</div><div class="ttdef"><b>Definition:</b> <a href="WMListenerWorker_8hpp_source.html#l00175">WMListenerWorker.hpp:175</a></div></div>
<div class="ttc" id="aclasscarma__wm_1_1WMListenerWorker_html_ae84a214a0c12c4ccc3bce45c17a97bf9"><div class="ttname"><a href="classcarma__wm_1_1WMListenerWorker.html#ae84a214a0c12c4ccc3bce45c17a97bf9">carma_wm::WMListenerWorker::setVehicleParticipationType</a></div><div class="ttdeci">void setVehicleParticipationType(std::string participant)</div><div class="ttdoc">Allows user to set a callback to be triggered when a map update is received.</div><div class="ttdef"><b>Definition:</b> <a href="WMListenerWorker_8cpp_source.html#l00718">WMListenerWorker.cpp:718</a></div></div>
<div class="ttc" id="ahelper_8cpp_html_ac0f7f7ec5375e47d4c681359431356b9"><div class="ttname"><a href="helper_8cpp.html#ac0f7f7ec5375e47d4c681359431356b9">callback</a></div><div class="ttdeci">bool callback(cav_srvs::PlanTrajectory::Request &amp;req, cav_srvs::PlanTrajectory::Response &amp;res)</div><div class="ttdef"><b>Definition:</b> <a href="helper_8cpp_source.html#l00021">helper.cpp:21</a></div></div>
<div class="ttc" id="anamespacecarma__wm_html"><div class="ttname"><a href="namespacecarma__wm.html">carma_wm</a></div><div class="ttdef"><b>Definition:</b> <a href="CARMAWorldModel_8hpp_source.html#l00036">CARMAWorldModel.hpp:37</a></div></div>
<div class="ttc" id="anamespacecarma__wm_html_a23411d3d299da623ec379efbc1a5b14a"><div class="ttname"><a href="namespacecarma__wm.html#a23411d3d299da623ec379efbc1a5b14a">carma_wm::LaneletRoutingGraphPtr</a></div><div class="ttdeci">std::shared_ptr&lt; lanelet::routing::RoutingGraph &gt; LaneletRoutingGraphPtr</div><div class="ttdef"><b>Definition:</b> <a href="WorldModel_8hpp_source.html#l00050">WorldModel.hpp:50</a></div></div>
<div class="ttc" id="anamespacecarma__wm_html_a3ac653959e0b6198cae274d68b343228"><div class="ttname"><a href="namespacecarma__wm.html#a3ac653959e0b6198cae274d68b343228">carma_wm::WorldModelConstPtr</a></div><div class="ttdeci">std::shared_ptr&lt; const WorldModel &gt; WorldModelConstPtr</div><div class="ttdef"><b>Definition:</b> <a href="WorldModel_8hpp_source.html#l00442">WorldModel.hpp:442</a></div></div>
<div class="ttc" id="anamespacecarma__wm_html_a3c6c82d3e0fcfc7dd50176a453598911"><div class="ttname"><a href="namespacecarma__wm.html#a3c6c82d3e0fcfc7dd50176a453598911">carma_wm::fromBinMsg</a></div><div class="ttdeci">void fromBinMsg(const autoware_lanelet2_msgs::msg::MapBin &amp;msg, std::shared_ptr&lt; carma_wm::TrafficControl &gt; gf_ptr, lanelet::LaneletMapPtr lanelet_map=nullptr)</div><div class="ttdef"><b>Definition:</b> <a href="TrafficControl_8cpp_source.html#l00040">TrafficControl.cpp:40</a></div></div>
<div class="ttc" id="anamespacecarma__wm_html_a4c3b7aaa05aea0c95189c98c5d902cf8"><div class="ttname"><a href="namespacecarma__wm.html#a4c3b7aaa05aea0c95189c98c5d902cf8">carma_wm::resolveGeofenceType</a></div><div class="ttdeci">GeofenceType resolveGeofenceType(const std::string &amp;rule_name)</div><div class="ttdef"><b>Definition:</b> <a href="WMListenerWorker_8cpp_source.html#l00031">WMListenerWorker.cpp:31</a></div></div>
<div class="ttc" id="anamespacecarma__wm_html_aae8a9e16b161a8edf05ca9df4307a5ec"><div class="ttname"><a href="namespacecarma__wm.html#aae8a9e16b161a8edf05ca9df4307a5ec">carma_wm::logSignalizedIntersectionManager</a></div><div class="ttdeci">void logSignalizedIntersectionManager(const carma_wm::SignalizedIntersectionManager &amp;sim)</div><div class="ttdef"><b>Definition:</b> <a href="WMListenerWorker_8cpp_source.html#l00120">WMListenerWorker.cpp:120</a></div></div>
<div class="ttc" id="anamespacecarma__wm_html_ac09d7a77e6f8f955651e7afa16136bf1"><div class="ttname"><a href="namespacecarma__wm.html#ac09d7a77e6f8f955651e7afa16136bf1">carma_wm::GeofenceType</a></div><div class="ttdeci">GeofenceType</div><div class="ttdef"><b>Definition:</b> <a href="WMListenerWorker_8cpp_source.html#l00028">WMListenerWorker.cpp:28</a></div></div>
<div class="ttc" id="anamespacecarma__wm_html_ac09d7a77e6f8f955651e7afa16136bf1a0acb40e631b1fdde545715ce5080ce82"><div class="ttname"><a href="namespacecarma__wm.html#ac09d7a77e6f8f955651e7afa16136bf1a0acb40e631b1fdde545715ce5080ce82">carma_wm::GeofenceType::PASSING_CONTROL_LINE</a></div><div class="ttdeci">@ PASSING_CONTROL_LINE</div></div>
<div class="ttc" id="anamespacecarma__wm_html_ac09d7a77e6f8f955651e7afa16136bf1a165080307b64c43de1a0939d3bf047ae"><div class="ttname"><a href="namespacecarma__wm.html#ac09d7a77e6f8f955651e7afa16136bf1a165080307b64c43de1a0939d3bf047ae">carma_wm::GeofenceType::DIRECTION_OF_TRAVEL</a></div><div class="ttdeci">@ DIRECTION_OF_TRAVEL</div></div>
<div class="ttc" id="anamespacecarma__wm_html_ac09d7a77e6f8f955651e7afa16136bf1a269b80a3c3f0b44a73071e21d4ab36c2"><div class="ttname"><a href="namespacecarma__wm.html#ac09d7a77e6f8f955651e7afa16136bf1a269b80a3c3f0b44a73071e21d4ab36c2">carma_wm::GeofenceType::CARMA_TRAFFIC_LIGHT</a></div><div class="ttdeci">@ CARMA_TRAFFIC_LIGHT</div></div>
<div class="ttc" id="anamespacecarma__wm_html_ac09d7a77e6f8f955651e7afa16136bf1a3342d8a1648c3c7b49348bdebb6a67d8"><div class="ttname"><a href="namespacecarma__wm.html#ac09d7a77e6f8f955651e7afa16136bf1a3342d8a1648c3c7b49348bdebb6a67d8">carma_wm::GeofenceType::REGION_ACCESS_RULE</a></div><div class="ttdeci">@ REGION_ACCESS_RULE</div></div>
<div class="ttc" id="anamespacecarma__wm_html_ac09d7a77e6f8f955651e7afa16136bf1a3ef9e3ed7808c7c32a48e954fad71c04"><div class="ttname"><a href="namespacecarma__wm.html#ac09d7a77e6f8f955651e7afa16136bf1a3ef9e3ed7808c7c32a48e954fad71c04">carma_wm::GeofenceType::STOP_RULE</a></div><div class="ttdeci">@ STOP_RULE</div></div>
<div class="ttc" id="anamespacecarma__wm_html_ac09d7a77e6f8f955651e7afa16136bf1a5183fcbc60f37b81f9ca22d76af71867"><div class="ttname"><a href="namespacecarma__wm.html#ac09d7a77e6f8f955651e7afa16136bf1a5183fcbc60f37b81f9ca22d76af71867">carma_wm::GeofenceType::SIGNALIZED_INTERSECTION</a></div><div class="ttdeci">@ SIGNALIZED_INTERSECTION</div></div>
<div class="ttc" id="anamespacecarma__wm_html_ac09d7a77e6f8f955651e7afa16136bf1a56a6787427d0254f508836bebdea7700"><div class="ttname"><a href="namespacecarma__wm.html#ac09d7a77e6f8f955651e7afa16136bf1a56a6787427d0254f508836bebdea7700">carma_wm::GeofenceType::DIGITAL_SPEED_LIMIT</a></div><div class="ttdeci">@ DIGITAL_SPEED_LIMIT</div></div>
<div class="ttc" id="anamespacecarma__wm_html_ac09d7a77e6f8f955651e7afa16136bf1a72fb3f0a086a3e9014953c51396b9f63"><div class="ttname"><a href="namespacecarma__wm.html#ac09d7a77e6f8f955651e7afa16136bf1a72fb3f0a086a3e9014953c51396b9f63">carma_wm::GeofenceType::DIGITAL_MINIMUM_GAP</a></div><div class="ttdeci">@ DIGITAL_MINIMUM_GAP</div></div>
<div class="ttc" id="anamespacecarma__wm_html_ac09d7a77e6f8f955651e7afa16136bf1accc0377a8afbf50e7094f5c23a8af223"><div class="ttname"><a href="namespacecarma__wm.html#ac09d7a77e6f8f955651e7afa16136bf1accc0377a8afbf50e7094f5c23a8af223">carma_wm::GeofenceType::INVALID</a></div><div class="ttdeci">@ INVALID</div></div>
<div class="ttc" id="anamespacelanelet_html"><div class="ttname"><a href="namespacelanelet.html">lanelet</a></div><div class="ttdef"><b>Definition:</b> <a href="MapConformer_8hpp_source.html#l00038">MapConformer.hpp:39</a></div></div>
<div class="ttc" id="anamespaceprocess__bag_html_af102a02c97622dd30b0dbf7bafb0d199"><div class="ttname"><a href="namespaceprocess__bag.html#af102a02c97622dd30b0dbf7bafb0d199">process_bag.i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="process__bag_8py_source.html#l00059">process_bag.py:59</a></div></div>
<div class="ttc" id="anamespacesci__strategic__plugin_html_a566a001705be58d1fa9b8b13ba6e3677a0614364ce8a300e7a392919c4753d8a8"><div class="ttname"><a href="namespacesci__strategic__plugin.html#a566a001705be58d1fa9b8b13ba6e3677a0614364ce8a300e7a392919c4753d8a8">sci_strategic_plugin::Left</a></div><div class="ttdeci">@ Left</div><div class="ttdef"><b>Definition:</b> <a href="sci__strategic__plugin_8hpp_source.html#l00046">sci_strategic_plugin.hpp:45</a></div></div>
<div class="ttc" id="anamespacesci__strategic__plugin_html_a566a001705be58d1fa9b8b13ba6e3677ae56f9187e18e7976a4565df987d0962e"><div class="ttname"><a href="namespacesci__strategic__plugin.html#a566a001705be58d1fa9b8b13ba6e3677ae56f9187e18e7976a4565df987d0962e">sci_strategic_plugin::Right</a></div><div class="ttdeci">@ Right</div><div class="ttdef"><b>Definition:</b> <a href="sci__strategic__plugin_8hpp_source.html#l00044">sci_strategic_plugin.hpp:44</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_063394ac95ddab6826ca68be56e39eae.html">carma_wm</a></li><li class="navelem"><a class="el" href="dir_bed7bb81c6bc1fae1bac689cbf6acc02.html">src</a></li><li class="navelem"><a class="el" href="WMListenerWorker_8cpp.html">WMListenerWorker.cpp</a></li>
    <li class="footer">Generated on Thu May 9 2024 21:46:56 for Carma-platform by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.4 </li>
  </ul>
</div>
</body>
</html>
