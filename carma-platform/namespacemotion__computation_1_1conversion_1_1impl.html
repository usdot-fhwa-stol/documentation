<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Carma-platform: motion_computation::conversion::impl Namespace Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Carma-platform<span id="projectnumber">&#160;v4.2.0</span>
   </div>
   <div id="projectbrief">CARMA Platform is built on robot operating system (ROS) and utilizes open source software (OSS) that enables Cooperative Driving Automation (CDA) features to allow Automated Driving Systems to interact and cooperate with infrastructure and other vehicles through communication.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('namespacemotion__computation_1_1conversion_1_1impl.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">motion_computation::conversion::impl Namespace Reference</div></div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:abb4c108e6903a12b1dff436ef0e6d825"><td class="memItemLeft" align="right" valign="top">std::pair&lt; carma_perception_msgs::msg::PredictedState, double &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemotion__computation_1_1conversion_1_1impl.html#abb4c108e6903a12b1dff436ef0e6d825">composePredictedState</a> (const tf2::Vector3 &amp;curr_pt, const tf2::Vector3 &amp;prev_pt, const rclcpp::Time &amp;prev_time_stamp, const rclcpp::Time &amp;curr_time_stamp, double prev_yaw)</td></tr>
<tr class="memdesc:abb4c108e6903a12b1dff436ef0e6d825"><td class="mdescLeft">&#160;</td><td class="mdescRight">Composes a PredictedState message form a provided current point and previous point. It calculates the speed from these points using mobility_path_time_step.  <a href="namespacemotion__computation_1_1conversion_1_1impl.html#abb4c108e6903a12b1dff436ef0e6d825">More...</a><br /></td></tr>
<tr class="separator:abb4c108e6903a12b1dff436ef0e6d825"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa87a85102ac70d15b834d6e1cd3d9429"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemotion__computation_1_1conversion_1_1impl.html#aa87a85102ac70d15b834d6e1cd3d9429">calculateAngVelocityOfPredictedStates</a> (carma_perception_msgs::msg::ExternalObject &amp;object)</td></tr>
<tr class="memdesc:aa87a85102ac70d15b834d6e1cd3d9429"><td class="mdescLeft">&#160;</td><td class="mdescRight">Helper function to fill in the angular velocity of the external object.  <a href="namespacemotion__computation_1_1conversion_1_1impl.html#aa87a85102ac70d15b834d6e1cd3d9429">More...</a><br /></td></tr>
<tr class="separator:aa87a85102ac70d15b834d6e1cd3d9429"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3dcbeb3180ab008815e6e7749796d147"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemotion__computation_1_1conversion_1_1impl.html#a3dcbeb3180ab008815e6e7749796d147">getYawFromQuaternionMsg</a> (const geometry_msgs::msg::Quaternion &amp;quaternion)</td></tr>
<tr class="memdesc:a3dcbeb3180ab008815e6e7749796d147"><td class="mdescLeft">&#160;</td><td class="mdescRight">Gets the yaw angle in degrees described by the provided quaternion.  <a href="namespacemotion__computation_1_1conversion_1_1impl.html#a3dcbeb3180ab008815e6e7749796d147">More...</a><br /></td></tr>
<tr class="separator:a3dcbeb3180ab008815e6e7749796d147"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa543f123dea7c2e5476ed7e17e25456f"><td class="memItemLeft" align="right" valign="top">tf2::Vector3&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemotion__computation_1_1conversion_1_1impl.html#aa543f123dea7c2e5476ed7e17e25456f">transform_to_map_frame</a> (const tf2::Vector3 &amp;ecef_point, const lanelet::projection::LocalFrameProjector &amp;map_projector)</td></tr>
<tr class="memdesc:aa543f123dea7c2e5476ed7e17e25456f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Transforms ecef point to map frame using internally saved map transform.  <a href="namespacemotion__computation_1_1conversion_1_1impl.html#aa543f123dea7c2e5476ed7e17e25456f">More...</a><br /></td></tr>
<tr class="separator:aa543f123dea7c2e5476ed7e17e25456f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a48389a44ecd9e272dbbcdebea32601fb"><td class="memItemLeft" align="right" valign="top">std::vector&lt; geometry_msgs::msg::Pose &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemotion__computation_1_1conversion_1_1impl.html#a48389a44ecd9e272dbbcdebea32601fb">sample_2d_path_from_radius</a> (const geometry_msgs::msg::Pose &amp;pose, double velocity, double radius_of_curvature, double period, double step_size)</td></tr>
<tr class="separator:a48389a44ecd9e272dbbcdebea32601fb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae5e3a18881b54fc666c13199ea6c7073"><td class="memItemLeft" align="right" valign="top">std::vector&lt; geometry_msgs::msg::Pose &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemotion__computation_1_1conversion_1_1impl.html#ae5e3a18881b54fc666c13199ea6c7073">sample_2d_linear_motion</a> (const geometry_msgs::msg::Pose &amp;pose, double velocity, double period, double step_size)</td></tr>
<tr class="separator:ae5e3a18881b54fc666c13199ea6c7073"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a50c675cb23fd3a743226b22287b32945"><td class="memItemLeft" align="right" valign="top">geometry_msgs::msg::PoseWithCovariance&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemotion__computation_1_1conversion_1_1impl.html#a50c675cb23fd3a743226b22287b32945">pose_from_gnss</a> (const lanelet::projection::LocalFrameProjector &amp;projector, const tf2::Quaternion &amp;ned_in_map_rotation, const lanelet::GPSPoint &amp;gps_point, const double &amp;heading, const double lat_variance, const double lon_variance, const double heading_variance)</td></tr>
<tr class="separator:a50c675cb23fd3a743226b22287b32945"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7cf9dd84c4528278ce20562def3047c3"><td class="memItemLeft" align="right" valign="top">std::vector&lt; carma_perception_msgs::msg::PredictedState &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemotion__computation_1_1conversion_1_1impl.html#a7cf9dd84c4528278ce20562def3047c3">predicted_poses_to_predicted_state</a> (const std::vector&lt; geometry_msgs::msg::Pose &gt; &amp;poses, double constant_velocity, const rclcpp::Time &amp;start_time, const rclcpp::Duration &amp;step_size, const std::string &amp;frame, double initial_pose_confidence, double initial_vel_confidence)</td></tr>
<tr class="separator:a7cf9dd84c4528278ce20562def3047c3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adcf6c7b8fa415af10c0cc489388fce40"><td class="memItemLeft" align="right" valign="top">rclcpp::Time&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemotion__computation_1_1conversion_1_1impl.html#adcf6c7b8fa415af10c0cc489388fce40">get_psm_timestamp</a> (const carma_v2x_msgs::msg::PSM &amp;in_msg, rclcpp::Clock::SharedPtr clock)</td></tr>
<tr class="separator:adcf6c7b8fa415af10c0cc489388fce40"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="aa87a85102ac70d15b834d6e1cd3d9429" name="aa87a85102ac70d15b834d6e1cd3d9429"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa87a85102ac70d15b834d6e1cd3d9429">&#9670;&nbsp;</a></span>calculateAngVelocityOfPredictedStates()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void motion_computation::conversion::impl::calculateAngVelocityOfPredictedStates </td>
          <td>(</td>
          <td class="paramtype">carma_perception_msgs::msg::ExternalObject &amp;&#160;</td>
          <td class="paramname"><em>object</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Helper function to fill in the angular velocity of the external object. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ExternalObject</td><td>to fill in its angular velocities </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="mobility__path__to__external__object_8cpp_source.html#l00211">211</a> of file <a class="el" href="mobility__path__to__external__object_8cpp_source.html">mobility_path_to_external_object.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  212</span>{</div>
<div class="line"><span class="lineno">  213</span>  <span class="keywordflow">if</span> (!<span class="keywordtype">object</span>.dynamic_obj || <span class="keywordtype">object</span>.predictions.size() == 0) {</div>
<div class="line"><span class="lineno">  214</span>    <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  215</span>  }</div>
<div class="line"><span class="lineno">  216</span> </div>
<div class="line"><span class="lineno">  217</span>  <span class="comment">// Object&#39;s current angular velocity</span></div>
<div class="line"><span class="lineno">  218</span>  <span class="keywordtype">double</span> dt = (rclcpp::Time(<span class="keywordtype">object</span>.header.stamp) - rclcpp::Time(<span class="keywordtype">object</span>.predictions[0].header.stamp))</div>
<div class="line"><span class="lineno">  219</span>                .seconds();</div>
<div class="line"><span class="lineno">  220</span>  <span class="keywordtype">object</span>.velocity.twist.angular.z =</div>
<div class="line"><span class="lineno">  221</span>    (<a class="code hl_function" href="namespacemotion__computation_1_1conversion_1_1impl.html#a3dcbeb3180ab008815e6e7749796d147">impl::getYawFromQuaternionMsg</a>(<span class="keywordtype">object</span>.pose.pose.orientation) -</div>
<div class="line"><span class="lineno">  222</span>     <a class="code hl_function" href="namespacemotion__computation_1_1conversion_1_1impl.html#a3dcbeb3180ab008815e6e7749796d147">impl::getYawFromQuaternionMsg</a>(<span class="keywordtype">object</span>.predictions[0].predicted_position.orientation)) /</div>
<div class="line"><span class="lineno">  223</span>    dt;</div>
<div class="line"><span class="lineno">  224</span> </div>
<div class="line"><span class="lineno">  225</span>  <span class="comment">// Predictions&#39; angular velocities</span></div>
<div class="line"><span class="lineno">  226</span>  <span class="keyword">auto</span> prev_orient = <span class="keywordtype">object</span>.pose.pose.orientation;</div>
<div class="line"><span class="lineno">  227</span>  <span class="keyword">auto</span> prev_time = rclcpp::Time(<span class="keywordtype">object</span>.predictions[0].header.stamp);</div>
<div class="line"><span class="lineno">  228</span>  <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp; pred : <span class="keywordtype">object</span>.predictions) {</div>
<div class="line"><span class="lineno">  229</span>    dt = (rclcpp::Time(pred.header.stamp) - prev_time).seconds();</div>
<div class="line"><span class="lineno">  230</span>    pred.predicted_velocity.angular.z =</div>
<div class="line"><span class="lineno">  231</span>      (<a class="code hl_function" href="namespacemotion__computation_1_1conversion_1_1impl.html#a3dcbeb3180ab008815e6e7749796d147">impl::getYawFromQuaternionMsg</a>(prev_orient) -</div>
<div class="line"><span class="lineno">  232</span>       <a class="code hl_function" href="namespacemotion__computation_1_1conversion_1_1impl.html#a3dcbeb3180ab008815e6e7749796d147">impl::getYawFromQuaternionMsg</a>(pred.predicted_position.orientation)) /</div>
<div class="line"><span class="lineno">  233</span>      dt;</div>
<div class="line"><span class="lineno">  234</span>  }</div>
<div class="line"><span class="lineno">  235</span>}</div>
<div class="ttc" id="anamespacemotion__computation_1_1conversion_1_1impl_html_a3dcbeb3180ab008815e6e7749796d147"><div class="ttname"><a href="namespacemotion__computation_1_1conversion_1_1impl.html#a3dcbeb3180ab008815e6e7749796d147">motion_computation::conversion::impl::getYawFromQuaternionMsg</a></div><div class="ttdeci">double getYawFromQuaternionMsg(const geometry_msgs::msg::Quaternion &amp;quaternion)</div><div class="ttdoc">Gets the yaw angle in degrees described by the provided quaternion.</div><div class="ttdef"><b>Definition:</b> <a href="mobility__path__to__external__object_8cpp_source.html#l00237">mobility_path_to_external_object.cpp:237</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="mobility__path__to__external__object_8cpp_source.html#l00237">getYawFromQuaternionMsg()</a>.</p>

<p class="reference">Referenced by <a class="el" href="mobility__path__to__external__object_8cpp_source.html#l00029">motion_computation::conversion::convert()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacemotion__computation_1_1conversion_1_1impl_aa87a85102ac70d15b834d6e1cd3d9429_cgraph.png" border="0" usemap="#anamespacemotion__computation_1_1conversion_1_1impl_aa87a85102ac70d15b834d6e1cd3d9429_cgraph" alt=""/></div>
<map name="anamespacemotion__computation_1_1conversion_1_1impl_aa87a85102ac70d15b834d6e1cd3d9429_cgraph" id="anamespacemotion__computation_1_1conversion_1_1impl_aa87a85102ac70d15b834d6e1cd3d9429_cgraph">
<area shape="rect" title="Helper function to fill in the angular velocity of the external object." alt="" coords="5,5,217,76"/>
<area shape="rect" href="namespacemotion__computation_1_1conversion_1_1impl.html#a3dcbeb3180ab008815e6e7749796d147" title="Gets the yaw angle in degrees described by the provided quaternion." alt="" coords="265,13,449,69"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacemotion__computation_1_1conversion_1_1impl_aa87a85102ac70d15b834d6e1cd3d9429_icgraph.png" border="0" usemap="#anamespacemotion__computation_1_1conversion_1_1impl_aa87a85102ac70d15b834d6e1cd3d9429_icgraph" alt=""/></div>
<map name="anamespacemotion__computation_1_1conversion_1_1impl_aa87a85102ac70d15b834d6e1cd3d9429_icgraph" id="anamespacemotion__computation_1_1conversion_1_1impl_aa87a85102ac70d15b834d6e1cd3d9429_icgraph">
<area shape="rect" title="Helper function to fill in the angular velocity of the external object." alt="" coords="193,5,405,76"/>
<area shape="rect" href="namespacemotion__computation_1_1conversion.html#ac015baeed44f7d5fbf23e8a71bb12876" title=" " alt="" coords="5,20,145,61"/>
</map>
</div>

</div>
</div>
<a id="abb4c108e6903a12b1dff436ef0e6d825" name="abb4c108e6903a12b1dff436ef0e6d825"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abb4c108e6903a12b1dff436ef0e6d825">&#9670;&nbsp;</a></span>composePredictedState()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::pair&lt; carma_perception_msgs::msg::PredictedState, double &gt; motion_computation::conversion::impl::composePredictedState </td>
          <td>(</td>
          <td class="paramtype">const tf2::Vector3 &amp;&#160;</td>
          <td class="paramname"><em>curr_pt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const tf2::Vector3 &amp;&#160;</td>
          <td class="paramname"><em>prev_pt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const rclcpp::Time &amp;&#160;</td>
          <td class="paramname"><em>prev_time_stamp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const rclcpp::Time &amp;&#160;</td>
          <td class="paramname"><em>curr_time_stamp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>prev_yaw</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Composes a PredictedState message form a provided current point and previous point. It calculates the speed from these points using mobility_path_time_step. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">curr_pt</td><td>current point </td></tr>
    <tr><td class="paramname">prev_pt</td><td>prev_pt. this point is recorded in the state </td></tr>
    <tr><td class="paramname">prev_time_stamp</td><td>prev_pt's time stamp. This time is recorded in the state </td></tr>
    <tr><td class="paramname">curr_time_stamp</td><td>The timestamp of the second point when used to compute velocity at prev point </td></tr>
    <tr><td class="paramname">prev_yaw</td><td>A previous yaw value in radians to use if the two provided points are equivalent </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>std::pair&lt;carma_perception_msgs::msg::PredictedState,double&gt; where the first element is the prediction including linear velocity, last_time, orientation filled in and the second element is the yaw in radians used to compute the orientation </dd></dl>

<p class="definition">Definition at line <a class="el" href="mobility__path__to__external__object_8cpp_source.html#l00166">166</a> of file <a class="el" href="mobility__path__to__external__object_8cpp_source.html">mobility_path_to_external_object.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  169</span>{</div>
<div class="line"><span class="lineno">  170</span>  carma_perception_msgs::msg::PredictedState output_state;</div>
<div class="line"><span class="lineno">  171</span>  <span class="comment">// Set Position</span></div>
<div class="line"><span class="lineno">  172</span>  output_state.predicted_position.position.x = prev_pt.x();</div>
<div class="line"><span class="lineno">  173</span>  output_state.predicted_position.position.y = prev_pt.y();</div>
<div class="line"><span class="lineno">  174</span>  output_state.predicted_position.position.z = prev_pt.z();</div>
<div class="line"><span class="lineno">  175</span> </div>
<div class="line"><span class="lineno">  176</span>  <span class="comment">// Set Orientation</span></div>
<div class="line"><span class="lineno">  177</span>  Eigen::Vector2d vehicle_vector = {curr_pt.x() - prev_pt.x(), curr_pt.y() - prev_pt.y()};</div>
<div class="line"><span class="lineno">  178</span>  Eigen::Vector2d x_axis = {1, 0};</div>
<div class="line"><span class="lineno">  179</span>  <span class="keywordtype">double</span> yaw = 0.0;</div>
<div class="line"><span class="lineno">  180</span>  <span class="keywordflow">if</span> (</div>
<div class="line"><span class="lineno">  181</span>    vehicle_vector.norm() &lt;</div>
<div class="line"><span class="lineno">  182</span>    0.000001) {  <span class="comment">// If there is zero magnitude use previous yaw to avoid divide by 0</span></div>
<div class="line"><span class="lineno">  183</span>    yaw = prev_yaw;</div>
<div class="line"><span class="lineno">  184</span>    RCLCPP_DEBUG_STREAM(</div>
<div class="line"><span class="lineno">  185</span>      rclcpp::get_logger(<span class="stringliteral">&quot;motion_computation::conversion&quot;</span>),</div>
<div class="line"><span class="lineno">  186</span>      <span class="stringliteral">&quot;Two identical points sent for predicting heading. Forced to use previous yaw or 0 if &quot;</span></div>
<div class="line"><span class="lineno">  187</span>      <span class="stringliteral">&quot;first &quot;</span></div>
<div class="line"><span class="lineno">  188</span>      <span class="stringliteral">&quot;point&quot;</span>);</div>
<div class="line"><span class="lineno">  189</span>  } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  190</span>    yaw = std::acos(vehicle_vector.dot(x_axis) / (vehicle_vector.norm() * x_axis.norm()));</div>
<div class="line"><span class="lineno">  191</span>  }</div>
<div class="line"><span class="lineno">  192</span> </div>
<div class="line"><span class="lineno">  193</span>  tf2::Quaternion vehicle_orientation;</div>
<div class="line"><span class="lineno">  194</span>  vehicle_orientation.setRPY(0, 0, yaw);</div>
<div class="line"><span class="lineno">  195</span>  output_state.predicted_position.orientation.x = vehicle_orientation.getX();</div>
<div class="line"><span class="lineno">  196</span>  output_state.predicted_position.orientation.y = vehicle_orientation.getY();</div>
<div class="line"><span class="lineno">  197</span>  output_state.predicted_position.orientation.z = vehicle_orientation.getZ();</div>
<div class="line"><span class="lineno">  198</span>  output_state.predicted_position.orientation.w = vehicle_orientation.getW();</div>
<div class="line"><span class="lineno">  199</span> </div>
<div class="line"><span class="lineno">  200</span>  <span class="comment">// Set velocity</span></div>
<div class="line"><span class="lineno">  201</span>  output_state.predicted_velocity.linear.x =</div>
<div class="line"><span class="lineno">  202</span> </div>
<div class="line"><span class="lineno">  203</span>    vehicle_vector.norm() / (curr_time_stamp - prev_time_stamp).seconds();</div>
<div class="line"><span class="lineno">  204</span> </div>
<div class="line"><span class="lineno">  205</span>  <span class="comment">// Set timestamp</span></div>
<div class="line"><span class="lineno">  206</span>  output_state.header.stamp = builtin_interfaces::msg::Time(prev_time_stamp);</div>
<div class="line"><span class="lineno">  207</span> </div>
<div class="line"><span class="lineno">  208</span>  <span class="keywordflow">return</span> std::make_pair(output_state, yaw);</div>
<div class="line"><span class="lineno">  209</span>}</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="mobility__path__to__external__object_8cpp_source.html#l00029">motion_computation::conversion::convert()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacemotion__computation_1_1conversion_1_1impl_abb4c108e6903a12b1dff436ef0e6d825_icgraph.png" border="0" usemap="#anamespacemotion__computation_1_1conversion_1_1impl_abb4c108e6903a12b1dff436ef0e6d825_icgraph" alt=""/></div>
<map name="anamespacemotion__computation_1_1conversion_1_1impl_abb4c108e6903a12b1dff436ef0e6d825_icgraph" id="anamespacemotion__computation_1_1conversion_1_1impl_abb4c108e6903a12b1dff436ef0e6d825_icgraph">
<area shape="rect" title="Composes a PredictedState message form a provided current point and previous point...." alt="" coords="193,5,355,61"/>
<area shape="rect" href="namespacemotion__computation_1_1conversion.html#ac015baeed44f7d5fbf23e8a71bb12876" title=" " alt="" coords="5,13,145,54"/>
</map>
</div>

</div>
</div>
<a id="adcf6c7b8fa415af10c0cc489388fce40" name="adcf6c7b8fa415af10c0cc489388fce40"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adcf6c7b8fa415af10c0cc489388fce40">&#9670;&nbsp;</a></span>get_psm_timestamp()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">rclcpp::Time motion_computation::conversion::impl::get_psm_timestamp </td>
          <td>(</td>
          <td class="paramtype">const carma_v2x_msgs::msg::PSM &amp;&#160;</td>
          <td class="paramname"><em>in_msg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">rclcpp::Clock::SharedPtr&#160;</td>
          <td class="paramname"><em>clock</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="psm__to__external__object__convertor_8cpp_source.html#l00477">477</a> of file <a class="el" href="psm__to__external__object__convertor_8cpp_source.html">psm_to_external_object_convertor.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  479</span>{</div>
<div class="line"><span class="lineno">  480</span>  boost::posix_time::ptime utc_time_of_current_psm;</div>
<div class="line"><span class="lineno">  481</span> </div>
<div class="line"><span class="lineno">  482</span>  <span class="comment">// Get the utc epoch start time</span></div>
<div class="line"><span class="lineno">  483</span>  <span class="keyword">static</span> <span class="keyword">const</span> boost::posix_time::ptime inception_boost(</div>
<div class="line"><span class="lineno">  484</span>    boost::posix_time::time_from_string(<span class="stringliteral">&quot;1970-01-01 00:00:00.000&quot;</span>));</div>
<div class="line"><span class="lineno">  485</span> </div>
<div class="line"><span class="lineno">  486</span>  <span class="comment">// Determine if the utc time of the path history can be used instead of the</span></div>
<div class="line"><span class="lineno">  487</span>  <span class="comment">// sec_mark The sec_mark is susceptible to large error on minute transitions</span></div>
<div class="line"><span class="lineno">  488</span>  <span class="comment">// due to missing &quot;minute of the year&quot; field If the second mark in the path</span></div>
<div class="line"><span class="lineno">  489</span>  <span class="comment">// history is identical and the full utc time is provided with ms resolution</span></div>
<div class="line"><span class="lineno">  490</span>  <span class="comment">// then it can be assumed the initial_position is the same as the PSM data and</span></div>
<div class="line"><span class="lineno">  491</span>  <span class="comment">// the utc_time can be used instead of sec_mark</span></div>
<div class="line"><span class="lineno">  492</span>  <span class="comment">// clang-format off</span></div>
<div class="line"><span class="lineno">  493</span> </div>
<div class="line"><span class="lineno">  494</span>  <span class="keyword">const</span> <span class="keyword">auto</span> initial_position_time{in_msg.path_history.initial_position.utc_time};</div>
<div class="line"><span class="lineno">  495</span>  <span class="keywordflow">if</span> ((in_msg.presence_vector &amp;</div>
<div class="line"><span class="lineno">  496</span>        carma_v2x_msgs::msg::PSM::HAS_PATH_HISTORY) &amp;&amp;</div>
<div class="line"><span class="lineno">  497</span>        (in_msg.path_history.presence_vector &amp;</div>
<div class="line"><span class="lineno">  498</span>        carma_v2x_msgs::msg::PathHistory::HAS_INITIAL_POSITION) &amp;&amp;</div>
<div class="line"><span class="lineno">  499</span>        (initial_position_time.presence_vector &amp; j2735_v2x_msgs::msg::DDateTime::YEAR) &amp;&amp;</div>
<div class="line"><span class="lineno">  500</span>        (initial_position_time.presence_vector &amp; j2735_v2x_msgs::msg::DDateTime::MONTH) &amp;&amp;</div>
<div class="line"><span class="lineno">  501</span>        (initial_position_time.presence_vector &amp; j2735_v2x_msgs::msg::DDateTime::DAY) &amp;&amp;</div>
<div class="line"><span class="lineno">  502</span>        (initial_position_time.presence_vector &amp; j2735_v2x_msgs::msg::DDateTime::HOUR) &amp;&amp;</div>
<div class="line"><span class="lineno">  503</span>        (initial_position_time.presence_vector &amp; j2735_v2x_msgs::msg::DDateTime::MINUTE) &amp;&amp;</div>
<div class="line"><span class="lineno">  504</span>        (initial_position_time.presence_vector &amp; j2735_v2x_msgs::msg::DDateTime::SECOND) &amp;&amp;</div>
<div class="line"><span class="lineno">  505</span>      (in_msg.sec_mark.millisecond == initial_position_time.second.millisecond)) {</div>
<div class="line"><span class="lineno">  506</span>    <span class="comment">// clang-format on</span></div>
<div class="line"><span class="lineno">  507</span>    RCLCPP_DEBUG_STREAM(</div>
<div class="line"><span class="lineno">  508</span>      rclcpp::get_logger(<span class="stringliteral">&quot;motion_computation::conversion&quot;</span>),</div>
<div class="line"><span class="lineno">  509</span>      <span class="stringliteral">&quot;Using UTC time of path history to determine PSM &quot;</span></div>
<div class="line"><span class="lineno">  510</span>      <span class="stringliteral">&quot;timestamp. Assumed valid since UTC is fully specified &quot;</span></div>
<div class="line"><span class="lineno">  511</span>      <span class="stringliteral">&quot;and sec_mark == utc_time.seconds in this message.&quot;</span>);</div>
<div class="line"><span class="lineno">  512</span> </div>
<div class="line"><span class="lineno">  513</span>    boost::posix_time::time_duration time_of_day =</div>
<div class="line"><span class="lineno">  514</span>      boost::posix_time::hours(in_msg.path_history.initial_position.utc_time.hour.hour) +</div>
<div class="line"><span class="lineno">  515</span>      boost::posix_time::minutes(in_msg.path_history.initial_position.utc_time.minute.minute) +</div>
<div class="line"><span class="lineno">  516</span>      boost::posix_time::milliseconds(</div>
<div class="line"><span class="lineno">  517</span>        in_msg.path_history.initial_position.utc_time.second.millisecond);</div>
<div class="line"><span class="lineno">  518</span> </div>
<div class="line"><span class="lineno">  519</span>    boost::gregorian::date utc_day(</div>
<div class="line"><span class="lineno">  520</span>      in_msg.path_history.initial_position.utc_time.year.year,</div>
<div class="line"><span class="lineno">  521</span>      in_msg.path_history.initial_position.utc_time.month.month,</div>
<div class="line"><span class="lineno">  522</span>      in_msg.path_history.initial_position.utc_time.day.day);</div>
<div class="line"><span class="lineno">  523</span> </div>
<div class="line"><span class="lineno">  524</span>    utc_time_of_current_psm = boost::posix_time::ptime(utc_day) + time_of_day;</div>
<div class="line"><span class="lineno">  525</span>  } <span class="keywordflow">else</span> {  <span class="comment">// If the utc time of the path history cannot be used to account for minute</span></div>
<div class="line"><span class="lineno">  526</span>            <span class="comment">// change over, then we have to default to the sec mark</span></div>
<div class="line"><span class="lineno">  527</span> </div>
<div class="line"><span class="lineno">  528</span>    RCLCPP_WARN_STREAM_THROTTLE(</div>
<div class="line"><span class="lineno">  529</span>      rclcpp::get_logger(<span class="stringliteral">&quot;motion_computation::conversion&quot;</span>), *clock.get(),</div>
<div class="line"><span class="lineno">  530</span>      rclcpp::Duration(5, 0).nanoseconds(),</div>
<div class="line"><span class="lineno">  531</span>      <span class="stringliteral">&quot;PSM PathHistory utc timstamp does not match &quot;</span></div>
<div class="line"><span class="lineno">  532</span>      <span class="stringliteral">&quot;sec_mark. Unable to determine the minute of &quot;</span></div>
<div class="line"><span class="lineno">  533</span>      <span class="stringliteral">&quot;the year used for PSM data. Assuming local &quot;</span></div>
<div class="line"><span class="lineno">  534</span>      <span class="stringliteral">&quot;clock is exactly synced. This is NOT &quot;</span></div>
<div class="line"><span class="lineno">  535</span>      <span class="stringliteral">&quot;ADVISED.&quot;</span>);</div>
<div class="line"><span class="lineno">  536</span> </div>
<div class="line"><span class="lineno">  537</span>    <span class="comment">// Get the current ROS time</span></div>
<div class="line"><span class="lineno">  538</span>    <span class="keyword">auto</span> current_time = clock-&gt;now();</div>
<div class="line"><span class="lineno">  539</span> </div>
<div class="line"><span class="lineno">  540</span>    <span class="comment">// Convert the ros time to a boost duration</span></div>
<div class="line"><span class="lineno">  541</span>    boost::posix_time::time_duration duration_since_inception(</div>
<div class="line"><span class="lineno">  542</span>      lanelet::time::durationFromSec(current_time.seconds()));</div>
<div class="line"><span class="lineno">  543</span> </div>
<div class="line"><span class="lineno">  544</span>    <span class="comment">// Get the current ROS time in UTC</span></div>
<div class="line"><span class="lineno">  545</span>    <span class="keyword">auto</span> curr_time_boost = inception_boost + duration_since_inception;</div>
<div class="line"><span class="lineno">  546</span> </div>
<div class="line"><span class="lineno">  547</span>    <span class="comment">// Get duration of current day</span></div>
<div class="line"><span class="lineno">  548</span>    <span class="keyword">auto</span> duration_in_day_till_current_time = curr_time_boost.time_of_day();</div>
<div class="line"><span class="lineno">  549</span> </div>
<div class="line"><span class="lineno">  550</span>    <span class="comment">// Extract hours and minutes</span></div>
<div class="line"><span class="lineno">  551</span>    <span class="keyword">auto</span> hour_count_in_day = duration_in_day_till_current_time.hours();</div>
<div class="line"><span class="lineno">  552</span>    <span class="keyword">auto</span> minute_count_in_hour = duration_in_day_till_current_time.minutes();</div>
<div class="line"><span class="lineno">  553</span> </div>
<div class="line"><span class="lineno">  554</span>    <span class="comment">// Get the duration of the minute in the day</span></div>
<div class="line"><span class="lineno">  555</span>    <span class="keyword">auto</span> start_of_minute_in_day = boost::posix_time::hours(hour_count_in_day) +</div>
<div class="line"><span class="lineno">  556</span>                                  boost::posix_time::minutes(minute_count_in_hour);</div>
<div class="line"><span class="lineno">  557</span> </div>
<div class="line"><span class="lineno">  558</span>    <span class="comment">// Get the start of the day in ROS time</span></div>
<div class="line"><span class="lineno">  559</span>    boost::posix_time::ptime start_of_day(curr_time_boost.date());</div>
<div class="line"><span class="lineno">  560</span> </div>
<div class="line"><span class="lineno">  561</span>    <span class="comment">// Ge the start of the current minute in ROS time</span></div>
<div class="line"><span class="lineno">  562</span>    boost::posix_time::ptime utc_start_of_current_minute = start_of_day + start_of_minute_in_day;</div>
<div class="line"><span class="lineno">  563</span> </div>
<div class="line"><span class="lineno">  564</span>    <span class="comment">// Compute the UTC PSM stamp from the sec_mark using ROS time as the clock</span></div>
<div class="line"><span class="lineno">  565</span> </div>
<div class="line"><span class="lineno">  566</span>    boost::posix_time::time_duration s_in_cur_minute =</div>
<div class="line"><span class="lineno">  567</span>      boost::posix_time::milliseconds(in_msg.sec_mark.millisecond);</div>
<div class="line"><span class="lineno">  568</span> </div>
<div class="line"><span class="lineno">  569</span>    utc_time_of_current_psm = utc_start_of_current_minute + s_in_cur_minute;</div>
<div class="line"><span class="lineno">  570</span>  }</div>
<div class="line"><span class="lineno">  571</span> </div>
<div class="line"><span class="lineno">  572</span>  boost::posix_time::time_duration nsec_since_epoch = utc_time_of_current_psm - inception_boost;</div>
<div class="line"><span class="lineno">  573</span> </div>
<div class="line"><span class="lineno">  574</span>  <span class="keywordflow">if</span> (nsec_since_epoch.is_special()) {</div>
<div class="line"><span class="lineno">  575</span>    RCLCPP_ERROR_STREAM(</div>
<div class="line"><span class="lineno">  576</span>      rclcpp::get_logger(<span class="stringliteral">&quot;motion_computation::conversion&quot;</span>),</div>
<div class="line"><span class="lineno">  577</span>      <span class="stringliteral">&quot;Computed psm nsec_since_epoch is special (computation &quot;</span></div>
<div class="line"><span class="lineno">  578</span>      <span class="stringliteral">&quot;failed). Value effectively undefined.&quot;</span>);</div>
<div class="line"><span class="lineno">  579</span>  }</div>
<div class="line"><span class="lineno">  580</span> </div>
<div class="line"><span class="lineno">  581</span>  <span class="keywordflow">return</span> rclcpp::Time(nsec_since_epoch.total_nanoseconds());</div>
<div class="line"><span class="lineno">  582</span>}</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="psm__to__external__object__convertor_8cpp_source.html#l00038">motion_computation::conversion::convert()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacemotion__computation_1_1conversion_1_1impl_adcf6c7b8fa415af10c0cc489388fce40_icgraph.png" border="0" usemap="#anamespacemotion__computation_1_1conversion_1_1impl_adcf6c7b8fa415af10c0cc489388fce40_icgraph" alt=""/></div>
<map name="anamespacemotion__computation_1_1conversion_1_1impl_adcf6c7b8fa415af10c0cc489388fce40_icgraph" id="anamespacemotion__computation_1_1conversion_1_1impl_adcf6c7b8fa415af10c0cc489388fce40_icgraph">
<area shape="rect" title=" " alt="" coords="841,205,981,261"/>
<area shape="rect" href="namespacemotion__computation_1_1conversion.html#a9884e63460f3d5f5e2b755354984dc29" title=" " alt="" coords="653,213,793,254"/>
<area shape="rect" href="classmotion__computation_1_1MotionComputationWorker.html#a5e3044066ec8779205710e50b90a2c08" title=" " alt="" coords="424,5,605,61"/>
<area shape="rect" href="classgnss__to__map__convertor_1_1GNSSToMapConvertor.html#a3b37a3b059aa5da9f6e6faf1d92627fb" title="GNSS Fix callback which will publish a pose representing that fix in the map frame if the required tr..." alt="" coords="433,245,596,301"/>
<area shape="rect" href="classmotion__computation_1_1MotionComputationWorker.html#ac4b94de8991236d24c73160bfcd85902" title=" " alt="" coords="424,85,605,141"/>
<area shape="rect" href="classmotion__computation_1_1MotionComputationWorker.html#a4d67a9ee5932611188f5b8f9182520f2" title=" " alt="" coords="424,165,605,221"/>
<area shape="rect" href="namespacecarma__wm_1_1geometry.html#a33b80c2f327d0293d7bdb9b4503a1cd5" title="Extract extrinsic roll&#45;pitch&#45;yaw from quaternion." alt="" coords="442,325,587,366"/>
<area shape="rect" href="classcarma__cloud__client_1_1CarmaCloudClient.html#aa9bee7b1b058329f9121ca67e071aa08" title="Funtion to Convert the TCR into XML format." alt="" coords="445,389,584,445"/>
<area shape="rect" href="classmotion__computation_1_1MotionComputationNode.html#a6fef0cbb33460d4d3c9b0c9da36dd76a" title=" " alt="" coords="199,85,370,141"/>
<area shape="rect" href="classgnss__to__map__convertor_1_1Node.html#a0de3641c944433ac709ce9ca395c24b3" title=" " alt="" coords="193,253,376,294"/>
<area shape="rect" href="classcarma__cloud__client_1_1CarmaCloudClient.html#a235e21b0786bc1fd86185f932f8894f5" title="TCR subscription callback." alt="" coords="215,389,354,445"/>
<area shape="rect" href="classcarma__cloud__client_1_1CarmaCloudClient.html#a1813aa46114d0d36cd4de6c56bd1ab35" title=" " alt="" coords="5,389,145,445"/>
</map>
</div>

</div>
</div>
<a id="a3dcbeb3180ab008815e6e7749796d147" name="a3dcbeb3180ab008815e6e7749796d147"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3dcbeb3180ab008815e6e7749796d147">&#9670;&nbsp;</a></span>getYawFromQuaternionMsg()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double motion_computation::conversion::impl::getYawFromQuaternionMsg </td>
          <td>(</td>
          <td class="paramtype">const geometry_msgs::msg::Quaternion &amp;&#160;</td>
          <td class="paramname"><em>quaternion</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Gets the yaw angle in degrees described by the provided quaternion. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">quaternion</td><td>The quaternion to extract yaw from </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The yaw in degrees </dd></dl>

<p class="definition">Definition at line <a class="el" href="mobility__path__to__external__object_8cpp_source.html#l00237">237</a> of file <a class="el" href="mobility__path__to__external__object_8cpp_source.html">mobility_path_to_external_object.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  238</span>{</div>
<div class="line"><span class="lineno">  239</span>  tf2::Quaternion orientation;</div>
<div class="line"><span class="lineno">  240</span>  orientation.setX(quaternion.x);</div>
<div class="line"><span class="lineno">  241</span>  orientation.setY(quaternion.y);</div>
<div class="line"><span class="lineno">  242</span>  orientation.setZ(quaternion.z);</div>
<div class="line"><span class="lineno">  243</span>  orientation.setW(quaternion.w);</div>
<div class="line"><span class="lineno">  244</span> </div>
<div class="line"><span class="lineno">  245</span>  <span class="keywordtype">double</span> roll;</div>
<div class="line"><span class="lineno">  246</span>  <span class="keywordtype">double</span> pitch;</div>
<div class="line"><span class="lineno">  247</span>  <span class="keywordtype">double</span> yaw;</div>
<div class="line"><span class="lineno">  248</span>  tf2::Matrix3x3(orientation).getRPY(roll, pitch, yaw);</div>
<div class="line"><span class="lineno">  249</span> </div>
<div class="line"><span class="lineno">  250</span>  <span class="keywordflow">return</span> yaw;</div>
<div class="line"><span class="lineno">  251</span>}</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="mobility__path__to__external__object_8cpp_source.html#l00211">calculateAngVelocityOfPredictedStates()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacemotion__computation_1_1conversion_1_1impl_a3dcbeb3180ab008815e6e7749796d147_icgraph.png" border="0" usemap="#anamespacemotion__computation_1_1conversion_1_1impl_a3dcbeb3180ab008815e6e7749796d147_icgraph" alt=""/></div>
<map name="anamespacemotion__computation_1_1conversion_1_1impl_a3dcbeb3180ab008815e6e7749796d147_icgraph" id="anamespacemotion__computation_1_1conversion_1_1impl_a3dcbeb3180ab008815e6e7749796d147_icgraph">
<area shape="rect" title="Gets the yaw angle in degrees described by the provided quaternion." alt="" coords="453,13,637,69"/>
<area shape="rect" href="namespacemotion__computation_1_1conversion_1_1impl.html#aa87a85102ac70d15b834d6e1cd3d9429" title="Helper function to fill in the angular velocity of the external object." alt="" coords="193,5,405,76"/>
<area shape="rect" href="namespacemotion__computation_1_1conversion.html#ac015baeed44f7d5fbf23e8a71bb12876" title=" " alt="" coords="5,20,145,61"/>
</map>
</div>

</div>
</div>
<a id="a50c675cb23fd3a743226b22287b32945" name="a50c675cb23fd3a743226b22287b32945"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a50c675cb23fd3a743226b22287b32945">&#9670;&nbsp;</a></span>pose_from_gnss()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">geometry_msgs::msg::PoseWithCovariance motion_computation::conversion::impl::pose_from_gnss </td>
          <td>(</td>
          <td class="paramtype">const lanelet::projection::LocalFrameProjector &amp;&#160;</td>
          <td class="paramname"><em>projector</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const tf2::Quaternion &amp;&#160;</td>
          <td class="paramname"><em>ned_in_map_rotation</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const lanelet::GPSPoint &amp;&#160;</td>
          <td class="paramname"><em>gps_point</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double &amp;&#160;</td>
          <td class="paramname"><em>heading</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&#160;</td>
          <td class="paramname"><em>lat_variance</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&#160;</td>
          <td class="paramname"><em>lon_variance</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&#160;</td>
          <td class="paramname"><em>heading_variance</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Convert the position information into the map frame using the proj library</p>
<p >Convert the position information into the map frame using the proj library</p>

<p class="definition">Definition at line <a class="el" href="psm__to__external__object__convertor_8cpp_source.html#l00339">339</a> of file <a class="el" href="psm__to__external__object__convertor_8cpp_source.html">psm_to_external_object_convertor.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  344</span>{</div>
<div class="line"><span class="lineno">  347</span>  lanelet::BasicPoint3d map_point = projector.forward(gps_point);</div>
<div class="line"><span class="lineno">  348</span> </div>
<div class="line"><span class="lineno">  349</span>  RCLCPP_DEBUG_STREAM(</div>
<div class="line"><span class="lineno">  350</span>    rclcpp::get_logger(<span class="stringliteral">&quot;motion_computation::conversion&quot;</span>),</div>
<div class="line"><span class="lineno">  351</span>    <span class="stringliteral">&quot;map_point: &quot;</span> &lt;&lt; map_point.x() &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; map_point.y() &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; map_point.z());</div>
<div class="line"><span class="lineno">  352</span> </div>
<div class="line"><span class="lineno">  353</span>  <span class="keywordflow">if</span> (</div>
<div class="line"><span class="lineno">  354</span>    fabs(map_point.x()) &gt; 10000.0 ||</div>
<div class="line"><span class="lineno">  355</span>    fabs(map_point.y()) &gt;</div>
<div class="line"><span class="lineno">  356</span>      10000.0) {  <span class="comment">// Above 10km from map origin earth curvature will start to have a negative</span></div>
<div class="line"><span class="lineno">  357</span>                  <span class="comment">// impact on system performance</span></div>
<div class="line"><span class="lineno">  358</span> </div>
<div class="line"><span class="lineno">  359</span>    RCLCPP_WARN_STREAM(</div>
<div class="line"><span class="lineno">  360</span>      rclcpp::get_logger(<span class="stringliteral">&quot;motion_computation::conversion&quot;</span>),</div>
<div class="line"><span class="lineno">  361</span>      <span class="stringliteral">&quot;Distance from map origin is larger than supported by system &quot;</span></div>
<div class="line"><span class="lineno">  362</span>      <span class="stringliteral">&quot;assumptions. Strongly advise &quot;</span></div>
<div class="line"><span class="lineno">  363</span>      <span class="stringliteral">&quot;alternative map origin be used. &quot;</span>);</div>
<div class="line"><span class="lineno">  364</span>  }</div>
<div class="line"><span class="lineno">  365</span> </div>
<div class="line"><span class="lineno">  367</span>  <span class="comment">// This logic assumes that the orientation difference between an NED frame</span></div>
<div class="line"><span class="lineno">  368</span>  <span class="comment">// located at the map origin and an NED frame located at the GNSS point are</span></div>
<div class="line"><span class="lineno">  369</span>  <span class="comment">// sufficiently small that they can be ignored. Therefore it is assumed the</span></div>
<div class="line"><span class="lineno">  370</span>  <span class="comment">// heading report of the GNSS system regardless of its postion in the map</span></div>
<div class="line"><span class="lineno">  371</span>  <span class="comment">// without change in its orientation will give the same result (as far as we</span></div>
<div class="line"><span class="lineno">  372</span>  <span class="comment">// are concered).</span></div>
<div class="line"><span class="lineno">  373</span> </div>
<div class="line"><span class="lineno">  374</span>  tf2::Quaternion R_m_n(ned_in_map_rotation);  <span class="comment">// Rotation of NED frame in map</span></div>
<div class="line"><span class="lineno">  375</span>                                               <span class="comment">// frame</span></div>
<div class="line"><span class="lineno">  376</span>  tf2::Quaternion R_n_h;                       <span class="comment">// Rotation of sensor heading report in NED frame</span></div>
<div class="line"><span class="lineno">  377</span>  R_n_h.setRPY(0, 0, heading * wgs84_utils::DEG2RAD);</div>
<div class="line"><span class="lineno">  378</span> </div>
<div class="line"><span class="lineno">  379</span>  tf2::Quaternion R_m_s = R_m_n * R_n_h;  <span class="comment">// Rotation of sensor in map frame under assumption that</span></div>
<div class="line"><span class="lineno">  380</span>                                          <span class="comment">// distance from map origin is sufficiently small so as to</span></div>
<div class="line"><span class="lineno">  381</span>                                          <span class="comment">// ignore local changes in NED orientation</span></div>
<div class="line"><span class="lineno">  382</span> </div>
<div class="line"><span class="lineno">  383</span>  RCLCPP_DEBUG_STREAM(</div>
<div class="line"><span class="lineno">  384</span>    rclcpp::get_logger(<span class="stringliteral">&quot;motion_computation::conversion&quot;</span>),</div>
<div class="line"><span class="lineno">  385</span>    <span class="stringliteral">&quot;R_m_n (x,y,z,w) : ( &quot;</span> &lt;&lt; R_m_n.x() &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; R_m_n.y() &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; R_m_n.z() &lt;&lt; <span class="stringliteral">&quot;, &quot;</span></div>
<div class="line"><span class="lineno">  386</span>                           &lt;&lt; R_m_n.w());</div>
<div class="line"><span class="lineno">  387</span> </div>
<div class="line"><span class="lineno">  388</span>  RCLCPP_DEBUG_STREAM(</div>
<div class="line"><span class="lineno">  389</span>    rclcpp::get_logger(<span class="stringliteral">&quot;motion_computation::conversion&quot;</span>),</div>
<div class="line"><span class="lineno">  390</span>    <span class="stringliteral">&quot;R_n_h (x,y,z,w) : ( &quot;</span> &lt;&lt; R_n_h.x() &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; R_n_h.y() &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; R_n_h.z() &lt;&lt; <span class="stringliteral">&quot;, &quot;</span></div>
<div class="line"><span class="lineno">  391</span>                           &lt;&lt; R_n_h.w());</div>
<div class="line"><span class="lineno">  392</span> </div>
<div class="line"><span class="lineno">  393</span>  RCLCPP_DEBUG_STREAM(</div>
<div class="line"><span class="lineno">  394</span>    rclcpp::get_logger(<span class="stringliteral">&quot;motion_computation::conversion&quot;</span>),</div>
<div class="line"><span class="lineno">  395</span>    <span class="stringliteral">&quot;R_m_s (x,y,z,w) : ( &quot;</span> &lt;&lt; R_m_s.x() &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; R_m_s.y() &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; R_m_s.z() &lt;&lt; <span class="stringliteral">&quot;, &quot;</span></div>
<div class="line"><span class="lineno">  396</span>                           &lt;&lt; R_m_s.w());</div>
<div class="line"><span class="lineno">  397</span> </div>
<div class="line"><span class="lineno">  398</span>  tf2::Transform T_m_s(</div>
<div class="line"><span class="lineno">  399</span>    R_m_s, tf2::Vector3(</div>
<div class="line"><span class="lineno">  400</span>             map_point.x(), map_point.y(),</div>
<div class="line"><span class="lineno">  401</span>             map_point.z()));  <span class="comment">// Reported position and orientation</span></div>
<div class="line"><span class="lineno">  402</span>                               <span class="comment">// of sensor frame in map frame</span></div>
<div class="line"><span class="lineno">  403</span> </div>
<div class="line"><span class="lineno">  404</span>  tf2::Transform T_m_n_no_heading(</div>
<div class="line"><span class="lineno">  405</span>    R_m_n, tf2::Vector3(0, 0, 0));  <span class="comment">// Used to transform the covariance</span></div>
<div class="line"><span class="lineno">  406</span> </div>
<div class="line"><span class="lineno">  407</span>  <span class="comment">// This covariance represents the covariance of the NED frame N-lat,</span></div>
<div class="line"><span class="lineno">  408</span>  <span class="comment">// E-lon, heading- angle east of north This means that the covariance is</span></div>
<div class="line"><span class="lineno">  409</span>  <span class="comment">// in the NED frame, and needs to be transformed to the map frame</span></div>
<div class="line"><span class="lineno">  410</span>  <span class="comment">// clang-format off</span></div>
<div class="line"><span class="lineno">  411</span>        std::array&lt;double, 36&gt; input_covariance = {</div>
<div class="line"><span class="lineno">  412</span>          lat_variance, 0, 0,  0, 0, 0,</div>
<div class="line"><span class="lineno">  413</span>          0, lon_variance, 0,  0, 0, 0,</div>
<div class="line"><span class="lineno">  414</span>          0, 0, 1,  0, 0, 0,</div>
<div class="line"><span class="lineno">  415</span>          0,  0,  0,  1,  0, 0,</div>
<div class="line"><span class="lineno">  416</span>          0,  0,  0,  0,  1, 0,</div>
<div class="line"><span class="lineno">  417</span>          0,  0,  0,  0,  0, heading_variance</div>
<div class="line"><span class="lineno">  418</span>        };</div>
<div class="line"><span class="lineno">  419</span>  <span class="comment">// clang-format on</span></div>
<div class="line"><span class="lineno">  420</span> </div>
<div class="line"><span class="lineno">  421</span>  std::array&lt;double, 36&gt; new_cov = <a class="code hl_function" href="namespacecovariance__helper.html#af38530465ec3a2a40b4e9be14032f65e">tf2::transformCovariance</a>(</div>
<div class="line"><span class="lineno">  422</span>    input_covariance,</div>
<div class="line"><span class="lineno">  423</span>    <span class="comment">// Per the usage of transformCovariance in tf2_geometry_msgs</span></div>
<div class="line"><span class="lineno">  424</span>    <span class="comment">// this frame should be the transform between the map which the pose</span></div>
<div class="line"><span class="lineno">  425</span>    <span class="comment">// is in an the target frame.</span></div>
<div class="line"><span class="lineno">  426</span>    T_m_n_no_heading);</div>
<div class="line"><span class="lineno">  427</span> </div>
<div class="line"><span class="lineno">  428</span>  <span class="comment">// Populate message</span></div>
<div class="line"><span class="lineno">  429</span>  geometry_msgs::msg::PoseWithCovariance pose;</div>
<div class="line"><span class="lineno">  430</span>  pose.pose.position.x = T_m_s.getOrigin().getX();</div>
<div class="line"><span class="lineno">  431</span>  pose.pose.position.y = T_m_s.getOrigin().getY();</div>
<div class="line"><span class="lineno">  432</span>  pose.pose.position.z = T_m_s.getOrigin().getZ();</div>
<div class="line"><span class="lineno">  433</span> </div>
<div class="line"><span class="lineno">  434</span>  pose.pose.orientation.x = T_m_s.getRotation().getX();</div>
<div class="line"><span class="lineno">  435</span>  pose.pose.orientation.y = T_m_s.getRotation().getY();</div>
<div class="line"><span class="lineno">  436</span>  pose.pose.orientation.z = T_m_s.getRotation().getZ();</div>
<div class="line"><span class="lineno">  437</span>  pose.pose.orientation.w = T_m_s.getRotation().getW();</div>
<div class="line"><span class="lineno">  438</span> </div>
<div class="line"><span class="lineno">  439</span>  pose.covariance = new_cov;</div>
<div class="line"><span class="lineno">  440</span> </div>
<div class="line"><span class="lineno">  441</span>  <span class="keywordflow">return</span> pose;</div>
<div class="line"><span class="lineno">  442</span>}</div>
<div class="ttc" id="anamespacecovariance__helper_html_af38530465ec3a2a40b4e9be14032f65e"><div class="ttname"><a href="namespacecovariance__helper.html#af38530465ec3a2a40b4e9be14032f65e">covariance_helper::transformCovariance</a></div><div class="ttdeci">geometry_msgs::msg::PoseWithCovariance::_covariance_type transformCovariance(const geometry_msgs::msg::PoseWithCovariance::_covariance_type &amp;cov_in, const tf2::Transform &amp;transform)</div><div class="ttdoc">Transform the covariance matrix of a PoseWithCovariance message to a new frame.</div><div class="ttdef"><b>Definition:</b> <a href="covariance__helper_8h_source.html#l00057">covariance_helper.h:57</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="covariance__helper_8h_source.html#l00057">covariance_helper::transformCovariance()</a>.</p>

<p class="reference">Referenced by <a class="el" href="bsm__to__external__object__convertor_8cpp_source.html#l00029">motion_computation::conversion::convert()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacemotion__computation_1_1conversion_1_1impl_a50c675cb23fd3a743226b22287b32945_cgraph.png" border="0" usemap="#anamespacemotion__computation_1_1conversion_1_1impl_a50c675cb23fd3a743226b22287b32945_cgraph" alt=""/></div>
<map name="anamespacemotion__computation_1_1conversion_1_1impl_a50c675cb23fd3a743226b22287b32945_cgraph" id="anamespacemotion__computation_1_1conversion_1_1impl_a50c675cb23fd3a743226b22287b32945_cgraph">
<area shape="rect" title=" " alt="" coords="5,5,144,61"/>
<area shape="rect" href="namespacecovariance__helper.html#af38530465ec3a2a40b4e9be14032f65e" title="Transform the covariance matrix of a PoseWithCovariance message to a new frame." alt="" coords="192,13,335,54"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacemotion__computation_1_1conversion_1_1impl_a50c675cb23fd3a743226b22287b32945_icgraph.png" border="0" usemap="#anamespacemotion__computation_1_1conversion_1_1impl_a50c675cb23fd3a743226b22287b32945_icgraph" alt=""/></div>
<map name="anamespacemotion__computation_1_1conversion_1_1impl_a50c675cb23fd3a743226b22287b32945_icgraph" id="anamespacemotion__computation_1_1conversion_1_1impl_a50c675cb23fd3a743226b22287b32945_icgraph">
<area shape="rect" title=" " alt="" coords="193,5,332,61"/>
<area shape="rect" href="namespacemotion__computation_1_1conversion.html#a9e19fcaf4fb394f34162ae07eab989ad" title=" " alt="" coords="5,13,145,54"/>
</map>
</div>

</div>
</div>
<a id="a7cf9dd84c4528278ce20562def3047c3" name="a7cf9dd84c4528278ce20562def3047c3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7cf9dd84c4528278ce20562def3047c3">&#9670;&nbsp;</a></span>predicted_poses_to_predicted_state()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt; carma_perception_msgs::msg::PredictedState &gt; motion_computation::conversion::impl::predicted_poses_to_predicted_state </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; geometry_msgs::msg::Pose &gt; &amp;&#160;</td>
          <td class="paramname"><em>poses</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>constant_velocity</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const rclcpp::Time &amp;&#160;</td>
          <td class="paramname"><em>start_time</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const rclcpp::Duration &amp;&#160;</td>
          <td class="paramname"><em>step_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>frame</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>initial_pose_confidence</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>initial_vel_confidence</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="psm__to__external__object__convertor_8cpp_source.html#l00444">444</a> of file <a class="el" href="psm__to__external__object__convertor_8cpp_source.html">psm_to_external_object_convertor.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  448</span>{</div>
<div class="line"><span class="lineno">  449</span>  std::vector&lt;carma_perception_msgs::msg::PredictedState&gt; output;</div>
<div class="line"><span class="lineno">  450</span>  output.reserve(poses.size());</div>
<div class="line"><span class="lineno">  451</span> </div>
<div class="line"><span class="lineno">  452</span>  rclcpp::Time time(start_time);</div>
<div class="line"><span class="lineno">  453</span> </div>
<div class="line"><span class="lineno">  454</span>  <span class="keywordflow">for</span> (<span class="keyword">auto</span> p : poses) {</div>
<div class="line"><span class="lineno">  455</span>    time += step_size;</div>
<div class="line"><span class="lineno">  456</span>    carma_perception_msgs::msg::PredictedState pred_state;</div>
<div class="line"><span class="lineno">  457</span>    pred_state.header.stamp = time;</div>
<div class="line"><span class="lineno">  458</span>    pred_state.header.frame_id = frame;</div>
<div class="line"><span class="lineno">  459</span> </div>
<div class="line"><span class="lineno">  460</span>    pred_state.predicted_position = p;</div>
<div class="line"><span class="lineno">  461</span>    pred_state.predicted_position_confidence =</div>
<div class="line"><span class="lineno">  462</span>      0.9 * initial_pose_confidence;  <span class="comment">// Reduce confidence by 10 % per timestep</span></div>
<div class="line"><span class="lineno">  463</span>    initial_pose_confidence = pred_state.predicted_position_confidence;</div>
<div class="line"><span class="lineno">  464</span> </div>
<div class="line"><span class="lineno">  465</span>    pred_state.predicted_velocity.linear.x = constant_velocity;</div>
<div class="line"><span class="lineno">  466</span>    pred_state.predicted_velocity_confidence =</div>
<div class="line"><span class="lineno">  467</span>      0.9 * initial_vel_confidence;  <span class="comment">// Reduce confidence by 10 % per</span></div>
<div class="line"><span class="lineno">  468</span>                                     <span class="comment">// timestep</span></div>
<div class="line"><span class="lineno">  469</span>    initial_vel_confidence = pred_state.predicted_velocity_confidence;</div>
<div class="line"><span class="lineno">  470</span> </div>
<div class="line"><span class="lineno">  471</span>    output.push_back(pred_state);</div>
<div class="line"><span class="lineno">  472</span>  }</div>
<div class="line"><span class="lineno">  473</span> </div>
<div class="line"><span class="lineno">  474</span>  <span class="keywordflow">return</span> output;</div>
<div class="line"><span class="lineno">  475</span>}</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="bsm__to__external__object__convertor_8cpp_source.html#l00029">motion_computation::conversion::convert()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacemotion__computation_1_1conversion_1_1impl_a7cf9dd84c4528278ce20562def3047c3_icgraph.png" border="0" usemap="#anamespacemotion__computation_1_1conversion_1_1impl_a7cf9dd84c4528278ce20562def3047c3_icgraph" alt=""/></div>
<map name="anamespacemotion__computation_1_1conversion_1_1impl_a7cf9dd84c4528278ce20562def3047c3_icgraph" id="anamespacemotion__computation_1_1conversion_1_1impl_a7cf9dd84c4528278ce20562def3047c3_icgraph">
<area shape="rect" title=" " alt="" coords="193,5,424,61"/>
<area shape="rect" href="namespacemotion__computation_1_1conversion.html#a9e19fcaf4fb394f34162ae07eab989ad" title=" " alt="" coords="5,13,145,54"/>
</map>
</div>

</div>
</div>
<a id="ae5e3a18881b54fc666c13199ea6c7073" name="ae5e3a18881b54fc666c13199ea6c7073"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae5e3a18881b54fc666c13199ea6c7073">&#9670;&nbsp;</a></span>sample_2d_linear_motion()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt; geometry_msgs::msg::Pose &gt; motion_computation::conversion::impl::sample_2d_linear_motion </td>
          <td>(</td>
          <td class="paramtype">const geometry_msgs::msg::Pose &amp;&#160;</td>
          <td class="paramname"><em>pose</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>velocity</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>period</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>step_size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="psm__to__external__object__convertor_8cpp_source.html#l00293">293</a> of file <a class="el" href="psm__to__external__object__convertor_8cpp_source.html">psm_to_external_object_convertor.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  295</span>{</div>
<div class="line"><span class="lineno">  296</span>  std::vector&lt;geometry_msgs::msg::Pose&gt; output;</div>
<div class="line"><span class="lineno">  297</span>  output.reserve((period / step_size) + 1);</div>
<div class="line"><span class="lineno">  298</span> </div>
<div class="line"><span class="lineno">  299</span>  tf2::Vector3 pose_in_map_translation(pose.position.x, pose.position.y, pose.position.z);</div>
<div class="line"><span class="lineno">  300</span>  tf2::Quaternion pose_in_map_quat(</div>
<div class="line"><span class="lineno">  301</span>    pose.orientation.x, pose.orientation.y, pose.orientation.z, pose.orientation.w);</div>
<div class="line"><span class="lineno">  302</span> </div>
<div class="line"><span class="lineno">  303</span>  tf2::Transform pose_in_map(pose_in_map_quat, pose_in_map_translation);</div>
<div class="line"><span class="lineno">  304</span> </div>
<div class="line"><span class="lineno">  305</span>  <span class="keywordtype">double</span> total_dt = 0;</div>
<div class="line"><span class="lineno">  306</span> </div>
<div class="line"><span class="lineno">  307</span>  <span class="keywordflow">while</span> (total_dt &lt; period) {</div>
<div class="line"><span class="lineno">  308</span>    <span class="comment">// Compute the 2d position and orientation in the Pose frame</span></div>
<div class="line"><span class="lineno">  309</span>    total_dt += step_size;</div>
<div class="line"><span class="lineno">  310</span>    <span class="keywordtype">double</span> dx_from_start = velocity * total_dt;  <span class="comment">// Assuming linear motion in pose frame</span></div>
<div class="line"><span class="lineno">  311</span> </div>
<div class="line"><span class="lineno">  312</span>    <span class="keywordtype">double</span> <a class="code hl_variable" href="namespaceprocess__traj__logs.html#af3ba6144a2d35a4990f1a8d04632a052">x</a> = pose.position.x + dx_from_start;</div>
<div class="line"><span class="lineno">  313</span> </div>
<div class="line"><span class="lineno">  314</span>    tf2::Vector3 position(<a class="code hl_variable" href="namespaceprocess__traj__logs.html#af3ba6144a2d35a4990f1a8d04632a052">x</a>, 0, 0);</div>
<div class="line"><span class="lineno">  315</span> </div>
<div class="line"><span class="lineno">  316</span>    <span class="comment">// Convert the position and orientation in the pose frame to the map frame</span></div>
<div class="line"><span class="lineno">  317</span>    tf2::Transform pose_to_sample(tf2::Quaternion::getIdentity(), position);</div>
<div class="line"><span class="lineno">  318</span>    tf2::Transform map_to_sample = pose_in_map * pose_to_sample;</div>
<div class="line"><span class="lineno">  319</span> </div>
<div class="line"><span class="lineno">  320</span>    geometry_msgs::msg::Pose sample_pose;</div>
<div class="line"><span class="lineno">  321</span> </div>
<div class="line"><span class="lineno">  322</span>    sample_pose.position.x = map_to_sample.getOrigin().x();</div>
<div class="line"><span class="lineno">  323</span>    sample_pose.position.y = map_to_sample.getOrigin().y();</div>
<div class="line"><span class="lineno">  324</span>    sample_pose.position.z = map_to_sample.getOrigin().z();</div>
<div class="line"><span class="lineno">  325</span> </div>
<div class="line"><span class="lineno">  326</span>    sample_pose.orientation.x = map_to_sample.getRotation().x();</div>
<div class="line"><span class="lineno">  327</span>    sample_pose.orientation.y = map_to_sample.getRotation().y();</div>
<div class="line"><span class="lineno">  328</span>    sample_pose.orientation.z = map_to_sample.getRotation().z();</div>
<div class="line"><span class="lineno">  329</span>    sample_pose.orientation.w = map_to_sample.getRotation().w();</div>
<div class="line"><span class="lineno">  330</span> </div>
<div class="line"><span class="lineno">  331</span>    output.emplace_back(sample_pose);</div>
<div class="line"><span class="lineno">  332</span>  }</div>
<div class="line"><span class="lineno">  333</span> </div>
<div class="line"><span class="lineno">  334</span>  <span class="keywordflow">return</span> output;</div>
<div class="line"><span class="lineno">  335</span>}</div>
<div class="ttc" id="anamespaceprocess__traj__logs_html_af3ba6144a2d35a4990f1a8d04632a052"><div class="ttname"><a href="namespaceprocess__traj__logs.html#af3ba6144a2d35a4990f1a8d04632a052">process_traj_logs.x</a></div><div class="ttdeci">x</div><div class="ttdef"><b>Definition:</b> <a href="process__traj__logs_8py_source.html#l00128">process_traj_logs.py:128</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="process__traj__logs_8py_source.html#l00128">process_traj_logs::x</a>.</p>

<p class="reference">Referenced by <a class="el" href="bsm__to__external__object__convertor_8cpp_source.html#l00029">motion_computation::conversion::convert()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacemotion__computation_1_1conversion_1_1impl_ae5e3a18881b54fc666c13199ea6c7073_icgraph.png" border="0" usemap="#anamespacemotion__computation_1_1conversion_1_1impl_ae5e3a18881b54fc666c13199ea6c7073_icgraph" alt=""/></div>
<map name="anamespacemotion__computation_1_1conversion_1_1impl_ae5e3a18881b54fc666c13199ea6c7073_icgraph" id="anamespacemotion__computation_1_1conversion_1_1impl_ae5e3a18881b54fc666c13199ea6c7073_icgraph">
<area shape="rect" title=" " alt="" coords="193,5,363,61"/>
<area shape="rect" href="namespacemotion__computation_1_1conversion.html#a9e19fcaf4fb394f34162ae07eab989ad" title=" " alt="" coords="5,13,145,54"/>
</map>
</div>

</div>
</div>
<a id="a48389a44ecd9e272dbbcdebea32601fb" name="a48389a44ecd9e272dbbcdebea32601fb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a48389a44ecd9e272dbbcdebea32601fb">&#9670;&nbsp;</a></span>sample_2d_path_from_radius()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt; geometry_msgs::msg::Pose &gt; motion_computation::conversion::impl::sample_2d_path_from_radius </td>
          <td>(</td>
          <td class="paramtype">const geometry_msgs::msg::Pose &amp;&#160;</td>
          <td class="paramname"><em>pose</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>velocity</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>radius_of_curvature</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>period</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>step_size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="psm__to__external__object__convertor_8cpp_source.html#l00236">236</a> of file <a class="el" href="psm__to__external__object__convertor_8cpp_source.html">psm_to_external_object_convertor.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  239</span>{</div>
<div class="line"><span class="lineno">  240</span>  std::vector&lt;geometry_msgs::msg::Pose&gt; output;</div>
<div class="line"><span class="lineno">  241</span>  output.reserve((period / step_size) + 1);</div>
<div class="line"><span class="lineno">  242</span> </div>
<div class="line"><span class="lineno">  243</span>  tf2::Vector3 pose_in_map_translation(pose.position.x, pose.position.y, pose.position.z);</div>
<div class="line"><span class="lineno">  244</span>  tf2::Quaternion pose_in_map_quat(</div>
<div class="line"><span class="lineno">  245</span>    pose.orientation.x, pose.orientation.y, pose.orientation.z, pose.orientation.w);</div>
<div class="line"><span class="lineno">  246</span>  tf2::Transform pose_in_map(pose_in_map_quat, pose_in_map_translation);</div>
<div class="line"><span class="lineno">  247</span> </div>
<div class="line"><span class="lineno">  248</span>  <span class="comment">// The radius of curvature originates from the frame of the provided pose</span></div>
<div class="line"><span class="lineno">  249</span>  <span class="comment">// So the turning center is at (0, r)</span></div>
<div class="line"><span class="lineno">  250</span>  <span class="keywordtype">double</span> center_x_in_pose = 0;</div>
<div class="line"><span class="lineno">  251</span>  <span class="keywordtype">double</span> center_y_in_pose = radius_of_curvature;</div>
<div class="line"><span class="lineno">  252</span> </div>
<div class="line"><span class="lineno">  253</span>  <span class="keywordtype">double</span> total_dt = 0;</div>
<div class="line"><span class="lineno">  254</span> </div>
<div class="line"><span class="lineno">  255</span>  <span class="keywordflow">while</span> (total_dt &lt; period) {</div>
<div class="line"><span class="lineno">  256</span>    <span class="comment">// Compute the 2d position and orientation in the Pose frame</span></div>
<div class="line"><span class="lineno">  257</span>    total_dt += step_size;</div>
<div class="line"><span class="lineno">  258</span>    <span class="keywordtype">double</span> delta_arc_length = velocity * total_dt;  <span class="comment">// Assumes perfect point motion along curve</span></div>
<div class="line"><span class="lineno">  259</span> </div>
<div class="line"><span class="lineno">  260</span>    <span class="keywordtype">double</span> turning_angle = delta_arc_length / radius_of_curvature;</div>
<div class="line"><span class="lineno">  261</span>    <span class="keywordtype">double</span> dx_from_center = radius_of_curvature * sin(turning_angle);</div>
<div class="line"><span class="lineno">  262</span>    <span class="keywordtype">double</span> dy_from_center = radius_of_curvature * cos(turning_angle);</div>
<div class="line"><span class="lineno">  263</span> </div>
<div class="line"><span class="lineno">  264</span>    <span class="keywordtype">double</span> <a class="code hl_variable" href="namespaceprocess__traj__logs.html#af3ba6144a2d35a4990f1a8d04632a052">x</a> = center_x_in_pose + dx_from_center;</div>
<div class="line"><span class="lineno">  265</span>    <span class="keywordtype">double</span> <a class="code hl_variable" href="namespaceprocess__traj__logs.html#a05bdb238bfbf3836fb0aa69c5aa1bb48">y</a> = center_y_in_pose + dy_from_center;</div>
<div class="line"><span class="lineno">  266</span> </div>
<div class="line"><span class="lineno">  267</span>    tf2::Vector3 position(<a class="code hl_variable" href="namespaceprocess__traj__logs.html#af3ba6144a2d35a4990f1a8d04632a052">x</a>, <a class="code hl_variable" href="namespaceprocess__traj__logs.html#a05bdb238bfbf3836fb0aa69c5aa1bb48">y</a>, 0);</div>
<div class="line"><span class="lineno">  268</span> </div>
<div class="line"><span class="lineno">  269</span>    tf2::Quaternion quat;</div>
<div class="line"><span class="lineno">  270</span>    quat.setRPY(0, 0, turning_angle);</div>
<div class="line"><span class="lineno">  271</span> </div>
<div class="line"><span class="lineno">  272</span>    <span class="comment">// Convert the position and orientation in the pose frame to the map frame</span></div>
<div class="line"><span class="lineno">  273</span>    tf2::Transform pose_to_sample(quat, position);</div>
<div class="line"><span class="lineno">  274</span>    tf2::Transform map_to_sample = pose_in_map * pose_to_sample;</div>
<div class="line"><span class="lineno">  275</span> </div>
<div class="line"><span class="lineno">  276</span>    geometry_msgs::msg::Pose sample_pose;</div>
<div class="line"><span class="lineno">  277</span> </div>
<div class="line"><span class="lineno">  278</span>    sample_pose.position.x = map_to_sample.getOrigin().x();</div>
<div class="line"><span class="lineno">  279</span>    sample_pose.position.y = map_to_sample.getOrigin().y();</div>
<div class="line"><span class="lineno">  280</span>    sample_pose.position.z = pose.orientation.z;  <span class="comment">// Reuse the z position from the initial pose</span></div>
<div class="line"><span class="lineno">  281</span> </div>
<div class="line"><span class="lineno">  282</span>    sample_pose.orientation.x = map_to_sample.getRotation().x();</div>
<div class="line"><span class="lineno">  283</span>    sample_pose.orientation.y = map_to_sample.getRotation().y();</div>
<div class="line"><span class="lineno">  284</span>    sample_pose.orientation.z = map_to_sample.getRotation().z();</div>
<div class="line"><span class="lineno">  285</span>    sample_pose.orientation.w = map_to_sample.getRotation().w();</div>
<div class="line"><span class="lineno">  286</span> </div>
<div class="line"><span class="lineno">  287</span>    output.emplace_back(sample_pose);</div>
<div class="line"><span class="lineno">  288</span>  }</div>
<div class="line"><span class="lineno">  289</span> </div>
<div class="line"><span class="lineno">  290</span>  <span class="keywordflow">return</span> output;</div>
<div class="line"><span class="lineno">  291</span>}</div>
<div class="ttc" id="anamespaceprocess__traj__logs_html_a05bdb238bfbf3836fb0aa69c5aa1bb48"><div class="ttname"><a href="namespaceprocess__traj__logs.html#a05bdb238bfbf3836fb0aa69c5aa1bb48">process_traj_logs.y</a></div><div class="ttdeci">y</div><div class="ttdef"><b>Definition:</b> <a href="process__traj__logs_8py_source.html#l00129">process_traj_logs.py:129</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="process__traj__logs_8py_source.html#l00128">process_traj_logs::x</a>, and <a class="el" href="process__traj__logs_8py_source.html#l00129">process_traj_logs::y</a>.</p>

<p class="reference">Referenced by <a class="el" href="psm__to__external__object__convertor_8cpp_source.html#l00038">motion_computation::conversion::convert()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacemotion__computation_1_1conversion_1_1impl_a48389a44ecd9e272dbbcdebea32601fb_icgraph.png" border="0" usemap="#anamespacemotion__computation_1_1conversion_1_1impl_a48389a44ecd9e272dbbcdebea32601fb_icgraph" alt=""/></div>
<map name="anamespacemotion__computation_1_1conversion_1_1impl_a48389a44ecd9e272dbbcdebea32601fb_icgraph" id="anamespacemotion__computation_1_1conversion_1_1impl_a48389a44ecd9e272dbbcdebea32601fb_icgraph">
<area shape="rect" title=" " alt="" coords="841,205,1033,261"/>
<area shape="rect" href="namespacemotion__computation_1_1conversion.html#a9884e63460f3d5f5e2b755354984dc29" title=" " alt="" coords="653,213,793,254"/>
<area shape="rect" href="classmotion__computation_1_1MotionComputationWorker.html#a5e3044066ec8779205710e50b90a2c08" title=" " alt="" coords="424,5,605,61"/>
<area shape="rect" href="classgnss__to__map__convertor_1_1GNSSToMapConvertor.html#a3b37a3b059aa5da9f6e6faf1d92627fb" title="GNSS Fix callback which will publish a pose representing that fix in the map frame if the required tr..." alt="" coords="433,245,596,301"/>
<area shape="rect" href="classmotion__computation_1_1MotionComputationWorker.html#ac4b94de8991236d24c73160bfcd85902" title=" " alt="" coords="424,85,605,141"/>
<area shape="rect" href="classmotion__computation_1_1MotionComputationWorker.html#a4d67a9ee5932611188f5b8f9182520f2" title=" " alt="" coords="424,165,605,221"/>
<area shape="rect" href="namespacecarma__wm_1_1geometry.html#a33b80c2f327d0293d7bdb9b4503a1cd5" title="Extract extrinsic roll&#45;pitch&#45;yaw from quaternion." alt="" coords="442,325,587,366"/>
<area shape="rect" href="classcarma__cloud__client_1_1CarmaCloudClient.html#aa9bee7b1b058329f9121ca67e071aa08" title="Funtion to Convert the TCR into XML format." alt="" coords="445,389,584,445"/>
<area shape="rect" href="classmotion__computation_1_1MotionComputationNode.html#a6fef0cbb33460d4d3c9b0c9da36dd76a" title=" " alt="" coords="199,85,370,141"/>
<area shape="rect" href="classgnss__to__map__convertor_1_1Node.html#a0de3641c944433ac709ce9ca395c24b3" title=" " alt="" coords="193,253,376,294"/>
<area shape="rect" href="classcarma__cloud__client_1_1CarmaCloudClient.html#a235e21b0786bc1fd86185f932f8894f5" title="TCR subscription callback." alt="" coords="215,389,354,445"/>
<area shape="rect" href="classcarma__cloud__client_1_1CarmaCloudClient.html#a1813aa46114d0d36cd4de6c56bd1ab35" title=" " alt="" coords="5,389,145,445"/>
</map>
</div>

</div>
</div>
<a id="aa543f123dea7c2e5476ed7e17e25456f" name="aa543f123dea7c2e5476ed7e17e25456f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa543f123dea7c2e5476ed7e17e25456f">&#9670;&nbsp;</a></span>transform_to_map_frame()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">tf2::Vector3 motion_computation::conversion::impl::transform_to_map_frame </td>
          <td>(</td>
          <td class="paramtype">const tf2::Vector3 &amp;&#160;</td>
          <td class="paramname"><em>ecef_point</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const lanelet::projection::LocalFrameProjector &amp;&#160;</td>
          <td class="paramname"><em>map_projector</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Transforms ecef point to map frame using internally saved map transform. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ecef_point</td><td>ecef_point to transform </td></tr>
    <tr><td class="paramname">map_projector</td><td>Projector used for frame conversion </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>point in map </dd></dl>

<p class="definition">Definition at line <a class="el" href="mobility__path__to__external__object_8cpp_source.html#l00253">253</a> of file <a class="el" href="mobility__path__to__external__object_8cpp_source.html">mobility_path_to_external_object.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  255</span>{</div>
<div class="line"><span class="lineno">  256</span>  lanelet::BasicPoint3d map_point = map_projector.projectECEF(</div>
<div class="line"><span class="lineno">  257</span>    {ecef_point.x(), ecef_point.y(), ecef_point.z()},</div>
<div class="line"><span class="lineno">  258</span>    -1);  <span class="comment">// Input should already be converted to m</span></div>
<div class="line"><span class="lineno">  259</span> </div>
<div class="line"><span class="lineno">  260</span>  <span class="keywordflow">return</span> tf2::Vector3(map_point.x(), map_point.y(), map_point.z());</div>
<div class="line"><span class="lineno">  261</span>}</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="mobility__path__to__external__object_8cpp_source.html#l00029">motion_computation::conversion::convert()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacemotion__computation_1_1conversion_1_1impl_aa543f123dea7c2e5476ed7e17e25456f_icgraph.png" border="0" usemap="#anamespacemotion__computation_1_1conversion_1_1impl_aa543f123dea7c2e5476ed7e17e25456f_icgraph" alt=""/></div>
<map name="anamespacemotion__computation_1_1conversion_1_1impl_aa543f123dea7c2e5476ed7e17e25456f_icgraph" id="anamespacemotion__computation_1_1conversion_1_1impl_aa543f123dea7c2e5476ed7e17e25456f_icgraph">
<area shape="rect" title="Transforms ecef point to map frame using internally saved map transform." alt="" coords="193,5,360,61"/>
<area shape="rect" href="namespacemotion__computation_1_1conversion.html#ac015baeed44f7d5fbf23e8a71bb12876" title=" " alt="" coords="5,13,145,54"/>
</map>
</div>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespacemotion__computation.html">motion_computation</a></li><li class="navelem"><a class="el" href="namespacemotion__computation_1_1conversion.html">conversion</a></li><li class="navelem"><a class="el" href="namespacemotion__computation_1_1conversion_1_1impl.html">impl</a></li>
    <li class="footer">Generated on Mon Dec 4 2023 18:10:16 for Carma-platform by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.4 </li>
  </ul>
</div>
</body>
</html>
